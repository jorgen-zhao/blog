(window.webpackJsonp=window.webpackJsonp||[]).push([[288],{638:function(s,t,a){"use strict";a.r(t);var n=a(15),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("在构建大规模流处理应用时，我们常常把注意力放在如何实现业务逻辑、如何优化性能以及如何保证数据一致性上。然而，一个常常被忽视但同样重要的方面是系统的监控与可观测性。没有有效的监控，就像在黑夜中驾驶没有仪表盘的汽车——你不知道速度、油量或者引擎是否过热。")]),s._v(" "),t("p",[s._v('本文将深入探讨Flink的监控与可观测性，介绍如何构建一个全面的监控体系，让你的Flink应用"看得见、听得清、反应快"。')]),s._v(" "),t("h2",{attrs:{id:"为什么flink监控如此重要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么flink监控如此重要"}},[s._v("#")]),s._v(" 为什么Flink监控如此重要？")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("监控不是事后补救，而是事前预防。有效的监控可以让你在问题发生前就发现征兆，在问题发生时快速定位，在问题解决后验证效果。")])]),s._v(" "),t("p",[s._v("在流处理环境中，监控尤为重要，因为：")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("实时性要求高")]),s._v("：流处理应用需要7x24小时不间断运行，任何中断都可能导致数据丢失或业务停滞。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("问题定位困难")]),s._v("：与批处理不同，流处理问题往往难以重现，需要详细的运行时信息来辅助诊断。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("资源消耗波动大")]),s._v("：数据流量可能突然激增，导致资源瓶颈，需要实时监控以自动扩缩容。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("业务影响直接")]),s._v("：流处理结果通常直接面向最终用户，任何延迟或错误都可能直接影响用户体验。")])])]),s._v(" "),t("h2",{attrs:{id:"flink内置监控机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flink内置监控机制"}},[s._v("#")]),s._v(" Flink内置监控机制")]),s._v(" "),t("p",[s._v("Flink本身提供了丰富的监控接口和工具，让我们能够深入了解应用内部运行状态。")]),s._v(" "),t("h3",{attrs:{id:"_1-flink-web-ui"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-flink-web-ui"}},[s._v("#")]),s._v(" 1. Flink Web UI")]),s._v(" "),t("p",[s._v("Flink Web UI是最基础也是最直观的监控工具，它提供了作业运行状态的全方位视图。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动Flink集群后，访问 http://localhost:8081 查看")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Web UI提供了以下关键信息：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("作业概览")]),s._v("：展示作业的基本信息，如状态、启动时间、检查点等。")]),s._v(" "),t("li",[t("strong",[s._v("指标监控")]),s._v("：实时展示各项性能指标，如吞吐量、延迟、背压情况等。")]),s._v(" "),t("li",[t("strong",[s._v("任务详情")]),s._v("：每个子任务的运行状态、资源使用情况和指标数据。")]),s._v(" "),t("li",[t("strong",[s._v("检查点信息")]),s._v("：检查点的创建、大小、耗时等详细信息。")]),s._v(" "),t("li",[t("strong",[s._v("配置信息")]),s._v("：作业的运行时配置参数。")])]),s._v(" "),t("h3",{attrs:{id:"_2-指标系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-指标系统"}},[s._v("#")]),s._v(" 2. 指标系统")]),s._v(" "),t("p",[s._v("Flink提供了强大的指标系统，可以收集和暴露各种运行时指标。")]),s._v(" "),t("h4",{attrs:{id:"核心指标类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#核心指标类型"}},[s._v("#")]),s._v(" 核心指标类型")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Gauge")]),s._v("：瞬时值，如当前队列大小")]),s._v(" "),t("li",[t("strong",[s._v("Counter")]),s._v("：计数器，如处理记录数")]),s._v(" "),t("li",[t("strong",[s._v("Meter")]),s._v("：测量速率，如每秒处理记录数")]),s._v(" "),t("li",[t("strong",[s._v("Histogram")]),s._v("：分布统计，如处理延迟分布")])]),s._v(" "),t("h4",{attrs:{id:"自定义指标示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义指标示例"}},[s._v("#")]),s._v(" 自定义指标示例")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取指标注册表")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MetricGroup")]),s._v(" metrics "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRuntimeContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMetricGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 注册Counter")]),s._v("\nmetrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("counter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"processedRecords"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("inc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 注册Gauge")]),s._v("\nmetrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gauge")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"currentQueueSize"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 注册Meter")]),s._v("\nmetrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("meter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"throughput"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Meter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MeterRegistry")]),s._v(" registry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MeterRegistry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ID")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MetricRegistry")]),s._v(" registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("meter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Meter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"throughput"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"records"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"processed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COUNTER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mark")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mark")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mark")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" amount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mark")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("amount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h3",{attrs:{id:"_3-事件与日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-事件与日志"}},[s._v("#")]),s._v(" 3. 事件与日志")]),s._v(" "),t("p",[s._v("Flink通过事件和日志记录系统的关键操作和异常情况。")]),s._v(" "),t("h4",{attrs:{id:"事件系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事件系统"}},[s._v("#")]),s._v(" 事件系统")]),s._v(" "),t("p",[s._v("Flink的事件系统记录了作业生命周期中的关键事件：")]),s._v(" "),t("ul",[t("li",[s._v("作业启动/停止")]),s._v(" "),t("li",[s._v("检查点开始/完成/失败")]),s._v(" "),t("li",[s._v("任务开始/结束")]),s._v(" "),t("li",[s._v("状态变更")])]),s._v(" "),t("p",[s._v("可以通过"),t("code",[s._v("StreamExecutionEnvironment")]),s._v("配置事件日志：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("enableCheckpointing")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 启用检查点，同时也是事件源")]),s._v("\nenv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setRestartStrategy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RestartStrategies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fixedDelayRestart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"日志配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志配置"}},[s._v("#")]),s._v(" 日志配置")]),s._v(" "),t("p",[s._v("合理的日志配置对于问题排查至关重要：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- log4j.properties 示例 --\x3e")]),s._v("\nlog4j.rootLogger=INFO, stdout\n\n# Flink相关日志\nlog4j.logger.org.apache.flink=INFO\nlog4j.logger.org.apache.flink.streaming=DEBUG\n\n# 控制台输出\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss,SSS} [%t] %-5p %c{1}:%L - %m%n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h2",{attrs:{id:"高级监控方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高级监控方案"}},[s._v("#")]),s._v(" 高级监控方案")]),s._v(" "),t("p",[s._v("虽然Flink提供了基础的监控能力，但在生产环境中，我们通常需要更强大的监控解决方案。")]),s._v(" "),t("h3",{attrs:{id:"_1-prometheus-grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-prometheus-grafana"}},[s._v("#")]),s._v(" 1. Prometheus + Grafana")]),s._v(" "),t("p",[s._v("Prometheus和Grafana是目前业界主流的开源监控解决方案，非常适合Flink监控。")]),s._v(" "),t("h4",{attrs:{id:"集成prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集成prometheus"}},[s._v("#")]),s._v(" 集成Prometheus")]),s._v(" "),t("p",[s._v("Flink提供了Prometheus的metrics reporter，可以将指标暴露给Prometheus：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在代码中配置")]),s._v("\nenv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMetricReporter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("metricsReporter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 或通过flink-conf.yaml配置")]),s._v("\nmetrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reporter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flink"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("metrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("PrometheusReporter")]),s._v("\nmetrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reporter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),s._v("\nmetrics"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reporter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" localhost\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"grafana仪表盘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#grafana仪表盘"}},[s._v("#")]),s._v(" Grafana仪表盘")]),s._v(" "),t("p",[s._v("在Grafana中可以创建丰富的仪表盘，展示Flink的关键指标：")]),s._v(" "),t("ul",[t("li",[s._v("作业吞吐量和延迟趋势")]),s._v(" "),t("li",[s._v("资源使用率（CPU、内存）")]),s._v(" "),t("li",[s._v("背压情况")]),s._v(" "),t("li",[s._v("检查点统计")]),s._v(" "),t("li",[s._v("水位线进展")])]),s._v(" "),t("h3",{attrs:{id:"_2-分布式追踪"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-分布式追踪"}},[s._v("#")]),s._v(" 2. 分布式追踪")]),s._v(" "),t("p",[s._v("对于复杂的流处理管道，分布式追踪可以帮助我们理解请求在系统中的完整路径。")]),s._v(" "),t("h4",{attrs:{id:"jaeger集成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jaeger集成"}},[s._v("#")]),s._v(" Jaeger集成")]),s._v(" "),t("p",[s._v("Flink可以通过OpenTelemetry集成Jaeger：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 添加依赖")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("opentelemetry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("opentelemetry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("extension"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tracing"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("actors"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.12")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dependency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 配置追踪")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setProperty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"otel.exporter.otlp.endpoint"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://jaeger-collector:4317"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setProperty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"otel.service.name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flink-job"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"追踪数据解读"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#追踪数据解读"}},[s._v("#")]),s._v(" 追踪数据解读")]),s._v(" "),t("p",[s._v("分布式追踪数据可以帮助我们：")]),s._v(" "),t("ul",[t("li",[s._v("识别延迟瓶颈")]),s._v(" "),t("li",[s._v("追踪数据在各个算子间的流转")]),s._v(" "),t("li",[s._v("分析异常传播路径")]),s._v(" "),t("li",[s._v("优化数据流拓扑")])]),s._v(" "),t("h3",{attrs:{id:"_3-自定义监控告警"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-自定义监控告警"}},[s._v("#")]),s._v(" 3. 自定义监控告警")]),s._v(" "),t("p",[s._v("监控的最终目的是发现问题并采取行动，因此告警机制至关重要。")]),s._v(" "),t("h4",{attrs:{id:"告警规则示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#告警规则示例"}},[s._v("#")]),s._v(" 告警规则示例")]),s._v(" "),t("p",[s._v("基于Prometheus的告警规则示例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flink_alerts\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" FlinkJobFailed\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' flink_job_status == "FAILED"\n    '),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("severity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" critical\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("summary")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Flink job {{ $labels.jobname }} has failed"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Flink job {{ $labels.jobname }} has been in FAILED state for more than 1 minute."')]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" FlinkBackpressureDetected\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" fllink_task_backpressure_ratio "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" 0.5\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("severity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" warning\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("summary")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Backpressure detected in Flink job {{ $labels.jobname }}"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Task {{ $labels.taskname }} in job {{ $labels.jobname }} has backpressure ratio above 0.5 for 5 minutes."')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h4",{attrs:{id:"告警通知渠道"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#告警通知渠道"}},[s._v("#")]),s._v(" 告警通知渠道")]),s._v(" "),t("p",[s._v("常见的告警通知渠道包括：")]),s._v(" "),t("ul",[t("li",[s._v("邮件")]),s._v(" "),t("li",[s._v("短信")]),s._v(" "),t("li",[s._v("即时通讯工具（Slack、钉钉、企业微信）")]),s._v(" "),t("li",[s._v("PagerDuty等专业的告警管理平台")])]),s._v(" "),t("h2",{attrs:{id:"监控最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控最佳实践"}},[s._v("#")]),s._v(" 监控最佳实践")]),s._v(" "),t("h3",{attrs:{id:"_1-关键指标清单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-关键指标清单"}},[s._v("#")]),s._v(" 1. 关键指标清单")]),s._v(" "),t("p",[s._v("以下是一份Flink作业的关键监控指标清单：")]),s._v(" "),t("h4",{attrs:{id:"整体作业指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#整体作业指标"}},[s._v("#")]),s._v(" 整体作业指标")]),s._v(" "),t("ul",[t("li",[s._v("作业状态（RUNNING/FAILED/CANCELLED等）")]),s._v(" "),t("li",[s._v("吞吐量（records/processed）")]),s._v(" "),t("li",[s._v("处理延迟（latency）")]),s._v(" "),t("li",[s._v("背压情况（backpressure）")])]),s._v(" "),t("h4",{attrs:{id:"资源指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源指标"}},[s._v("#")]),s._v(" 资源指标")]),s._v(" "),t("ul",[t("li",[s._v("CPU使用率")]),s._v(" "),t("li",[s._v("内存使用量")]),s._v(" "),t("li",[s._v("网络IO")]),s._v(" "),t("li",[s._v("磁盘IO")])]),s._v(" "),t("h4",{attrs:{id:"任务级指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#任务级指标"}},[s._v("#")]),s._v(" 任务级指标")]),s._v(" "),t("ul",[t("li",[s._v("子任务状态")]),s._v(" "),t("li",[s._v("并行度")]),s._v(" "),t("li",[s._v("检查点统计（频率、大小、耗时）")]),s._v(" "),t("li",[s._v("水位线（watermark）进展")])]),s._v(" "),t("h3",{attrs:{id:"_2-监控策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-监控策略"}},[s._v("#")]),s._v(" 2. 监控策略")]),s._v(" "),t("h4",{attrs:{id:"多层次监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多层次监控"}},[s._v("#")]),s._v(" 多层次监控")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("基础设施层")]),s._v("：集群资源、网络状况")]),s._v(" "),t("li",[t("strong",[s._v("Flink层")]),s._v("：作业状态、资源分配")]),s._v(" "),t("li",[t("strong",[s._v("应用层")]),s._v("：业务指标、自定义指标")])]),s._v(" "),t("h4",{attrs:{id:"实时与历史结合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实时与历史结合"}},[s._v("#")]),s._v(" 实时与历史结合")]),s._v(" "),t("ul",[t("li",[s._v("实时监控：快速发现异常")]),s._v(" "),t("li",[s._v("历史分析：趋势预测、容量规划")])]),s._v(" "),t("h4",{attrs:{id:"预警与诊断分离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#预警与诊断分离"}},[s._v("#")]),s._v(" 预警与诊断分离")]),s._v(" "),t("ul",[t("li",[s._v("预警系统：关注阈值和异常")]),s._v(" "),t("li",[s._v("诊断系统：提供详细信息和上下文")])]),s._v(" "),t("h3",{attrs:{id:"_3-监控可视化设计原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-监控可视化设计原则"}},[s._v("#")]),s._v(" 3. 监控可视化设计原则")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("聚焦关键指标")]),s._v("：仪表盘应突出显示最重要的指标")]),s._v(" "),t("li",[t("strong",[s._v("层次分明")]),s._v("：从整体到细节，逐层展开")]),s._v(" "),t("li",[t("strong",[s._v("上下文丰富")]),s._v("：提供足够的上下文信息辅助问题定位")]),s._v(" "),t("li",[t("strong",[s._v("可交互")]),s._v("：支持下钻、筛选等操作")])]),s._v(" "),t("h2",{attrs:{id:"实战案例-构建flink监控体系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战案例-构建flink监控体系"}},[s._v("#")]),s._v(" 实战案例：构建Flink监控体系")]),s._v(" "),t("p",[s._v("让我们通过一个实际案例，展示如何构建一个完整的Flink监控体系。")]),s._v(" "),t("h3",{attrs:{id:"架构设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构设计"}},[s._v("#")]),s._v(" 架构设计")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("┌─────────────┐    ┌─────────────┐    ┌─────────────┐\n│   Flink Job │───▶│ Prometheus  │───▶│  Grafana    │\n└─────────────┘    └─────────────┘    └─────────────┘\n       │                   │                   │\n       │                   ▼                   ▼\n       │            ┌─────────────┐    ┌─────────────┐\n       └────────────▶│ Jaeger      │    │ Alertmanager│\n                     └─────────────┘    └─────────────┘\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"实施步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实施步骤"}},[s._v("#")]),s._v(" 实施步骤")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("环境准备")])]),s._v(" "),t("ul",[t("li",[s._v("安装Prometheus")]),s._v(" "),t("li",[s._v("安装Grafana")]),s._v(" "),t("li",[s._v("安装Jaeger")]),s._v(" "),t("li",[s._v("安装Alertmanager")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("Flink配置")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flink-conf.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.prom.class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" org.apache.flink.metrics.prometheus.PrometheusReporter\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.prom.port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics.reporter.prom.interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1min\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用OpenTelemetry追踪")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pipeline.jars")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("///path/to/opentelemetry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("javaagent.jar\npipeline.options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("otel.exporter.otlp.endpoint=http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//jaeger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4317")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("Grafana仪表盘配置")])]),s._v(" "),t("ul",[t("li",[s._v("创建Flink作业概览仪表盘")]),s._v(" "),t("li",[s._v("创建资源使用率仪表盘")]),s._v(" "),t("li",[s._v("创建性能分析仪表盘")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("告警规则配置")])]),s._v(" "),t("ul",[t("li",[s._v("设置作业失败告警")]),s._v(" "),t("li",[s._v("设置背压告警")]),s._v(" "),t("li",[s._v("设置资源使用率告警")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("通知渠道配置")])]),s._v(" "),t("ul",[t("li",[s._v("配置邮件通知")]),s._v(" "),t("li",[s._v("配置Slack通知")]),s._v(" "),t("li",[s._v("配置短信通知（可选）")])])])]),s._v(" "),t("h2",{attrs:{id:"结语"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[s._v("#")]),s._v(" 结语")]),s._v(" "),t("p",[s._v("监控和可观测性是构建健壮流处理系统的关键组成部分。通过Flink内置的监控机制结合外部监控工具，我们可以构建一个全方位的监控体系，实现对流处理应用的全生命周期管理。")]),s._v(" "),t("p",[s._v("记住，"),t("strong",[s._v('好的监控系统应该能告诉你"发生了什么"，而优秀的监控系统还能告诉你"为什么会发生"以及"应该如何解决"')]),s._v("。希望本文能为你的Flink监控体系建设提供有益的参考。")]),s._v(" "),t("blockquote",[t("p",[s._v('"没有测量的东西是无法管理的，没有监控的系统是无法信赖的。" —— 流处理系统建设的黄金法则')])]),s._v(" "),t("hr"),s._v(" "),t("p",[t("strong",[s._v("参考资料")]),s._v("：")]),s._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://nightlies.apache.org/flink/flink-docs-release-1.16/docs/ops/monitoring/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Flink官方文档 - 监控"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://prometheus.io/docs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus官方文档"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://grafana.com/docs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Grafana官方文档"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);