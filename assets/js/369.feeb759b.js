(window.webpackJsonp=window.webpackJsonp||[]).push([[369],{721:function(s,t,a){"use strict";a.r(t);var n=a(15),_=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("在当今高并发的互联网应用中，数据库往往是系统的性能瓶颈。当数据量激增、访问量飙升时，直接查询数据库可能会导致系统响应缓慢甚至崩溃。为了解决这个问题，缓存技术应运而生，成为提升系统性能的关键武器。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("缓存是一种用空间换时间的技术，通过将频繁访问的数据存储在高速存储介质中，减少对数据库的直接访问，从而提高系统响应速度和吞吐量。")])]),s._v(" "),t("p",[s._v("本文将深入探讨数据库缓存的各种策略、实现方式以及需要注意的问题，帮助你构建高性能的数据访问层。")]),s._v(" "),t("h2",{attrs:{id:"缓存的基本概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存的基本概念"}},[s._v("#")]),s._v(" 缓存的基本概念")]),s._v(" "),t("p",[s._v("缓存（Cache）是一种高速数据存储层，它存储了数据副本，并且原始数据存储在 somewhere else（通常是数据库）。当应用程序需要访问数据时，它会首先检查缓存中是否存在该数据，如果存在则直接从缓存中读取，避免了访问较慢的原始数据源。")]),s._v(" "),t("h3",{attrs:{id:"缓存的优势"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存的优势"}},[s._v("#")]),s._v(" 缓存的优势")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("提高响应速度")]),s._v("：内存访问速度远快于磁盘访问，缓存可以显著减少数据获取时间")]),s._v(" "),t("li",[t("strong",[s._v("降低数据库负载")]),s._v("：减少对数据库的直接查询，降低数据库压力")]),s._v(" "),t("li",[t("strong",[s._v("提高系统吞吐量")]),s._v("：缓存可以处理比数据库更高的并发请求")]),s._v(" "),t("li",[t("strong",[s._v("增强系统可用性")]),s._v("：即使数据库暂时不可用，系统仍可能从缓存中提供数据")])]),s._v(" "),t("h3",{attrs:{id:"常见的缓存实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见的缓存实现"}},[s._v("#")]),s._v(" 常见的缓存实现")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("本地缓存")]),s._v("：在应用服务器内存中实现的缓存，如Caffeine、Guava Cache")]),s._v(" "),t("li",[t("strong",[s._v("分布式缓存")]),s._v("：独立于应用服务器的缓存系统，如Redis、Memcached")]),s._v(" "),t("li",[t("strong",[s._v("CDN缓存")]),s._v("：内容分发网络缓存，主要用于静态资源")]),s._v(" "),t("li",[t("strong",[s._v("数据库缓存")]),s._v("：数据库自带的缓存机制，如MySQL的Buffer Pool")])]),s._v(" "),t("h2",{attrs:{id:"缓存策略详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存策略详解"}},[s._v("#")]),s._v(" 缓存策略详解")]),s._v(" "),t("h3",{attrs:{id:"_1-缓存更新策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-缓存更新策略"}},[s._v("#")]),s._v(" 1. 缓存更新策略")]),s._v(" "),t("p",[s._v("缓存更新策略决定了何时以及如何更新缓存中的数据，常见的策略有：")]),s._v(" "),t("h4",{attrs:{id:"_1-1-cache-aside-旁路缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-cache-aside-旁路缓存"}},[s._v("#")]),s._v(" 1.1 Cache-Aside（旁路缓存）")]),s._v(" "),t("p",[s._v("这是最常用的缓存策略，应用程序负责维护缓存和数据库的一致性。")]),s._v(" "),t("p",[t("strong",[s._v("读流程")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("应用程序首先查询缓存")]),s._v(" "),t("li",[s._v("如果缓存命中，直接返回数据")]),s._v(" "),t("li",[s._v("如果缓存未命中，查询数据库")]),s._v(" "),t("li",[s._v("将数据库结果写入缓存")]),s._v(" "),t("li",[s._v("返回数据")])]),s._v(" "),t("p",[t("strong",[s._v("写流程")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("更新数据库")]),s._v(" "),t("li",[s._v("删除缓存中的对应数据")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 伪代码示例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 从缓存获取")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 缓存未命中，从数据库获取")]),s._v("\n    value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("query")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 写入缓存")]),s._v("\n    cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 更新数据库")]),s._v("\n    db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 删除缓存")]),s._v("\n    cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("实现简单，应用程序完全控制缓存逻辑")]),s._v(" "),t("li",[s._v("适用于大多数读多写少的场景")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("需要手动维护缓存和数据库的一致性")]),s._v(" "),t("li",[s._v("在并发场景下可能出现缓存不一致问题")])]),s._v(" "),t("h4",{attrs:{id:"_1-2-read-through-穿透读取"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-read-through-穿透读取"}},[s._v("#")]),s._v(" 1.2 Read-Through（穿透读取）")]),s._v(" "),t("p",[s._v("当缓存未命中时，由缓存系统负责从数据库加载数据，而不是由应用程序完成。")]),s._v(" "),t("p",[t("strong",[s._v("读流程")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("应用程序查询缓存")]),s._v(" "),t("li",[s._v("如果缓存命中，直接返回数据")]),s._v(" "),t("li",[s._v("如果缓存未命中，缓存系统自动从数据库加载数据")]),s._v(" "),t("li",[s._v("将数据存入缓存")]),s._v(" "),t("li",[s._v("返回数据")])]),s._v(" "),t("p",[t("strong",[s._v("写流程")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("应用程序更新数据库")]),s._v(" "),t("li",[s._v("缓存系统在下次读取时自动更新缓存")])]),s._v(" "),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("应用程序代码更简洁，不需要处理缓存未命中的情况")]),s._v(" "),t("li",[s._v("缓存系统可以统一管理缓存加载逻辑")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("需要缓存系统支持Read-Through功能")]),s._v(" "),t("li",[s._v("写操作后缓存不会立即更新")])]),s._v(" "),t("h4",{attrs:{id:"_1-3-write-through-穿透写入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-write-through-穿透写入"}},[s._v("#")]),s._v(" 1.3 Write-Through（穿透写入）")]),s._v(" "),t("p",[s._v("写操作同时更新缓存和数据库，由缓存系统负责保证一致性。")]),s._v(" "),t("p",[t("strong",[s._v("写流程")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("应用程序发起写请求")]),s._v(" "),t("li",[s._v("缓存系统先更新数据库")]),s._v(" "),t("li",[s._v("数据库更新成功后，缓存系统更新缓存")]),s._v(" "),t("li",[s._v("返回操作结果")])]),s._v(" "),t("p",[t("strong",[s._v("读流程")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("应用程序查询缓存")]),s._v(" "),t("li",[s._v("如果缓存命中，直接返回数据")]),s._v(" "),t("li",[s._v("如果缓存未命中，缓存系统从数据库加载数据并返回")])]),s._v(" "),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("保证了缓存和数据库的强一致性")]),s._v(" "),t("li",[s._v("应用程序代码简单")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("写操作延迟较高，需要等待数据库和缓存都更新完成")]),s._v(" "),t("li",[s._v("实现复杂，需要缓存系统支持Write-Through功能")])]),s._v(" "),t("h4",{attrs:{id:"_1-4-write-behind-异步写入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-write-behind-异步写入"}},[s._v("#")]),s._v(" 1.4 Write-Behind（异步写入）")]),s._v(" "),t("p",[s._v("写操作先更新缓存，然后异步更新数据库。")]),s._v(" "),t("p",[t("strong",[s._v("写流程")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("应用程序发起写请求")]),s._v(" "),t("li",[s._v("缓存系统立即更新缓存")]),s._v(" "),t("li",[s._v("返回操作结果")]),s._v(" "),t("li",[s._v("缓存系统异步将变更写入数据库")])]),s._v(" "),t("p",[t("strong",[s._v("读流程")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("应用程序查询缓存")]),s._v(" "),t("li",[s._v("如果缓存命中，直接返回数据")]),s._v(" "),t("li",[s._v("如果缓存未命中，从数据库加载数据")])]),s._v(" "),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("写操作响应速度快，用户体验好")]),s._v(" "),t("li",[s._v("数据库写入压力小，可以批量处理")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("数据可能暂时不一致")]),s._v(" "),t("li",[s._v("实现复杂，需要处理缓存恢复、数据丢失等问题")])]),s._v(" "),t("h3",{attrs:{id:"_2-缓存淘汰策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-缓存淘汰策略"}},[s._v("#")]),s._v(" 2. 缓存淘汰策略")]),s._v(" "),t("p",[s._v("当缓存空间不足时，需要选择合适的淘汰策略来决定哪些数据应该被移除：")]),s._v(" "),t("h4",{attrs:{id:"_2-1-lru-least-recently-used"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-lru-least-recently-used"}},[s._v("#")]),s._v(" 2.1 LRU（Least Recently Used）")]),s._v(" "),t("p",[s._v("最近最少使用策略，淘汰最久未被使用的数据。")]),s._v(" "),t("p",[t("strong",[s._v("适用场景")]),s._v("：数据访问模式有明显的时间局部性，最近访问的数据很可能在近期再次被访问。")]),s._v(" "),t("p",[t("strong",[s._v("实现方式")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("使用哈希表+双向链表实现")]),s._v(" "),t("li",[s._v("哈希表用于快速查找数据")]),s._v(" "),t("li",[s._v("双向链表用于维护访问顺序")])]),s._v(" "),t("h4",{attrs:{id:"_2-2-lfu-least-frequently-used"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-lfu-least-frequently-used"}},[s._v("#")]),s._v(" 2.2 LFU（Least Frequently Used）")]),s._v(" "),t("p",[s._v("最不经常使用策略，淘汰访问频率最低的数据。")]),s._v(" "),t("p",[t("strong",[s._v("适用场景")]),s._v("：数据访问频率差异较大，需要优先保留高频访问数据。")]),s._v(" "),t("p",[t("strong",[s._v("实现方式")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("为每个数据维护访问计数器")]),s._v(" "),t("li",[s._v("淘汰计数器最小的数据")])]),s._v(" "),t("h4",{attrs:{id:"_2-3-fifo-first-in-first-out"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-fifo-first-in-first-out"}},[s._v("#")]),s._v(" 2.3 FIFO（First In First Out）")]),s._v(" "),t("p",[s._v("先进先出策略，淘汰最早进入缓存的数据。")]),s._v(" "),t("p",[t("strong",[s._v("适用场景")]),s._v("：数据访问顺序与进入缓存顺序相关，如时间序列数据。")]),s._v(" "),t("p",[t("strong",[s._v("实现方式")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("使用队列实现，先进入的数据先被淘汰")])]),s._v(" "),t("h4",{attrs:{id:"_2-4-random-随机淘汰"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-random-随机淘汰"}},[s._v("#")]),s._v(" 2.4 Random（随机淘汰）")]),s._v(" "),t("p",[s._v("随机选择数据进行淘汰。")]),s._v(" "),t("p",[t("strong",[s._v("适用场景")]),s._v("：数据访问模式无明显规律，随机淘汰策略简单有效。")]),s._v(" "),t("p",[t("strong",[s._v("实现方式")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("随机选择一个数据进行淘汰")])]),s._v(" "),t("h3",{attrs:{id:"_3-缓存穿透问题及解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-缓存穿透问题及解决方案"}},[s._v("#")]),s._v(" 3. 缓存穿透问题及解决方案")]),s._v(" "),t("h4",{attrs:{id:"_3-1-什么是缓存穿透"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-什么是缓存穿透"}},[s._v("#")]),s._v(" 3.1 什么是缓存穿透")]),s._v(" "),t("p",[s._v("缓存穿透是指查询一个一定不存在的数据，由于缓存中没有，请求会直接打到数据库上，数据库中也没有，所以不会写入缓存。如果大量这种请求，数据库压力会骤增。")]),s._v(" "),t("h4",{attrs:{id:"_3-2-缓存穿透的解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-缓存穿透的解决方案"}},[s._v("#")]),s._v(" 3.2 缓存穿透的解决方案")]),s._v(" "),t("h5",{attrs:{id:"_3-2-1-缓存空值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-缓存空值"}},[s._v("#")]),s._v(" 3.2.1 缓存空值")]),s._v(" "),t("p",[s._v("如果查询数据库发现数据不存在，仍然将这个空结果缓存起来，并设置较短的过期时间。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 从缓存获取")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 缓存未命中，从数据库获取")]),s._v("\n    value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("query")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 如果数据库也没有数据，缓存空值")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NULL"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 缓存空值，60秒过期")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. 写入缓存")]),s._v("\n    cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("简单易实现")]),s._v(" "),t("li",[s._v("防止重复查询数据库")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("需要额外存储空值")]),s._v(" "),t("li",[s._v("如果大量不存在的key，会浪费缓存空间")])]),s._v(" "),t("h5",{attrs:{id:"_3-2-2-布隆过滤器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-布隆过滤器"}},[s._v("#")]),s._v(" 3.2.2 布隆过滤器")]),s._v(" "),t("p",[s._v("布隆过滤器是一种概率型数据结构，可以高效判断一个元素是否在一个集合中。")]),s._v(" "),t("p",[t("strong",[s._v("实现方式")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("使用布隆过滤器存储所有可能查询的key")]),s._v(" "),t("li",[s._v("查询前先检查布隆过滤器")]),s._v(" "),t("li",[s._v("如果布隆过滤器判断key不存在，直接返回")]),s._v(" "),t("li",[s._v("如果布隆过滤器判断key可能存在，再查询缓存和数据库")])]),s._v(" "),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("可以有效防止恶意查询不存在的key")]),s._v(" "),t("li",[s._v("内存占用小")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("存在误判率，可能将不存在的key判断为存在")]),s._v(" "),t("li",[s._v("不支持删除操作（或需要特殊处理）")])]),s._v(" "),t("h3",{attrs:{id:"_4-缓存雪崩问题及解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-缓存雪崩问题及解决方案"}},[s._v("#")]),s._v(" 4. 缓存雪崩问题及解决方案")]),s._v(" "),t("h4",{attrs:{id:"_4-1-什么是缓存雪崩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-什么是缓存雪崩"}},[s._v("#")]),s._v(" 4.1 什么是缓存雪崩")]),s._v(" "),t("p",[s._v("缓存雪崩是指在同一时间大量缓存失效，导致所有请求直接打到数据库上，数据库压力骤增，可能导致数据库崩溃。")]),s._v(" "),t("h4",{attrs:{id:"_4-2-缓存雪崩的解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-缓存雪崩的解决方案"}},[s._v("#")]),s._v(" 4.2 缓存雪崩的解决方案")]),s._v(" "),t("h5",{attrs:{id:"_4-2-1-缓存过期时间添加随机值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-缓存过期时间添加随机值"}},[s._v("#")]),s._v(" 4.2.1 缓存过期时间添加随机值")]),s._v(" "),t("p",[s._v("为不同的缓存key设置不同的过期时间，避免同时失效。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 原过期时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" baseExpireTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1小时")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 添加随机值，如±300秒")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" random "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Math")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("random")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" expireTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" baseExpireTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" random"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ncache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" expireTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("简单易实现")]),s._v(" "),t("li",[s._v("可以有效避免同时失效")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("不能完全避免雪崩，只是分散失效时间")])]),s._v(" "),t("h5",{attrs:{id:"_4-2-2-服务降级与熔断"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-服务降级与熔断"}},[s._v("#")]),s._v(" 4.2.2 服务降级与熔断")]),s._v(" "),t("p",[s._v("当检测到缓存大量失效时，启动服务降级或熔断机制，暂时拒绝部分请求或返回默认值。")]),s._v(" "),t("p",[t("strong",[s._v("实现方式")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("监控缓存命中率")]),s._v(" "),t("li",[s._v("当命中率低于阈值时，触发降级")]),s._v(" "),t("li",[s._v("降级期间，返回默认值或提示用户稍后重试")])]),s._v(" "),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("保护数据库不被压垮")]),s._v(" "),t("li",[s._v("给系统恢复的时间")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("用户体验下降")])]),s._v(" "),t("h5",{attrs:{id:"_4-2-3-缓存预热"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-缓存预热"}},[s._v("#")]),s._v(" 4.2.3 缓存预热")]),s._v(" "),t("p",[s._v("系统启动或低峰期，预先加载热点数据到缓存中。")]),s._v(" "),t("p",[t("strong",[s._v("实现方式")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("分析历史访问数据，识别热点数据")]),s._v(" "),t("li",[s._v("在系统启动时，批量加载这些数据到缓存")]),s._v(" "),t("li",[s._v("定期更新热点数据")])]),s._v(" "),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("避免系统启动时缓存为空")]),s._v(" "),t("li",[s._v("提高系统初始响应速度")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("需要提前识别热点数据")]),s._v(" "),t("li",[s._v("增加了系统启动时间")])]),s._v(" "),t("h3",{attrs:{id:"_5-缓存一致性问题及解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-缓存一致性问题及解决方案"}},[s._v("#")]),s._v(" 5. 缓存一致性问题及解决方案")]),s._v(" "),t("h4",{attrs:{id:"_5-1-什么是缓存一致性问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-什么是缓存一致性问题"}},[s._v("#")]),s._v(" 5.1 什么是缓存一致性问题")]),s._v(" "),t("p",[s._v("在分布式系统中，缓存和数据库的更新可能不是原子的，导致两者数据不一致。")]),s._v(" "),t("h4",{attrs:{id:"_5-2-缓存一致性的解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-缓存一致性的解决方案"}},[s._v("#")]),s._v(" 5.2 缓存一致性的解决方案")]),s._v(" "),t("h5",{attrs:{id:"_5-2-1-延迟双删策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-延迟双删策略"}},[s._v("#")]),s._v(" 5.2.1 延迟双删策略")]),s._v(" "),t("p",[s._v("先删除缓存，更新数据库，再延迟一段时间后再次删除缓存。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 先删除缓存")]),s._v("\n    cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 更新数据库")]),s._v("\n    db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 延迟一段时间后再次删除缓存")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ScheduledExecutorService")]),s._v(" executor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Executors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("newSingleThreadScheduledExecutor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    executor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("schedule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MILLISECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("可以解决大部分并发场景下的不一致问题")]),s._v(" "),t("li",[s._v("实现相对简单")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("延迟时间难以精确控制")]),s._v(" "),t("li",[s._v("不能保证100%一致性")])]),s._v(" "),t("h5",{attrs:{id:"_5-2-2-消息队列保证最终一致性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-2-消息队列保证最终一致性"}},[s._v("#")]),s._v(" 5.2.2 消息队列保证最终一致性")]),s._v(" "),t("p",[s._v("通过消息队列将数据库变更事件通知给缓存服务。")]),s._v(" "),t("p",[t("strong",[s._v("实现方式")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("更新数据库")]),s._v(" "),t("li",[s._v("发送数据库变更消息到消息队列")]),s._v(" "),t("li",[s._v("缓存服务订阅消息队列，更新缓存")])]),s._v(" "),t("p",[t("strong",[s._v("优点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("可以保证最终一致性")]),s._v(" "),t("li",[s._v("系统解耦，扩展性好")])]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("实现复杂")]),s._v(" "),t("li",[s._v("引入了额外的系统组件")])]),s._v(" "),t("h2",{attrs:{id:"缓存架构设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存架构设计"}},[s._v("#")]),s._v(" 缓存架构设计")]),s._v(" "),t("h3",{attrs:{id:"_1-多级缓存架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-多级缓存架构"}},[s._v("#")]),s._v(" 1. 多级缓存架构")]),s._v(" "),t("p",[s._v("在大型系统中，通常会采用多级缓存架构，从内到外依次是：")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("本地缓存")]),s._v("：应用服务器内存中的缓存，速度最快但容量小")]),s._v(" "),t("li",[t("strong",[s._v("分布式缓存")]),s._v("：如Redis，容量较大，速度次之")]),s._v(" "),t("li",[t("strong",[s._v("CDN缓存")]),s._v("：用于静态资源和地理位置分散的数据")])]),s._v(" "),t("h3",{attrs:{id:"_2-缓存分层设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-缓存分层设计"}},[s._v("#")]),s._v(" 2. 缓存分层设计")]),s._v(" "),t("p",[s._v("根据数据访问模式，可以将数据分为不同的层级：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("L1缓存")]),s._v("：高频访问的热点数据，如用户基本信息")]),s._v(" "),t("li",[t("strong",[s._v("L2缓存")]),s._v("：中等频率访问的数据，如商品详情")]),s._v(" "),t("li",[t("strong",[s._v("L3缓存")]),s._v("：低频访问的数据，如历史订单")])]),s._v(" "),t("h3",{attrs:{id:"_3-缓存集群设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-缓存集群设计"}},[s._v("#")]),s._v(" 3. 缓存集群设计")]),s._v(" "),t("p",[s._v("对于大规模系统，缓存也需要集群化部署：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("主从复制")]),s._v("：提高缓存可用性和读取性能")]),s._v(" "),t("li",[t("strong",[s._v("分片策略")]),s._v("：如一致性哈希，将数据分布到多个缓存节点")]),s._v(" "),t("li",[t("strong",[s._v("故障转移")]),s._v("：当主节点故障时，自动切换到备用节点")])]),s._v(" "),t("h2",{attrs:{id:"缓存性能优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存性能优化"}},[s._v("#")]),s._v(" 缓存性能优化")]),s._v(" "),t("h3",{attrs:{id:"_1-缓存序列化优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-缓存序列化优化"}},[s._v("#")]),s._v(" 1. 缓存序列化优化")]),s._v(" "),t("p",[s._v("选择高效的序列化方式，减少内存占用和网络传输时间：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("JSON")]),s._v("：可读性好，但性能较差")]),s._v(" "),t("li",[t("strong",[s._v("Protobuf")]),s._v("：二进制格式，性能好")]),s._v(" "),t("li",[t("strong",[s._v("Kryo")]),s._v("：高性能Java序列化框架")]),s._v(" "),t("li",[t("strong",[s._v("FST")]),s._v("：比Kryo更快的序列化框架")])]),s._v(" "),t("h3",{attrs:{id:"_2-缓存批量操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-缓存批量操作"}},[s._v("#")]),s._v(" 2. 缓存批量操作")]),s._v(" "),t("p",[s._v("使用批量操作减少网络开销：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("批量获取")]),s._v("：使用mget等命令一次获取多个key")]),s._v(" "),t("li",[t("strong",[s._v("批量设置")]),s._v("：使用mset等命令一次设置多个key")])]),s._v(" "),t("h3",{attrs:{id:"_3-缓存分片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-缓存分片"}},[s._v("#")]),s._v(" 3. 缓存分片")]),s._v(" "),t("p",[s._v("对于大数据量的缓存，采用分片策略：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("客户端分片")]),s._v("：由客户端决定key存储在哪个节点")]),s._v(" "),t("li",[t("strong",[s._v("代理分片")]),s._v("：由代理服务（如Twemproxy）负责分片")]),s._v(" "),t("li",[t("strong",[s._v("服务端分片")]),s._v("：由缓存服务自身支持分片（如Redis Cluster）")])]),s._v(" "),t("h2",{attrs:{id:"缓存监控与运维"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存监控与运维"}},[s._v("#")]),s._v(" 缓存监控与运维")]),s._v(" "),t("h3",{attrs:{id:"_1-缓存监控指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-缓存监控指标"}},[s._v("#")]),s._v(" 1. 缓存监控指标")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("命中率")]),s._v("：缓存命中次数/总请求次数")]),s._v(" "),t("li",[t("strong",[s._v("内存使用率")]),s._v("：已使用内存/总内存")]),s._v(" "),t("li",[t("strong",[s._v("慢查询")]),s._v("：执行时间超过阈值的查询")]),s._v(" "),t("li",[t("strong",[s._v("连接数")]),s._v("：当前活跃的连接数")]),s._v(" "),t("li",[t("strong",[s._v("持久化信息")]),s._v("：RDB/AOF的持久化状态")])]),s._v(" "),t("h3",{attrs:{id:"_2-缓存告警"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-缓存告警"}},[s._v("#")]),s._v(" 2. 缓存告警")]),s._v(" "),t("p",[s._v("设置合理的告警阈值：")]),s._v(" "),t("ul",[t("li",[s._v("缓存命中率低于阈值")]),s._v(" "),t("li",[s._v("内存使用率超过阈值")]),s._v(" "),t("li",[s._v("慢查询数量超过阈值")]),s._v(" "),t("li",[s._v("连接数超过阈值")])]),s._v(" "),t("h3",{attrs:{id:"_3-缓存容量规划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-缓存容量规划"}},[s._v("#")]),s._v(" 3. 缓存容量规划")]),s._v(" "),t("p",[s._v("根据业务需求，合理规划缓存容量：")]),s._v(" "),t("ul",[t("li",[s._v("评估数据量和访问模式")]),s._v(" "),t("li",[s._v("考虑数据增长趋势")]),s._v(" "),t("li",[s._v("预留足够的缓冲空间")])]),s._v(" "),t("h2",{attrs:{id:"结语"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[s._v("#")]),s._v(" 结语")]),s._v(" "),t("p",[s._v("缓存是构建高性能系统不可或缺的技术，但缓存的设计和实现并非易事。本文详细介绍了缓存的各种策略、常见问题及解决方案，希望能够帮助你更好地在实际项目中应用缓存技术。")]),s._v(" "),t("div",{staticClass:"custom-block right"},[t("p",[s._v('"没有缓存，就没有高性能的系统。"\n::>')]),s._v(" "),t("p",[s._v("缓存技术的选择和设计需要根据具体业务场景来决定，没有放之四海而皆准的解决方案。在实际应用中，我们需要不断监控、调优和优化缓存策略，以适应不断变化的业务需求。")]),s._v(" "),t("p",[s._v("随着系统规模的扩大，缓存技术也在不断发展，从简单的本地缓存到复杂的分布式缓存系统，再到与云原生结合的缓存解决方案。作为技术人员，我们需要持续学习和探索，才能在系统架构中做出最佳选择。")]),s._v(" "),t("p",[s._v("希望本文能够为你的数据库缓存策略设计提供一些思路和参考，如果你有任何问题或建议，欢迎在评论区交流讨论！")])])])}),[],!1,null,null,null);t.default=_.exports}}]);