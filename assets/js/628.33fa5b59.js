(window.webpackJsonp=window.webpackJsonp||[]).push([[628],{981:function(s,t,a){"use strict";a.r(t);var n=a(15),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("在构建现代Web应用时，实时通信已成为不可或缺的功能。无论是WebSocket、SSE还是gRPC，这些协议为我们的应用带来了前所未有的实时交互能力。然而，随着系统复杂度的增加，如何确保这些实时通信系统的稳定性、快速定位并解决故障，成为了一个挑战。")]),s._v(" "),t("blockquote",[t("p",[s._v('"在实时通信的世界里，看不见的问题往往比可见的问题更致命。"')])]),s._v(" "),t("p",[s._v("今天，我想和大家分享如何为实时通信系统建立完善的监控机制，以及如何高效地排查和解决常见问题。这不仅是一篇技术指南，更是一份实战经验总结。")]),s._v(" "),t("h2",{attrs:{id:"为什么实时通信监控如此重要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么实时通信监控如此重要"}},[s._v("#")]),s._v(" 为什么实时通信监控如此重要？")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("实时通信系统的监控与普通HTTP服务的监控有着本质区别。实时连接的持续性、状态的复杂性以及故障的隐蔽性，都使得监控变得尤为重要。")])]),s._v(" "),t("p",[s._v("与传统的HTTP请求-响应模式不同，实时通信系统具有以下特点：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("长连接特性")]),s._v("：连接可能持续数小时甚至数天")]),s._v(" "),t("li",[t("strong",[s._v("状态复杂性")]),s._v("：连接状态、消息队列、心跳机制等都需要监控")]),s._v(" "),t("li",[t("strong",[s._v("故障隐蔽性")]),s._v("：连接断开可能不会立即被发现")]),s._v(" "),t("li",[t("strong",[s._v("性能敏感性")]),s._v("：延迟和抖动直接影响用户体验")])]),s._v(" "),t("h2",{attrs:{id:"实时通信监控的关键指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实时通信监控的关键指标"}},[s._v("#")]),s._v(" 实时通信监控的关键指标")]),s._v(" "),t("h3",{attrs:{id:"websocket监控指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#websocket监控指标"}},[s._v("#")]),s._v(" WebSocket监控指标")]),s._v(" "),t("p",[s._v("对于WebSocket连接，我们需要关注以下关键指标：")]),s._v(" "),t("h4",{attrs:{id:"连接指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接指标"}},[s._v("#")]),s._v(" 连接指标")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("活跃连接数")]),s._v("：当前活跃的WebSocket连接数量")]),s._v(" "),t("li",[t("strong",[s._v("连接成功率")]),s._v("：成功建立连接的请求数与总请求数的比例")]),s._v(" "),t("li",[t("strong",[s._v("连接断开率")]),s._v("：连接断开的频率和原因分布")]),s._v(" "),t("li",[t("strong",[s._v("平均连接时长")]),s._v("：连接从建立到断开的平均时间")])]),s._v(" "),t("h4",{attrs:{id:"消息指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息指标"}},[s._v("#")]),s._v(" 消息指标")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("消息发送速率")]),s._v("：每秒发送的消息数量")]),s._v(" "),t("li",[t("strong",[s._v("消息接收速率")]),s._v("：每秒接收的消息数量")]),s._v(" "),t("li",[t("strong",[s._v("消息延迟")]),s._v("：从发送到接收的平均时间")]),s._v(" "),t("li",[t("strong",[s._v("消息积压情况")]),s._v("：未处理的消息队列长度")])]),s._v(" "),t("h4",{attrs:{id:"错误指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误指标"}},[s._v("#")]),s._v(" 错误指标")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("错误率")]),s._v("：连接和消息传输过程中的错误比例")]),s._v(" "),t("li",[t("strong",[s._v("错误类型分布")]),s._v("：不同类型错误的占比")]),s._v(" "),t("li",[t("strong",[s._v("重连频率")]),s._v("：客户端尝试重新连接的频率")])]),s._v(" "),t("h3",{attrs:{id:"sse监控指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sse监控指标"}},[s._v("#")]),s._v(" SSE监控指标")]),s._v(" "),t("p",[s._v("SSE作为轻量级的服务器推送技术，其监控重点略有不同：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("活跃订阅数")]),s._v("：当前活跃的SSE连接数量")]),s._v(" "),t("li",[t("strong",[s._v("事件发送速率")]),s._v("：每秒发送的事件数量")]),s._v(" "),t("li",[t("strong",[s._v("客户端断开率")]),s._v("：客户端主动断开连接的比例")]),s._v(" "),t("li",[t("strong",[s._v("事件处理延迟")]),s._v("：从事件生成到客户端接收的时间差")])]),s._v(" "),t("h2",{attrs:{id:"监控工具与实现方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控工具与实现方案"}},[s._v("#")]),s._v(" 监控工具与实现方案")]),s._v(" "),t("h3",{attrs:{id:"prometheus-grafana-监控栈"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-grafana-监控栈"}},[s._v("#")]),s._v(" Prometheus + Grafana 监控栈")]),s._v(" "),t("p",[s._v("Prometheus作为开源监控解决方案，非常适合实时通信系统的监控。")]),s._v(" "),t("h4",{attrs:{id:"prometheus配置示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus配置示例"}},[s._v("#")]),s._v(" Prometheus配置示例")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实时通信监控配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'websocket_metrics'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:8080'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics_path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/metrics'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"自定义指标收集"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义指标收集"}},[s._v("#")]),s._v(" 自定义指标收集")]),s._v(" "),t("p",[s._v("在WebSocket服务中，我们可以这样收集指标：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Node.js示例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prom-client'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建自定义指标")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" websocketConnections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Gauge")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'websocket_active_connections'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("help")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'当前活跃的WebSocket连接数'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" messageLatency "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Histogram")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'websocket_message_latency_seconds'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("help")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'WebSocket消息延迟'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("buckets")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在连接建立时")]),s._v("\nwebsocket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("inc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在消息处理时")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Date"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理消息...")]),s._v("\nmessageLatency"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("observe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Date"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("h3",{attrs:{id:"grafana仪表盘设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#grafana仪表盘设计"}},[s._v("#")]),s._v(" Grafana仪表盘设计")]),s._v(" "),t("p",[s._v("一个完善的实时通信监控仪表盘应包含：")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("连接概览")]),s._v("：显示当前连接数、连接趋势")]),s._v(" "),t("li",[t("strong",[s._v("消息流量")]),s._v("：发送/接收消息的速率图表")]),s._v(" "),t("li",[t("strong",[s._v("延迟监控")]),s._v("：消息延迟的分布和趋势")]),s._v(" "),t("li",[t("strong",[s._v("错误分析")]),s._v("：错误类型和频率的饼图")]),s._v(" "),t("li",[t("strong",[s._v("客户端地理分布")]),s._v("：连接来源的地理热力图")])]),s._v(" "),t("h2",{attrs:{id:"常见故障排查方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见故障排查方法"}},[s._v("#")]),s._v(" 常见故障排查方法")]),s._v(" "),t("h3",{attrs:{id:"websocket连接问题排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#websocket连接问题排查"}},[s._v("#")]),s._v(" WebSocket连接问题排查")]),s._v(" "),t("h4",{attrs:{id:"连接建立失败"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接建立失败"}},[s._v("#")]),s._v(" 连接建立失败")]),s._v(" "),t("p",[t("strong",[s._v("可能原因")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("防火墙阻止")]),s._v(" "),t("li",[s._v("代理服务器不支持WebSocket")]),s._v(" "),t("li",[s._v("服务器资源不足")])]),s._v(" "),t("p",[t("strong",[s._v("排查步骤")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("检查服务器日志是否有连接错误")]),s._v(" "),t("li",[s._v("使用浏览器开发者工具查看WebSocket握手过程")]),s._v(" "),t("li",[s._v("验证代理服务器配置")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 客户端连接测试代码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" ws "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebSocket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ws://example.com/socket'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nws"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onopen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'WebSocket连接已建立'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nws"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onerror")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'WebSocket错误:'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"连接频繁断开"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接频繁断开"}},[s._v("#")]),s._v(" 连接频繁断开")]),s._v(" "),t("p",[t("strong",[s._v("可能原因")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("网络不稳定")]),s._v(" "),t("li",[s._v("服务器负载过高")]),s._v(" "),t("li",[s._v("心跳机制配置不当")])]),s._v(" "),t("p",[t("strong",[s._v("排查方法")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("监控服务器资源使用情况")]),s._v(" "),t("li",[s._v("检查心跳配置是否合理")]),s._v(" "),t("li",[s._v("分析客户端网络环境")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 心跳配置示例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("heartbeat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 30s  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 心跳间隔")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 60s   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 超时时间")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"sse连接问题排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sse连接问题排查"}},[s._v("#")]),s._v(" SSE连接问题排查")]),s._v(" "),t("h4",{attrs:{id:"事件接收延迟"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事件接收延迟"}},[s._v("#")]),s._v(" 事件接收延迟")]),s._v(" "),t("p",[t("strong",[s._v("可能原因")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("服务器处理能力不足")]),s._v(" "),t("li",[s._v("网络带宽限制")]),s._v(" "),t("li",[s._v("客户端处理能力不足")])]),s._v(" "),t("p",[t("strong",[s._v("排查方法")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("检查服务器CPU和内存使用情况")]),s._v(" "),t("li",[s._v("分析网络带宽和延迟")]),s._v(" "),t("li",[s._v("检查客户端事件处理逻辑")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// SSE客户端性能测试")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" eventSource "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventSource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/events'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\neventSource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onmessage")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" performance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理事件...")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" duration "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" performance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token template-string"}},[t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("事件处理耗时: ")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("duration"),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("ms")]),t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"实战案例分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战案例分析"}},[s._v("#")]),s._v(" 实战案例分析")]),s._v(" "),t("h3",{attrs:{id:"案例1-高并发下的websocket连接问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例1-高并发下的websocket连接问题"}},[s._v("#")]),s._v(" 案例1：高并发下的WebSocket连接问题")]),s._v(" "),t("p",[t("strong",[s._v("背景")]),s._v("：某社交应用在大型活动期间，WebSocket连接数激增，导致部分用户连接断开。")]),s._v(" "),t("p",[t("strong",[s._v("监控发现")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("连接数短时间内从5000增长到50000")]),s._v(" "),t("li",[s._v("服务器CPU使用率达到90%")]),s._v(" "),t("li",[s._v("消息处理延迟从50ms增加到2s")])]),s._v(" "),t("p",[t("strong",[s._v("解决方案")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("扩展WebSocket服务器实例")]),s._v(" "),t("li",[s._v("实施连接限流策略")]),s._v(" "),t("li",[s._v("优化消息处理逻辑")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 连接限流示例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" connectionLimiter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RateLimiter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("tokens")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 最大并发连接数")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("interval")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 时间窗口(1分钟)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在连接建立前检查")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("connectionLimiter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTokens")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 拒绝新连接")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"案例2-sse事件积压问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例2-sse事件积压问题"}},[s._v("#")]),s._v(" 案例2：SSE事件积压问题")]),s._v(" "),t("p",[t("strong",[s._v("背景")]),s._v("：新闻推送服务在突发新闻事件时，SSE事件出现积压，导致用户接收延迟。")]),s._v(" "),t("p",[t("strong",[s._v("监控发现")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("事件发送速率峰值达到5000事件/秒")]),s._v(" "),t("li",[s._v("客户端处理能力只有2000事件/秒")]),s._v(" "),t("li",[s._v("事件队列长度持续增长")])]),s._v(" "),t("p",[t("strong",[s._v("解决方案")]),s._v("：")]),s._v(" "),t("ol",[t("li",[s._v("实施事件优先级机制")]),s._v(" "),t("li",[s._v("增加客户端处理能力")]),s._v(" "),t("li",[s._v("优化服务器推送策略")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 事件优先级处理")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" eventQueue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PriorityQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("comparator")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("priority "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("priority\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理事件时优先处理高优先级事件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eventQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" eventQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dequeue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendToClient")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"自动化告警机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自动化告警机制"}},[s._v("#")]),s._v(" 自动化告警机制")]),s._v(" "),t("h3",{attrs:{id:"告警规则设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#告警规则设计"}},[s._v("#")]),s._v(" 告警规则设计")]),s._v(" "),t("p",[s._v("合理的告警规则是及时发现问题的关键：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Prometheus告警规则示例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" realtime_alerts\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" WebSocket连接数异常\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" websocket_active_connections "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" 10000\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("severity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" warning\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("summary")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WebSocket连接数异常高"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"当前连接数: {{ $value }}"')]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" WebSocket消息延迟过高\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" websocket_message_latency_seconds_mean "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" 1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2m\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("severity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" critical\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("summary")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WebSocket消息延迟过高"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"平均延迟: {{ $value }}秒"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h3",{attrs:{id:"多渠道告警"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多渠道告警"}},[s._v("#")]),s._v(" 多渠道告警")]),s._v(" "),t("p",[s._v("为了确保告警及时传达，应建立多渠道告警机制：")]),s._v(" "),t("ul",[t("li",[s._v("邮件通知")]),s._v(" "),t("li",[s._v("即时通讯工具(如Slack、钉钉)")]),s._v(" "),t("li",[s._v("短信通知")]),s._v(" "),t("li",[s._v("电话告警(严重故障)")])]),s._v(" "),t("h2",{attrs:{id:"总结与展望"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结与展望"}},[s._v("#")]),s._v(" 总结与展望")]),s._v(" "),t("p",[s._v("实时通信系统的监控与故障排查是一个持续优化的过程。随着系统复杂度的增加，我们需要不断改进监控策略，提升故障排查效率。")]),s._v(" "),t("blockquote",[t("p",[s._v('"在实时通信的世界里，没有完美的系统，只有不断进化的监控与应对机制。"')])]),s._v(" "),t("p",[s._v("未来，随着AI技术的发展，我们可能会看到智能化的故障预测和自动修复系统。但无论如何，扎实的基础监控和完善的故障排查机制，始终是保障系统稳定性的基石。")]),s._v(" "),t("p",[s._v("希望今天的分享对大家有所帮助。如果你有任何问题或经验想要分享，欢迎在评论区留言交流！")]),s._v(" "),t("div",{staticClass:"custom-block right"},[t("p",[s._v('"监控不是目的，而是手段；排查不是终点，而是起点。"')])])])}),[],!1,null,null,null);t.default=e.exports}}]);