(window.webpackJsonp=window.webpackJsonp||[]).push([[554],{906:function(s,t,a){"use strict";a.r(t);var n=a(15),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"å‰è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[s._v("#")]),s._v(" å‰è¨€")]),s._v(" "),t("p",[s._v("åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°éœ€è¦è·¨æœåŠ¡æ“ä½œçš„åœºæ™¯ï¼šæ¯”å¦‚åˆ›å»ºè®¢å•æ—¶éœ€è¦åŒæ—¶æ‰£å‡åº“å­˜ã€æ”¯ä»˜æ—¶éœ€è¦æ›´æ–°è®¢å•çŠ¶æ€ã€‚"),t("s",[s._v("ä¼ ç»Ÿçš„ä¸¤é˜¶æ®µæäº¤åè®®åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç®€ç›´å°±æ˜¯æ€§èƒ½æ€æ‰‹")]),s._v(" ğŸ¢ã€‚æ¶ˆæ¯é˜Ÿåˆ—çš„äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶æä¾›äº†ä¸€ç§ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢ä¿è¯äº†æ•°æ®ä¸€è‡´æ€§ï¼Œåˆé¿å…äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„å¤æ‚æ€§ã€‚")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("æç¤º")]),s._v(" "),t("p",[s._v('äº‹åŠ¡æ¶ˆæ¯çš„æœ¬è´¨æ˜¯"å¯é æ¶ˆæ¯+æœ¬åœ°äº‹åŠ¡"çš„æ··åˆæ¨¡å¼ï¼Œé€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶çš„çŠ¶æ€æ§åˆ¶æ¥åè°ƒåˆ†å¸ƒå¼æ“ä½œã€‚')])]),s._v(" "),t("h2",{attrs:{id:"ä»€ä¹ˆæ˜¯äº‹åŠ¡æ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯äº‹åŠ¡æ¶ˆæ¯"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯äº‹åŠ¡æ¶ˆæ¯ï¼Ÿ")]),s._v(" "),t("p",[s._v("äº‹åŠ¡æ¶ˆæ¯æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æä¾›çš„ä¸€ç§ç‰¹æ®Šæ¶ˆæ¯ç±»å‹ï¼Œå®ƒå°†æœ¬åœ°äº‹åŠ¡å’Œæ¶ˆæ¯å‘é€ç»‘å®šä¸ºä¸€ä¸ªåŸå­æ“ä½œã€‚å½“æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«çœŸæ­£æŠ•é€’ï¼›å¦‚æœäº‹åŠ¡å¤±è´¥ï¼Œæ¶ˆæ¯ä¼šè¢«å›æ»šï¼Œç¡®ä¿ä¸‹æ¸¸æœåŠ¡ä¸ä¼šæ”¶åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚")]),s._v(" "),t("h3",{attrs:{id:"ä¼ ç»Ÿæ–¹æ¡ˆ-vs-äº‹åŠ¡æ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¼ ç»Ÿæ–¹æ¡ˆ-vs-äº‹åŠ¡æ¶ˆæ¯"}},[s._v("#")]),s._v(" ä¼ ç»Ÿæ–¹æ¡ˆ vs äº‹åŠ¡æ¶ˆæ¯")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("æ–¹æ¡ˆ")]),s._v(" "),t("th",[s._v("ä¸€è‡´æ€§")]),s._v(" "),t("th",[s._v("æ€§èƒ½")]),s._v(" "),t("th",[s._v("å®ç°å¤æ‚åº¦")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("ä¸¤é˜¶æ®µæäº¤(2PC)")]),s._v(" "),t("td",[s._v("å¼ºä¸€è‡´")]),s._v(" "),t("td",[s._v("ä½")]),s._v(" "),t("td",[s._v("é«˜")])]),s._v(" "),t("tr",[t("td",[s._v("TCC")]),s._v(" "),t("td",[s._v("æœ€ç»ˆä¸€è‡´")]),s._v(" "),t("td",[s._v("ä¸­")]),s._v(" "),t("td",[s._v("æé«˜")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("äº‹åŠ¡æ¶ˆæ¯")])]),s._v(" "),t("td",[t("strong",[s._v("æœ€ç»ˆä¸€è‡´")])]),s._v(" "),t("td",[t("strong",[s._v("é«˜")])]),s._v(" "),t("td",[t("strong",[s._v("ä¸­")])])])])]),s._v(" "),t("h2",{attrs:{id:"rocketmqäº‹åŠ¡æ¶ˆæ¯å®æˆ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rocketmqäº‹åŠ¡æ¶ˆæ¯å®æˆ˜"}},[s._v("#")]),s._v(" RocketMQäº‹åŠ¡æ¶ˆæ¯å®æˆ˜")]),s._v(" "),t("h3",{attrs:{id:"æ ¸å¿ƒæµç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ ¸å¿ƒæµç¨‹"}},[s._v("#")]),s._v(" æ ¸å¿ƒæµç¨‹")]),s._v(" "),t("div",{staticClass:"language-mermaid line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-mermaid"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sequenceDiagram")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("participant")]),s._v(" Producer\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("participant")]),s._v(" Broker\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("participant")]),s._v(" Consumer\n    \n    Producer"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("->>")]),s._v("Broker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" å‘é€åŠæ¶ˆæ¯"),t("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(Prepare)")]),s._v("\n    Broker"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e>")]),s._v("Producer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ç¡®è®¤æ¥æ”¶\n    Producer"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("->>")]),s._v("Producer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ‰§è¡Œæœ¬åœ°äº‹åŠ¡\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alt")]),s._v(" æœ¬åœ°äº‹åŠ¡æˆåŠŸ\n        Producer"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("->>")]),s._v("Broker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æäº¤äº‹åŠ¡"),t("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(Commit)")]),s._v("\n        Broker"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("->>")]),s._v("Consumer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æŠ•é€’æ¶ˆæ¯\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" æœ¬åœ°äº‹åŠ¡å¤±è´¥\n        Producer"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("->>")]),s._v("Broker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" å›æ»šäº‹åŠ¡"),t("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(Rollback)")]),s._v("\n        Broker"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e>")]),s._v("Producer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" æ¶ˆæ¯ä¸¢å¼ƒ\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"å®ç°æ­¥éª¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°æ­¥éª¤"}},[s._v("#")]),s._v(" å®ç°æ­¥éª¤")]),s._v(" "),t("h4",{attrs:{id:"_1-å‘é€åŠæ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å‘é€åŠæ¶ˆæ¯"}},[s._v("#")]),s._v(" 1. å‘é€åŠæ¶ˆæ¯")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘é€åŠæ¶ˆæ¯")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionSendResult")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessageInTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ORDER_TOPIC"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order-123"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderTransactionListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order-data"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"_2-å®ç°æœ¬åœ°äº‹åŠ¡ç›‘å¬å™¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å®ç°æœ¬åœ°äº‹åŠ¡ç›‘å¬å™¨"}},[s._v("#")]),s._v(" 2. å®ç°æœ¬åœ°äº‹åŠ¡ç›‘å¬å™¨")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderTransactionListener")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionListener")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("executeLocalTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. æ‰§è¡Œæœ¬åœ°ä¸šåŠ¡é€»è¾‘")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Order")]),s._v(" order "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseOrderData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            orderService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createOrder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. è¿”å›äº‹åŠ¡çŠ¶æ€")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMIT_MESSAGE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLLBACK_MESSAGE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkLocalTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Brokerå›æŸ¥æ¶ˆæ¯çŠ¶æ€")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" orderId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("existsOrder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMIT_MESSAGE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLLBACK_MESSAGE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h4",{attrs:{id:"_3-æ¶ˆè´¹ç«¯å¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ¶ˆè´¹ç«¯å¤„ç†"}},[s._v("#")]),s._v(" 3. æ¶ˆè´¹ç«¯å¤„ç†")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("consumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ORDER_TOPIC"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("registerMessageListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageListenerConcurrently")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msgs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" msgs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†ä¸šåŠ¡é€»è¾‘")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Order")]),s._v(" order "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseOrder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            paymentService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processPayment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CONSUME_SUCCESS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RECONSUME_LATER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h2",{attrs:{id:"å…³é”®æ³¨æ„äº‹é¡¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…³é”®æ³¨æ„äº‹é¡¹"}},[s._v("#")]),s._v(" å…³é”®æ³¨æ„äº‹é¡¹")]),s._v(" "),t("h3",{attrs:{id:"_1-å›æŸ¥æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å›æŸ¥æœºåˆ¶"}},[s._v("#")]),s._v(" 1. å›æŸ¥æœºåˆ¶")]),s._v(" "),t("ul",[t("li",[s._v("Brokerä¼šå®šæœŸå›æŸ¥æœªç¡®å®šçŠ¶æ€çš„æ¶ˆæ¯")]),s._v(" "),t("li",[s._v("éœ€è¦ä¿è¯ä¸šåŠ¡é€»è¾‘çš„å¹‚ç­‰æ€§")]),s._v(" "),t("li",[s._v("å›æŸ¥è¶…æ—¶æ—¶é—´é»˜è®¤15åˆ†é’Ÿï¼ˆå¯é€šè¿‡"),t("code",[s._v("transactionTimeout")]),s._v("é…ç½®ï¼‰")])]),s._v(" "),t("h3",{attrs:{id:"_2-æ­»ä¿¡é˜Ÿåˆ—å¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ­»ä¿¡é˜Ÿåˆ—å¤„ç†"}},[s._v("#")]),s._v(" 2. æ­»ä¿¡é˜Ÿåˆ—å¤„ç†")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é…ç½®æ­»ä¿¡é˜Ÿåˆ—å‚æ•°")]),s._v("\nconsumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConsumeFromWhere")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeFromWhere")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CONSUME_FROM_FIRST_OFFSET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("registerMessageListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageListenerOrderly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msgs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†å¤±è´¥åå‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("failCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        producer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DLQ_TOPIC"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeOrderlyStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMIT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeOrderlyStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SUSPEND_CURRENT_QUEUE_A_MOMENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_3-æ€§èƒ½ä¼˜åŒ–ç‚¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ€§èƒ½ä¼˜åŒ–ç‚¹"}},[s._v("#")]),s._v(" 3. æ€§èƒ½ä¼˜åŒ–ç‚¹")]),s._v(" "),t("ul",[t("li",[s._v("åˆç†è®¾ç½®"),t("code",[s._v("transactionTimeout")]),s._v("é¿å…é•¿æ—¶é—´é˜»å¡")]),s._v(" "),t("li",[s._v("ä½¿ç”¨æ‰¹é‡æ¶ˆæ¯å‡å°‘ç½‘ç»œIO")]),s._v(" "),t("li",[s._v("å¯¹ä¸šåŠ¡å…³é”®æ¶ˆæ¯å¼€å¯"),t("code",[s._v("retryTimesWhenSendFailed")]),s._v("é‡è¯•æœºåˆ¶")])]),s._v(" "),t("h2",{attrs:{id:"é€‚ç”¨åœºæ™¯åˆ†æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é€‚ç”¨åœºæ™¯åˆ†æ"}},[s._v("#")]),s._v(" é€‚ç”¨åœºæ™¯åˆ†æ")]),s._v(" "),t("h3",{attrs:{id:"âœ…-å¼ºçƒˆæ¨èåœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#âœ…-å¼ºçƒˆæ¨èåœºæ™¯"}},[s._v("#")]),s._v(" âœ… å¼ºçƒˆæ¨èåœºæ™¯")]),s._v(" "),t("ul",[t("li",[s._v("è®¢å•åˆ›å»ºä¸åº“å­˜æ‰£å‡")]),s._v(" "),t("li",[s._v("æ”¯ä»˜ä¸è®¢å•çŠ¶æ€å˜æ›´")]),s._v(" "),t("li",[s._v("è·¨ç³»ç»Ÿæ•°æ®åŒæ­¥")])]),s._v(" "),t("h3",{attrs:{id:"âŒ-ä¸é€‚ç”¨åœºæ™¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#âŒ-ä¸é€‚ç”¨åœºæ™¯"}},[s._v("#")]),s._v(" âŒ ä¸é€‚ç”¨åœºæ™¯")]),s._v(" "),t("ul",[t("li",[s._v("å¯¹å®æ—¶æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼ˆå¦‚è‚¡ç¥¨äº¤æ˜“ï¼‰")]),s._v(" "),t("li",[s._v("éœ€è¦å¼ºä¸€è‡´æ€§çš„é‡‘èäº¤æ˜“")]),s._v(" "),t("li",[s._v("å•ä½“åº”ç”¨å†…çš„æ“ä½œ")])]),s._v(" "),t("h2",{attrs:{id:"ç»“è¯­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“è¯­"}},[s._v("#")]),s._v(" ç»“è¯­")]),s._v(" "),t("p",[s._v('äº‹åŠ¡æ¶ˆæ¯ä½œä¸ºåˆ†å¸ƒå¼äº‹åŠ¡çš„"è½»é‡çº§è§£å†³æ–¹æ¡ˆ"ï¼Œåœ¨ä¿è¯ä¸šåŠ¡æœ€ç»ˆä¸€è‡´æ€§çš„åŒæ—¶ï¼Œæä¾›äº†ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°ã€‚é€šè¿‡RocketMQçš„äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»¥è¾ƒä½çš„æˆæœ¬å®ç°è·¨æœåŠ¡çš„å¯é æ“ä½œã€‚')]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("ç»éªŒæ€»ç»“")]),s._v("ï¼šåœ¨å®æ–½äº‹åŠ¡æ¶ˆæ¯æ—¶ï¼Œä¸€å®šè¦åšå¥½å¹‚ç­‰æ€§è®¾è®¡ï¼Œå¹¶åˆç†é…ç½®å›æŸ¥å‚æ•°ã€‚å¯¹äºå…³é”®ä¸šåŠ¡ï¼Œå»ºè®®ç»“åˆæœ¬åœ°äº‹åŠ¡è¡¨è¿›è¡ŒäºŒæ¬¡å…œåº•ã€‚")])]),s._v(" "),t("div",{staticClass:"custom-block right"},[t("p",[s._v('"åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ¬è´¨æ˜¯ç®¡ç†ä¸ç¡®å®šæ€§ï¼Œè€Œäº‹åŠ¡æ¶ˆæ¯æ˜¯æˆ‘ä»¬æ‰‹ä¸­çš„ä¸€å¼ ç¡®å®šæ€§åº•ç‰Œ"')])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code")]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"})])])}),[],!1,null,null,null);t.default=r.exports}}]);