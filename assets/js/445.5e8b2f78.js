(window.webpackJsonp=window.webpackJsonp||[]).push([[445],{795:function(t,s,a){"use strict";a.r(s);var r=a(15),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("在分布式系统领域，CAP理论告诉我们网络分区时必须在一致性和可用性之间做权衡。而BASE理论则为我们提供了最终一致性的解决方案。但当我们真正需要实现强一致性时，就需要具体的一致性协议来支撑。"),s("s",[t._v("Paxos算法虽然经典，但理解门槛太高了")]),t._v("，今天我们来聊聊更友好的Raft算法！")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v('Raft算法由Diego Ongaro和John Ousterhout在2013年提出，其核心目标是"可理解性"。它通过将分布式共识问题分解为领导者选举、日志复制和安全三个部分，大大降低了学习门槛。')])]),t._v(" "),s("h2",{attrs:{id:"raft核心概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#raft核心概念"}},[t._v("#")]),t._v(" Raft核心概念")]),t._v(" "),s("h3",{attrs:{id:"节点角色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#节点角色"}},[t._v("#")]),t._v(" 节点角色")]),t._v(" "),s("p",[t._v("Raft集群中的节点有三种状态：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("领导者(Leader)")]),t._v("：处理所有客户端请求，负责日志复制")]),t._v(" "),s("li",[s("strong",[t._v("跟随者(Follower)")]),t._v("：被动响应，不主动发起请求")]),t._v(" "),s("li",[s("strong",[t._v("候选人(Candidate)")]),t._v("：在选举过程中临时存在的状态")])]),t._v(" "),s("h3",{attrs:{id:"任期-term"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任期-term"}},[t._v("#")]),t._v(" 任期(Term)")]),t._v(" "),s("p",[t._v("Raft将时间划分为连续的任期，每个任期开始时会发起新的选举：")]),t._v(" "),s("div",{staticClass:"language-mermaid line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-mermaid"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" LR\n    A"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[任期开始]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[选举超时]")]),t._v("\n    B "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" C"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("{是否收到投票请求?}")]),t._v("\n    C "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|否|")]),t._v(" D"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[转为候选人]")]),t._v("\n    C "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|是|")]),t._v(" E"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[跟随者]")]),t._v("\n    D "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" F"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[发起投票]")]),t._v("\n    F "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" G"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("{获得多数票?}")]),t._v("\n    G "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|是|")]),t._v(" H"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[成为新Leader]")]),t._v("\n    G "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|否|")]),t._v(" I"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[等待新任期]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("h3",{attrs:{id:"日志复制流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志复制流程"}},[t._v("#")]),t._v(" 日志复制流程")]),t._v(" "),s("p",[t._v("当客户端请求到达领导者时，Raft会：")]),t._v(" "),s("ol",[s("li",[t._v("将操作追加到本地日志")]),t._v(" "),s("li",[t._v("通过"),s("code",[t._v("AppendEntries")]),t._v(" RPC复制到所有跟随者")]),t._v(" "),s("li",[t._v("当大多数节点确认后，提交日志并应用状态机")])]),t._v(" "),s("div",{staticClass:"custom-block theorem"},[s("p",{staticClass:"title"},[t._v("Raft安全性保证")]),s("p",[t._v("在任何任期内，最多只能选举出一个有效的领导者")])]),s("h2",{attrs:{id:"关键机制详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关键机制详解"}},[t._v("#")]),t._v(" 关键机制详解")]),t._v(" "),s("h3",{attrs:{id:"领导者选举"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#领导者选举"}},[t._v("#")]),t._v(" 领导者选举")]),t._v(" "),s("p",[t._v("当节点检测到选举超时（通常150-300ms随机间隔）时：")]),t._v(" "),s("ol",[s("li",[t._v("增加当前任期号")]),t._v(" "),s("li",[t._v("转换为候选人状态")]),t._v(" "),s("li",[t._v("为自己投票")]),t._v(" "),s("li",[t._v("向其他节点发送"),s("code",[t._v("RequestVote")]),t._v(" RPC")])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("关键点")]),t._v("：候选人需要获得集群中大多数节点的投票才能成为领导者。这确保了即使部分节点分区，也不会出现多个领导者。")])]),t._v(" "),s("h3",{attrs:{id:"日志一致性保证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志一致性保证"}},[t._v("#")]),t._v(" 日志一致性保证")]),t._v(" "),s("p",[t._v("Raft通过以下机制确保日志一致性：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("日志匹配原则")]),t._v("：如果两个日志在相同索引位置的日志项和任期号相同，则它们之前的所有日志都相同")]),t._v(" "),s("li",[s("strong",[t._v("领导者唯一性")]),t._v("：领导者永远不会覆盖或删除自己的日志")]),t._v(" "),s("li",[s("strong",[t._v("提交规则")]),t._v("：只有当前任期的日志项被复制到大多数节点后，才会被提交")])]),t._v(" "),s("h3",{attrs:{id:"成员变更"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#成员变更"}},[t._v("#")]),t._v(" 成员变更")]),t._v(" "),s("p",[t._v("Raft使用"),s("strong",[t._v("两阶段提交")]),t._v("实现安全的成员变更：")]),t._v(" "),s("ol",[s("li",[t._v("配置变更日志先以单节点多数派提交")]),t._v(" "),s("li",[t._v("新配置生效后，以新配置多数派提交后续变更")])]),t._v(" "),s("h2",{attrs:{id:"实际应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实际应用场景"}},[t._v("#")]),t._v(" 实际应用场景")]),t._v(" "),s("p",[t._v("Raft算法因其可理解性和可靠性，被广泛应用于：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("etcd")]),t._v("：Kubernetes的底层键值存储")]),t._v(" "),s("li",[s("strong",[t._v("Consul")]),t._v("：HashiCorp的服务发现工具")]),t._v(" "),s("li",[s("strong",[t._v("TiKV")]),t._v("：分布式事务型键值数据库")]),t._v(" "),s("li",[s("strong",[t._v("CockroachDB")]),t._v("：分布式SQL数据库")])]),t._v(" "),s("h2",{attrs:{id:"结语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[t._v("#")]),t._v(" 结语")]),t._v(" "),s("p",[t._v("Raft算法通过将复杂的分布式共识问题分解为清晰可理解的部分，大大降低了分布式系统的开发门槛。它不仅提供了强一致性保证，还通过领导者选举、日志复制等机制实现了容错性。")]),t._v(" "),s("div",{staticClass:"custom-block right"},[s("p",[t._v('"Raft的设计目标是可理解性，而不是性能"'),s("br"),t._v("\n—— Raft论文作者")])]),t._v(" "),s("p",[t._v("在分布式系统设计中，理解一致性协议是构建可靠系统的基石。相比CAP理论这种宏观指导，Raft这样的具体实现方案更能帮助我们解决实际问题。希望今天的分享对你有所帮助！")]),t._v(" "),s("blockquote",[s("p",[t._v("记住：在分布式系统中，没有银弹，只有最适合场景的选择。Raft不是万能的，但它绝对是你的工具箱里最趁手的武器之一！")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code")]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"})])])}),[],!1,null,null,null);s.default=e.exports}}]);