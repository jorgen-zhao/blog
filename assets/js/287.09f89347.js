(window.webpackJsonp=window.webpackJsonp||[]).push([[287],{639:function(t,s,a){"use strict";a.r(s);var n=a(15),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"å‰è¨€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[t._v("#")]),t._v(" å‰è¨€")]),t._v(" "),s("p",[t._v("åœ¨æµå¤„ç†çš„ä¸–ç•Œä¸­ï¼Œæ•°æ®ä¸€è‡´æ€§æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚å½“æˆ‘ä»¬è°ˆè®ºæµå¤„ç†ç³»ç»Ÿçš„å¯é æ€§æ—¶ï¼ŒExactly-Onceè¯­ä¹‰æ— ç–‘æ˜¯è¡¡é‡ä¸€ä¸ªç³»ç»Ÿæˆç†Ÿåº¦çš„é‡è¦æŒ‡æ ‡ã€‚ğŸ—")]),t._v(" "),s("blockquote",[s("p",[t._v("Exactly-Onceè¯­ä¹‰æ„å‘³ç€å³ä½¿ç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œæ¯æ¡æ•°æ®ä¹Ÿåªä¼šè¢«ç²¾ç¡®å¤„ç†ä¸€æ¬¡ï¼Œæ—¢ä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šé‡å¤å¤„ç†ã€‚")])]),t._v(" "),s("p",[t._v("Apache Flinkä½œä¸ºä¸šç•Œé¢†å…ˆçš„æµå¤„ç†å¼•æ“ï¼Œå…¶Exactly-Onceè¯­ä¹‰çš„å®ç°æœºåˆ¶æ˜¯å…¶æ ¸å¿ƒç«äº‰åŠ›ä¹‹ä¸€ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Flinkå¦‚ä½•å®ç°ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰ï¼Œä»¥åŠåœ¨å®é™…åº”ç”¨ä¸­å¦‚ä½•é…ç½®å’Œä¼˜åŒ–è¿™ä¸€ç‰¹æ€§ã€‚")]),t._v(" "),s("h2",{attrs:{id:"exactly-onceçš„é‡è¦æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exactly-onceçš„é‡è¦æ€§"}},[t._v("#")]),t._v(" Exactly-Onceçš„é‡è¦æ€§")]),t._v(" "),s("p",[t._v("åœ¨å¼€å§‹æ·±å…¥æŠ€æœ¯ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç†è§£ä¸ºä»€ä¹ˆExactly-Onceå¦‚æ­¤é‡è¦ï¼š")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("æ•°æ®ä¸€è‡´æ€§")]),t._v("ï¼šç¡®ä¿ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ‰§è¡Œï¼Œé¿å…å› æ•°æ®é‡å¤æˆ–ä¸¢å¤±å¯¼è‡´çš„è®¡ç®—é”™è¯¯")]),t._v(" "),s("li",[s("strong",[t._v("ä¸šåŠ¡å‡†ç¡®æ€§")]),t._v("ï¼šå¯¹äºé‡‘èã€ç”µå•†ç­‰å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼ŒExactly-Onceæ˜¯åˆšéœ€")]),t._v(" "),s("li",[s("strong",[t._v("ç³»ç»Ÿå¯é æ€§")]),t._v("ï¼šæä¾›æ•…éšœæ¢å¤èƒ½åŠ›ï¼ŒåŒæ—¶ä¿è¯æ•°æ®å¤„ç†çš„ç²¾ç¡®æ€§")])]),t._v(" "),s("h2",{attrs:{id:"flinkä¸­çš„exactly-onceå®ç°æœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flinkä¸­çš„exactly-onceå®ç°æœºåˆ¶"}},[t._v("#")]),t._v(" Flinkä¸­çš„Exactly-Onceå®ç°æœºåˆ¶")]),t._v(" "),s("h3",{attrs:{id:"_1-checkpointæœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-checkpointæœºåˆ¶"}},[t._v("#")]),t._v(" 1. Checkpointæœºåˆ¶")]),t._v(" "),s("p",[t._v("Flinkçš„Exactly-Onceè¯­ä¹‰æ ¸å¿ƒä¾èµ–äºå…¶å¼ºå¤§çš„Checkpointæœºåˆ¶ã€‚ğŸ’¡")]),t._v(" "),s("div",{staticClass:"custom-block theorem"},[s("p",{staticClass:"title"},[t._v("THEOREM")]),s("p",[t._v("Checkpointæœºåˆ¶æ˜¯Flinkå®ç°å®¹é”™å’ŒçŠ¶æ€æ¢å¤çš„åŸºç¡€ï¼Œé€šè¿‡å®šæœŸä¿å­˜åˆ†å¸ƒå¼æ•°æ®æµçš„å¿«ç…§ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨æ•…éšœåèƒ½å¤Ÿä»ä¸€è‡´çš„çŠ¶æ€æ¢å¤ã€‚")])]),s("p",[t._v("Checkpointçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("Barrierå¯¹é½")]),t._v("ï¼šFlinkåœ¨æ•°æ®æµä¸­æ’å…¥ç‰¹æ®Šçš„Barrierï¼Œè¿™äº›Barrierä¼šéšç€æ•°æ®ä¸€èµ·æµåŠ¨")]),t._v(" "),s("li",[s("strong",[t._v("çŠ¶æ€å¿«ç…§")]),t._v("ï¼šå½“Operatoræ¥æ”¶åˆ°æ‰€æœ‰Barrieråï¼Œå°†å…¶çŠ¶æ€ä¿å­˜åˆ°æŒä¹…åŒ–å­˜å‚¨")]),t._v(" "),s("li",[s("strong",[t._v("ç¡®è®¤æäº¤")]),t._v("ï¼šå¿«ç…§å®Œæˆåï¼Œå‘JobManagerç¡®è®¤æäº¤")])]),t._v(" "),s("div",{staticClass:"language-mermaid line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-mermaid"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" LR\n    A"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[Source]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|Barrier|")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(Operator 1)")]),t._v("\n    B "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|Barrier|")]),t._v(" C"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(Operator 2)")]),t._v("\n    B "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|Barrier|")]),t._v(" D"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(Operator 3)")]),t._v("\n    C "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|å¿«ç…§|")]),t._v(" E"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[çŠ¶æ€å­˜å‚¨]")]),t._v("\n    D "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|å¿«ç…§|")]),t._v(" E\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("h3",{attrs:{id:"_2-ä¸¤é˜¶æ®µæäº¤åè®®-2pc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ä¸¤é˜¶æ®µæäº¤åè®®-2pc"}},[t._v("#")]),t._v(" 2. ä¸¤é˜¶æ®µæäº¤åè®®(2PC)")]),t._v(" "),s("p",[t._v("å¯¹äºéœ€è¦ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’çš„åœºæ™¯ï¼ŒFlinké€šè¿‡ä¸¤é˜¶æ®µæäº¤åè®®(2PC)æ¥å®ç°ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰ã€‚")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("æç¤º")]),t._v(" "),s("p",[t._v("ç«¯åˆ°ç«¯Exactly-Onceä¸ä»…åŒ…æ‹¬Flinkå†…éƒ¨çš„ç²¾ç¡®ä¸€æ¬¡å¤„ç†ï¼Œè¿˜åŒ…æ‹¬ä¸å¤–éƒ¨ç³»ç»Ÿ(å¦‚Kafkaã€HDFSç­‰)çš„ç²¾ç¡®ä¸€æ¬¡äº¤äº’ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"_2-1-é¢„æäº¤é˜¶æ®µ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-é¢„æäº¤é˜¶æ®µ"}},[t._v("#")]),t._v(" 2.1 é¢„æäº¤é˜¶æ®µ")]),t._v(" "),s("ol",[s("li",[t._v('Flinkå‘æ‰€æœ‰å‚ä¸äº‹åŠ¡çš„å¤–éƒ¨ç³»ç»Ÿå‘é€"é¢„æäº¤"è¯·æ±‚')]),t._v(" "),s("li",[t._v("å¤–éƒ¨ç³»ç»Ÿå‡†å¤‡äº‹åŠ¡ä½†ä¸æäº¤")]),t._v(" "),s("li",[t._v("Flinkä¿å­˜åŒ…å«æ‰€æœ‰é¢„æäº¤ä¿¡æ¯çš„Checkpoint")])]),t._v(" "),s("h4",{attrs:{id:"_2-2-æäº¤é˜¶æ®µ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-æäº¤é˜¶æ®µ"}},[t._v("#")]),t._v(" 2.2 æäº¤é˜¶æ®µ")]),t._v(" "),s("ol",[s("li",[t._v("Checkpointå®Œæˆåï¼ŒFlinké€šçŸ¥æ‰€æœ‰å¤–éƒ¨ç³»ç»Ÿæäº¤äº‹åŠ¡")]),t._v(" "),s("li",[t._v("å¦‚æœç³»ç»Ÿæ¢å¤ï¼ŒFlinkåªä¼šæäº¤å·²æˆåŠŸä¿å­˜çš„Checkpointå¯¹åº”çš„äº‹åŠ¡")])]),t._v(" "),s("h3",{attrs:{id:"_3-kafkaè¿æ¥å™¨çš„exactly-onceæ”¯æŒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-kafkaè¿æ¥å™¨çš„exactly-onceæ”¯æŒ"}},[t._v("#")]),t._v(" 3. Kafkaè¿æ¥å™¨çš„Exactly-Onceæ”¯æŒ")]),t._v(" "),s("p",[t._v("ä½œä¸ºæœ€å¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒKafkaä¸Flinkçš„Exactly-Onceé›†æˆå°¤ä¸ºé‡è¦ï¼š")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),t._v(" properties "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bootstrap.servers"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9092"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"group.id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"flink-exactly-once"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"isolation.level"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"read_committed"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¯»å–å·²æäº¤æ¶ˆæ¯")]),t._v("\nproperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"enable.auto.commit"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç¦ç”¨è‡ªåŠ¨æäº¤")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FlinkKafkaConsumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" kafkaSource "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FlinkKafkaConsumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleStringSchema")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    properties\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nkafkaSource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStartFromLatest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[t._v("å…³é”®é…ç½®ç‚¹ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("isolation.level")]),t._v(": è®¾ç½®ä¸º"),s("code",[t._v("read_committed")]),t._v("ï¼Œåªè¯»å–å·²æäº¤çš„æ¶ˆæ¯")]),t._v(" "),s("li",[s("code",[t._v("enable.auto.commit")]),t._v(": ç¦ç”¨è‡ªåŠ¨æäº¤ï¼Œç”±Flinkæ§åˆ¶æ¶ˆè´¹åç§»é‡")]),t._v(" "),s("li",[t._v("ä½¿ç”¨Kafkaäº‹åŠ¡APIç¡®ä¿æ¶ˆæ¯å†™å…¥å’Œåç§»é‡æ›´æ–°çš„åŸå­æ€§")])]),t._v(" "),s("h2",{attrs:{id:"é…ç½®exactly-onceè¯­ä¹‰"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®exactly-onceè¯­ä¹‰"}},[t._v("#")]),t._v(" é…ç½®Exactly-Onceè¯­ä¹‰")]),t._v(" "),s("h3",{attrs:{id:"_1-å¯ç”¨checkpoint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å¯ç”¨checkpoint"}},[t._v("#")]),t._v(" 1. å¯ç”¨Checkpoint")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StreamExecutionEnvironment")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StreamExecutionEnvironment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getExecutionEnvironment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯ç”¨Checkpointï¼Œæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡")]),t._v("\nenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enableCheckpointing")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®¾ç½®è¯­ä¹‰ä¸ºEXACTLY_ONCE")]),t._v("\nenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCheckpointConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCheckpointingMode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CheckpointingMode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EXACTLY_ONCE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç¡®ä¿Checkpointä¹‹é—´è‡³å°‘æœ‰500msçš„é—´éš”")]),t._v("\nenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCheckpointConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMinPauseBetweenCheckpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Checkpointå¿…é¡»åœ¨10åˆ†é’Ÿå†…å®Œæˆï¼Œå¦åˆ™è¶…æ—¶")]),t._v("\nenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCheckpointConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCheckpointTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("600000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åŒä¸€ä¸ªæ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªCheckpointåœ¨è¿è¡Œ")]),t._v("\nenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCheckpointConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxConcurrentCheckpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¤–éƒ¨æŒä¹…åŒ–å­˜å‚¨è·¯å¾„")]),t._v("\nenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStateBackend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RocksDBStateBackend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file:///path/to/checkpoint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br")])]),s("h3",{attrs:{id:"_2-ä½¿ç”¨æ”¯æŒexactly-onceçš„å¤–éƒ¨ç³»ç»Ÿ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ä½¿ç”¨æ”¯æŒexactly-onceçš„å¤–éƒ¨ç³»ç»Ÿ"}},[t._v("#")]),t._v(" 2. ä½¿ç”¨æ”¯æŒExactly-Onceçš„å¤–éƒ¨ç³»ç»Ÿ")]),t._v(" "),s("p",[t._v("ä¸åŒçš„å¤–éƒ¨ç³»ç»Ÿå¯¹Exactly-Onceçš„æ”¯æŒç¨‹åº¦ä¸åŒï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("å¤–éƒ¨ç³»ç»Ÿ")]),t._v(" "),s("th",[t._v("æ”¯æŒç¨‹åº¦")]),t._v(" "),s("th",[t._v("å®ç°æ–¹å¼")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Kafka")]),t._v(" "),s("td",[t._v("å®Œå…¨æ”¯æŒ")]),t._v(" "),s("td",[t._v("äº‹åŠ¡API + å¹‚ç­‰å†™å…¥")])]),t._v(" "),s("tr",[s("td",[t._v("HDFS")]),t._v(" "),s("td",[t._v("å®Œå…¨æ”¯æŒ")]),t._v(" "),s("td",[t._v("åŸå­é‡å‘½åæ“ä½œ")])]),t._v(" "),s("tr",[s("td",[t._v("Elasticsearch")]),t._v(" "),s("td",[t._v("éƒ¨åˆ†æ”¯æŒ")]),t._v(" "),s("td",[t._v("å¹‚ç­‰å†™å…¥ + å”¯ä¸€é”®")])]),t._v(" "),s("tr",[s("td",[t._v("MySQL")]),t._v(" "),s("td",[t._v("éƒ¨åˆ†æ”¯æŒ")]),t._v(" "),s("td",[t._v("å¹‚ç­‰å†™å…¥")])])])]),t._v(" "),s("h3",{attrs:{id:"_3-å®ç°å¹‚ç­‰å†™å…¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-å®ç°å¹‚ç­‰å†™å…¥"}},[t._v("#")]),t._v(" 3. å®ç°å¹‚ç­‰å†™å…¥")]),t._v(" "),s("p",[t._v("å¯¹äºä¸æ”¯æŒåŸç”Ÿäº‹åŠ¡çš„å¤–éƒ¨ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸šåŠ¡é€»è¾‘å®ç°å¹‚ç­‰å†™å…¥ï¼š")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä½¿ç”¨ä¸šåŠ¡ä¸»é”®ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œé¿å…é‡å¤å†™å…¥")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataStream")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tuple2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nresult"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSink")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RichSinkFunction")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tuple2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("transient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PreparedStatement")]),t._v(" insertStatement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("transient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PreparedStatement")]),t._v(" updateStatement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Configuration")]),t._v(" parameters"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Connection")]),t._v(" connection "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDbConnection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ’å…¥è¯­å¥ï¼ˆä½¿ç”¨ON DUPLICATE KEY UPDATEå®ç°å¹‚ç­‰ï¼‰")]),t._v("\n        insertStatement "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepareStatement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO metrics (metric_key, metric_value) VALUES (?, ?) "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ON DUPLICATE KEY UPDATE metric_value = ?"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tuple2")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ— è®ºæ˜¯å¦å·²å­˜åœ¨ï¼Œæ‰§è¡Œç›¸åŒçš„æ’å…¥æ“ä½œ")]),t._v("\n        insertStatement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        insertStatement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        insertStatement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("f1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        insertStatement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeUpdate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br")])]),s("h2",{attrs:{id:"exactly-onceçš„æ€§èƒ½è€ƒé‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exactly-onceçš„æ€§èƒ½è€ƒé‡"}},[t._v("#")]),t._v(" Exactly-Onceçš„æ€§èƒ½è€ƒé‡")]),t._v(" "),s("p",[t._v("å®ç°Exactly-Onceè¯­ä¹‰é€šå¸¸ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸€è‡´æ€§å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ï¼š")]),t._v(" "),s("h3",{attrs:{id:"_1-checkpointé¢‘ç‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-checkpointé¢‘ç‡"}},[t._v("#")]),t._v(" 1. Checkpointé¢‘ç‡")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("é¢‘ç¹Checkpoint")]),t._v("ï¼šæé«˜æ•°æ®å®‰å…¨æ€§ï¼Œä½†å¢åŠ I/Oå¼€é”€")]),t._v(" "),s("li",[s("strong",[t._v("ç¨€ç–Checkpoint")]),t._v("ï¼šå‡å°‘I/Oå¼€é”€ï¼Œä½†å¢åŠ æ•…éšœæ¢å¤æ—¶çš„æ•°æ®é‡æ”¾é‡")])]),t._v(" "),s("h3",{attrs:{id:"_2-å¼‚æ­¥checkpoint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¼‚æ­¥checkpoint"}},[t._v("#")]),t._v(" 2. å¼‚æ­¥Checkpoint")]),t._v(" "),s("p",[t._v("Flinkæ”¯æŒå¼‚æ­¥Checkpointï¼Œå°†çŠ¶æ€å¿«ç…§ä¸æ•°æ®å¤„ç†åˆ†ç¦»ï¼š")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCheckpointConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCheckpointingMode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CheckpointingMode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EXACTLY_ONCE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCheckpointConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enableUnalignedCheckpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯ç”¨éå¯¹é½Checkpoint")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("éå¯¹é½Checkpointå¯ä»¥å‡å°‘Barrierå¯¹é½å¸¦æ¥çš„å»¶è¿Ÿï¼Œç‰¹åˆ«é€‚åˆå¤„ç†èƒŒå‹ä¸¥é‡çš„åœºæ™¯ã€‚")]),t._v(" "),s("h3",{attrs:{id:"_3-å¢é‡checkpoint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-å¢é‡checkpoint"}},[t._v("#")]),t._v(" 3. å¢é‡Checkpoint")]),t._v(" "),s("p",[t._v("å¯¹äºå¤§è§„æ¨¡çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨å¢é‡Checkpointå‡å°‘å­˜å‚¨ç©ºé—´å’ŒI/Oå¼€é”€ï¼š")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStateBackend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RocksDBStateBackend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file:///path/to/checkpoint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯ç”¨å¢é‡Checkpoint")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"exactly-once-vs-at-least-once"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exactly-once-vs-at-least-once"}},[t._v("#")]),t._v(" Exactly-Once vs At-Least-Once")]),t._v(" "),s("p",[t._v("ç†è§£Exactly-Onceä¸At-Least-Onceçš„åŒºåˆ«å¯¹äºç³»ç»Ÿè®¾è®¡è‡³å…³é‡è¦ï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ç‰¹æ€§")]),t._v(" "),s("th",[t._v("Exactly-Once")]),t._v(" "),s("th",[t._v("At-Least-Once")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("æ•°æ®å¤„ç†")]),t._v(" "),s("td",[t._v("æ¯æ¡æ•°æ®ç²¾ç¡®å¤„ç†ä¸€æ¬¡")]),t._v(" "),s("td",[t._v("æ¯æ¡æ•°æ®è‡³å°‘å¤„ç†ä¸€æ¬¡")])]),t._v(" "),s("tr",[s("td",[t._v("é€‚ç”¨åœºæ™¯")]),t._v(" "),s("td",[t._v("é‡‘èã€äº¤æ˜“ã€è®¡è´¹")]),t._v(" "),s("td",[t._v("æ—¥å¿—åˆ†æã€ç›‘æ§")])]),t._v(" "),s("tr",[s("td",[t._v("å®ç°å¤æ‚åº¦")]),t._v(" "),s("td",[t._v("é«˜")]),t._v(" "),s("td",[t._v("ä½")])]),t._v(" "),s("tr",[s("td",[t._v("æ€§èƒ½å¼€é”€")]),t._v(" "),s("td",[t._v("è¾ƒé«˜")]),t._v(" "),s("td",[t._v("è¾ƒä½")])]),t._v(" "),s("tr",[s("td",[t._v("å¤–éƒ¨ç³»ç»Ÿä¾èµ–")]),t._v(" "),s("td",[t._v("éœ€è¦æ”¯æŒäº‹åŠ¡æˆ–å¹‚ç­‰å†™å…¥")]),t._v(" "),s("td",[t._v("æ— ç‰¹æ®Šè¦æ±‚")])])])]),t._v(" "),s("h2",{attrs:{id:"exactly-onceçš„æœ€ä½³å®è·µ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exactly-onceçš„æœ€ä½³å®è·µ"}},[t._v("#")]),t._v(" Exactly-Onceçš„æœ€ä½³å®è·µ")]),t._v(" "),s("h3",{attrs:{id:"_1-åˆç†è®¾ç½®checkpointé—´éš”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-åˆç†è®¾ç½®checkpointé—´éš”"}},[t._v("#")]),t._v(" 1. åˆç†è®¾ç½®Checkpointé—´éš”")]),t._v(" "),s("p",[t._v("æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’ŒSLAè¦æ±‚ï¼Œé€‰æ‹©åˆé€‚çš„Checkpointé—´éš”ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("é«˜å»¶è¿Ÿå®¹å¿åœºæ™¯ï¼š5-10åˆ†é’Ÿ")]),t._v(" "),s("li",[t._v("ä¸­ç­‰å»¶è¿Ÿå®¹å¿åœºæ™¯ï¼š1-5åˆ†é’Ÿ")]),t._v(" "),s("li",[t._v("ä½å»¶è¿Ÿå®¹å¿åœºæ™¯ï¼š30ç§’-1åˆ†é’Ÿ")])]),t._v(" "),s("h3",{attrs:{id:"_2-ç›‘æ§checkpointæŒ‡æ ‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç›‘æ§checkpointæŒ‡æ ‡"}},[t._v("#")]),t._v(" 2. ç›‘æ§CheckpointæŒ‡æ ‡")]),t._v(" "),s("p",[t._v("å¯†åˆ‡å…³æ³¨ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Checkpointå®Œæˆæ—¶é—´")]),t._v(" "),s("li",[t._v("Checkpointå¤±è´¥ç‡")]),t._v(" "),s("li",[t._v("çŠ¶æ€å¤§å°å˜åŒ–è¶‹åŠ¿")]),t._v(" "),s("li",[t._v("Checkpointå¼•èµ·çš„èƒŒå‹æƒ…å†µ")])]),t._v(" "),s("h3",{attrs:{id:"_3-ä½¿ç”¨å¤–éƒ¨ç³»ç»Ÿçš„äº‹åŠ¡åŠŸèƒ½"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä½¿ç”¨å¤–éƒ¨ç³»ç»Ÿçš„äº‹åŠ¡åŠŸèƒ½"}},[t._v("#")]),t._v(" 3. ä½¿ç”¨å¤–éƒ¨ç³»ç»Ÿçš„äº‹åŠ¡åŠŸèƒ½")]),t._v(" "),s("p",[t._v("å°½å¯èƒ½ä½¿ç”¨å¤–éƒ¨ç³»ç»ŸåŸç”Ÿçš„äº‹åŠ¡æ”¯æŒï¼Œå¦‚Kafkaäº‹åŠ¡ã€HDFSåŸå­æ“ä½œç­‰ã€‚")]),t._v(" "),s("h3",{attrs:{id:"_4-å®ç°å¹‚ç­‰è®¾è®¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-å®ç°å¹‚ç­‰è®¾è®¡"}},[t._v("#")]),t._v(" 4. å®ç°å¹‚ç­‰è®¾è®¡")]),t._v(" "),s("p",[t._v("å¯¹äºä¸æ”¯æŒäº‹åŠ¡çš„å¤–éƒ¨ç³»ç»Ÿï¼Œåœ¨åº”ç”¨å±‚å®ç°å¹‚ç­‰æ“ä½œï¼Œç¡®ä¿é‡å¤å†™å…¥ä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚")]),t._v(" "),s("h2",{attrs:{id:"ç»“è¯­"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç»“è¯­"}},[t._v("#")]),t._v(" ç»“è¯­")]),t._v(" "),s("p",[t._v("Exactly-Onceè¯­ä¹‰æ˜¯æ„å»ºé«˜å¯é æµå¤„ç†åº”ç”¨çš„æ ¸å¿ƒï¼Œå®ƒç¡®ä¿äº†æ•°æ®åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ç²¾ç¡®ä¸€è‡´æ€§ã€‚ğŸ¤”")]),t._v(" "),s("p",[t._v("é€šè¿‡æ·±å…¥ç†è§£Flinkçš„Checkpointæœºåˆ¶ã€ä¸¤é˜¶æ®µæäº¤åè®®ä»¥åŠä¸å¤–éƒ¨ç³»ç»Ÿçš„é›†æˆæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„åŒæ—¶ï¼Œæœ€å¤§é™åº¦åœ°é™ä½æ€§èƒ½å¼€é”€ã€‚")]),t._v(" "),s("p",[t._v("åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯ã€SLAè¦æ±‚å’Œç³»ç»Ÿèµ„æºï¼Œåœ¨Exactly-Onceå’ŒAt-Least-Onceä¹‹é—´åšå‡ºåˆç†é€‰æ‹©ï¼Œå¹¶é€šè¿‡ç›‘æ§å’Œè°ƒä¼˜ä¸æ–­ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v('"åœ¨æµå¤„ç†çš„ä¸–ç•Œä¸­ï¼Œæ²¡æœ‰ç»å¯¹çš„ä¸€è‡´æ€§ï¼Œåªæœ‰é€‚åˆä¸šåŠ¡åœºæ™¯çš„æƒè¡¡ã€‚" â€”â€” æµå¤„ç†å“²å­¦')])]),t._v(" "),s("p",[t._v("é€šè¿‡åˆç†é…ç½®å’Œè®¾è®¡ï¼ŒFlinkèƒ½å¤Ÿä¸ºå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯æä¾›å¯é çš„Exactly-Onceè¯­ä¹‰æ”¯æŒï¼Œæˆä¸ºæ„å»ºä¸‹ä¸€ä»£å®æ—¶æ•°æ®ç®¡é“çš„ç†æƒ³é€‰æ‹©ã€‚")])])}),[],!1,null,null,null);s.default=e.exports}}]);