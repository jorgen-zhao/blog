(window.webpackJsonp=window.webpackJsonp||[]).push([[343],{694:function(s,t,a){"use strict";a.r(t);var n=a(15),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("æŠ€æœ¯æç®€ä¸»ä¹‰ï¼šä¸€åˆ‡çš†ç”¨Postgres")]),s._v(" "),t("h2",{attrs:{id:"å‰è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[s._v("#")]),s._v(" å‰è¨€")]),s._v(" "),t("p",[s._v('åœ¨å½“ä»Šè¿™ä¸ªæŠ€æœ¯æ ˆçˆ†ç‚¸çš„æ—¶ä»£ï¼Œæˆ‘ä»¬å¸¸å¸¸é™·å…¥"è¿‡åº¦å·¥ç¨‹åŒ–"çš„é™·é˜±ï¼šä¸€ä¸ªWebåº”ç”¨éœ€è¦Redisç¼“å­˜ã€MongoDBæ–‡æ¡£å­˜å‚¨ã€Elasticsearchæœç´¢ã€ClickHouseåˆ†æ... '),t("s",[s._v("ç„¶åå‘ç°è¿ç»´å›¢é˜Ÿå·²ç»é›†ä½“è¾èŒäº†")]),s._v("ã€‚ğŸ¤·â€â™‚ï¸")]),s._v(" "),t("p",[s._v('ä¸¤å¹´å‰ï¼Œå½“æˆ‘è´Ÿè´£é‡æ„å…¬å¸æ ¸å¿ƒç³»ç»Ÿæ—¶ï¼Œæˆ‘å†³å®šæ‹¥æŠ±ä¸€ä¸ª"åæ‰§"çš„ç†å¿µï¼š'),t("strong",[s._v("ä¸€åˆ‡çš†ç”¨Postgres")]),s._v('ã€‚è¿™ä¸ªçœ‹ä¼¼æç«¯çš„é€‰æ‹©ï¼Œå´æ„å¤–åœ°å¸¦æ¥äº†æƒŠäººçš„å·¥ç¨‹æ•ˆç‡æå‡ã€‚ä»Šå¤©æƒ³èŠèŠè¿™ä¸ª"æ•°æ®åº“ç‹¬è£ä¸»ä¹‰"èƒŒåçš„æ€è€ƒä¸å®è·µã€‚')]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("æç¤º")]),s._v(" "),t("p",[s._v('"æœ€å¥½çš„æŠ€æœ¯æ˜¯è®©ä½ æ„Ÿè§‰ä¸åˆ°æŠ€æœ¯çš„æŠ€æœ¯"'),t("br"),s._v("\nâ€”â€”PostgreSQLç¤¾åŒºéšå£«")])]),s._v(" "),t("h2",{attrs:{id:"ä¸ºä»€ä¹ˆæ˜¯postgres"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆæ˜¯postgres"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆæ˜¯Postgresï¼Ÿ")]),s._v(" "),t("h3",{attrs:{id:"_1-åŠŸèƒ½çš„ç‘å£«å†›åˆ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŠŸèƒ½çš„ç‘å£«å†›åˆ€"}},[s._v("#")]),s._v(" 1. åŠŸèƒ½çš„ç‘å£«å†›åˆ€")]),s._v(" "),t("p",[s._v("PostgreSQLçš„å¼ºå¤§å¸¸å¸¸è¢«ä½ä¼°ï¼Œå®ƒæ—©å·²ä¸æ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼š")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- JSONBåŸç”Ÿæ”¯æŒï¼ˆå¸¦ç´¢å¼•ï¼ï¼‰")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" products "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" attributes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'color'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'red'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- å…¨æ–‡æœç´¢æ— éœ€é¢å¤–ç»„ä»¶")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" to_tsvector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'english'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'The quick brown fox'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" @@ to_tsquery"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'english'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fox & quick'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- æ•°ç»„ç±»å‹åŸç”Ÿæ”¯æŒ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" users "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" interests "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ARRAY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hiking'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'coding'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"_2-æ‰©å±•æ€§ç”Ÿæ€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ‰©å±•æ€§ç”Ÿæ€"}},[s._v("#")]),s._v(" 2. æ‰©å±•æ€§ç”Ÿæ€")]),s._v(" "),t("p",[s._v("é€šè¿‡æ‰©å±•ï¼ŒPostgresèƒ½å˜èº«å¤šç§æ•°æ®åº“ï¼š")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("æ‰©å±•åç§°")]),s._v(" "),t("th",[s._v("åŠŸèƒ½")]),s._v(" "),t("th",[s._v("é€‚ç”¨åœºæ™¯")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("TimescaleDB")]),s._v(" "),t("td",[s._v("æ—¶åºæ•°æ®åº“")]),s._v(" "),t("td",[s._v("ç‰©è”ç½‘ç›‘æ§")])]),s._v(" "),t("tr",[t("td",[s._v("PostGIS")]),s._v(" "),t("td",[s._v("ç©ºé—´æ•°æ®åº“")]),s._v(" "),t("td",[s._v("åœ°ç†ä¿¡æ¯ç³»ç»Ÿ")])]),s._v(" "),t("tr",[t("td",[s._v("pg_graphql")]),s._v(" "),t("td",[s._v("GraphQLæ¥å£")]),s._v(" "),t("td",[s._v("APIå¿«é€Ÿå¼€å‘")])]),s._v(" "),t("tr",[t("td",[s._v("pgvector")]),s._v(" "),t("td",[s._v("å‘é‡æ•°æ®åº“")]),s._v(" "),t("td",[s._v("AIè¯­ä¹‰æœç´¢")])])])]),s._v(" "),t("h3",{attrs:{id:"_3-äº‹åŠ¡çš„åšå¦‚ç£çŸ³"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-äº‹åŠ¡çš„åšå¦‚ç£çŸ³"}},[s._v("#")]),s._v(" 3. äº‹åŠ¡çš„åšå¦‚ç£çŸ³")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®æµ‹ï¼š10ä¸‡çº§å¹¶å‘å†™å…¥çš„äº‹åŠ¡ä¸€è‡´æ€§")]),s._v("\n$ pgbench "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ååé‡: 45,234 tps")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é›¶æ•°æ®ä¸ä¸€è‡´æŠ¥å‘Š ğŸ¯")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"å®æˆ˜åœºæ™¯-ç»Ÿä¸€æ¶æ„è®¾è®¡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®æˆ˜åœºæ™¯-ç»Ÿä¸€æ¶æ„è®¾è®¡"}},[s._v("#")]),s._v(" å®æˆ˜åœºæ™¯ï¼šç»Ÿä¸€æ¶æ„è®¾è®¡")]),s._v(" "),t("h3",{attrs:{id:"webåº”ç”¨-ç¼“å­˜å±‚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webåº”ç”¨-ç¼“å­˜å±‚"}},[s._v("#")]),s._v(" Webåº”ç”¨ + ç¼“å­˜å±‚")]),s._v(" "),t("p",[s._v("ä¼ ç»Ÿæ¶æ„ï¼š")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("App â†’ Redis â†’ MySQL\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("æç®€æ¶æ„ï¼š")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ä½¿ç”¨pg_cronå®ç°è‡ªåŠ¨ç¼“å­˜")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" EXTENSION pg_cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLACE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FUNCTION")]),s._v(" refresh_cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURNS")]),s._v(" void "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" $$\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" cache_table "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" jsonb_build_object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cache_time'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NOW")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" products\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" CONFLICT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" EXCLUDED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n$$ "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LANGUAGE")]),s._v(" plpgsql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- æ¯å°æ—¶è‡ªåŠ¨æ‰§è¡Œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("schedule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0 * * * *'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" refresh_cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"å®æ—¶åˆ†æç³»ç»Ÿ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®æ—¶åˆ†æç³»ç»Ÿ"}},[s._v("#")]),s._v(" å®æ—¶åˆ†æç³»ç»Ÿ")]),s._v(" "),t("p",[s._v("ä¼ ç»Ÿæ–¹æ¡ˆéœ€è¦Kafka + Spark + ClickHouseï¼Œç°åœ¨ï¼š")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ä½¿ç”¨LISTEN/NOTIFYå®ç°äº‹ä»¶æµ")]),s._v("\nLISTEN user_events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- è§¦å‘å™¨æ•è·å˜æ›´")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" user_activity\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AFTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" users\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR EACH ROW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FUNCTION")]),s._v(" pg_notify"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_events'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  jsonb_build_object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NEW"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'event'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CASE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHEN")]),s._v(" NEW"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("last_login "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" OLD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("last_login "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'login'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ELSE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ts'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NOW")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- æ¶ˆè´¹ç«¯å®æ—¶èšåˆ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pg_notify_channel_stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_events'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" event_time "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NOW")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTERVAL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1 hour'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"æ–‡æ¡£å­˜å‚¨æ›¿ä»£æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ–‡æ¡£å­˜å‚¨æ›¿ä»£æ–¹æ¡ˆ"}},[s._v("#")]),s._v(" æ–‡æ¡£å­˜å‚¨æ›¿ä»£æ–¹æ¡ˆ")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- æ›¿ä»£MongoDBçš„æ–‡æ¡£å­˜å‚¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" documents "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SERIAL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  content JSONB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  metadata JSONB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  created_at TIMESTAMPTZ "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NOW")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- åŸå­æ“ä½œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" documents \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" content "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" content "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"tags": ["tech"]}\'')]),s._v("::jsonb\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"æç®€ä¸»ä¹‰çš„é™·é˜±"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æç®€ä¸»ä¹‰çš„é™·é˜±"}},[s._v("#")]),s._v(" æç®€ä¸»ä¹‰çš„é™·é˜±")]),s._v(" "),t("p",[s._v('å½“ç„¶ï¼Œ"ä¸€åˆ‡çš†ç”¨Postgres"ä¸æ˜¯é“¶å¼¹ï¼Œæˆ‘è¸©è¿‡çš„å‘ï¼š')]),s._v(" "),t("h3",{attrs:{id:"æ€§èƒ½è¾¹ç•Œ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€§èƒ½è¾¹ç•Œ"}},[s._v("#")]),s._v(" æ€§èƒ½è¾¹ç•Œ")]),s._v(" "),t("ul",[t("li",[s._v("å¤§è¡¨å…¨è¡¨æ‰«æï¼ˆ>5000ä¸‡è¡Œï¼‰æ—¶ä»éœ€åˆ†åŒº")]),s._v(" "),t("li",[s._v("å¤æ‚OLAPæŸ¥è¯¢å¯èƒ½éœ€è¦åˆ—å¼å­˜å‚¨")])]),s._v(" "),t("h3",{attrs:{id:"è¿ç§»æˆæœ¬"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¿ç§»æˆæœ¬"}},[s._v("#")]),s._v(" è¿ç§»æˆæœ¬")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä»MongoDBè¿ç§»çš„å™©æ¢¦")]),s._v("\n$ mongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--db")]),s._v(" myapp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--collection")]),s._v(" logs\n$ psql "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CREATE EXTENSION mongo_fdw;"')]),s._v("\n$ psql "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"CREATE SERVER mongo_server FOREIGN DATA WRAPPER mongo_fdw OPTIONS (address 'mongo:27017', dbname 'myapp');\"")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"å›¢é˜Ÿè®¤çŸ¥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å›¢é˜Ÿè®¤çŸ¥"}},[s._v("#")]),s._v(" å›¢é˜Ÿè®¤çŸ¥")]),s._v(" "),t("p",[s._v('å¼€å‘å›¢é˜Ÿéœ€è¦ç†è§£å…³ç³»æ¨¡å‹å’ŒJSONBçš„æœ€ä½³å®è·µï¼Œè¿™æ¯”"NoSQLéšä¾¿å­˜"è¦æ±‚æ›´é«˜ã€‚')]),s._v(" "),t("h2",{attrs:{id:"ç»“è¯­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“è¯­"}},[s._v("#")]),s._v(" ç»“è¯­")]),s._v(" "),t("p",[s._v("ç»è¿‡ä¸¤å¹´çš„å®è·µï¼Œæˆ‘ä»¬çš„æŠ€æœ¯æ ˆä»7ä¸ªæ•°æ®åº“ç»„ä»¶ç¼©å‡åˆ°Postgres + 1ä¸ªç¼“å­˜å±‚ï¼ˆå…¶å®è¿˜æ˜¯PostgreSQLçš„è¡¨ç©ºé—´ï¼‰ã€‚è¿ç»´å¤æ‚åº¦ä¸‹é™äº†70%ï¼Œæ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦æå‡äº†3å€ã€‚ğŸš€")]),s._v(" "),t("blockquote",[t("p",[s._v('æŠ€æœ¯é€‰å‹çš„ç»ˆæç›®æ ‡ä¸æ˜¯ç‚«æŠ€ï¼Œè€Œæ˜¯è®©å›¢é˜Ÿä¸“æ³¨äºä¸šåŠ¡åˆ›æ–°ã€‚Postgresçš„"å…¨èƒ½é€‰æ‰‹"ç‰¹æ€§ï¼Œæ°æ°æ»¡è¶³äº†ç°ä»£åº”ç”¨å¯¹æ•°æ®å­˜å‚¨çš„å¤åˆéœ€æ±‚ã€‚')])]),s._v(" "),t("p",[s._v("å½“ç„¶ï¼Œæˆ‘å¹¶ä¸é¼“å¹ç›²ç›®ä½¿ç”¨Postgresâ€”â€”å½“ä½ çš„éœ€æ±‚æ˜ç¡®æ˜¯æ—¶åºæ•°æ®åº“æˆ–å›¾æ•°æ®åº“æ—¶ï¼Œä¸“ç”¨å·¥å…·ä»æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä½†åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼ŒPostgresçš„çµæ´»æ€§å’Œå¯é æ€§è¶³ä»¥èƒœä»»ã€‚ğŸ†")]),s._v(" "),t("div",{staticClass:"custom-block right"},[t("p",[s._v('"å½“ä½ åªæœ‰ä¸€ä¸ªé”¤å­æ—¶ï¼Œæ‰€æœ‰é—®é¢˜éƒ½åƒé’‰å­"'),t("br"),s._v("\nâ€”â€”ä½†è‡³å°‘è¿™ä¸ªé”¤å­èƒ½ä¿®é£æœºå¼•æ“ï¼")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code")]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"})])])}),[],!1,null,null,null);t.default=e.exports}}]);