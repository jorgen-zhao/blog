(window.webpackJsonp=window.webpackJsonp||[]).push([[444],{794:function(t,a,s){"use strict";s.r(a);var r=s(15),e=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v('在分布式系统的世界里，数据一致性就像"薛定谔的猫"一样令人着迷 🤔。我们之前聊过CAP理论和BASE原则，它们告诉我们"一致性"是多么珍贵又难以捉摸的资源。但理论终究是理论，实际系统中我们到底该如何保证多个节点数据的一致性呢？今天我们就来聊聊分布式系统中的"一致性协议"这个硬核话题！')]),t._v(" "),a("blockquote",[a("p",[t._v("💡 "),a("strong",[t._v("一致性协议")]),t._v('：分布式系统中用于在多个节点间达成共识的算法集合，是分布式系统的"宪法"。')])]),t._v(" "),a("h2",{attrs:{id:"分布式一致性的挑战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分布式一致性的挑战"}},[t._v("#")]),t._v(" 分布式一致性的挑战")]),t._v(" "),a("p",[t._v("想象一个场景：我们有三台数据库服务器，一个用户在上海修改了地址信息，这个变更需要同步到北京和深圳的服务器上。问题来了：")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("网络分区")]),t._v("：如果北京服务器突然断网怎么办？")]),t._v(" "),a("li",[a("strong",[t._v("节点故障")]),t._v("：如果深圳服务器宕机又重启，数据怎么恢复？")]),t._v(" "),a("li",[a("strong",[t._v("性能瓶颈")]),t._v("：每次修改都要等所有节点确认，用户会不会等得抓狂？")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v('分布式一致性协议的核心目标：在"部分节点故障"和"网络延迟"的条件下，保证所有节点的数据最终达成一致。')])]),t._v(" "),a("h2",{attrs:{id:"paxos-优雅但复杂的解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#paxos-优雅但复杂的解决方案"}},[t._v("#")]),t._v(" Paxos：优雅但复杂的解决方案")]),t._v(" "),a("h3",{attrs:{id:"paxos简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#paxos简介"}},[t._v("#")]),t._v(" Paxos简介")]),t._v(" "),a("p",[t._v("Paxos算法由Leslie Lamport于1990年提出，是第一个被证明的、能在异步系统中保证安全性的共识算法。它由两个阶段组成：")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("准备阶段")]),t._v("：Proposer向所有Acceptor发送提案编号")]),t._v(" "),a("li",[a("strong",[t._v("接受阶段")]),t._v("：Acceptor响应并承诺接受编号最大的提案")])]),t._v(" "),a("div",{staticClass:"language-mermaid line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sequenceDiagram")]),t._v("\n    Proposer"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->>")]),t._v("Acceptor1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Prepare"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1)")]),t._v("\n    Proposer"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->>")]),t._v("Acceptor2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Prepare"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1)")]),t._v("\n    Proposer"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->>")]),t._v("Acceptor3"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Prepare"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1)")]),t._v("\n    Acceptor1"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e>")]),t._v("Proposer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Promise"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1)")]),t._v("\n    Acceptor2"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e>")]),t._v("Proposer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Promise"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1)")]),t._v("\n    Acceptor3"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e>")]),t._v("Proposer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Promise"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1)")]),t._v("\n    Proposer"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->>")]),t._v("Acceptor1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Accept"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1, value)")]),t._v("\n    Proposer"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->>")]),t._v("Acceptor2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Accept"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1, value)")]),t._v("\n    Proposer"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->>")]),t._v("Acceptor3"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Accept"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(1, value)")]),t._v("\n    Acceptor1"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e>")]),t._v("Proposer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Accepted\n    Acceptor2"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e>")]),t._v("Proposer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Accepted\n    Acceptor3"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e>")]),t._v("Proposer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Accepted\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("h3",{attrs:{id:"paxos的优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#paxos的优缺点"}},[t._v("#")]),t._v(" Paxos的优缺点")]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("数学证明严谨，理论安全性有保障")]),t._v(" "),a("li",[t._v("能处理任意数量的节点故障")])]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v('实现极其复杂，连Lamport自己都说："The part of the protocol that is difficult is not the proof; it is the implementation."')]),t._v(" "),a("li",[t._v("效率较低，需要多轮通信")]),t._v(" "),a("li",[t._v('难以理解，有"Paxos can live with Byzantine failures"的调侃 😂')])]),t._v(" "),a("div",{staticClass:"custom-block theorem"},[a("p",{staticClass:"title"},[t._v("THEOREM")]),a("p",[t._v("Paxos定理：在存在消息丢失、延迟和重复，以及节点故障的异步系统中，只有满足以下条件才能达成共识：")]),t._v(" "),a("ol",[a("li",[t._v("只有被大多数节点接受的值才可能被选择")]),t._v(" "),a("li",[t._v("每个节点最多只能选择一个值")])])]),a("h2",{attrs:{id:"raft-让共识算法变得可理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#raft-让共识算法变得可理解"}},[t._v("#")]),t._v(" Raft：让共识算法变得可理解")]),t._v(" "),a("h3",{attrs:{id:"raft简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#raft简介"}},[t._v("#")]),t._v(" Raft简介")]),t._v(" "),a("p",[t._v('2014年，Diego Ongaro和John Ousterhout提出了Raft算法，目标是让共识算法变得"可理解"。它将问题分解为三个核心部分：')]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("领导选举")]),t._v("：选出Leader节点")]),t._v(" "),a("li",[a("strong",[t._v("日志复制")]),t._v("：Leader将日志复制到所有节点")]),t._v(" "),a("li",[a("strong",[t._v("安全性")]),t._v("：保证系统安全性")])]),t._v(" "),a("div",{staticClass:"language-mermaid line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("stateDiagram-v2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[*]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Follower\n    Follower "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Candidate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 选举超时\n    Candidate "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Leader"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 获得多数票\n    Candidate "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Follower"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 选举失败\n    Leader "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Follower"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 任期结束\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("h3",{attrs:{id:"raft的工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#raft的工作流程"}},[t._v("#")]),t._v(" Raft的工作流程")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("选举阶段")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("节点启动为Follower状态")]),t._v(" "),a("li",[t._v("等待Leader心跳，超时后转为Candidate")]),t._v(" "),a("li",[t._v("Candidate向其他节点投票请求")]),t._v(" "),a("li",[t._v("获得多数票的节点成为Leader")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("日志复制阶段")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("Leader接收客户端写请求")]),t._v(" "),a("li",[t._v("将日志条目追加到本地日志")]),t._v(" "),a("li",[t._v("通过AppendEntries RPC将日志复制到所有节点")]),t._v(" "),a("li",[t._v("当大多数节点确认后，提交日志")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("安全性保证")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("选举限制：只有包含已提交日志的节点才能成为Leader")]),t._v(" "),a("li",[t._v("日志匹配：Leader只能向Follower发送自己日志中存在的条目")]),t._v(" "),a("li",[t._v("Leader完整性：Leader永远不会覆盖已提交的日志")])])])]),t._v(" "),a("h3",{attrs:{id:"raft的优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#raft的优缺点"}},[t._v("#")]),t._v(" Raft的优缺点")]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("设计清晰，状态机模型易于理解")]),t._v(" "),a("li",[t._v("强Leader简化了日志复制逻辑")]),t._v(" "),a("li",[t._v("有丰富的可视化工具（如Raft Visualization）")]),t._v(" "),a("li",[t._v("已在多个生产系统中应用（如etcd, Consul）")])]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("依赖时间同步（虽然Paxos也依赖）")]),t._v(" "),a("li",[t._v("在小集群中性能可能不如Paxos优化方案")])]),t._v(" "),a("h2",{attrs:{id:"paxos-vs-raft-一场优雅与实用的较量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#paxos-vs-raft-一场优雅与实用的较量"}},[t._v("#")]),t._v(" Paxos vs Raft：一场优雅与实用的较量")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("特性")]),t._v(" "),a("th",[t._v("Paxos")]),t._v(" "),a("th",[t._v("Raft")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("设计目标")]),t._v(" "),a("td",[t._v("理论严谨性")]),t._v(" "),a("td",[t._v("可理解性")])]),t._v(" "),a("tr",[a("td",[t._v("实现复杂度")]),t._v(" "),a("td",[t._v("极高 🤯")]),t._v(" "),a("td",[t._v("中等 📚")])]),t._v(" "),a("tr",[a("td",[t._v("性能")]),t._v(" "),a("td",[t._v("较低")]),t._v(" "),a("td",[t._v("较高")])]),t._v(" "),a("tr",[a("td",[t._v("应用案例")]),t._v(" "),a("td",[t._v("Chubby, Google Spanner")]),t._v(" "),a("td",[t._v("etcd, Consul")])]),t._v(" "),a("tr",[a("td",[t._v("学习曲线")]),t._v(" "),a("td",[t._v("陡峭 🧗‍♂️")]),t._v(" "),a("td",[t._v("平缓 🚶‍♂️")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("🤔 "),a("strong",[t._v("个人观点")]),t._v('：Raft的"可理解性"革命性地降低了分布式系统的开发门槛。就像从汇编语言进化到高级语言，虽然Paxos在理论上更优雅，但Raft让更多人能够构建可靠的分布式系统。')])]),t._v(" "),a("h2",{attrs:{id:"结语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[t._v("#")]),t._v(" 结语")]),t._v(" "),a("p",[t._v("分布式一致性协议是分布式系统的基石，Paxos和Raft代表了两种不同的哲学：一个是理论上的完美，另一个是实践中的实用。在云原生时代，我们见证了Raft的崛起——从etcd到Kubernetes，从Consul到TiKV，Raft正在构建着现代分布式世界的基础设施。")]),t._v(" "),a("div",{staticClass:"custom-block right"},[a("p",[t._v('"分布式系统的艺术在于在不可靠的组件上构建可靠的系统" —— Pat Helland\n::>')]),t._v(" "),a("p",[t._v('对于开发者来说，理解这些协议不仅是技术能力的提升，更是思维方式的转变：从"追求完美"到"权衡取舍"，从"单机思维"到"分布式思维"。下次当你设计分布式系统时，不妨思考：你的系统需要什么样的"宪法"来保证一致性？')]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("个人建议")]),t._v("：如果正在构建新的分布式系统，建议从Raft入手；如果研究分布式理论，Paxos仍然值得深入学习。毕竟，在分布式世界里，没有银弹，只有最适合的权衡。🏗️")])])])}),[],!1,null,null,null);a.default=e.exports}}]);