(window.webpackJsonp=window.webpackJsonp||[]).push([[557],{913:function(s,t,a){"use strict";a.r(t);var n=a(15),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"å‰è¨€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[s._v("#")]),s._v(" å‰è¨€")]),s._v(" "),t("p",[s._v("åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚å®ƒä¸ä»…èƒ½å¤Ÿè§£è€¦ç³»ç»Ÿç»„ä»¶ï¼Œæé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§å’Œå¯ç”¨æ€§ï¼Œè¿˜èƒ½æœ‰æ•ˆå‰Šå³°å¡«è°·ï¼Œæå‡ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ç„¶è€Œï¼Œåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸é¢ä¸´ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¦‚ä½•ä¿è¯æ¶ˆæ¯å‘é€æ–¹ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œæ¶ˆæ¯æ¥æ”¶æ–¹ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ")]),s._v(" "),t("p",[s._v("è¿™ä¸ªé—®é¢˜å°±æ˜¯ä»Šå¤©æˆ‘ä»¬è¦æ¢è®¨çš„æ ¸å¿ƒâ€”â€”äº‹åŠ¡æ¶ˆæ¯ä¸å¯é æ€§ä¿è¯ã€‚ğŸ¤”")]),s._v(" "),t("p",[s._v("åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«æˆ‘åœ¨é¡¹ç›®ä¸­å¤„ç†äº‹åŠ¡æ¶ˆæ¯çš„ç»éªŒï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å„ç§æœºåˆ¶ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ é€’ã€‚")]),s._v(" "),t("h2",{attrs:{id:"äº‹åŠ¡æ¶ˆæ¯çš„æŒ‘æˆ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡æ¶ˆæ¯çš„æŒ‘æˆ˜"}},[s._v("#")]),s._v(" äº‹åŠ¡æ¶ˆæ¯çš„æŒ‘æˆ˜")]),s._v(" "),t("h3",{attrs:{id:"åˆ†å¸ƒå¼äº‹åŠ¡çš„å›°å¢ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†å¸ƒå¼äº‹åŠ¡çš„å›°å¢ƒ"}},[s._v("#")]),s._v(" åˆ†å¸ƒå¼äº‹åŠ¡çš„å›°å¢ƒ")]),s._v(" "),t("p",[s._v("åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®åº“äº‹åŠ¡æ¥ä¿è¯å¤šä¸ªæ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ä½†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§å˜å¾—å¼‚å¸¸å¤æ‚ã€‚"),t("s",[s._v("æˆ‘ç¬¬ä¸€æ¬¡é¢å¯¹è¿™ä¸ªé—®é¢˜æ—¶ï¼Œå·®ç‚¹å°±æƒ³å›é€€åˆ°å•ä½“æ¶æ„äº†")]),s._v("ã€‚")]),s._v(" "),t("p",[s._v("æ¶ˆæ¯é˜Ÿåˆ—è™½ç„¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£è€¦ç³»ç»Ÿï¼Œä½†ä¹Ÿå¼•å…¥äº†æ–°çš„æŒ‘æˆ˜ï¼š")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("æ¶ˆæ¯å‘é€å¤±è´¥")]),s._v("ï¼šä¸šåŠ¡é€»è¾‘æ‰§è¡ŒæˆåŠŸï¼Œä½†æ¶ˆæ¯å‘é€å¤±è´¥")]),s._v(" "),t("li",[t("strong",[s._v("æ¶ˆæ¯æ¥æ”¶å¤±è´¥")]),s._v("ï¼šæ¶ˆæ¯æˆåŠŸåˆ°è¾¾é˜Ÿåˆ—ï¼Œä½†æ¶ˆè´¹è€…å¤„ç†å¤±è´¥")]),s._v(" "),t("li",[t("strong",[s._v("é‡å¤æ¶ˆè´¹")]),s._v("ï¼šæ¶ˆæ¯è¢«å¤šæ¬¡å¤„ç†ï¼Œå¯¼è‡´ä¸šåŠ¡æ•°æ®ä¸ä¸€è‡´")]),s._v(" "),t("li",[t("strong",[s._v("æ¶ˆæ¯ä¸¢å¤±")]),s._v("ï¼šæ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±")])]),s._v(" "),t("h3",{attrs:{id:"äº‹åŠ¡æ¶ˆæ¯çš„å®šä¹‰"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡æ¶ˆæ¯çš„å®šä¹‰"}},[s._v("#")]),s._v(" äº‹åŠ¡æ¶ˆæ¯çš„å®šä¹‰")]),s._v(" "),t("p",[s._v('äº‹åŠ¡æ¶ˆæ¯æ˜¯æŒ‡èƒ½å¤Ÿä¿è¯æœ¬åœ°äº‹åŠ¡ä¸æ¶ˆæ¯å‘é€åŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥çš„æ¶ˆæ¯æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯"å…ˆæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå†å‘é€æ¶ˆæ¯"ï¼Œå¦‚æœä¸šåŠ¡é€»è¾‘æ‰§è¡Œå¤±è´¥ï¼Œåˆ™æ¶ˆæ¯ä¸ä¼šå‘é€ï¼›å¦‚æœæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œåˆ™å›æ»šä¸šåŠ¡é€»è¾‘ã€‚')]),s._v(" "),t("h2",{attrs:{id:"äº‹åŠ¡æ¶ˆæ¯çš„å®ç°æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡æ¶ˆæ¯çš„å®ç°æ–¹æ¡ˆ"}},[s._v("#")]),s._v(" äº‹åŠ¡æ¶ˆæ¯çš„å®ç°æ–¹æ¡ˆ")]),s._v(" "),t("h3",{attrs:{id:"æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆ"}},[s._v("#")]),s._v(" æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆ")]),s._v(" "),t("p",[s._v("è¿™æ˜¯æœ€ç»å…¸çš„äº‹åŠ¡æ¶ˆæ¯å®ç°æ–¹æ¡ˆä¹‹ä¸€ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æœ¬åœ°æ•°æ®åº“æ¥è®°å½•æ¶ˆæ¯çŠ¶æ€ã€‚")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("æç¤º")]),s._v(" "),t("p",[s._v("æ ¸å¿ƒæ€æƒ³ï¼šå°†æ¶ˆæ¯ä¸ä¸šåŠ¡æ•°æ®æ”¾åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­å¤„ç†ï¼Œé€šè¿‡æœ¬åœ°æ¶ˆæ¯è¡¨è®°å½•æ¶ˆæ¯çŠ¶æ€ï¼Œç„¶åç”±å®šæ—¶ä»»åŠ¡å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚")])]),s._v(" "),t("p",[s._v("å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("åˆ›å»ºæœ¬åœ°æ¶ˆæ¯è¡¨ï¼ŒåŒ…å«æ¶ˆæ¯IDã€æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯çŠ¶æ€ç­‰å­—æ®µ")]),s._v(" "),t("li",[s._v("åœ¨ä¸šåŠ¡æ–¹æ³•ä¸­ï¼Œå¼€å¯æœ¬åœ°äº‹åŠ¡")]),s._v(" "),t("li",[s._v("æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå°†ä¸šåŠ¡æ•°æ®å†™å…¥ä¸šåŠ¡è¡¨")]),s._v(" "),t("li",[s._v("å°†æ¶ˆæ¯ä¿¡æ¯å†™å…¥æœ¬åœ°æ¶ˆæ¯è¡¨")]),s._v(" "),t("li",[s._v("æäº¤æœ¬åœ°äº‹åŠ¡")]),s._v(" "),t("li",[s._v('ç”±å®šæ—¶ä»»åŠ¡æ‰«ææœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œå°†çŠ¶æ€ä¸º"å¾…å‘é€"çš„æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—')]),s._v(" "),t("li",[s._v('å‘é€æˆåŠŸåï¼Œæ›´æ–°æ¶ˆæ¯çŠ¶æ€ä¸º"å·²å‘é€"')])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("local_message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("message_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'æ¶ˆæ¯å”¯ä¸€æ ‡è¯†'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("message_body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'æ¶ˆæ¯å†…å®¹'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("message_status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tinyint")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'æ¶ˆæ¯çŠ¶æ€:0-å¾…å‘é€,1-å·²å‘é€,2-å‘é€å¤±è´¥'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("create_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("datetime")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURRENT_TIMESTAMP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'åˆ›å»ºæ—¶é—´'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("update_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("datetime")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURRENT_TIMESTAMP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURRENT_TIMESTAMP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'æ›´æ–°æ—¶é—´'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("uk_message_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("message_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"rocketmqçš„äº‹åŠ¡æ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rocketmqçš„äº‹åŠ¡æ¶ˆæ¯"}},[s._v("#")]),s._v(" RocketMQçš„äº‹åŠ¡æ¶ˆæ¯")]),s._v(" "),t("p",[s._v("RocketMQåŸç”Ÿæ”¯æŒäº‹åŠ¡æ¶ˆæ¯ï¼Œå…¶å®ç°æœºåˆ¶æ›´ä¸ºä¼˜é›…ã€‚")]),s._v(" "),t("div",{staticClass:"custom-block theorem"},[t("p",{staticClass:"title"},[s._v("THEOREM")]),t("p",[s._v("RocketMQäº‹åŠ¡æ¶ˆæ¯åŸç†ï¼šé€šè¿‡ä¸¤é˜¶æ®µæäº¤åè®®ï¼Œç¡®ä¿æœ¬åœ°äº‹åŠ¡ä¸æ¶ˆæ¯å‘é€çš„åŸå­æ€§ã€‚\n::å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("å‘é€æ–¹å‘é€åŠæ¶ˆæ¯ï¼ˆHalf Messageï¼‰åˆ°MQ")]),s._v(" "),t("li",[s._v('MQå°†æ¶ˆæ¯æ ‡è®°ä¸º"æš‚ä¸å¯æ¶ˆè´¹"')]),s._v(" "),t("li",[s._v("å‘é€æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡")]),s._v(" "),t("li",[s._v("æ ¹æ®æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœï¼Œå‘MQæäº¤äºŒæ¬¡ç¡®è®¤ï¼ˆCommitæˆ–Rollbackï¼‰")]),s._v(" "),t("li",[s._v("MQæ”¶åˆ°ç¡®è®¤åï¼Œå°†æ¶ˆæ¯æ ‡è®°ä¸ºå¯æ¶ˆè´¹æˆ–åˆ é™¤æ¶ˆæ¯")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// äº‹åŠ¡æ¶ˆæ¯å‘é€ç¤ºä¾‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionMQProducer")]),s._v(" producer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionMQProducer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"please_rename_unique_group_name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproducer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproducer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTransactionListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("executeLocalTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" arg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰§è¡Œæœ¬åœ°äº‹åŠ¡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸šåŠ¡é€»è¾‘å¤„ç†...")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMIT_MESSAGE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLLBACK_MESSAGE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkLocalTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å›æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¹æ®ä¸šåŠ¡å®é™…æƒ…å†µåˆ¤æ–­æ˜¯å¦æäº¤æˆ–å›æ»š")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMIT_MESSAGE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproducer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘é€äº‹åŠ¡æ¶ˆæ¯")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionSendResult")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessageInTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h3",{attrs:{id:"rabbitmqçš„äº‹åŠ¡æ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmqçš„äº‹åŠ¡æ¶ˆæ¯"}},[s._v("#")]),s._v(" RabbitMQçš„äº‹åŠ¡æ¶ˆæ¯")]),s._v(" "),t("p",[s._v("RabbitMQæœ¬èº«ä¸ç›´æ¥æ”¯æŒäº‹åŠ¡æ¶ˆæ¯ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("ä½¿ç”¨å‘å¸ƒç¡®è®¤ï¼ˆPublisher Confirmsï¼‰æœºåˆ¶")]),s._v(" "),t("li",[s._v("ç»“åˆæœ¬åœ°æ¶ˆæ¯è¡¨å®ç°")]),s._v(" "),t("li",[s._v("ä½¿ç”¨RabbitMQçš„æ’ä»¶å®ç°äº‹åŠ¡æ¶ˆæ¯")])]),s._v(" "),t("h2",{attrs:{id:"æ¶ˆæ¯å¯é æ€§ä¿éšœæœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¶ˆæ¯å¯é æ€§ä¿éšœæœºåˆ¶"}},[s._v("#")]),s._v(" æ¶ˆæ¯å¯é æ€§ä¿éšœæœºåˆ¶")]),s._v(" "),t("p",[s._v("é™¤äº†äº‹åŠ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å¯é æ€§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„å¯é æ€§ä¿éšœæœºåˆ¶ï¼š")]),s._v(" "),t("h3",{attrs:{id:"æ¶ˆæ¯æŒä¹…åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¶ˆæ¯æŒä¹…åŒ–"}},[s._v("#")]),s._v(" æ¶ˆæ¯æŒä¹…åŒ–")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("æç¤º")]),s._v(" "),t("p",[s._v("æ¶ˆæ¯æŒä¹…åŒ–æ˜¯å°†æ¶ˆæ¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå³ä½¿MQæœåŠ¡å™¨é‡å¯ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚")])])]),t("p",[s._v("åœ¨å¤§å¤šæ•°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°æ¶ˆæ¯æŒä¹…åŒ–ï¼š")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("äº¤æ¢æœºæŒä¹…åŒ–")]),s._v("ï¼šç¡®ä¿äº¤æ¢æœºåœ¨é‡å¯åä»ç„¶å­˜åœ¨")]),s._v(" "),t("li",[t("strong",[s._v("é˜Ÿåˆ—æŒä¹…åŒ–")]),s._v("ï¼šç¡®ä¿é˜Ÿåˆ—åœ¨é‡å¯åä»ç„¶å­˜åœ¨")]),s._v(" "),t("li",[t("strong",[s._v("æ¶ˆæ¯æŒä¹…åŒ–")]),s._v("ï¼šç¡®ä¿æ¶ˆæ¯åœ¨å†™å…¥ç£ç›˜åæ‰è¿”å›ç¡®è®¤")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// RabbitMQä¸­è®¾ç½®æŒä¹…åŒ–")]),s._v("\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exchangeDeclare")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exchange.name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"direct"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("queueDeclare")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"queue.name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("basicPublish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exchange.name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"routing.key"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageProperties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PERSISTENT_TEXT_PLAIN")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"æ¶ˆæ¯ç¡®è®¤æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¶ˆæ¯ç¡®è®¤æœºåˆ¶"}},[s._v("#")]),s._v(" æ¶ˆæ¯ç¡®è®¤æœºåˆ¶")]),s._v(" "),t("p",[s._v("æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ç¡®ä¿æ¶ˆæ¯è¢«æ­£ç¡®å¤„ç†ï¼š")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ç”Ÿäº§è€…ç¡®è®¤")]),s._v("ï¼šç¡®è®¤æ¶ˆæ¯å·²æˆåŠŸå‘é€åˆ°MQ")]),s._v(" "),t("li",[t("strong",[s._v("æ¶ˆè´¹è€…ç¡®è®¤")]),s._v("ï¼šç¡®è®¤æ¶ˆæ¯å·²è¢«æˆåŠŸå¤„ç†")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// RabbitMQä¸­å¼€å¯ç”Ÿäº§è€…ç¡®è®¤")]),s._v("\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("confirmSelect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addConfirmListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConfirmListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleAck")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" deliveryTag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" multiple"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¶ˆæ¯æˆåŠŸå‘é€åˆ°MQ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleNack")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" deliveryTag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" multiple"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œéœ€è¦é‡è¯•")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"é‡è¯•æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é‡è¯•æœºåˆ¶"}},[s._v("#")]),s._v(" é‡è¯•æœºåˆ¶")]),s._v(" "),t("p",[s._v("å½“æ¶ˆæ¯å¤„ç†å¤±è´¥æ—¶ï¼Œåˆç†çš„é‡è¯•æœºåˆ¶è‡³å…³é‡è¦ï¼š")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("æœ‰é™æ¬¡æ•°é‡è¯•")]),s._v("ï¼šé¿å…æ— é™é‡è¯•å¯¼è‡´èµ„æºæµªè´¹")]),s._v(" "),t("li",[t("strong",[s._v("æŒ‡æ•°é€€é¿")]),s._v("ï¼šé¿å…çŸ­æ—¶é—´å†…å¤§é‡é‡è¯•å¯¹ç³»ç»Ÿé€ æˆå†²å‡»")]),s._v(" "),t("li",[t("strong",[s._v("æ­»ä¿¡é˜Ÿåˆ—")]),s._v("ï¼šè¶…è¿‡é‡è¯•æ¬¡æ•°çš„æ¶ˆæ¯è½¬å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œäººå·¥å¹²é¢„")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// RabbitMQä¸­è®¾ç½®é‡è¯•å’Œæ­»ä¿¡é˜Ÿåˆ—")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" args "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nargs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-dead-letter-exchange"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dlx.exchange"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nargs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-dead-letter-routing-key"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dlx.routing"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nargs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-message-ttl"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¶ˆæ¯è¿‡æœŸæ—¶é—´")]),s._v("\n\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("queueDeclare")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"retry.queue"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"å¹‚ç­‰æ€§å¤„ç†"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¹‚ç­‰æ€§å¤„ç†"}},[s._v("#")]),s._v(" å¹‚ç­‰æ€§å¤„ç†")]),s._v(" "),t("p",[s._v("åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºç½‘ç»œé—®é¢˜æˆ–æ¶ˆè´¹è€…æ•…éšœï¼ŒåŒä¸€æ¡æ¶ˆæ¯å¯èƒ½ä¼šè¢«å¤šæ¬¡å¤„ç†ã€‚å› æ­¤ï¼Œæ¶ˆè´¹è€…å¿…é¡»å…·å¤‡å¹‚ç­‰æ€§ã€‚")]),s._v(" "),t("p",[s._v("å¸¸è§çš„å¹‚ç­‰æ€§å¤„ç†æ–¹æ¡ˆï¼š")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("å”¯ä¸€IDå»é‡")]),s._v("ï¼šä¸ºæ¯æ¡æ¶ˆæ¯ç”Ÿæˆå”¯ä¸€IDï¼Œå¤„ç†å‰æ£€æŸ¥æ˜¯å¦å·²å¤„ç†è¿‡")]),s._v(" "),t("li",[t("strong",[s._v("æ•°æ®åº“å”¯ä¸€çº¦æŸ")]),s._v("ï¼šåˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€çº¦æŸé˜²æ­¢é‡å¤å¤„ç†")]),s._v(" "),t("li",[t("strong",[s._v("çŠ¶æ€æœºæ¨¡å¼")]),s._v("ï¼šé€šè¿‡çŠ¶æ€æœºæ§åˆ¶ä¸šåŠ¡æµç¨‹ï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œ")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¹‚ç­‰æ€§å¤„ç†ç¤ºä¾‹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" messageId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ£€æŸ¥æ˜¯å¦å·²å¤„ç†")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("existsById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤„ç†ä¸šåŠ¡é€»è¾‘")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®°å½•å¤„ç†çŠ¶æ€")]),s._v("\n    messageRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("messageId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h2",{attrs:{id:"å®æˆ˜æ¡ˆä¾‹-è®¢å•ç³»ç»Ÿä¸­çš„äº‹åŠ¡æ¶ˆæ¯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å®æˆ˜æ¡ˆä¾‹-è®¢å•ç³»ç»Ÿä¸­çš„äº‹åŠ¡æ¶ˆæ¯"}},[s._v("#")]),s._v(" å®æˆ˜æ¡ˆä¾‹ï¼šè®¢å•ç³»ç»Ÿä¸­çš„äº‹åŠ¡æ¶ˆæ¯")]),s._v(" "),t("p",[s._v("è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè®¢å•ç³»ç»Ÿçš„æ¡ˆä¾‹ï¼Œæ¥å±•ç¤ºå¦‚ä½•åœ¨å®é™…åº”ç”¨ä¸­ç»“åˆäº‹åŠ¡æ¶ˆæ¯å’Œå¯é æ€§æœºåˆ¶ã€‚")]),s._v(" "),t("h3",{attrs:{id:"åœºæ™¯æè¿°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åœºæ™¯æè¿°"}},[s._v("#")]),s._v(" åœºæ™¯æè¿°")]),s._v(" "),t("p",[s._v("ç”¨æˆ·ä¸‹å•åï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š")]),s._v(" "),t("ol",[t("li",[s._v("åˆ›å»ºè®¢å•è®°å½•")]),s._v(" "),t("li",[s._v("æ‰£å‡åº“å­˜")]),s._v(" "),t("li",[s._v("å‘é€è®¢å•åˆ›å»ºæ¶ˆæ¯ï¼Œé€šçŸ¥å…¶ä»–ç³»ç»Ÿ")])]),s._v(" "),t("h3",{attrs:{id:"è§£å†³æ–¹æ¡ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è§£å†³æ–¹æ¡ˆ"}},[s._v("#")]),s._v(" è§£å†³æ–¹æ¡ˆ")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("ä½¿ç”¨RocketMQäº‹åŠ¡æ¶ˆæ¯")]),s._v("ä¿è¯è®¢å•åˆ›å»ºä¸æ¶ˆæ¯å‘é€çš„åŸå­æ€§")]),s._v(" "),t("li",[t("strong",[s._v("å¼€å¯æ¶ˆæ¯æŒä¹…åŒ–")]),s._v("é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±")]),s._v(" "),t("li",[t("strong",[s._v("é…ç½®æ¶ˆè´¹è€…é‡è¯•æœºåˆ¶")]),s._v("ï¼Œæœ€å¤šé‡è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”æŒ‡æ•°å¢é•¿")]),s._v(" "),t("li",[t("strong",[s._v("å®ç°å¹‚ç­‰æ€§å¤„ç†")]),s._v("ï¼Œé˜²æ­¢é‡å¤ä¸‹å•")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¢å•æœåŠ¡ä¸­çš„äº‹åŠ¡æ¶ˆæ¯å‘é€")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionMQProducer")]),s._v(" transactionMQProducer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderRepository")]),s._v(" orderRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InventoryService")]),s._v(" inventoryService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createOrder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderDTO")]),s._v(" orderDTO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºè®¢å•")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Order")]),s._v(" order "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Order")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...è®¾ç½®è®¢å•å±æ€§")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¿å­˜è®¢å•")]),s._v("\n        orderRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‘é€äº‹åŠ¡æ¶ˆæ¯")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" message "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order-topic"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order-create"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toJSONString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionSendResult")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" transactionMQProducer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessageInTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" order"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@TransactionalEventListener")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleOrderCreatedEvent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderCreatedEvent")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰£å‡åº“å­˜")]),s._v("\n        inventoryService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decreaseStock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getProductId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getQuantity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åº“å­˜æœåŠ¡æ¶ˆè´¹è€…")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RabbitListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("queues "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"inventory.queue"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InventoryConsumer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InventoryRepository")]),s._v(" inventoryRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Retryable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" maxAttempts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" backoff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Backoff")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delay "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" multiplier "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleInventoryDecrease")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InventoryDecreaseMessage")]),s._v(" message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¹‚ç­‰æ€§æ£€æŸ¥")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inventoryRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("existsByMessageId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMessageId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰£å‡åº“å­˜é€»è¾‘")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®°å½•å¤„ç†çŠ¶æ€")]),s._v("\n        inventoryRepository"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InventoryProcessRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMessageId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br")])]),t("h2",{attrs:{id:"æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),t("p",[s._v("åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†æ¶ˆæ¯é˜Ÿåˆ—çš„äº‹åŠ¡æ¶ˆæ¯ä¸å¯é æ€§ä¿è¯æœºåˆ¶ã€‚é€šè¿‡æœ¬åœ°æ¶ˆæ¯è¡¨ã€RocketMQäº‹åŠ¡æ¶ˆæ¯ç­‰æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼›é€šè¿‡æ¶ˆæ¯æŒä¹…åŒ–ã€ç¡®è®¤æœºåˆ¶ã€é‡è¯•æœºåˆ¶å’Œå¹‚ç­‰æ€§å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ¶ˆæ¯çš„å¯é ä¼ é€’ã€‚")]),s._v(" "),t("p",[s._v("åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯å’Œç³»ç»Ÿç‰¹ç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆã€‚è®°ä½ï¼Œæ²¡æœ‰é“¶å¼¹ï¼Œæ¯ç§æ–¹æ¡ˆéƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯å’Œå±€é™æ€§ã€‚ğŸ¤·â€â™‚ï¸")]),s._v(" "),t("blockquote",[t("p",[s._v('æ­£å¦‚Martin Fowleræ‰€è¯´ï¼š"ä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªä¸­é—´å±‚æ¥è§£å†³"ï¼Œè€Œæ¶ˆæ¯é˜Ÿåˆ—æ­£æ˜¯é‚£ä¸ªç¥å¥‡çš„ä¸­é—´å±‚ï¼Œå®ƒè®©æˆ‘ä»¬çš„ç³»ç»Ÿæ›´åŠ æ¾è€¦åˆï¼Œæ›´åŠ å¥å£®ã€‚')])]),s._v(" "),t("p",[s._v("å¸Œæœ›æœ¬æ–‡èƒ½å¯¹ä½ åœ¨é¡¹ç›®ä¸­ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºï¼ğŸ˜Š")]),s._v(" "),t("hr"),s._v(" "),t("p",[t("em",[s._v("å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œåˆ«å¿˜äº†ç‚¹èµå’Œå…³æ³¨å“¦ï¼ä½ çš„æ”¯æŒæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼")])])])}),[],!1,null,null,null);t.default=e.exports}}]);