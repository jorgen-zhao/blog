---
title: MCPå¤šç§Ÿæˆ·ä¸æƒé™ç®¡ç†æŒ‡å—-æ„å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·åº”ç”¨
date: 2026-01-30
tags:
  - MCPå¤šç§Ÿæˆ·
  - æƒé™ç®¡ç†
  - ä¼ä¸šçº§åº”ç”¨
---

## å‰è¨€

å—¨ï¼Œå¤§å®¶å¥½ï¼æˆ‘æ˜¯Jorgenï¼Œä»Šå¤©æƒ³å’Œå¤§å®¶èŠèŠä¸€ä¸ªåœ¨MCPå¼€å‘ä¸­ç»å¸¸è¢«å¿½è§†ä½†åˆæå…¶é‡è¦çš„ä¸»é¢˜â€”â€”å¤šç§Ÿæˆ·ä¸æƒé™ç®¡ç†ã€‚ğŸ¤”

åœ¨æ„å»ºä¼ä¸šçº§åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦åœ¨ä¸€ä¸ªå¹³å°ä¸Šä¸ºå¤šä¸ªå®¢æˆ·æä¾›æœåŠ¡ï¼Œè¿™å°±æ¶‰åŠåˆ°å¤šç§Ÿæˆ·æ¶æ„ã€‚è€Œå¦‚ä½•ç¡®ä¿æ¯ä¸ªå®¢æˆ·çš„æ•°æ®å®‰å…¨ã€æ“ä½œæƒé™åˆ†æ˜ï¼Œåˆ™æ˜¯æƒé™ç®¡ç†çš„æ ¸å¿ƒã€‚~~è¯´å®è¯ï¼Œæˆ‘æ›¾ç»å› ä¸ºå¿½ç•¥äº†è¿™ä¸€ç‚¹ï¼Œå·®ç‚¹æŠŠAå…¬å¸çš„æ•°æ®å±•ç¤ºç»™äº†Bå…¬å¸çš„å®¢æˆ·ï¼Œå¹¸å¥½åŠæ—¶å‘ç°ï¼Œå¦åˆ™åæœä¸å ªè®¾æƒ³ï¼~~

::: tip
å¤šç§Ÿæˆ·æ¶æ„æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼Œå…¶ä¸­å•ä¸ªè½¯ä»¶å®ä¾‹æœåŠ¡äºå¤šä¸ªå®¢æˆ·ï¼ˆç§Ÿæˆ·ï¼‰ï¼Œä½†æ¯ä¸ªå®¢æˆ·çš„æ•°æ®å’Œé…ç½®æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚
:::

ä»Šå¤©ï¼Œæˆ‘å°†å¸¦å¤§å®¶æ·±å…¥äº†è§£å¦‚ä½•åœ¨MCPå¹³å°ä¸­å®ç°é«˜æ•ˆçš„å¤šç§Ÿæˆ·æ¶æ„ä¸ç²¾ç»†åŒ–çš„æƒé™ç®¡ç†ï¼Œè®©ä½ çš„åº”ç”¨æ—¢å®‰å…¨åˆçµæ´»ï¼

## MCPå¤šç§Ÿæˆ·æ¶æ„åŸºç¡€

### ä»€ä¹ˆæ˜¯å¤šç§Ÿæˆ·æ¶æ„ï¼Ÿ

å¤šç§Ÿæˆ·æ¶æ„æ˜¯æŒ‡å•ä¸ªè½¯ä»¶å®ä¾‹ä¸ºå¤šä¸ªå®¢æˆ·ï¼ˆç§Ÿæˆ·ï¼‰æä¾›æœåŠ¡çš„ä¸€ç§æ¶æ„æ¨¡å¼ã€‚åœ¨è¿™ç§æ¶æ„ä¸­ï¼Œä¸åŒç§Ÿæˆ·çš„æ•°æ®å’Œé…ç½®æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œä½†å…±äº«ç›¸åŒçš„ä»£ç åº“å’ŒåŸºç¡€è®¾æ–½ã€‚

::: theorem
å¤šç§Ÿæˆ·æ¶æ„çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š
1. **æˆæœ¬æ•ˆç›Š**ï¼šå¤šä¸ªç§Ÿæˆ·å…±äº«èµ„æºï¼Œé™ä½æ€»ä½“æ‹¥æœ‰æˆæœ¬
2. **é›†ä¸­ç»´æŠ¤**ï¼šåªéœ€ç»´æŠ¤ä¸€ä¸ªä»£ç åº“ï¼Œç®€åŒ–å‡çº§å’Œç»´æŠ¤
3. **ä¸€è‡´æ€§ä½“éªŒ**ï¼šæ‰€æœ‰ç§Ÿæˆ·ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„åŠŸèƒ½
:::

### MCPä¸­çš„å¤šç§Ÿæˆ·å®ç°æ¨¡å¼

åœ¨MCPå¹³å°ä¸­ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å¤šç§Ÿæˆ·å®ç°æ¨¡å¼ï¼š

#### 1. å…±äº«æ•°æ®åº“ï¼Œå…±äº«æ¶æ„æ¨¡å¼

æ‰€æœ‰ç§Ÿæˆ·ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“æ¶æ„ï¼Œé€šè¿‡ç§Ÿæˆ·IDè¿›è¡Œæ•°æ®éš”ç¦»ã€‚

```sql
-- ç¤ºä¾‹ï¼šé€šè¿‡ç§Ÿæˆ·IDéš”ç¦»æ•°æ®
SELECT * FROM orders WHERE tenant_id = 'tenant123';
```

**ä¼˜ç‚¹**ï¼š
- å®ç°ç®€å•ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜
- æŸ¥è¯¢æ€§èƒ½è¾ƒå¥½

**ç¼ºç‚¹**ï¼š
- å­˜åœ¨æ•°æ®æ³„éœ²é£é™©ï¼ˆå¦‚æœç§Ÿæˆ·IDå¤„ç†ä¸å½“ï¼‰
- éš¾ä»¥å®ç°å®šåˆ¶åŒ–çš„æ¶æ„éœ€æ±‚

#### 2. ç‹¬ç«‹æ•°æ®åº“æ¨¡å¼

æ¯ä¸ªç§Ÿæˆ·æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ã€‚

**ä¼˜ç‚¹**ï¼š
- æ•°æ®éš”ç¦»æ€§æœ€å¼º
- å¯ä»¥ä¸ºæ¯ä¸ªç§Ÿæˆ·å®šåˆ¶æ•°æ®åº“æ¶æ„
- æ˜“äºè¿ç§»å’Œå¤‡ä»½

**ç¼ºç‚¹**ï¼š
- èµ„æºæ¶ˆè€—å¤§
- ç®¡ç†å¤æ‚åº¦é«˜

#### 3. å…±äº«æ•°æ®åº“ï¼Œç‹¬ç«‹æ¶æ„æ¨¡å¼

å…±äº«æ•°æ®åº“ï¼Œä½†æ¯ä¸ªç§Ÿæˆ·æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“æ¶æ„ï¼ˆé€šè¿‡ä¸åŒçš„è¡¨å‰ç¼€æˆ–schemaå®ç°ï¼‰ã€‚

**ä¼˜ç‚¹**ï¼š
- å¹³è¡¡äº†éš”ç¦»æ€§å’Œèµ„æºåˆ©ç”¨ç‡
- å¯ä»¥å®ç°ä¸€å®šç¨‹åº¦çš„å®šåˆ¶åŒ–

**ç¼ºç‚¹**ï¼š
- ç®¡ç†å¤æ‚åº¦è¾ƒé«˜
- æŸäº›æ•°æ®åº“æ“ä½œå¯èƒ½å—é™

åœ¨MCPå¹³å°ä¸­ï¼Œæˆ‘æ¨èä½¿ç”¨**å…±äº«æ•°æ®åº“ï¼Œç‹¬ç«‹æ¶æ„æ¨¡å¼**ä½œä¸ºé»˜è®¤é€‰æ‹©ï¼Œå› ä¸ºå®ƒåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹æä¾›äº†æœ€ä½³çš„æ€§èƒ½ä¸éš”ç¦»æ€§å¹³è¡¡ã€‚

## MCPæƒé™ç®¡ç†ç³»ç»Ÿè®¾è®¡

### æƒé™æ¨¡å‹æ¦‚è¿°

ä¸€ä¸ªå®Œå–„çš„æƒé™ç®¡ç†ç³»ç»Ÿåº”è¯¥åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š

1. **ç”¨æˆ·ï¼ˆUserï¼‰**ï¼šç³»ç»Ÿçš„å®é™…ä½¿ç”¨è€…
2. **è§’è‰²ï¼ˆRoleï¼‰**ï¼šæƒé™çš„é›†åˆï¼Œå¦‚ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ç­‰
3. **æƒé™ï¼ˆPermissionï¼‰**ï¼šå…·ä½“çš„æ“ä½œæƒé™ï¼Œå¦‚"åˆ›å»ºè®¢å•"ã€"æŸ¥çœ‹æŠ¥è¡¨"ç­‰
4. **èµ„æºï¼ˆResourceï¼‰**ï¼šç³»ç»Ÿä¸­çš„å¯æ“ä½œå¯¹è±¡ï¼Œå¦‚è®¢å•ã€å®¢æˆ·ã€äº§å“ç­‰

::: right
"æƒé™ç®¡ç†ä¸æ˜¯é™åˆ¶ç”¨æˆ·ï¼Œè€Œæ˜¯ä¿æŠ¤æ•°æ®å’ŒåŠŸèƒ½çš„å®‰å…¨è¾¹ç•Œ"
:::

### åŸºäºRBACçš„æƒé™æ¨¡å‹

åœ¨MCPä¸­ï¼Œæˆ‘æ¨èä½¿ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰æ¨¡å‹ï¼Œå› ä¸ºå®ƒæ—¢çµæ´»åˆæ˜“äºç†è§£å’Œå®ç°ã€‚

```mermaid
graph TD
    A[ç”¨æˆ·] --> B[è§’è‰²]
    B --> C[æƒé™]
    C --> D[èµ„æºæ“ä½œ]
```

#### å®ç°ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäºRBACçš„æƒé™ç®¡ç†å®ç°ç¤ºä¾‹ï¼š

```python
# ç”¨æˆ·æ¨¡å‹
class User:
    def __init__(self, user_id, username):
        self.user_id = user_id
        self.username = username
        self.roles = []

# è§’è‰²æ¨¡å‹
class Role:
    def __init__(self, role_id, role_name):
        self.role_id = role_id
        self.role_name = role_name
        self.permissions = []

# æƒé™æ¨¡å‹
class Permission:
    def __init__(self, permission_id, resource, action):
        self.permission_id = permission_id
        self.resource = resource  # å¦‚ 'order', 'product'
        self.action = action      # å¦‚ 'create', 'read', 'update', 'delete'

# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ç‰¹å®šæƒé™
def has_permission(user, resource, action):
    for role in user.roles:
        for permission in role.permissions:
            if permission.resource == resource and permission.action == action:
                return True
    return False
```

### MCPä¸­çš„æƒé™å®ç°ç­–ç•¥

#### 1. å£°æ˜å¼æƒé™æ§åˆ¶

åœ¨MCPä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£æˆ–è£…é¥°å™¨æ¥å®ç°å£°æ˜å¼æƒé™æ§åˆ¶ï¼š

```java
// Javaç¤ºä¾‹
@PreAuthorize("hasPermission('order', 'create')")
public Order createOrder(OrderRequest request) {
    // åˆ›å»ºè®¢å•é€»è¾‘
    return orderService.createOrder(request);
}
```

#### 2. æ•°æ®è¿‡æ»¤æƒé™

åœ¨æ•°æ®æŸ¥è¯¢æ—¶ï¼Œè‡ªåŠ¨åº”ç”¨æƒé™è¿‡æ»¤ï¼š

```sql
-- è‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·IDå’Œæƒé™è¿‡æ»¤æ¡ä»¶
SELECT * FROM orders 
WHERE tenant_id = :tenantId 
AND (created_by = :userId OR has_permission(:userId, 'order', 'read'));
```

#### 3. UIçº§æƒé™æ§åˆ¶

åœ¨å‰ç«¯å®ç°åŸºäºæƒé™çš„UIæ§åˆ¶ï¼š

```javascript
// Vue.jsç¤ºä¾‹
<template>
  <div v-if="hasPermission('order', 'create')">
    <button @click="showCreateOrderDialog">åˆ›å»ºè®¢å•</button>
  </div>
</template>

<script>
export default {
  methods: {
    hasPermission(resource, action) {
      return this.$store.getters.hasPermission(resource, action);
    }
  }
}
</script>
```

## MCPå¤šç§Ÿæˆ·æœ€ä½³å®è·µ

### 1. æ•°æ®éš”ç¦»ç­–ç•¥

ç¡®ä¿æ•°æ®éš”ç¦»æ˜¯å¤šç§Ÿæˆ·æ¶æ„çš„æ ¸å¿ƒã€‚ä»¥ä¸‹æ˜¯å‡ ç§æœ‰æ•ˆçš„æ•°æ®éš”ç¦»ç­–ç•¥ï¼š

#### ç§Ÿæˆ·ä¸Šä¸‹æ–‡ä¼ é€’

åœ¨æ¯ä¸ªè¯·æ±‚ä¸­ä¼ é€’ç§Ÿæˆ·ä¸Šä¸‹æ–‡ï¼š

```java
// ä½¿ç”¨çº¿ç¨‹å±€éƒ¨å˜é‡å­˜å‚¨å½“å‰ç§Ÿæˆ·ID
private static final ThreadLocal<String> CURRENT_TENANT = new ThreadLocal<>();

public void setCurrentTenant(String tenantId) {
    CURRENT_TENANT.set(tenantId);
}

public String getCurrentTenant() {
    return CURRENT_TENANT.get();
}
```

#### è‡ªåŠ¨ç§Ÿæˆ·è¿‡æ»¤

å®ç°è‡ªåŠ¨ç§Ÿæˆ·è¿‡æ»¤çš„æ‹¦æˆªå™¨ï¼š

```java
public class TenantFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) 
            throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String tenantId = httpRequest.getHeader("X-Tenant-ID");
        
        // è®¾ç½®å½“å‰ç§Ÿæˆ·ä¸Šä¸‹æ–‡
        setCurrentTenant(tenantId);
        
        try {
            chain.doFilter(request, response);
        } finally {
            // æ¸…ç†ç§Ÿæˆ·ä¸Šä¸‹æ–‡
            clearCurrentTenant();
        }
    }
}
```

### 2. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

å¤šç§Ÿæˆ·ç¯å¢ƒä¸‹çš„ç¼“å­˜éœ€è¦ç‰¹åˆ«æ³¨æ„éš”ç¦»æ€§ï¼š

```java
// ä½¿ç”¨ç§Ÿæˆ·IDä½œä¸ºç¼“å­˜é”®å‰ç¼€
public String getCacheKey(String key, String tenantId) {
    return tenantId + ":" + key;
}

// ç¤ºä¾‹ä½¿ç”¨
String productKey = getCacheKey("product:123", getCurrentTenant());
Product product = cache.get(productKey);
```

### 3. ç›‘æ§ä¸æ—¥å¿—

å®ç°ç§Ÿæˆ·çº§åˆ«çš„ç›‘æ§å’Œæ—¥å¿—ï¼š

```java
// ä½¿ç”¨MDCï¼ˆMapped Diagnostic Contextï¼‰è®°å½•ç§Ÿæˆ·ä¿¡æ¯
MDC.put("tenantId", getCurrentTenant());

// æ—¥å¿—è¾“å‡ºç¤ºä¾‹
// 2026-01-30 10:15:30 [main] INFO com.example.service.OrderService - Created order for tenant: tenant123
```

## MCPæƒé™ç®¡ç†è¿›é˜¶

### åŠ¨æ€æƒé™æ§åˆ¶

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å®ç°åŠ¨æ€æƒé™æ§åˆ¶ï¼Œä¾‹å¦‚åŸºäºæ•°æ®æ‰€æœ‰æƒçš„æƒé™ï¼š

```java
@PreAuthorize("hasPermission(#orderId, 'order', 'read') or hasRole('ADMIN')")
public Order getOrder(String orderId) {
    // è·å–è®¢å•é€»è¾‘
    return orderService.getOrder(orderId);
}
```

### æƒé™ç»§æ‰¿ä¸ç»„åˆ

å®ç°è§’è‰²ç»§æ‰¿å’Œæƒé™ç»„åˆï¼š

```java
// è§’è‰²ç»§æ‰¿
class Role {
    private List<Role> inheritsFrom = new ArrayList<>();
    
    public boolean hasPermission(String resource, String action) {
        // æ£€æŸ¥å½“å‰è§’è‰²çš„æƒé™
        for (Permission permission : permissions) {
            if (permission.matches(resource, action)) {
                return true;
            }
        }
        
        // æ£€æŸ¥ç»§æ‰¿è§’è‰²çš„æƒé™
        for (Role role : inheritsFrom) {
            if (role.hasPermission(resource, action)) {
                return true;
            }
        }
        
        return false;
    }
}
```

### å®¡è®¡æ—¥å¿—

å®ç°å…¨é¢çš„æƒé™å®¡è®¡æ—¥å¿—ï¼š

```java
@Aspect
@Component
public class PermissionAuditAspect {
    
    @AfterReturning("execution(* com.example..*(..)) && @annotation(preAuthorize)")
    public void auditPermission(JoinPoint joinPoint, PreAuthorize preAuthorize) {
        String tenantId = getCurrentTenant();
        String username = getCurrentUser();
        String method = joinPoint.getSignature().getName();
        
        // è®°å½•æƒé™å®¡è®¡æ—¥å¿—
        auditService.logPermissionUsage(tenantId, username, method);
    }
}
```

## ç»“è¯­

å¤šç§Ÿæˆ·ä¸æƒé™ç®¡ç†æ˜¯æ„å»ºä¼ä¸šçº§MCPåº”ç”¨ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚é€šè¿‡åˆç†çš„è®¾è®¡å’Œå®ç°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¿è¯æ•°æ®å®‰å…¨çš„åŒæ—¶ï¼Œæä¾›çµæ´»çš„æƒé™æ§åˆ¶æœºåˆ¶ã€‚

ğŸ— æ„å»ºä¸€ä¸ªå®Œå–„çš„å¤šç§Ÿæˆ·æƒé™ç³»ç»Ÿéœ€è¦è€ƒè™‘å¤šä¸ªæ–¹é¢ï¼Œä»æ•°æ®éš”ç¦»åˆ°æƒé™æ§åˆ¶ï¼Œä»ç¼“å­˜ç­–ç•¥åˆ°å®¡è®¡æ—¥å¿—ã€‚ä½†æ­£æ˜¯è¿™äº›ç»†èŠ‚ï¼Œå†³å®šäº†ä½ çš„åº”ç”¨æ˜¯å¦èƒ½å¤ŸçœŸæ­£æ»¡è¶³ä¼ä¸šçº§éœ€æ±‚ã€‚

ğŸ’¡ è®°ä½ï¼Œæƒé™ç®¡ç†ä¸æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼Œè€Œæ˜¯ä¸€ä¸ªæŒç»­æ¼”è¿›çš„è¿‡ç¨‹ã€‚éšç€ä¸šåŠ¡çš„å‘å±•å’Œéœ€æ±‚çš„å˜åŒ–ï¼Œä½ éœ€è¦ä¸æ–­ä¼˜åŒ–å’Œå®Œå–„ä½ çš„æƒé™ç³»ç»Ÿã€‚

å¸Œæœ›ä»Šå¤©çš„åˆ†äº«èƒ½å¤Ÿå¸®åŠ©å¤§å®¶åœ¨MCPå¼€å‘ä¸­æ›´å¥½åœ°å®ç°å¤šç§Ÿæˆ·ä¸æƒé™ç®¡ç†ã€‚å¦‚æœæœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºï¼

> "å®‰å…¨ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯ä¸€æ®µæ—…ç¨‹ã€‚åœ¨å¤šç§Ÿæˆ·æ¶æ„ä¸­ï¼Œæƒé™ç®¡ç†å°±æ˜¯æˆ‘ä»¬åœ¨è¿™æ®µæ—…ç¨‹ä¸­çš„æŒ‡å—é’ˆã€‚"