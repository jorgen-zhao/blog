---
title: Flinké«˜çº§è°ƒè¯•ä¸æ•…éšœæ’é™¤æŒ‡å—-æ„å»ºå¥å£®æµå¤„ç†ç³»ç»Ÿçš„å¿…å¤‡æŠ€èƒ½
date: 2026-02-04
tags: [Flink, è°ƒè¯•æŠ€æœ¯, æ•…éšœæ’é™¤]
---

## å‰è¨€

åœ¨æ„å»ºå¤æ‚çš„æµå¤„ç†åº”ç”¨æ—¶ï¼Œè°ƒè¯•å’Œæ•…éšœæ’é™¤æ˜¯ä¸å¯é¿å…çš„æŒ‘æˆ˜ã€‚ğŸ¤” Flinkä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„åˆ†å¸ƒå¼æµå¤„ç†å¼•æ“ï¼Œæä¾›äº†ä¸°å¯Œçš„è°ƒè¯•å·¥å…·å’Œæœºåˆ¶ï¼Œä½†å¦‚ä½•åœ¨å¤æ‚çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­é«˜æ•ˆåœ°å®šä½å’Œè§£å†³é—®é¢˜ï¼Œä»ç„¶éœ€è¦æ·±å…¥çš„ç†è§£å’Œå®è·µã€‚

æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Flinkæµå¤„ç†çš„é«˜çº§è°ƒè¯•æŠ€æœ¯å’Œæ•…éšœæ’é™¤ç­–ç•¥ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´åŠ å¥å£®å’Œå¯é çš„æµå¤„ç†ç³»ç»Ÿã€‚

## Flinkè°ƒè¯•åŸºç¡€

åœ¨æ·±å…¥é«˜çº§è°ƒè¯•æŠ€æœ¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£Flinkæä¾›çš„åŸºæœ¬è°ƒè¯•å·¥å…·å’Œæ–¹æ³•ã€‚

### Web UIç›‘æ§

Flinkçš„Web UIæ˜¯ç›‘æ§å’Œè°ƒè¯•ä½œä¸šçš„å¼ºå¤§å·¥å…·ã€‚é€šè¿‡Web UIï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

- æŸ¥çœ‹ä½œä¸šçš„æ‹“æ‰‘ç»“æ„å’Œæ‰§è¡Œè®¡åˆ’
- ç›‘æ§ä½œä¸šçš„ååé‡å’Œå»¶è¿Ÿ
- æ£€æŸ¥ç®—å­çš„çŠ¶æ€å’ŒèƒŒå‹æƒ…å†µ
- æŸ¥çœ‹ä½œä¸šçš„æ—¥å¿—å’Œå¼‚å¸¸ä¿¡æ¯

```bash
# å¯åŠ¨Flinké›†ç¾¤åï¼Œè®¿é—®Web UI
http://localhost:8081
```

### æ—¥å¿—åˆ†æ

Flinkæä¾›äº†è¯¦ç»†çš„æ—¥å¿—è®°å½•æœºåˆ¶ï¼Œå¸®åŠ©æˆ‘ä»¬ç†è§£ä½œä¸šçš„æ‰§è¡Œæƒ…å†µã€‚æ—¥å¿—åˆ†ä¸ºä¸åŒçº§åˆ«ï¼šINFOã€WARNã€ERRORç­‰ã€‚

```yaml
# log4j.propertiesé…ç½®ç¤ºä¾‹
log4j.rootLogger=INFO, stdout
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss,SSS} [%t] %-5p %c{1}:%L - %msg%n
```

### è°ƒè¯•æ¨¡å¼

Flinkæä¾›äº†è°ƒè¯•æ¨¡å¼ï¼Œå…è®¸æˆ‘ä»¬åœ¨æœ¬åœ°ç¯å¢ƒä¸­å¼€å‘å’Œæµ‹è¯•ä½œä¸šï¼š

```java
StreamExecutionEnvironment env = StreamExecutionEnvironment.createLocalEnvironment();
// åœ¨æœ¬åœ°ç¯å¢ƒä¸­æ‰§è¡Œä½œä¸š
env.execute("Local Job Debug");
```

## åˆ†å¸ƒå¼è°ƒè¯•æŠ€æœ¯

åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è°ƒè¯•Flinkä½œä¸šéœ€è¦ç‰¹æ®Šçš„æŠ€å·§å’Œå·¥å…·ã€‚

### ä½œä¸šæ‹“æ‰‘åˆ†æ

ç†è§£ä½œä¸šçš„æ‹“æ‰‘ç»“æ„æ˜¯è°ƒè¯•çš„ç¬¬ä¸€æ­¥ã€‚Flinkæä¾›äº†å¤šç§æ–¹å¼æ¥å¯è§†åŒ–ä½œä¸šæ‹“æ‰‘ï¼š

```java
// æ‰“å°ä½œä¸šçš„æ‹“æ‰‘ç»“æ„
System.out.println(env.getExecutionPlan());
```

### åˆ†å¸ƒå¼è¿½è¸ª

åˆ†å¸ƒå¼è¿½è¸ªæ˜¯è°ƒè¯•åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼ºå¤§å·¥å…·ã€‚Flinkä¸Zipkinã€Jaegerç­‰é›†æˆæ”¯æŒåˆ†å¸ƒå¼è¿½è¸ªï¼š

```java
// æ·»åŠ Zipkinè¿½è¸ª
env.enableCheckpointing(5000);
env.setRestartStrategy(RestartStrategies.fixedDelayRestart(3, 10000));
env.addSource(new FlinkKafkaConsumer<>("topic", new SimpleStringSchema(), properties))
   .addSink(new ZipkinSink("http://localhost:9411/api/v2/spans"));
```

### è¿œç¨‹è°ƒè¯•

Flinkæ”¯æŒè¿œç¨‹è°ƒè¯•ï¼Œå…è®¸æˆ‘ä»¬åœ¨IDEä¸­è¿æ¥åˆ°è¿œç¨‹è¿è¡Œçš„ä½œä¸šï¼š

```bash
# å¯åŠ¨Flinkä½œä¸šæ—¶å¯ç”¨è¿œç¨‹è°ƒè¯•
./bin/flink run -d -d 5005 ./examples/streaming/WordCount.jar
```

ç„¶ååœ¨IDEä¸­é…ç½®è¿œç¨‹è°ƒè¯•è¿æ¥ï¼š

```
Host: localhost
Port: 5005
```

## æ–­ç‚¹è°ƒè¯•ä¸ä»£ç çº§è°ƒè¯•

å¯¹äºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»£ç çº§è°ƒè¯•æ˜¯å¿…ä¸å¯å°‘çš„ã€‚

### æœ¬åœ°è°ƒè¯•æ¨¡å¼

Flinkæ”¯æŒåœ¨æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œä½œä¸šï¼Œä¾¿äºæ–­ç‚¹è°ƒè¯•ï¼š

```java
// åˆ›å»ºæœ¬åœ°æ‰§è¡Œç¯å¢ƒ
final StreamExecutionEnvironment env = StreamExecutionEnvironment.createLocalEnvironment();

// æ·»åŠ æ•°æ®æº
DataStream<String> text = env.socketTextStream("localhost", 9999);

// å¤„ç†æ•°æ®
DataStream<Tuple2<String, Integer>> counts = text
    .flatMap(new Tokenizer())
    .keyBy(0)
    .sum(1);

// æ‰“å°ç»“æœ
counts.print();

// æ‰§è¡Œä½œä¸š
env.execute("Socket WordCount");
```

### æ£€æŸ¥ç‚¹ä¸è°ƒè¯•

æ£€æŸ¥ç‚¹æœºåˆ¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨æ•…éšœæ¢å¤æ—¶ä¿æŒåº”ç”¨çŠ¶æ€ä¸€è‡´æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨äºè°ƒè¯•ï¼š

```java
// å¯ç”¨æ£€æŸ¥ç‚¹
env.enableCheckpointing(5000); // æ¯5ç§’åšä¸€æ¬¡æ£€æŸ¥ç‚¹

// é«˜çº§æ£€æŸ¥ç‚¹é…ç½®
env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);
env.getCheckpointConfig().setMinPauseBetweenCheckpoints(1000);
env.getCheckpointConfig().setCheckpointTimeout(60000);
env.getCheckpointConfig().setMaxConcurrentCheckpoints(1);
env.getCheckpointConfig().enableExternalizedCheckpoints(CheckpointConfig.ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);
```

## æ€§èƒ½ç“¶é¢ˆåˆ†æ

è¯†åˆ«å’Œåˆ†ææ€§èƒ½ç“¶é¢ˆæ˜¯ä¼˜åŒ–æµå¤„ç†åº”ç”¨çš„å…³é”®ã€‚

### ååé‡ä¸å»¶è¿Ÿç›‘æ§

Flinkçš„Web UIæä¾›äº†ååé‡å’Œå»¶è¿Ÿçš„ç›‘æ§åŠŸèƒ½ï¼š

```java
// æ·»åŠ ååé‡ç›‘æ§
env.getConfig().setLatencyTrackingInterval(1000); // æ¯ç§’è®°å½•å»¶è¿Ÿ

// è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡
getRuntimeContext().getMetricGroup()
    .addGroup("wordcount")
    .counter("elements-processed")
    .inc();
```

### èƒŒå‹åˆ†æ

èƒŒå‹æ˜¯æµå¤„ç†ç³»ç»Ÿä¸­çš„å¸¸è§é—®é¢˜ï¼ŒFlinkæä¾›äº†èƒŒå‹ç›‘æ§å·¥å…·ï¼š

```bash
# ä½¿ç”¨Flinkçš„èƒŒå‹ç›‘æ§å·¥å…·
./bin/flink list
./bin/flink job-status <job-id>
./bin/flink job-heapdump <job-id>
```

## å¸¸è§æ•…éšœæ’é™¤

äº†è§£å¸¸è§çš„æ•…éšœå’Œæ’é™¤æ–¹æ³•å¯ä»¥æé«˜è°ƒè¯•æ•ˆç‡ã€‚

### å†…å­˜æº¢å‡º

å†…å­˜æº¢å‡ºæ˜¯Flinkä½œä¸šä¸­çš„å¸¸è§é—®é¢˜ï¼š

```bash
# å¢åŠ TaskManagerå†…å­˜
./bin/flink run -d -tm 2048 ./examples/streaming/WordCount.jar

# è°ƒæ•´åƒåœ¾å›æ”¶ç­–ç•¥
export JVM_OPTS="-XX:+UseG1GC -XX:MaxGCPauseMillis=100"
```

### çŠ¶æ€åç«¯é—®é¢˜

çŠ¶æ€åç«¯çš„é…ç½®ä¸å½“å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼š

```java
// é…ç½®RocksDBçŠ¶æ€åç«¯
env.setStateBackend(new RocksDBStateBackend("file:///path/to/rocksdb"));

// é…ç½®å¢é‡æ£€æŸ¥ç‚¹
env.getCheckpointConfig().setIncrementalCheckpointingEnabled(true);
```

### ååºåˆ—åŒ–é—®é¢˜

ååºåˆ—åŒ–é”™è¯¯å¯èƒ½å¯¼è‡´ä½œä¸šå¤±è´¥ï¼š

```java
// è‡ªå®šä¹‰åºåˆ—åŒ–å™¨
env.getConfig().addKryoSerializer(MyCustomType.class, MyCustomSerializer.class);

// æ³¨å†Œç±»å‹
env.getConfig().registerTypeWithKryoSerializer(MyCustomType.class, MyCustomSerializer.class);
```

## é«˜çº§è°ƒè¯•å·¥å…·

é™¤äº†Flinkå†…ç½®çš„è°ƒè¯•å·¥å…·ï¼Œè¿˜æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°è°ƒè¯•Flinkä½œä¸šã€‚

### Apache Flink Profiler

Flink Profileræ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºFlinkä½œä¸šæ€§èƒ½åˆ†æçš„å·¥å…·ï¼š

```bash
# å¯åŠ¨Flink Profiler
./bin/flink run -d -p ./profiler ./examples/streaming/WordCount.jar
```

### Apache Flink Metrics

Flink Metricsæä¾›äº†ä¸°å¯Œçš„åº¦é‡æŒ‡æ ‡ï¼Œç”¨äºç›‘æ§å’Œåˆ†æä½œä¸šæ€§èƒ½ï¼š

```java
// æ³¨å†Œè‡ªå®šä¹‰æŒ‡æ ‡
getRuntimeContext().getMetricGroup()
    .addGroup("wordcount")
    .gauge("last-processed-timestamp", System::currentTimeMillis);
```

## æœ€ä½³å®è·µ

éµå¾ªæœ€ä½³å®è·µå¯ä»¥å¤§å¤§æé«˜è°ƒè¯•æ•ˆç‡å’Œæ•ˆæœã€‚

### å¼€å‘é˜¶æ®µè°ƒè¯•

1. ä½¿ç”¨æœ¬åœ°ç¯å¢ƒè¿›è¡Œå¼€å‘å’Œæµ‹è¯•
2. ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
3. ä½¿ç”¨å°æ•°æ®é›†è¿›è¡ŒéªŒè¯
4. æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•

### ç”Ÿäº§ç¯å¢ƒè°ƒè¯•

1. å¯ç”¨è¯¦ç»†çš„æ—¥å¿—è®°å½•
2. é…ç½®é€‚å½“çš„ç›‘æ§å’Œå‘Šè­¦
3. ä½¿ç”¨æ£€æŸ¥ç‚¹æœºåˆ¶è¿›è¡Œæ•…éšœæ¢å¤
4. å®šæœŸè¿›è¡Œæ€§èƒ½æµ‹è¯•å’Œè°ƒä¼˜

## ç»“è¯­

è°ƒè¯•å’Œæ•…éšœæ’é™¤æ˜¯æ„å»ºå¥å£®æµå¤„ç†ç³»ç»Ÿçš„å…³é”®æŠ€èƒ½ã€‚é€šè¿‡æŒæ¡Flinkçš„é«˜çº§è°ƒè¯•æŠ€æœ¯å’Œæ•…éšœæ’é™¤ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¿«åœ°å®šä½å’Œè§£å†³é—®é¢˜ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿå¯é æ€§ã€‚

éšç€Flinkçš„ä¸æ–­å‘å±•å’Œæ¼”è¿›ï¼Œè°ƒè¯•å·¥å…·å’ŒæŠ€æœ¯ä¹Ÿåœ¨ä¸æ–­æ›´æ–°ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦æŒç»­å­¦ä¹ å’Œå®è·µï¼Œä¸æ–­æå‡è‡ªå·±çš„è°ƒè¯•èƒ½åŠ›ï¼Œæ„å»ºæ›´åŠ é«˜æ•ˆå’Œå¯é çš„æµå¤„ç†åº”ç”¨ã€‚

> "è°ƒè¯•æ˜¯ç¼–ç¨‹çš„äºŒåˆ†ä¹‹ä¸€ã€‚" â€” éšç€Flinkåº”ç”¨çš„å¤æ‚æ€§å¢åŠ ï¼Œè°ƒè¯•çš„é‡è¦æ€§æ„ˆå‘å‡¸æ˜¾ã€‚æŒæ¡é«˜çº§è°ƒè¯•æŠ€æœ¯ï¼Œå°†ä½¿ä½ åœ¨æ„å»ºæµå¤„ç†ç³»ç»Ÿæ—¶æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚