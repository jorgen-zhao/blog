---
title: Flinkä¸æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ-æ„å»ºå®æ—¶æ•°æ®ç®¡é“çš„å…³é”®ç»„ä»¶
date: 2026-02-03
tags: [Flink, æ¶ˆæ¯é˜Ÿåˆ—, å®æ—¶æ•°æ®ç®¡é“]
---

## å‰è¨€

å¤§å®¶å¥½ï¼æˆ‘æ˜¯Jorgenï¼Œä»Šå¤©æƒ³å’Œå¤§å®¶èŠä¸€èŠæˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªè¯é¢˜ï¼š**Flinkä¸æ¶ˆæ¯é˜Ÿåˆ—çš„é›†æˆ**ã€‚ğŸš€

åœ¨æ„å»ºå®æ—¶æ•°æ®ç®¡é“çš„è¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å’Œæµå¤„ç†å¼•æ“å°±åƒæ˜¯"å¤©ä½œä¹‹åˆ"ã€‚æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†æ•°æ®ç¼“å†²å’Œè§£è€¦çš„èƒ½åŠ›ï¼Œè€ŒFlinkåˆ™æä¾›äº†å¼ºå¤§çš„å®æ—¶è®¡ç®—èƒ½åŠ›ã€‚å°†ä¸¤è€…ç»“åˆèµ·æ¥ï¼Œå¯ä»¥æ„å»ºå‡ºé«˜æ•ˆã€å¯é ä¸”å¯æ‰©å±•çš„å®æ—¶æ•°æ®å¤„ç†ç³»ç»Ÿã€‚

ç„¶è€Œï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘å‘ç°å¾ˆå¤šå¼€å‘è€…å¯¹äºFlinkä¸å„ç§æ¶ˆæ¯é˜Ÿåˆ—çš„é›†æˆç»†èŠ‚å’Œæœ€ä½³å®è·µå¹¶ä¸ç†Ÿæ‚‰ã€‚ä»Šå¤©ï¼Œæˆ‘å°±æ¥åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨è¿™ä¸ªé¢†åŸŸçš„ä¸€äº›ç»éªŒå’Œè§è§£ã€‚

::: tip
æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æµå¤„ç†ç³»ç»Ÿä¸­çš„"æ•°æ®é«˜é€Ÿå…¬è·¯"ï¼Œè€ŒFlinkåˆ™æ˜¯è¿™æ¡è·¯ä¸Šçš„"è¶…çº§è·‘è½¦"ã€‚åªæœ‰ä¸¤è€…å®Œç¾é…åˆï¼Œæ‰èƒ½å®ç°æ•°æ®çš„æé€ŸæµåŠ¨å’Œå¤„ç†ã€‚
:::

## ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ

åœ¨æ·±å…¥æ¢è®¨Flinkä¸æ¶ˆæ¯é˜Ÿåˆ—çš„é›†æˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨æµå¤„ç†ç³»ç»Ÿä¸­éœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ã€‚

### æ¶ˆæ¯é˜Ÿåˆ—çš„æ ¸å¿ƒä»·å€¼

1. **ç³»ç»Ÿè§£è€¦**ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥ç‹¬ç«‹æ‰©å±•å’Œéƒ¨ç½²ï¼Œäº’ä¸å½±å“ã€‚
2. **æµé‡å‰Šå³°**ï¼šåº”å¯¹çªå‘æµé‡ï¼Œé˜²æ­¢ç³»ç»Ÿè¢«å‹å®ã€‚
3. **æ•°æ®ç¼“å†²**ï¼šåœ¨æ¶ˆè´¹è€…å¤„ç†èƒ½åŠ›ä¸è¶³æ—¶ï¼Œæä¾›æ•°æ®ç¼“å†²ã€‚
4. **å¯é æ€§ä¿è¯**ï¼šç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ï¼Œæ”¯æŒé‡è¯•æœºåˆ¶ã€‚

### ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”

| æ¶ˆæ¯é˜Ÿåˆ— | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| Apache Kafka | é«˜ååã€æŒä¹…åŒ–ã€åˆ†åŒºæœºåˆ¶ | å¤§è§„æ¨¡å®æ—¶æ•°æ®æµå¤„ç† |
| RabbitMQ | è·¯ç”±çµæ´»ã€æ”¯æŒå¤šç§åè®® | ä¼ä¸šçº§æ¶ˆæ¯è·¯ç”± |
| Apache Pulsar | å¤šç§Ÿæˆ·ã€ç»Ÿä¸€å­˜å‚¨è®¡ç®— | äº‘åŸç”Ÿæ¶æ„ |
| RocketMQ | ä½å»¶è¿Ÿã€äº‹åŠ¡æ¶ˆæ¯ | é‡‘èäº¤æ˜“åœºæ™¯ |

::: theorem
é€‰æ‹©æ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œåº”è€ƒè™‘æ•°æ®é‡ã€å»¶è¿Ÿè¦æ±‚ã€å¯é æ€§éœ€æ±‚ä»¥åŠå›¢é˜ŸæŠ€æœ¯æ ˆç­‰å› ç´ ã€‚æ²¡æœ‰"æœ€å¥½"çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªæœ‰"æœ€é€‚åˆ"çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚
:::

## Flinkä¸Kafkaé›†æˆ

Kafkaæ˜¯ç›®å‰ä¸Flinké›†æˆæœ€å¹¿æ³›çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸¤è€…éƒ½æ˜¯Apacheæ——ä¸‹çš„é¡¶çº§é¡¹ç›®ï¼Œå¤©ç”Ÿä¸€å¯¹ã€‚ğŸ˜

### åŸºæœ¬é›†æˆæ–¹å¼

åœ¨Flinkä¸­æ¶ˆè´¹Kafkaæ•°æ®éå¸¸ç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨`FlinkKafkaConsumer`ï¼š

```java
Properties properties = new Properties();
properties.setProperty("bootstrap.servers", "localhost:9092");
properties.setProperty("group.id", "flink-consumer");

FlinkKafkaConsumer<String> kafkaConsumer = new FlinkKafkaConsumer<>(
    "topic-name", 
    new SimpleStringSchema(), 
    properties
);

DataStream<String> stream = env.addSource(kafkaConsumer);
```

### é«˜çº§é…ç½®ä¸æœ€ä½³å®è·µ

#### 1. æ¶ˆè´¹è€…åç§»é‡ç®¡ç†

```java
properties.setProperty("enable.auto.commit", "false");
properties.setProperty("auto.offset.reset", "earliest");
```

::: tip
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®æ‰‹åŠ¨ç®¡ç†åç§»é‡ï¼Œå¹¶ç»“åˆFlinkçš„Checkpointæœºåˆ¶ï¼Œå®ç°Exactly-Onceè¯­ä¹‰ã€‚
:::

#### 2. ååºåˆ—åŒ–ä¼˜åŒ–

Kafkaæ¶ˆæ¯çš„ååºåˆ—åŒ–æ˜¯æ€§èƒ½ç“¶é¢ˆä¹‹ä¸€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨ï¼š

```java
public class CustomDeserializer implements DeserializationSchema<MyEvent> {
    @Override
    public MyEvent deserialize(byte message) {
        // è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘
    }
    
    @Override
    public boolean isEndOfStream(MyEvent nextElement) {
        return false;
    }
    
    @Override
    public TypeInformation<MyEvent> getProducedType() {
        return TypeInformation.of(MyEvent.class);
    }
}
```

#### 3. æ‰¹é‡æ¶ˆè´¹ä¸å¤„ç†

```java
FlinkKafkaConsumer<MyEvent> kafkaConsumer = new FlinkKafkaConsumer<>(
    "topic-name",
    new CustomDeserializer(),
    properties,
    OffsetStorageProperties::new // å¯ç”¨æ‰¹é‡è¯»å–
);
```

## Flinkä¸RabbitMQé›†æˆ

è™½ç„¶Kafkaåœ¨å¤§æ•°æ®åœºæ™¯ä¸­æ›´å¸¸è§ï¼Œä½†RabbitMQåœ¨ä¼ä¸šåº”ç”¨ä¸­ä»ç„¶å æ®é‡è¦åœ°ä½ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å°†Flinkä¸RabbitMQé›†æˆã€‚

### åŸºæœ¬é›†æˆæ–¹å¼

```java
FlinkRabbitMQConsumer<String> rabbitMQConsumer = new FlinkRabbitMQConsumer<>(
    "exchange-name", 
    "routing-key", 
    new SimpleStringSchema(), 
    new RMQConnectionConfig.Builder()
        .setHost("localhost")
        .setPort(5672)
        .setUsername("guest")
        .setPassword("guest")
        .build()
);

DataStream<String> stream = env.addSource(rabbitMQConsumer);
```

### é«˜çº§ç‰¹æ€§

#### 1. æ¶ˆæ¯ç¡®è®¤æœºåˆ¶

```java
// è®¾ç½®æ¶ˆæ¯ç¡®è®¤æ¨¡å¼
rabbitMQConsumer.setAckMode(AckMode.AUTO);
```

#### 2. æ¶ˆæ¯æŒä¹…åŒ–

```java
// é…ç½®é˜Ÿåˆ—æŒä¹…åŒ–
Map<String, Object> queueArguments = new HashMap<>();
queueArguments.put("x-ha-policy", "all");
rabbitMQConsumer.setQueueArguments(queueArguments);
```

## Flinkä¸Pulsaré›†æˆ

Pulsarä½œä¸ºæ–°å…´çš„äº‘åŸç”Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸Flinkçš„é›†æˆä¹Ÿè¶Šæ¥è¶Šå—åˆ°å…³æ³¨ã€‚

### åŸºæœ¬é›†æˆæ–¹å¼

```java
PulsarSource<String> pulsarSource = PulsarSource.builder()
    .serviceUrl("pulsar://localhost:6650")
    .topic("persistent://my-namespace/my-topic")
    .subscriptionName("my-subscription")
    .format(new SimpleStringSchema())
    .build();

DataStream<String> stream = env.addSource(pulsarSource);
```

### Pulsarç‹¬ç‰¹ä¼˜åŠ¿

1. **å¤šç§Ÿæˆ·æ”¯æŒ**ï¼šåŸç”Ÿæ”¯æŒå¤šç§Ÿæˆ·éš”ç¦»
2. **ç»Ÿä¸€å­˜å‚¨è®¡ç®—**ï¼šè®¡ç®—å’Œå­˜å‚¨åˆ†ç¦»æ¶æ„
3. **Schemaç®¡ç†**ï¼šå†…ç½®Schemaç®¡ç†åŠŸèƒ½

## å®æˆ˜æ¡ˆä¾‹ï¼šæ„å»ºå®æ—¶æ•°æ®ç®¡é“

ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…æ¡ˆä¾‹æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨Flinkå’ŒKafkaæ„å»ºä¸€ä¸ªå®æ—¶æ•°æ®ç®¡é“ã€‚

### åœºæ™¯æè¿°

æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªå®æ—¶ç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿï¼Œæ¥æ”¶æ¥è‡ªå¤šä¸ªåº”ç”¨çš„æ—¥å¿—æ•°æ®ï¼Œè¿›è¡Œå®æ—¶å¤„ç†å’Œåˆ†æï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°Elasticsearchä¸­ã€‚

### æ¶æ„è®¾è®¡

```
[åº”ç”¨] -> [Kafka] -> [Flink] -> [Elasticsearch]
```

### å®ç°ä»£ç 

```java
// 1. åˆ›å»ºFlinkæ‰§è¡Œç¯å¢ƒ
StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();

// 2. é…ç½®Kafkaæ¶ˆè´¹è€…
Properties kafkaProps = new Properties();
kafkaProps.setProperty("bootstrap.servers", "kafka1:9092,kafka2:9092");
kafkaProps.setProperty("group.id", "user-behavior-analysis");

// 3. åˆ›å»ºKafkaæº
FlinkKafkaConsumer<UserEvent> kafkaSource = new FlinkKafkaConsumer<>(
    "user-events",
    new UserEventDeserializer(),
    kafkaProps
);

// å¯ç”¨Checkpoint
env.enableCheckpointing(5000); // 5ç§’ä¸€æ¬¡Checkpoint
env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);
env.getCheckpointConfig().setMinPauseBetweenCheckpoints(300);
env.getCheckpointConfig().setCheckpointTimeout(60000);
env.getCheckpointConfig().setMaxConcurrentCheckpoints(1);
env.getCheckpointConfig().enableExternalizedCheckpoints(CheckpointConfig.ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);

// 4. æ·»åŠ æ•°æ®æº
DataStream<UserEvent> events = env.addSource(kafkaSource);

// 5. æ•°æ®å¤„ç†
DataStream<UserBehavior> behaviors = events
    .filter(event -> event.isValid()) // è¿‡æ»¤æ— æ•ˆæ•°æ®
    .keyBy(event -> event.getUserId()) // æŒ‰ç”¨æˆ·IDåˆ†ç»„
    .timeWindow(Time.minutes(5)) // 5åˆ†é’Ÿçª—å£
    .process(new UserBehaviorProcessFunction()); // è‡ªå®šä¹‰å¤„ç†å‡½æ•°

// 6. è¾“å‡ºåˆ°Elasticsearch
ElasticsearchSink.Builder<UserBehavior> esSinkBuilder = new ElasticsearchSink.Builder<>(
    behaviors,
    new ArrayList<>(Arrays.asList(
        new Host("http", "elasticsearch1", 9200),
        new Host("http", "elasticsearch2", 9200)
    )),
    new ElasticsearchSinkFunction<UserBehavior>() {
        @Override
        public void process(UserBehavior element, RuntimeContext ctx, RequestIndexer indexer) {
            Map<String, Object> json = new HashMap<>();
            json.put("user_id", element.getUserId());
            json.put("behavior_type", element.getBehaviorType());
            json.put("timestamp", element.getTimestamp());
            json.put("window_end", element.getWindowEnd());
            
            indexer.add(Requests.indexRequest()
                .index("user-behaviors")
                .type("_doc")
                .source(json));
        }
    }
);

// é…ç½®æ‰¹é‡åˆ·æ–°å’Œé‡è¯•
esSinkBuilder.setBulkFlushMaxActions(1000);
esSinkBuilder.setBulkFlushMaxMb(10);
esSinkBuilder.setBulkFlushInterval(1);
esSinkBuilder.setFailureHandler(new AfterFailureRetryHandler());

// æ·»åŠ Sink
behaviors.addSink(esSinkBuilder.build());

// 7. æ‰§è¡Œä½œä¸š
env.execute("User Behavior Analysis Pipeline");
```

## æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ

### 1. æ¶ˆè´¹è€…å¹¶è¡Œåº¦è®¾ç½®

```java
// æ ¹æ®Kafkaåˆ†åŒºæ•°è®¾ç½®å¹¶è¡Œåº¦
int parallelism = kafkaSource.getPartitionsForTopic("topic-name").size();
env.setParallelism(parallelism);
```

### 2. ååºåˆ—åŒ–ä¼˜åŒ–

```java
// ä½¿ç”¨Flinkçš„Kafka DeserializationSchemaæ¥å£
public class CustomDeserializer implements DeserializationSchema<MyEvent> {
    private final ObjectMapper objectMapper = new ObjectMapper();
    
    @Override
    public MyEvent deserialize(byte[] message) {
        try {
            return objectMapper.readValue(message, MyEvent.class);
        } catch (IOException e) {
            throw new RuntimeException("Failed to deserialize message", e);
        }
    }
    
    @Override
    public boolean isEndOfStream(MyEvent nextElement) {
        return false;
    }
    
    @Override
    public TypeInformation<MyEvent> getProducedType() {
        return TypeInformation.of(MyEvent.class);
    }
}
```

### 3. æ‰¹é‡å¤„ç†ä¸èƒŒå‹æ§åˆ¶

```java
// å¯ç”¨æ‰¹é‡å¤„ç†
env.getConfig().setUseBatchProcessing(true);

// è®¾ç½®èƒŒå‹ç›‘æ§
env.setBufferTimeout(100); // 100ms

// ç›‘æ§èƒŒå‹
env.executeAsync().getJobExecutionResult().getAllAccumulatorResults().forEach(
    (k, v) -> System.out.println(k + ": " + v)
);
```

## ç»“è¯­

é€šè¿‡ä»Šå¤©çš„åˆ†äº«ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†Flinkä¸å„ç§æ¶ˆæ¯é˜Ÿåˆ—çš„é›†æˆæ–¹å¼ã€æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚ğŸ‰

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„æ¶ˆæ¯é˜Ÿåˆ—å¹¶æ­£ç¡®é…ç½®ä¸Flinkçš„é›†æˆï¼Œæ˜¯æ„å»ºé«˜æ•ˆå®æ—¶æ•°æ®ç®¡é“çš„å…³é”®ä¸€æ­¥ã€‚æ— è®ºæ˜¯Kafkaçš„é«˜ååã€RabbitMQçš„çµæ´»æ€§è¿˜æ˜¯Pulsarçš„äº‘åŸç”Ÿç‰¹æ€§ï¼Œéƒ½å¯ä»¥ä¸Flinkå®Œç¾ç»“åˆï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚

> æ­£å¦‚ä¸€å¥åè¨€æ‰€è¯´ï¼š"åœ¨æµå¤„ç†çš„ä¸–ç•Œé‡Œï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ•°æ®çš„'é«˜é€Ÿå…¬è·¯'ï¼Œè€ŒFlinkåˆ™æ˜¯è¿™æ¡è·¯ä¸Šçš„'è¶…çº§è·‘è½¦'ã€‚åªæœ‰ä¸¤è€…å®Œç¾é…åˆï¼Œæ‰èƒ½å®ç°æ•°æ®çš„æé€ŸæµåŠ¨å’Œå¤„ç†ã€‚"

å¸Œæœ›ä»Šå¤©çš„åˆ†äº«èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–ç»éªŒæƒ³è¦åˆ†äº«ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµã€‚ğŸ˜Š

ç¥å¤§å®¶æŠ€æœ¯æˆé•¿é¡ºåˆ©ï¼Œæ„å»ºå‡ºæ›´åŠ é«˜æ•ˆã€å¯é çš„å®æ—¶æ•°æ®å¤„ç†ç³»ç»Ÿï¼ğŸ’ª

---

*æ³¨ï¼šæœ¬æ–‡åŸºäºä½œè€…åœ¨å®é™…é¡¹ç›®ä¸­çš„ç»éªŒæ€»ç»“ï¼Œå¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚*