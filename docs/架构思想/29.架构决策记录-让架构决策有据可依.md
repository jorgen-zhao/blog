---
title: 架构决策记录-让架构决策有据可依
date: 2023-11-15 10:30:00
categories: 
  - 架构思想
tags:
  - ADR
  - 架构决策
  - 技术文档
author: 
  name: Jorgen
  link: https://github.com/jorgen-zhao
---

## 前言

在软件开发过程中，我们每天都会做出无数决策：选择哪种技术栈、采用什么架构模式、如何解决特定问题...这些决策往往影响着项目的长期走向和可维护性。然而，随着时间的推移，这些决策的背景、原因和后果很容易被遗忘，导致团队在面临类似问题时重复讨论，甚至做出不一致的选择。

🤔 你是否也曾遇到过这样的场景：
- 新成员加入团队，询问为什么选择这个技术方案，却找不到当初的决策依据？
- 项目重构时，不确定某个组件是否可以安全修改，因为不清楚当初的设计意图？
- 团队成员对同一个问题有不同的理解，因为缺乏统一的决策记录？

这些问题都可以通过架构决策记录(ADR)来解决。今天，我想和大家分享这个简单却强大的工具，帮助我们的架构决策更加透明、有据可依。

## 什么是架构决策记录？

::: theorem
**架构决策记录(Architecture Decision Records, ADR)** 是一种轻量级的文档技术，用于记录软件架构中的重要决策及其背景、权衡和后果。
:::

简单来说，ADR就像是架构决策的"日记本"，它记录了"我们为什么选择这条路，而不是那条路"。每条ADR通常包含以下要素：

1. **决策编号和标题**：如"ADR-001: 选择PostgreSQL作为主数据库"
2. **状态**：如"已采纳"、"已否决"、"已替换"
3. **日期**：记录决策的时间
4. **背景**：描述面临的问题和上下文
5. **决策**：明确说明做出的选择
6. **后果**：讨论决策带来的积极和消极影响
7. **替代方案**：考虑过但未选择的其他方案及其原因

## 为什么需要ADR？

在我多年的架构实践中，ADR带来了诸多益处：

### 📈 知识传承与团队协作
ADR构建了团队的"集体记忆"，新成员可以快速了解项目的设计思路，减少沟通成本。当有人质疑"为什么我们这样做"时，ADR提供了明确的答案。

### 🧠 促进思考与决策质量
记录决策的过程迫使团队深入思考各种方案的优劣，而不是草率决定。这个过程本身就是一种架构思维的训练。

### 🔄 架构演进的可追溯性
当架构需要演进时，ADR提供了清晰的决策历史，帮助我们理解当前架构的形成过程，避免重复犯错。

### 📚 技术债务的透明化管理
通过ADR，团队可以明确记录技术债务及其原因，为后续重构提供依据，而不是让技术债务"暗藏"在代码中。

## 如何编写有效的ADR？

编写ADR不需要复杂的工具，一个简单的Markdown文件就足够了。以下是我常用的ADR模板：

```markdown
# ADR-[编号]: [决策标题]

**状态**: [已采纳/已否决/已替换]  
**日期**: [YYYY-MM-DD]  
**决策者**: [姓名]  
**相关ADR**: [其他相关ADR的编号]

## 背景

[描述面临的问题、上下文和约束条件]

## 决策

[明确说明做出的选择]

## 后果

### 积极
- [列出决策带来的积极影响]

### 消极
- [列出决策可能带来的负面影响或风险]

## 替代方案

1. **[方案名称]**
   - [简述方案内容]
   - [否决原因]
```

## 实践案例：微服务架构决策

让我分享一个真实的案例，展示ADR如何在实际项目中发挥作用。

### ADR-003: 采用微服务架构拆分用户服务

**状态**: 已采纳  
**日期**: 2023-03-15  
**决策者**: 架构团队  
**相关ADR**: ADR-002: 确定系统边界

## 背景

我们的电商平台最初采用单体架构，随着业务快速发展，用户模块变得越来越复杂：
- 开发团队规模扩大，多人同时修改同一模块导致频繁冲突
- 用户功能迭代速度慢，影响业务响应能力
- 部署和扩展困难，无法针对用户服务进行独立优化
- 技术栈选择受限，难以针对不同场景选择最适合的技术

## 决策

我们将用户模块从单体应用中拆分为独立的微服务，采用以下原则：
1. 按业务领域划分服务边界
2. 服务间通过API通信，采用RESTful风格
3. 每个服务拥有独立的数据库
4. 实施服务注册与发现机制

## 后果

### 积极
- 用户服务可以独立部署和扩展，提高了系统整体可用性
- 不同团队可以并行开发用户相关功能，加速了产品迭代
- 用户服务可以根据自身特点选择最适合的技术栈
- 故障隔离性增强，用户服务的问题不会影响整个系统

### 消极
- 分布式系统复杂性增加，需要处理网络延迟、数据一致性等问题
- 服务间通信成本增加，需要设计合理的API
- 运维复杂度提高，需要管理更多服务实例
- 开发人员需要具备分布式系统设计能力

## 替代方案

1. **继续使用单体架构**
   - 优势：开发简单，部署方便
   - 劣势：无法解决当前面临的扩展性和开发效率问题

2. **采用分层架构**
   - 优势：保持技术栈统一，降低分布式复杂性
   - 劣势：模块间耦合度高，难以独立扩展

## ADR工具推荐

虽然ADR可以简单到只是一个Markdown文件，但也有一些工具可以帮助更好地管理ADR：

1. **adr-tools**：命令行工具，用于管理ADR目录
2. **adr-viewer**：将Markdown ADR转换为美观的网页
3. **GitHub ADR模板**：可以直接在GitHub仓库中使用ADR模板
4. **MADR**：更现代的ADR模板，包含更多最佳实践

## 结语

架构决策记录是一个简单却强大的实践，它帮助我们：
- 📝 **记录决策**：让重要的架构决策不被遗忘
- 🧠 **促进思考**：通过记录过程提高决策质量
- 👥 **增强协作**：构建团队共享的知识库
- 🔄 **支持演进**：为架构变更提供历史依据

在我的团队中，ADR已经成为架构评审的标准环节。每当我们面临重要决策时，首先想到的不是"怎么做"，而是"为什么这么做"并记录下来。这个小小的习惯，却在长期中带来了巨大的价值。

> 正如著名软件架构家Martin Fowler所说："架构不仅仅是关于结构的，更是关于决策的。记录这些决策，就是记录了架构的灵魂。"

如果你还没有在你的项目中实践ADR，我强烈推荐从今天开始尝试。从记录一个简单的决策开始，你会发现它带来的价值远超预期。

架构决策记录，让我们的架构智慧得以传承，让每一个决策都有据可依。

---

*ADR-000: 本ADR模板*  
*ADR-001: 开始在项目中实践ADR*  
*ADR-002: 确定系统边界*  
*ADR-003: 采用微服务架构拆分用户服务*
```