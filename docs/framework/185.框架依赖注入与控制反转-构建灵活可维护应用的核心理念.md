---
title: æ¡†æ¶ä¾èµ–æ³¨å…¥ä¸æ§åˆ¶åè½¬-æ„å»ºçµæ´»å¯ç»´æŠ¤åº”ç”¨çš„æ ¸å¿ƒç†å¿µ
date: 2026-02-03
tags:
  - æ¡†æ¶è®¾è®¡
  - ä¾èµ–æ³¨å…¥
  - æ§åˆ¶åè½¬
---

## å‰è¨€

åœ¨æ¡†æ¶è®¾è®¡ä¸å¼€å‘çš„ä¸–ç•Œé‡Œï¼Œæœ‰ä¸¤ä¸ªæ¦‚å¿µå‡ ä¹æ— å¤„ä¸åœ¨ï¼Œå´åˆå¸¸å¸¸è¢«å¼€å‘è€…æ‰€å¿½è§†â€”â€”**ä¾èµ–æ³¨å…¥(Dependency Injection, DI)**å’Œ**æ§åˆ¶åè½¬(Inversion of Control, IoC)**ã€‚è¿™ä¸¤ä¸ªçœ‹ä¼¼æŠ½è±¡çš„æ¦‚å¿µï¼Œå®é™…ä¸Šæ˜¯æ„å»ºçµæ´»ã€å¯æµ‹è¯•ã€å¯ç»´æŠ¤ç°ä»£åº”ç”¨çš„åŸºçŸ³ã€‚ğŸ¤”

åœ¨è¿‡å»çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘æ·±å…¥ç ”ç©¶äº†å„ç§ä¸»æµæ¡†æ¶çš„æºç ï¼Œå‘ç°æ— è®ºæ˜¯å‰ç«¯æ¡†æ¶å¦‚Vueã€Reactï¼Œè¿˜æ˜¯åç«¯æ¡†æ¶å¦‚Springã€Expressï¼Œå…¶æ ¸å¿ƒæ¶æ„éƒ½ç¦»ä¸å¼€è¿™ä¸¤ä¸ªç†å¿µçš„æ”¯æ’‘ã€‚ç„¶è€Œï¼Œå¾ˆå°‘æœ‰æ–‡ç« ä¸“é—¨ä»æ¡†æ¶è®¾è®¡è€…çš„è§’åº¦ï¼Œæ·±å…¥æ¢è®¨å¦‚ä½•å®ç°ä¸€ä¸ªä¼˜é›…çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿã€‚ğŸ“¡

ä»Šå¤©ï¼Œæˆ‘æƒ³å’Œå¤§å®¶ä¸€èµ·æ­å¼€è¿™å±‚ç¥ç§˜é¢çº±ï¼Œæ¢ç´¢æ¡†æ¶ä¸­ä¾èµ–æ³¨å…¥ä¸æ§åˆ¶åè½¬çš„å®ç°åŸç†ï¼Œä»¥åŠå¦‚ä½•åœ¨è‡ªå·±çš„æ¡†æ¶ä¸­åº”ç”¨è¿™äº›æ ¸å¿ƒç†å¿µã€‚ğŸ’¡

## ä¾èµ–æ³¨å…¥ä¸æ§åˆ¶åè½¬åŸºç¡€

### ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬ï¼Ÿ

æ§åˆ¶åè½¬æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡åŸåˆ™ï¼Œå®ƒå°†æ§åˆ¶æƒä»ç¨‹åºä»£ç è½¬ç§»åˆ°æ¡†æ¶æˆ–å¤–éƒ¨å®¹å™¨ä¸­ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯**"æ¡†æ¶è°ƒç”¨ä»£ç ï¼Œè€Œä¸æ˜¯ä»£ç è°ƒç”¨æ¡†æ¶"**ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨æ²¡æœ‰IoCçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·å†™ä»£ç ï¼š

```javascript
class UserService {
  constructor() {
    this.database = new Database(); // ç›´æ¥åˆ›å»ºä¾èµ–
  }
  
  getUser(id) {
    return this.database.query(`SELECT * FROM users WHERE id = ${id}`);
  }
}
```

è€Œåœ¨IoCæ¨¡å¼ä¸‹ï¼Œä¾èµ–å…³ç³»ä¼šè¢«"åè½¬"ï¼š

```javascript
class UserService {
  constructor(database) { // é€šè¿‡æ„é€ å‡½æ•°æ¥æ”¶ä¾èµ–
    this.database = database;
  }
  
  getUser(id) {
    return this.database.query(`SELECT * FROM users WHERE id = ${id}`);
  }
}

// æ¡†æ¶è´Ÿè´£åˆ›å»ºå¹¶æ³¨å…¥Databaseå®ä¾‹
const database = new Database();
const userService = new UserService(database);
```

### ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ

ä¾èµ–æ³¨å…¥æ˜¯å®ç°IoCçš„ä¸€ç§å…·ä½“æ–¹å¼ã€‚å®ƒæŒ‡çš„æ˜¯å°†ä¾èµ–å¯¹è±¡"æ³¨å…¥"åˆ°éœ€è¦å®ƒçš„å¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯è®©å¯¹è±¡è‡ªå·±åˆ›å»ºä¾èµ–ã€‚DIä¸»è¦æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼š

1. **æ„é€ å‡½æ•°æ³¨å…¥**ï¼šé€šè¿‡æ„é€ å‡½æ•°ä¼ é€’ä¾èµ–
2. **å±æ€§æ³¨å…¥**ï¼šé€šè¿‡å±æ€§è®¾ç½®ä¾èµ–
3. **æ–¹æ³•æ³¨å…¥**ï¼šé€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’ä¾èµ–

::: tip
æ§åˆ¶åè½¬æ˜¯è®¾è®¡åŸåˆ™ï¼Œè€Œä¾èµ–æ³¨å…¥æ˜¯å®ç°è¿™ä¸€åŸåˆ™çš„å…·ä½“æŠ€æœ¯æ‰‹æ®µã€‚å¯ä»¥è¯´ï¼ŒDIæ˜¯IoCæœ€å¸¸è§çš„ä¸€ç§å®ç°æ–¹å¼ã€‚
:::

## æ¡†æ¶ä¸­çš„ä¾èµ–æ³¨å…¥å®ç°

### å®¹å™¨ä¸æ³¨å†Œæœºåˆ¶

ç°ä»£æ¡†æ¶é€šå¸¸ä½¿ç”¨ä¸€ä¸ª**å®¹å™¨**(Container)æ¥ç®¡ç†æ‰€æœ‰å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ã€‚å®¹å™¨è´Ÿè´£ï¼š

1. **æ³¨å†Œ**ï¼šå°†ç±»æˆ–æ¥å£ä¸å…¶å®ä¾‹å…³è”
2. **è§£æ**ï¼šæ ¹æ®è¯·æ±‚åˆ›å»ºå®ä¾‹å¹¶è§£å†³ä¾èµ–å…³ç³»
3. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ§åˆ¶å¯¹è±¡çš„åˆ›å»ºã€ä½¿ç”¨å’Œé”€æ¯

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„DIå®¹å™¨å®ç°ï¼š

```javascript
class Container {
  constructor() {
    this.services = new Map();
    this.singletons = new Map();
  }
  
  register(name, implementation, options = {}) {
    this.services.set(name, {
      implementation,
      singleton: options.singleton || false
    });
  }
  
  get(name) {
    if (!this.services.has(name)) {
      throw new Error(`Service ${name} not found`);
    }
    
    const service = this.services.get(name);
    
    // å¦‚æœæ˜¯å•ä¾‹ä¸”å·²åˆ›å»ºï¼Œç›´æ¥è¿”å›
    if (service.singleton && this.singletons.has(name)) {
      return this.singletons.get(name);
    }
    
    // åˆ›å»ºæ–°å®ä¾‹
    const instance = this.createInstance(service.implementation);
    
    // å¦‚æœæ˜¯å•ä¾‹ï¼Œç¼“å­˜å®ä¾‹
    if (service.singleton) {
      this.singletons.set(name, instance);
    }
    
    return instance;
  }
  
  createInstance(implementation) {
    // è·å–æ„é€ å‡½æ•°çš„ä¾èµ–å‚æ•°
    const dependencies = this.getDependencies(implementation);
    
    // åˆ›å»ºå®ä¾‹å¹¶æ³¨å…¥ä¾èµ–
    return new implementation(...dependencies);
  }
  
  getDependencies(implementation) {
    // é€šè¿‡åå°„è·å–æ„é€ å‡½æ•°å‚æ•°
    // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…å®ç°ä¼šæ›´å¤æ‚
    return [];
  }
}
```

### ä¾èµ–è§£æä¸è‡ªåŠ¨æ³¨å…¥

ç°ä»£æ¡†æ¶é€šå¸¸æ”¯æŒ**è‡ªåŠ¨è§£æ**ä¾èµ–ï¼Œé€šè¿‡åå°„æˆ–è£…é¥°å™¨æœºåˆ¶è‡ªåŠ¨è¯†åˆ«ç±»çš„ä¾èµ–éœ€æ±‚ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´å®Œæ•´çš„å®ç°ï¼š

```javascript
function Injectable() {
  return function(target) {
    // å°†ç±»æ³¨å†Œåˆ°å®¹å™¨
    container.register(target.name, target);
  };
}

function Inject(serviceName) {
  return function(target, propertyKey, parameterIndex) {
    // å­˜å‚¨ä¾èµ–ä¿¡æ¯ï¼Œä¾›åç»­è§£æä½¿ç”¨
    if (!target.__dependencies) {
      target.__dependencies = [];
    }
    target.__dependencies[parameterIndex] = serviceName;
  };
}

class Database {
  connect() {
    console.log('Connected to database');
  }
}

@Injectable()
class UserService {
  constructor(@Inject('Database') database) {
    this.database = database;
  }
  
  getUser(id) {
    return `User ${id} from database`;
  }
}

// ä½¿ç”¨å®¹å™¨
const container = new Container();
container.register('Database', Database);

const userService = container.get('UserService');
console.log(userService.getUser(1)); // è¾“å‡º: User 1 from database
```

### é«˜çº§ç‰¹æ€§ï¼šè£…é¥°å™¨ä¸å…ƒæ•°æ®

ç°ä»£æ¡†æ¶é€šå¸¸åˆ©ç”¨è£…é¥°å™¨å’Œå…ƒæ•°æ®æ¥ç®€åŒ–ä¾èµ–æ³¨å…¥çš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨TypeScriptä¸­ï¼š

```typescript
function Injectable() {
  return (target: any) => {
    // æ³¨å†Œç±»åˆ°å®¹å™¨
    container.register(target.name, target);
  };
}

function Inject(serviceName: string) {
  return (target: any, propertyKey: string, parameterIndex: number) => {
    // å­˜å‚¨ä¾èµ–ä¿¡æ¯
    const dependencies = Reflect.getMetadata('design:paramtypes', target) || [];
    dependencies[parameterIndex] = serviceName;
    Reflect.defineMetadata('dependencies', dependencies, target);
  };
}

@Injectable()
class Logger {
  log(message: string) {
    console.log(`[${new Date().toISOString()}] ${message}`);
  }
}

@Injectable()
class UserService {
  constructor(
    @Inject('Logger') private logger: Logger,
    @Inject('Database') private database: Database
  ) {}
  
  getUser(id: number) {
    this.logger.log(`Fetching user ${id}`);
    return `User ${id}`;
  }
}
```

## ä¸»æµæ¡†æ¶ä¸­çš„ä¾èµ–æ³¨å…¥å®è·µ

### Spring Framework (Java)

Springæ¡†æ¶æ˜¯ä¾èµ–æ³¨å…¥çš„å…¸èŒƒï¼Œå…¶æ ¸å¿ƒæ˜¯`ApplicationContext`å®¹å™¨ï¼š

```java
@Service
public class UserService {
    private final UserRepository userRepository;
    
    // æ„é€ å‡½æ•°æ³¨å…¥
    @Autowired
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
    
    public User getUser(Long id) {
        return userRepository.findById(id);
    }
}
```

### Angular (TypeScript)

Angularä½¿ç”¨ä¾èµ–æ³¨å…¥ä½œä¸ºå…¶æ ¸å¿ƒæ¶æ„çš„ä¸€éƒ¨åˆ†ï¼š

```typescript
@Injectable({
  providedIn: 'root'
})
export class UserService {
  constructor(private http: HttpClient) {}
  
  getUser(id: number): Observable<User> {
    return this.http.get<User>(`/api/users/${id}`);
  }
}
```

### Vue 3 (Composition API)

Vue 3çš„ä¾èµ–æ³¨å…¥æ˜¯é€šè¿‡`provide`å’Œ`inject`å®ç°çš„ï¼š

```javascript
// çˆ¶ç»„ä»¶
import { provide, ref } from 'vue';

export default {
  setup() {
    const user = ref(null);
    provide('user', user);
    // ...
  }
};

// å­ç»„ä»¶
import { inject } from 'vue';

export default {
  setup() {
    const user = inject('user');
    // ä½¿ç”¨user
  }
};
```

### NestJS (Node.js/TypeScript)

NestJSæ˜¯ä¸€ä¸ªåŸºäºä¾èµ–æ³¨å…¥çš„Node.jsæ¡†æ¶ï¼š

```typescript
@Injectable()
export class CatsService {
  constructor(private catsRepository: CatsRepository) {}

  findAll(): Promise<Cat[]> {
    return this.catsRepository.findAll();
  }
}
```

## è®¾è®¡ä¾èµ–æ³¨å…¥ç³»ç»Ÿçš„æœ€ä½³å®è·µ

### 1. æ˜ç¡®ä¾èµ–å…³ç³»

åœ¨è®¾è®¡æ¡†æ¶æ—¶ï¼Œåº”è¯¥æ˜ç¡®å“ªäº›ç»„ä»¶åº”è¯¥è¢«æ³¨å…¥ï¼Œå“ªäº›åº”è¯¥è‡ªè¡Œåˆ›å»ºã€‚ä¸€èˆ¬æ¥è¯´ï¼š

- **æœåŠ¡å±‚**ï¼šåº”è¯¥é€šè¿‡ä¾èµ–æ³¨å…¥è·å–ä¾èµ–
- **å·¥å…·ç±»**ï¼šé€šå¸¸æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯ä»¥ç›´æ¥å®ä¾‹åŒ–
- **é…ç½®å¯¹è±¡**ï¼šé€šå¸¸ä½œä¸ºå•ä¾‹æ³¨å…¥

```javascript
// å¥½çš„è®¾è®¡
@Injectable()
class UserService {
  constructor(
    @Inject('Database') private database,
    @Inject('Logger') private logger
  ) {}
}

// ä¸å¥½çš„è®¾è®¡ - ç›´æ¥åˆ›å»ºä¾èµ–
class UserService {
  constructor() {
    this.database = new Database(); // è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™
    this.logger = new Logger();
  }
}
```

### 2. ç”Ÿå‘½å‘¨æœŸç®¡ç†

ä¸ºä¸åŒç±»å‹çš„ä¾èµ–å®šä¹‰æ˜ç¡®çš„ç”Ÿå‘½å‘¨æœŸï¼š

- **ç¬æ€(Transient)**ï¼šæ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºæ–°å®ä¾‹
- **ä½œç”¨åŸŸ(Scoped)**ï¼šåœ¨ç‰¹å®šä½œç”¨åŸŸå†…å…±äº«å®ä¾‹
- **å•ä¾‹(Singleton)**ï¼šæ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…åªæœ‰ä¸€ä¸ªå®ä¾‹

```javascript
class Container {
  register(name, implementation, options = {}) {
    this.services.set(name, {
      implementation,
      lifecycle: options.lifecycle || 'transient', // é»˜è®¤ä¸ºç¬æ€
      scope: options.scope || 'global' // ä½œç”¨åŸŸ
    });
  }
  
  get(name, scope = 'global') {
    const service = this.services.get(name);
    
    if (service.lifecycle === 'singleton') {
      // å•ä¾‹é€»è¾‘
    } else if (service.lifecycle === 'scoped') {
      // ä½œç”¨åŸŸé€»è¾‘
    } else {
      // ç¬æ€é€»è¾‘
    }
  }
}
```

### 3. å¾ªç¯ä¾èµ–å¤„ç†

å¾ªç¯ä¾èµ–æ˜¯ä¾èµ–æ³¨å…¥ç³»ç»Ÿä¸­æœ€æ£˜æ‰‹çš„é—®é¢˜ä¹‹ä¸€ã€‚å¸¸è§çš„è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ï¼š

1. **å±æ€§æ³¨å…¥**ï¼šåœ¨æ–¹æ³•è°ƒç”¨æ—¶æ³¨å…¥ä¾èµ–ï¼Œè€Œä¸æ˜¯åœ¨æ„é€ æ—¶
2. **ä»£ç†æ¨¡å¼**ï¼šåˆ›å»ºä»£ç†å¯¹è±¡å»¶è¿Ÿè§£æä¾èµ–
3. **äº‹ä»¶æ€»çº¿**ï¼šé€šè¿‡äº‹ä»¶é€šä¿¡æ›¿ä»£ç›´æ¥ä¾èµ–

```javascript
// ä½¿ç”¨å±æ€§æ³¨å…¥è§£å†³å¾ªç¯ä¾èµ–
@Injectable()
class ServiceA {
  @Inject('ServiceB') serviceB;
  
  doSomething() {
    this.serviceB.doSomethingElse();
  }
}

@Injectable()
class ServiceB {
  @Inject('ServiceA') serviceA;
  
  doSomethingElse() {
    this.serviceA.doSomething();
  }
}
```

### 4. ä¾èµ–é…ç½®ä¸è¦†ç›–

åœ¨æµ‹è¯•å’Œä¸åŒç¯å¢ƒä¸­ï¼Œå¯èƒ½éœ€è¦è¦†ç›–æŸäº›ä¾èµ–ã€‚æ¡†æ¶åº”è¯¥æ”¯æŒï¼š

- **ç¯å¢ƒç‰¹å®šé…ç½®**ï¼šæ ¹æ®ç¯å¢ƒå˜é‡é€‰æ‹©ä¸åŒå®ç°
- **æµ‹è¯•æ›¿èº«**ï¼šåœ¨æµ‹è¯•ä¸­æ³¨å…¥æ¨¡æ‹Ÿå¯¹è±¡
- **æ¡ä»¶æ³¨å†Œ**ï¼šåŸºäºæ¡ä»¶æ³¨å†Œä¸åŒçš„å®ç°

```javascript
// ç¯å¢ƒç‰¹å®šé…ç½®
if (process.env.NODE_ENV === 'test') {
  container.register('Database', MockDatabase);
} else {
  container.register('Database', RealDatabase);
}

// æµ‹è¯•æ›¿èº«
describe('UserService', () => {
  let userService;
  
  beforeEach(() => {
    const mockDatabase = new MockDatabase();
    container.register('Database', mockDatabase);
    userService = container.get('UserService');
  });
  
  // æµ‹è¯•...
});
```

## æ¡†æ¶ä¾èµ–æ³¨å…¥ç³»ç»Ÿçš„æ€§èƒ½è€ƒé‡

### 1. å»¶è¿ŸåŠ è½½ä¸æ‡’åˆå§‹åŒ–

å¯¹äºå¤§å‹åº”ç”¨ï¼Œå»¶è¿ŸåŠ è½½å¯ä»¥æ˜¾è‘—æé«˜å¯åŠ¨æ€§èƒ½ï¼š

```javascript
class Container {
  get(name) {
    if (!this.services.has(name)) {
      throw new Error(`Service ${name} not found`);
    }
    
    const service = this.services.get(name);
    
    // æ‡’åˆå§‹åŒ–
    if (!service.instance) {
      service.instance = this.createInstance(service.implementation);
    }
    
    return service.instance;
  }
}
```

### 2. ä¾èµ–è§£æç¼“å­˜

ç¼“å­˜å·²è§£æçš„ä¾èµ–å…³ç³»å¯ä»¥å‡å°‘é‡å¤è®¡ç®—ï¼š

```javascript
class Container {
  constructor() {
    this.services = new Map();
    this.resolutions = new Map(); // ç¼“å­˜è§£æç»“æœ
  }
  
  get(name) {
    // æ£€æŸ¥ç¼“å­˜
    if (this.resolutions.has(name)) {
      return this.resolutions.get(name);
    }
    
    // è§£æå¹¶ç¼“å­˜
    const instance = this.resolve(name);
    this.resolutions.set(name, instance);
    return instance;
  }
}
```

### 3. ä¾èµ–å›¾åˆ†æ

åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆ†æä¾èµ–å›¾ï¼Œå¯ä»¥æå‰å‘ç°æ½œåœ¨é—®é¢˜ï¼š

```javascript
class Container {
  analyzeDependencies() {
    const graph = new Map();
    
    for (const [name, service] of this.services) {
      graph.set(name, this.getDependencies(service.implementation));
    }
    
    return graph;
  }
  
  detectCycles(graph) {
    // ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢æ£€æµ‹å¾ªç¯ä¾èµ–
    // ...
  }
}
```

## å®æˆ˜ï¼šæ„å»ºä¸€ä¸ªç®€å•çš„DIæ¡†æ¶

è®©æˆ‘ä»¬åŠ¨æ‰‹å®ç°ä¸€ä¸ªç®€å•çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå°†å‰é¢è®¨è®ºçš„æ¦‚å¿µä»˜è¯¸å®è·µï¼š

### 1. åŸºç¡€å®¹å™¨å®ç°

```javascript
class SimpleDIContainer {
  constructor() {
    this.services = new Map();
    this.instances = new Map();
  }
  
  register(name, implementation, options = {}) {
    this.services.set(name, {
      implementation,
      singleton: options.singleton || false,
      dependencies: this.extractDependencies(implementation)
    });
  }
  
  get(name) {
    if (!this.services.has(name)) {
      throw new Error(`Service '${name}' not found`);
    }
    
    const service = this.services.get(name);
    
    // å•ä¾‹æ£€æŸ¥
    if (service.singleton && this.instances.has(name)) {
      return this.instances.get(name);
    }
    
    // è§£æä¾èµ–
    const dependencies = this.resolveDependencies(service.dependencies);
    
    // åˆ›å»ºå®ä¾‹
    const instance = new service.implementation(...dependencies);
    
    // ç¼“å­˜å•ä¾‹
    if (service.singleton) {
      this.instances.set(name, instance);
    }
    
    return instance;
  }
  
  extractDependencies(implementation) {
    // ç®€åŒ–å¤„ç†ï¼Œå®é™…å®ç°åº”è¯¥ä½¿ç”¨åå°„æˆ–è£…é¥°å™¨
    // è¿™é‡Œå‡è®¾æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸç§æ–¹å¼è·å–æ„é€ å‡½æ•°å‚æ•°
    return [];
  }
  
  resolveDependencies(dependencies) {
    return dependencies.map(dep => this.get(dep));
  }
}
```

### 2. æ·»åŠ è£…é¥°å™¨æ”¯æŒ

```javascript
function Injectable() {
  return function(target) {
    // è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨
    const container = getContainer(); // è·å–å…¨å±€å®¹å™¨
    container.register(target.name, target);
  };
}

function Inject(serviceName) {
  return function(target, propertyKey, parameterIndex) {
    // å­˜å‚¨ä¾èµ–ä¿¡æ¯
    if (!target.__inject__) {
      target.__inject__ = [];
    }
    target.__inject__[parameterIndex] = serviceName;
  };
}
```

### 3. å®Œæ•´ç¤ºä¾‹

```javascript
// åˆ›å»ºå®¹å™¨
const container = new SimpleDIContainer();

// å®šä¹‰æœåŠ¡
@Injectable()
class Database {
  connect() {
    console.log('Connected to database');
  }
  
  query(sql) {
    return `Result for: ${sql}`;
  }
}

@Injectable()
class Logger {
  log(message) {
    console.log(`[${new Date().toISOString()}] ${message}`);
  }
}

@Injectable()
class UserService {
  constructor(
    @Inject('Database') database,
    @Inject('Logger') logger
  ) {
    this.database = database;
    this.logger = logger;
  }
  
  getUser(id) {
    this.logger.log(`Fetching user ${id}`);
    return this.database.query(`SELECT * FROM users WHERE id = ${id}`);
  }
}

// æ³¨å†ŒæœåŠ¡
container.register('Database', Database, { singleton: true });
container.register('Logger', Logger, { singleton: true });

// ä½¿ç”¨æœåŠ¡
const userService = container.get('UserService');
console.log(userService.getUser(1));
// è¾“å‡º:
// [2026-02-03T...:00.000Z] Fetching user 1
// Connected to database
// Result for: SELECT * FROM users WHERE id = 1
```

## ç»“è¯­

ä¾èµ–æ³¨å…¥ä¸æ§åˆ¶åè½¬è™½ç„¶å¬èµ·æ¥æŠ½è±¡ï¼Œä½†å®ƒä»¬æ˜¯æ„å»ºç°ä»£æ¡†æ¶çš„æ ¸å¿ƒæŠ€æœ¯ã€‚é€šè¿‡å°†å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†äº¤ç»™æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ›´æ¾è€¦åˆã€æ›´æ˜“äºæµ‹è¯•å’Œç»´æŠ¤çš„ä»£ç ç»“æ„ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»åŸºç¡€æ¦‚å¿µå‡ºå‘ï¼Œæ·±å…¥æ¢è®¨äº†ä¾èµ–æ³¨å…¥çš„å®ç°åŸç†ã€ä¸»æµæ¡†æ¶ä¸­çš„å®è·µï¼Œä»¥åŠè®¾è®¡DIç³»ç»Ÿçš„æœ€ä½³å®è·µã€‚æœ€åï¼Œæˆ‘ä»¬è¿˜åŠ¨æ‰‹å®ç°äº†ä¸€ä¸ªç®€å•çš„DIæ¡†æ¶ï¼Œå°†ç†è®ºçŸ¥è¯†è½¬åŒ–ä¸ºå®é™…ä»£ç ã€‚

~~è¯´å®è¯ï¼Œç†è§£DIå’ŒIoCå¯èƒ½æ¯”å®ç°å®ƒä»¬æ›´éš¾~~ ğŸ˜… ä½†ä¸€æ—¦æŒæ¡äº†è¿™äº›æ¦‚å¿µï¼Œä½ å°†èƒ½å¤Ÿè®¾è®¡å‡ºæ›´åŠ ä¼˜é›…ã€çµæ´»çš„æ¡†æ¶ï¼Œä¸ºå¼€å‘è€…æä¾›æ›´å¥½çš„ä½“éªŒã€‚

> "æ§åˆ¶åè½¬ä¸æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§æ€æƒ³ã€‚å®ƒè®©æˆ‘ä»¬ä»'å¦‚ä½•åˆ›å»ºå¯¹è±¡'çš„ç»†èŠ‚ä¸­è§£æ”¾å‡ºæ¥ï¼Œä¸“æ³¨äº'å¯¹è±¡å¦‚ä½•åä½œ'çš„æ›´é«˜å±‚æ¬¡é—®é¢˜ã€‚" â€”â€” è½¯ä»¶è®¾è®¡å“²å­¦

å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£æ¡†æ¶è®¾è®¡ä¸­ä¾èµ–æ³¨å…¥ä¸æ§åˆ¶åè½¬çš„å¥¥ç§˜ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–è§è§£ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ï¼ğŸ‘‹