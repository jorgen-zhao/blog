---
title: æ¶ˆæ¯é˜Ÿåˆ—çš„æµå¤„ç†èƒ½åŠ›-æ„å»ºäº‹ä»¶é©±åŠ¨æ¶æ„çš„æ ¸å¿ƒå¼•æ“
date: 2026-01-28
tags:
  - æµå¤„ç†
  - äº‹ä»¶é©±åŠ¨
  - å®æ—¶è®¡ç®—
---

## å‰è¨€

åœ¨æ„å»ºç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ—©å·²ä¸æ˜¯ç®€å•çš„"ç”Ÿäº§è€…-æ¶ˆè´¹è€…"æ¨¡å¼é€šä¿¡å·¥å…·äº†ã€‚éšç€Kafkaã€Pulsarã€RabbitMQ Streamç­‰æŠ€æœ¯çš„å‘å±•ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å·²ç»æ¼”å˜æˆäº†å¼ºå¤§çš„äº‹ä»¶æµå¤„ç†å¹³å°ã€‚ç„¶è€Œï¼Œæˆ‘åœ¨ç¿»é˜…è‡ªå·±çš„åšå®¢æ–‡ç« æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªæ˜æ˜¾çš„çŸ¥è¯†ç¼ºå£â€”â€”å…³äºæ¶ˆæ¯é˜Ÿåˆ—æµå¤„ç†èƒ½åŠ›çš„æ¢è®¨ã€‚

> æ¶ˆæ¯é˜Ÿåˆ—ä¸å†ä»…ä»…æ˜¯æ¶ˆæ¯çš„"ä¸­è½¬ç«™"ï¼Œè€Œæ˜¯æˆä¸ºäº†å®æ—¶æ•°æ®æµçš„"é«˜é€Ÿå…¬è·¯"ã€‚

ä»Šå¤©ï¼Œæˆ‘æƒ³å’Œå¤§å®¶èŠèŠæ¶ˆæ¯é˜Ÿåˆ—çš„æµå¤„ç†èƒ½åŠ›ï¼Œä»¥åŠå®ƒå¦‚ä½•æˆä¸ºæ„å»ºäº‹ä»¶é©±åŠ¨æ¶æ„çš„æ ¸å¿ƒå¼•æ“ã€‚

## ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¸æµå¤„ç†çš„åŒºåˆ«

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—å’Œæµå¤„ç†çš„åŒºåˆ«ï¼š

| ç‰¹æ€§ | ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ— | æµå¤„ç†å¹³å° |
|------|------------|------------|
| æ•°æ®æ¨¡å‹ | ç‚¹å¯¹ç‚¹æˆ–å‘å¸ƒ-è®¢é˜… | æŒä¹…åŒ–çš„æ•°æ®æµ |
| æ•°æ®ä¿ç•™ | é€šå¸¸è¢«æ¶ˆè´¹ååˆ é™¤ | æŒä¹…å­˜å‚¨ï¼Œå¯å›æº¯ |
| æ¶ˆè´¹æ¨¡å¼ | æ¶ˆè´¹ä¸€æ¬¡å³åˆ é™¤ | å¯å¤šæ¬¡æ¶ˆè´¹ï¼Œæ”¯æŒåç§»é‡ç®¡ç† |
| å®æ—¶æ€§ | è¿‘å®æ—¶ | çœŸæ­£çš„å®æ—¶å¤„ç† |
| æ‰©å±•èƒ½åŠ› | åŸºäºé˜Ÿåˆ—æ‰©å±• | åŸºäºåˆ†åŒºæ‰©å±•ï¼Œæ”¯æŒæ°´å¹³æ‰©å±• |

ä¼ ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦å…³æ³¨çš„æ˜¯**å¯é çš„æ¶ˆæ¯ä¼ é€’**ï¼Œè€Œæµå¤„ç†å¹³å°åˆ™æ›´å…³æ³¨**æ•°æ®çš„æŒä¹…åŒ–å’Œå®æ—¶å¤„ç†èƒ½åŠ›**ã€‚

## æµå¤„ç†çš„æ ¸å¿ƒæ¦‚å¿µ

### ğŸ“¡ æ•°æ®æµä¸äº‹ä»¶æº¯æº

åœ¨æµå¤„ç†æ¨¡å‹ä¸­ï¼Œæ•°æ®ä¸å†è¢«è§†ä¸ºå­¤ç«‹çš„è®°å½•ï¼Œè€Œæ˜¯è¿ç»­çš„ã€æœ‰åºçš„äº‹ä»¶æµã€‚è¿™ç§æ¨¡å‹å¤©ç„¶æ”¯æŒ**äº‹ä»¶æº¯æº(Event Sourcing)**æ¨¡å¼ï¼š

```mermaid
graph LR
    A[ä¸šåŠ¡æ“ä½œ] --> B[äº‹ä»¶ç”Ÿæˆ]
    B --> C[äº‹ä»¶å­˜å‚¨]
    C --> D[äº‹ä»¶æµ]
    D --> E[äº‹ä»¶æ¶ˆè´¹è€…]
```

äº‹ä»¶æº¯æºçš„ä¼˜åŠ¿åœ¨äºï¼š
- å®Œæ•´çš„ä¸šåŠ¡å†å²è¢«è®°å½•
- æ”¯æŒæ—¶é—´æ—…è¡Œå¼æŸ¥è¯¢
- ç³»ç»ŸçŠ¶æ€å¯é‡å»º
- å®¡è®¡å’Œåˆè§„æ€§æ”¯æŒ

### ğŸ”„ çŠ¶æ€è®¡ç®—ä¸çª—å£æ“ä½œ

æµå¤„ç†çš„å¦ä¸€ä¸ªæ ¸å¿ƒæ˜¯**çŠ¶æ€è®¡ç®—**ã€‚ä¸æ‰¹å¤„ç†ä¸åŒï¼Œæµå¤„ç†éœ€è¦åœ¨æ•°æ®æµåŠ¨è¿‡ç¨‹ä¸­ç»´æŠ¤å’Œæ›´æ–°çŠ¶æ€ï¼š

```java
// ä¼ªä»£ç ç¤ºä¾‹ï¼šçª—å£è®¡æ•°
stream
  .groupBy(user)
  .window(TumblingEventTimeWindows.of(Time.minutes(5)))
  .count()
  .toStream()
  .print();
```

å¸¸è§çš„çª—å£æ“ä½œåŒ…æ‹¬ï¼š
- æ»šåŠ¨çª—å£(Tumbling Window)
- æ»‘åŠ¨çª—å£(Hopping Window)
- ä¼šè¯çª—å£(Session Window)
- å…¨å±€çª—å£(Global Window)

### ğŸ§© æµå¤„ç†æ‹“æ‰‘ä¸ç®—å­

æµå¤„ç†åº”ç”¨é€šå¸¸æ„å»ºä¸º**æœ‰å‘æ— ç¯å›¾(DAG)**çš„å½¢å¼ï¼Œå…¶ä¸­èŠ‚ç‚¹æ˜¯å¤„ç†ç®—å­ï¼Œè¾¹æ˜¯æ•°æ®æµï¼š

```
Source -> Transform -> Transform -> Sink
   |         |          |
 Filter  MapFunction  Aggregation
```

å¸¸è§çš„æµå¤„ç†ç®—å­åŒ…æ‹¬ï¼š
- **Sourceç®—å­**ï¼šæ•°æ®æºæ¥å…¥
- **è½¬æ¢ç®—å­**ï¼šmap, filter, flatMapç­‰
- **è¿æ¥ç®—å­**ï¼šjoin, co-groupç­‰
- **èšåˆç®—å­**ï¼šreduce, aggregate, window aggregationç­‰
- **Sinkç®—å­**ï¼šç»“æœè¾“å‡º

## ä¸»æµæ¶ˆæ¯é˜Ÿåˆ—çš„æµå¤„ç†èƒ½åŠ›

### Kafka Streams

Kafkaä½œä¸ºæœ€æµè¡Œçš„æ¶ˆæ¯é˜Ÿåˆ—ä¹‹ä¸€ï¼Œæä¾›äº†å¼ºå¤§çš„æµå¤„ç†èƒ½åŠ›ï¼š

```java
// Kafka Streamsç¤ºä¾‹ï¼šå®æ—¶è¯é¢‘ç»Ÿè®¡
KStream<String, String> textLines = builder.stream("TextLinesTopic");
KTable<String, Long> wordCounts = textLines
    .flatMapValues(value -> Arrays.asList(value.toLowerCase().split(" ")))
    .groupBy((key, word) -> word)
    .count();
wordCounts.toStream().to("WordsWithCountsTopic", Produced.with(Serdes.String(), Serdes.Long()));
```

Kafka Streamsçš„ä¼˜åŠ¿ï¼š
- æ— éœ€éƒ¨ç½²ç‹¬ç«‹é›†ç¾¤
- ä¸Kafkaç”Ÿæ€æ— ç¼é›†æˆ
- æ”¯æŒexactly-onceè¯­ä¹‰
- è‡ªåŠ¨åŒ–çš„çŠ¶æ€å­˜å‚¨ç®¡ç†

### Apache Pulsar Functions

Pulsaræä¾›äº†è½»é‡çº§çš„å‡½æ•°è®¡ç®—èƒ½åŠ›ï¼š

```yaml
# Pulsar Functionsé…ç½®ç¤ºä¾‹
name: word-count
className: org.apache.pulsar.functions.api.examples.WordCount
inputs:
  - persistent://my-tenant/my-namespace/input-topic
output: persistent://my-tenant/my-namespace/output-topic
autoAck: true
```

Pulsar Functionsçš„ç‰¹ç‚¹ï¼š
- æ”¯æŒå¤šç§è¯­è¨€(Java, Python, Goç­‰)
- å†…ç½®çŠ¶æ€ç®¡ç†
- è‡ªåŠ¨æ‰©ç¼©å®¹
- æ”¯æŒå¤æ‚çš„å‡½æ•°é“¾å¼è°ƒç”¨

### RabbitMQ Stream

RabbitMQå¼•å…¥äº†æµå¼å¤„ç†èƒ½åŠ›ï¼š

```erlang
% RabbitMQ Streamç¤ºä¾‹
%% åˆ›å»ºæµ
rabbit_stream:create(my_stream, #{}).

%% å‘å¸ƒæ¶ˆæ¯
rabbit_stream:publish(my_stream, <<"message">>, #{}).

%% æ¶ˆè´¹æ¶ˆæ¯
rabbit_stream:subscribe(my_stream, self(), #{}).
```

RabbitMQ Streamçš„ä¼˜åŠ¿ï¼š
- ä¿æŒäº†AMQPåè®®çš„å…¼å®¹æ€§
- æ”¯æŒæ¶ˆæ¯å›æº¯
- ä¸RabbitMQç°æœ‰ç”Ÿæ€é›†æˆ
- æä¾›æµå¼å’Œé˜Ÿåˆ—ä¸¤ç§æ¶ˆè´¹æ¨¡å¼

## æµå¤„ç†æ¶æ„æ¨¡å¼

### ğŸ— äº‹ä»¶é©±åŠ¨æ¶æ„(EDA)

æµå¤„ç†æ˜¯æ„å»ºäº‹ä»¶é©±åŠ¨æ¶æ„çš„æ ¸å¿ƒï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº‹ä»¶æº    â”‚ â”€â”€> â”‚  äº‹ä»¶æ€»çº¿    â”‚ â”€â”€> â”‚  äº‹ä»¶å¤„ç†å™¨  â”‚
â”‚ (æ•°æ®åº“/UI) â”‚     â”‚ (æ¶ˆæ¯é˜Ÿåˆ—)   â”‚     â”‚ (å¾®æœåŠ¡)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

EDAçš„ä¼˜åŠ¿ï¼š
- ç³»ç»Ÿç»„ä»¶é—´è§£è€¦
- æé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦
- æ›´å¥½çš„å¯æ‰©å±•æ€§
- æ”¯æŒå¤æ‚çš„äº‹ä»¶å¤„ç†æµç¨‹

### ğŸ”„ CQRSæ¨¡å¼(å‘½ä»¤æŸ¥è¯¢è´£ä»»åˆ†ç¦»)

æµå¤„ç†ä½¿CQRSæ¨¡å¼æ›´åŠ å¯è¡Œï¼š

```
å‘½ä»¤ç«¯                  æŸ¥è¯¢ç«¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ“ä½œ â”‚ â”€â”€â”€â”€â”€â”€â”€>  â”‚ äº‹ä»¶å­˜å‚¨ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ äº‹ä»¶æµ  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ æŸ¥è¯¢æ¨¡å‹ â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

CQRSç»“åˆæµå¤„ç†çš„ä¼˜åŠ¿ï¼š
- è¯»å†™åˆ†ç¦»ï¼Œä¼˜åŒ–æ€§èƒ½
- æ”¯æŒå¤æ‚çš„æŸ¥è¯¢éœ€æ±‚
- æ›´å¥½çš„å¯æ‰©å±•æ€§
- äº‹ä»¶æº¯æºèƒ½åŠ›

## æµå¤„ç†çš„æœ€ä½³å®è·µ

### ğŸ’¡ çŠ¶æ€ç®¡ç†ç­–ç•¥

æµå¤„ç†ä¸­çš„çŠ¶æ€ç®¡ç†è‡³å…³é‡è¦ï¼š

1. **çŠ¶æ€å­˜å‚¨é€‰æ‹©**ï¼š
   - æœ¬åœ°çŠ¶æ€ï¼šä½å»¶è¿Ÿï¼Œä½†å¯é æ€§å—é™
   - åˆ†å¸ƒå¼çŠ¶æ€ï¼šé«˜å¯é æ€§ï¼Œä½†å¯èƒ½æœ‰å»¶è¿Ÿ

2. **çŠ¶æ€ä¸€è‡´æ€§**ï¼š
   - è‡³å°‘ä¸€æ¬¡å¤„ç†(At-least-once)
   - ç²¾ç¡®ä¸€æ¬¡å¤„ç†(Exactly-once)
   - æœ€å¤šä¸€æ¬¡å¤„ç†(At-most-once)

3. **çŠ¶æ€æ¸…ç†**ï¼š
   - åŸºäºæ—¶é—´çš„TTL
   - åŸºäºå¤§å°çš„é™åˆ¶
   - æ‰‹åŠ¨æ¸…ç†ç­–ç•¥

### ğŸš¨ å®¹é”™ä¸æ¢å¤

æµå¤„ç†ç³»ç»Ÿå¿…é¡»å…·å¤‡å¼ºå¤§çš„å®¹é”™èƒ½åŠ›ï¼š

1. **æ£€æŸ¥ç‚¹æœºåˆ¶**ï¼š
   - å®šæœŸä¿å­˜å¤„ç†çŠ¶æ€
   - æ”¯æŒä»æ£€æŸ¥ç‚¹æ¢å¤
   - ä¿è¯å¤„ç†è¯­ä¹‰çš„ä¸€è‡´æ€§

2. **é‡è¯•ç­–ç•¥**ï¼š
   - æŒ‡æ•°é€€é¿é‡è¯•
   - æ­»ä¿¡é˜Ÿåˆ—å¤„ç†
   - å¤±è´¥äº‹ä»¶éš”ç¦»

3. **ç›‘æ§ä¸å‘Šè­¦**ï¼š
   - å¤„ç†å»¶è¿Ÿç›‘æ§
   - ååé‡ç›‘æ§
   - é”™è¯¯ç‡ç›‘æ§

## æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### ğŸ“Š æ‰¹å¤„ç†ä¸å¾®æ‰¹å¤„ç†

åœ¨æµå¤„ç†ä¸­ï¼Œåˆç†ä½¿ç”¨æ‰¹å¤„ç†å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ï¼š

```java
// å¾®æ‰¹å¤„ç†ç¤ºä¾‹
stream
  .window(TumblingEventTimeWindows.of(Time.seconds(1)))
  .aggregate(
      () -> new AtomicInteger(0),
      (key, value, aggregate) -> {
          aggregate.add(value);
          return aggregate;
      },
      Materialized.as("aggregate-store")
  );
```

### ğŸ”„ å¹¶è¡Œåº¦ä¸åˆ†åŒºç­–ç•¥

åˆç†çš„å¹¶è¡Œåº¦è®¾ç½®æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ï¼š

1. **åˆ†åŒºæ•°é‡**ï¼š
   - åˆ†åŒºå¤ªå°‘ï¼šå¹¶è¡Œåº¦å—é™
   - åˆ†åŒºå¤ªå¤šï¼šèµ„æºæµªè´¹å’Œåè°ƒå¼€é”€

2. **åˆ†åŒºé”®é€‰æ‹©**ï¼š
   - ç›¸å…³æ•°æ®åº”åˆ†é…åˆ°åŒä¸€åˆ†åŒº
   - é¿å…æ•°æ®å€¾æ–œ
   - è€ƒè™‘è®¿é—®æ¨¡å¼

### ğŸ§© ç®—å­ä¼˜åŒ–

å…·ä½“çš„ç®—å­å®ç°ä¹Ÿä¼šå½±å“æ€§èƒ½ï¼š

1. **çŠ¶æ€è®¿é—®ä¼˜åŒ–**ï¼š
   - å‡å°‘çŠ¶æ€è®¿é—®é¢‘ç‡
   - ä½¿ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„
   - æ‰¹é‡çŠ¶æ€æ“ä½œ

2. **åºåˆ—åŒ–ä¼˜åŒ–**ï¼š
   - é«˜æ•ˆçš„åºåˆ—åŒ–æ ¼å¼
   - é¿å…ä¸å¿…è¦çš„åºåˆ—åŒ–/ååºåˆ—åŒ–
   - ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼

## ç»“è¯­

æ¶ˆæ¯é˜Ÿåˆ—çš„æµå¤„ç†èƒ½åŠ›æ­£åœ¨é‡æ–°å®šä¹‰æˆ‘ä»¬æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ–¹å¼ã€‚ä»ç®€å•çš„æ¶ˆæ¯ä¼ é€’åˆ°å¼ºå¤§çš„äº‹ä»¶æµå¤„ç†ï¼Œè¿™ä¸€è½¬å˜ä½¿ç³»ç»Ÿèƒ½å¤Ÿæ›´å¥½åœ°å“åº”å®æ—¶ä¸šåŠ¡éœ€æ±‚ï¼Œæ”¯æŒå¤æ‚çš„äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚

> æµå¤„ç†ä¸ä»…æ˜¯æŠ€æœ¯ï¼Œæ›´æ˜¯ä¸€ç§æ€ç»´æ–¹å¼çš„è½¬å˜â€”â€”ä»æ‰¹å¤„ç†æ€ç»´è½¬å‘å®æ—¶æ€ç»´ã€‚

éšç€äº‘åŸç”Ÿå’ŒServerlessæ¶æ„çš„å…´èµ·ï¼Œæµå¤„ç†ä¸è¿™äº›æ–°æŠ€æœ¯çš„ç»“åˆå°†äº§ç”Ÿæ›´å¤šåˆ›æ–°åº”ç”¨ã€‚æœªæ¥ï¼Œæˆ‘å°†ç»§ç»­æ¢ç´¢æ¶ˆæ¯é˜Ÿåˆ—åœ¨è¾¹ç¼˜è®¡ç®—ã€äº‹ä»¶ç½‘æ ¼ç­‰æ–°å…´é¢†åŸŸçš„åº”ç”¨ï¼Œæ•¬è¯·æœŸå¾…ï¼

---

*å¦‚æœä½ å¯¹æ¶ˆæ¯é˜Ÿåˆ—çš„æµå¤„ç†æœ‰ä»»ä½•ç–‘é—®æˆ–è§è§£ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµã€‚ä¹Ÿæ¬¢è¿å…³æ³¨æˆ‘çš„GitHubè·å–æ›´å¤šæŠ€æœ¯åˆ†äº«ã€‚*