---
title: å‰ç«¯æµ‹è¯•-æ„å»ºå¯é ä¸”é«˜è´¨é‡çš„ç”¨æˆ·ç•Œé¢
date: 2023-11-15 14:30:00
categories: 
  - å‰ç«¯å¼€å‘
tags:
  - å‰ç«¯æµ‹è¯•
  - å•å…ƒæµ‹è¯•
  - é›†æˆæµ‹è¯•
  - E2Eæµ‹è¯•
  - Jest
  - Cypress
author: 
  name: Jorgen
  link: https://github.com/jorgen-zhao
---

## å‰è¨€

ä½œä¸ºä¸€åå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ç»å¸¸é™·å…¥è¿™æ ·çš„å›°å¢ƒï¼šæ˜æ˜ä»£ç åœ¨æœ¬åœ°è¿è¡Œå¾—å¥½å¥½çš„ï¼Œä¸€ä¸Šçº¿å°±å‡ºç°å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚~~ç„¶åå¼€å§‹æ€€ç–‘äººç”Ÿï¼Œæ˜¯ä¸æ˜¯æˆ‘å†™çš„ä»£ç å¤ª"èªæ˜"äº†ï¼Ÿ~~ ğŸ˜…

äº‹å®ä¸Šï¼Œè¿™æ°æ°è¯´æ˜äº†å‰ç«¯æµ‹è¯•çš„é‡è¦æ€§ã€‚åœ¨å½“ä»Šå¿«é€Ÿè¿­ä»£çš„å‰ç«¯å¼€å‘ç¯å¢ƒä¸­ï¼Œæ²¡æœ‰æµ‹è¯•ä¿éšœçš„ä»£ç å°±åƒæ²¡æœ‰å®‰å…¨å¸¦çš„è¿‡å±±è½¦ï¼Œåˆºæ¿€ä½†å±é™©ã€‚

::: tip
"æµ‹è¯•ä¸æ˜¯å¼€å‘æµç¨‹çš„ç»ˆç‚¹ï¼Œè€Œæ˜¯è´¨é‡çš„èµ·ç‚¹ã€‚"
:::

åœ¨ä¹‹å‰çš„åšå®¢ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ¢è®¨äº†å‰ç«¯å·¥ç¨‹åŒ–ã€æ€§èƒ½ä¼˜åŒ–å’Œå„ç§æ¡†æ¶çš„ä½¿ç”¨ï¼Œä½†å”¯ç‹¬ç¼ºå°‘äº†æµ‹è¯•è¿™ä¸€ç¯ã€‚ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬ä¸€èµ·æ­å¼€å‰ç«¯æµ‹è¯•çš„ç¥ç§˜é¢çº±ï¼Œå­¦ä¹ å¦‚ä½•æ„å»ºå¯é ä¸”é«˜è´¨é‡çš„ç”¨æˆ·ç•Œé¢ã€‚

## ä¸ºä»€ä¹ˆå‰ç«¯æµ‹è¯•å¦‚æ­¤é‡è¦ï¼Ÿ

### 1. æé«˜ä»£ç è´¨é‡

æµ‹è¯•è¿«ä½¿æˆ‘ä»¬æ€è€ƒä»£ç çš„è¾¹ç•Œæƒ…å†µï¼Œä»è€Œå†™å‡ºæ›´å¥å£®çš„ä»£ç ã€‚å½“æˆ‘åœ¨é¡¹ç›®ä¸­å¼•å…¥æµ‹è¯•åï¼Œæˆ‘å‘ç°è‡ªå·±çš„ä»£ç å˜å¾—æ›´åŠ æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤ã€‚

### 2. åŠ é€Ÿå¼€å‘æµç¨‹

è™½ç„¶ç¼–å†™æµ‹è¯•éœ€è¦é¢å¤–çš„æ—¶é—´ï¼Œä½†å®ƒèƒ½æ˜¾è‘—å‡å°‘è°ƒè¯•æ—¶é—´ã€‚ğŸƒâ€â™‚ï¸ æˆ‘æ›¾ç»èŠ±è´¹æ•´æ•´ä¸‰å¤©æ—¶é—´æŸ¥æ‰¾ä¸€ä¸ªåªåœ¨ç‰¹å®šæµè§ˆå™¨ç‰ˆæœ¬ä¸‹å‡ºç°çš„bugï¼Œå¦‚æœå½“æ—¶æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½åªéœ€è¦ååˆ†é’Ÿå°±èƒ½è§£å†³ã€‚

### 3. æ”¯æŒæŒç»­é›†æˆ/æŒç»­éƒ¨ç½²(CI/CD)

ç°ä»£å¼€å‘æµç¨‹ä¸­ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯CI/CDç®¡é“çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚æ²¡æœ‰æµ‹è¯•ï¼Œä½ å°±ä¸æ•¢é¢‘ç¹éƒ¨ç½²ï¼Œè¿™ä¼šæ‹–æ…¢æ•´ä¸ªå›¢é˜Ÿçš„è¿­ä»£é€Ÿåº¦ã€‚

### 4. æ–‡æ¡£å’Œè®¾è®¡å‚è€ƒ

æµ‹è¯•ç”¨ä¾‹å®é™…ä¸Šæ˜¯ä¸€ç§"æ´»çš„æ–‡æ¡£"ï¼Œå®ƒå±•ç¤ºäº†ä»£ç çš„é¢„æœŸè¡Œä¸ºï¼Œå¯¹äºæ–°åŠ å…¥å›¢é˜Ÿçš„æˆå‘˜ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚

## å‰ç«¯æµ‹è¯•çš„ç±»å‹

å‰ç«¯æµ‹è¯•é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼Œæ¯ç§ç±»å‹éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä»·å€¼å’Œé€‚ç”¨åœºæ™¯ï¼š

### 1. å•å…ƒæµ‹è¯•(Unit Testing)

å•å…ƒæµ‹è¯•æ˜¯æœ€å°ç²’åº¦çš„æµ‹è¯•ï¼Œå®ƒæµ‹è¯•å•ä¸ªå‡½æ•°æˆ–ç»„ä»¶çš„ç‹¬ç«‹åŠŸèƒ½ã€‚

```javascript
// ç¤ºä¾‹ï¼šæµ‹è¯•ä¸€ä¸ªç®€å•çš„åŠ æ³•å‡½æ•°
import { add } from './math';

test('adds 1 + 2 to equal 3', () => {
  expect(add(1, 2)).toBe(3);
});
```

**ä¼˜ç‚¹**ï¼š
- è¿è¡Œé€Ÿåº¦å¿«
- æä¾›å¿«é€Ÿåé¦ˆ
- æ˜“äºè°ƒè¯•

**å¸¸ç”¨å·¥å…·**ï¼šJest, Mocha, Jasmine

### 2. ç»„ä»¶æµ‹è¯•(Component Testing)

ç»„ä»¶æµ‹è¯•æµ‹è¯•å•ä¸ªUIç»„ä»¶çš„æ¸²æŸ“å’Œäº¤äº’è¡Œä¸ºã€‚

```javascript
// ç¤ºä¾‹ï¼šä½¿ç”¨React Testing Libraryæµ‹è¯•ä¸€ä¸ªæŒ‰é’®ç»„ä»¶
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import Button from './Button';

test('calls onClick when button is clicked', async () => {
  const user = userEvent.setup();
  const handleClick = jest.fn();
  
  render(<Button onClick={handleClick}>Click me</Button>);
  
  const button = screen.getByRole('button');
  await user.click(button);
  
  expect(handleClick).toHaveBeenCalledTimes(1);
});
```

**ä¼˜ç‚¹**ï¼š
- ç¡®ä¿ç»„ä»¶æŒ‰é¢„æœŸå·¥ä½œ
- æ•è·UIé€»è¾‘é”™è¯¯
- æä¾›ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

**å¸¸ç”¨å·¥å…·**ï¼šReact Testing Library, Vue Test Utils, Cypress Component Testing

### 3. é›†æˆæµ‹è¯•(Integration Testing)

é›†æˆæµ‹è¯•æµ‹è¯•å¤šä¸ªç»„ä»¶æˆ–æœåŠ¡ä¹‹é—´çš„äº¤äº’ã€‚

```javascript
// ç¤ºä¾‹ï¼šæµ‹è¯•è¡¨å•æäº¤å’Œæ•°æ®è·å–çš„é›†æˆ
import { render, screen, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import Form from './Form';

test('submits form and displays data', async () => {
  const user = userEvent.setup();
  
  render(<Form />);
  
  const nameInput = screen.getByLabelText(/name/i);
  const emailInput = screen.getByLabelText(/email/i);
  const submitButton = screen.getByRole('button', { name: /submit/i });
  
  await user.type(nameInput, 'John Doe');
  await user.type(emailInput, 'john@example.com');
  await user.click(submitButton);
  
  await waitFor(() => {
    expect(screen.getByText(/success/i)).toBeInTheDocument();
  });
});
```

**ä¼˜ç‚¹**ï¼š
- éªŒè¯ç»„ä»¶é—´çš„äº¤äº’
- å‘ç°é›†æˆé—®é¢˜
- æ›´æ¥è¿‘çœŸå®ä½¿ç”¨åœºæ™¯

### 4. ç«¯åˆ°ç«¯æµ‹è¯•(E2E Testing)

ç«¯åˆ°ç«¯æµ‹è¯•æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œæ•´ä¸ªåº”ç”¨ç¨‹åºçš„æµç¨‹ã€‚

```javascript
// ç¤ºä¾‹ï¼šä½¿ç”¨Cypressæµ‹è¯•ç”¨æˆ·ç™»å½•æµç¨‹
describe('User Login', () => {
  it('allows a user to log in', () => {
    cy.visit('/login');
    
    cy.get('input[name="email"]').type('test@example.com');
    cy.get('input[name="password"]').type('password123');
    cy.get('button[type="submit"]').click();
    
    cy.url().should('include', '/dashboard');
    cy.contains('Welcome back!').should('be.visible');
  });
});
```

**ä¼˜ç‚¹**ï¼š
- æœ€æ¥è¿‘çœŸå®ç”¨æˆ·ä½“éªŒ
- éªŒè¯æ•´ä¸ªåº”ç”¨æµç¨‹
- å‘ç°è·¨ç»„ä»¶/è·¨é¡µé¢é—®é¢˜

**å¸¸ç”¨å·¥å…·**ï¼šCypress, Playwright, Selenium

## å¦‚ä½•åœ¨å‰ç«¯é¡¹ç›®ä¸­å®æ–½æµ‹è¯•

### 1. é€‰æ‹©åˆé€‚çš„æµ‹è¯•å·¥å…·

æ ¹æ®ä½ çš„æŠ€æœ¯æ ˆé€‰æ‹©åˆé€‚çš„æµ‹è¯•å·¥å…·ï¼š

- **React**: Jest + React Testing Library æˆ– Cypress
- **Vue**: Jest + Vue Test Utils æˆ– Cypress
- **Angular**: Jasmine + Karma æˆ– Cypress
- **é€šç”¨**: Playwright(è·¨æ¡†æ¶æ”¯æŒ)

### 2. è®¾è®¡æµ‹è¯•ç­–ç•¥

ä¸€ä¸ªå¥½çš„æµ‹è¯•ç­–ç•¥åº”è¯¥å¹³è¡¡æµ‹è¯•è¦†ç›–ç‡å’Œç»´æŠ¤æˆæœ¬ï¼š

```
æµ‹è¯•é‡‘å­—å¡”ï¼š
- å¤§é‡å•å…ƒæµ‹è¯• (70%)
- é€‚é‡é›†æˆæµ‹è¯• (20%)
- å°‘é‡E2Eæµ‹è¯• (10%)
```

### 3. ç¼–å†™å¯æµ‹è¯•çš„ä»£ç 

ä¸ºäº†ä½¿ä»£ç æ˜“äºæµ‹è¯•ï¼Œæˆ‘éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªå‡½æ•°/ç»„ä»¶åªåšä¸€ä»¶äº‹
2. **ä¾èµ–æ³¨å…¥**ï¼šé€šè¿‡propsæˆ–contextä¼ é€’ä¾èµ–ï¼Œè€Œä¸æ˜¯åœ¨å†…éƒ¨åˆ›å»º
3. **çº¯å‡½æ•°**ï¼šå°½å¯èƒ½ä½¿ç”¨çº¯å‡½æ•°ï¼Œå®ƒä»¬æ›´å®¹æ˜“æµ‹è¯•
4. **é¿å…ç›´æ¥æ“ä½œDOM**ï¼šä½¿ç”¨æ•°æ®é©±åŠ¨UIï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œDOM

### 4. å®è·µæµ‹è¯•é©±åŠ¨å¼€å‘(TDD)

æµ‹è¯•é©±åŠ¨å¼€å‘æ˜¯ä¸€ç§"å…ˆå†™æµ‹è¯•ï¼Œå†å†™ä»£ç "çš„å¼€å‘æ–¹æ³•ï¼š

1. çº¢è‰²ï¼šå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•
2. ç»¿è‰²ï¼šå†™æœ€å°‘çš„ä»£ç ä½¿æµ‹è¯•é€šè¿‡
3. é‡æ„ï¼šæ”¹è¿›ä»£ç è€Œä¸æ”¹å˜æµ‹è¯•

è™½ç„¶TDDä¸ä¸€å®šé€‚åˆæ‰€æœ‰åœºæ™¯ï¼Œä½†å®ƒç¡®å®èƒ½å¸®åŠ©ä½ å†™å‡ºæ›´ç®€æ´ã€æ›´å¯æµ‹è¯•çš„ä»£ç ã€‚

## å‰ç«¯æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç”¨æˆ·è¡Œä¸ºï¼Œè€Œéå®ç°ç»†èŠ‚

```javascript
// ä¸å¥½çš„æµ‹è¯•ï¼šæµ‹è¯•å†…éƒ¨å®ç°
test('increments the counter by calling setCount with currentCount + 1', () => {
  const { result } = renderHook(() => useCounter());
  act(() => {
    result.current.increment();
  });
  expect(result.current.count).toBe(1);
});

// å¥½çš„æµ‹è¯•ï¼šæµ‹è¯•ç”¨æˆ·è¡Œä¸º
test('increments the counter when button is clicked', () => {
  render(<Counter />);
  const button = screen.getByRole('button');
  fireEvent.click(button);
  expect(screen.getByText('Count: 1')).toBeInTheDocument();
});
```

### 2. ä½¿ç”¨æœ‰æ„ä¹‰çš„æµ‹è¯•åç§°

æµ‹è¯•åç§°åº”è¯¥æ¸…æ™°åœ°æè¿°è¢«æµ‹è¯•çš„åŠŸèƒ½å’Œé¢„æœŸè¡Œä¸ºï¼š

```javascript
// ä¸å¥½çš„æµ‹è¯•åç§°
test('counter test', () => {
  // ...
});

// å¥½çš„æµ‹è¯•åç§°
test('increments counter by 1 when increment button is clicked', () => {
  // ...
});
```

### 3. ä¿æŒæµ‹è¯•ç‹¬ç«‹æ€§

æ¯ä¸ªæµ‹è¯•åº”è¯¥æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–äºå…¶ä»–æµ‹è¯•çš„çŠ¶æ€ï¼š

```javascript
// ä¸å¥½çš„æµ‹è¯•ï¼šæµ‹è¯•é—´æœ‰ä¾èµ–
test('first test', () => {
  // è®¾ç½®çŠ¶æ€
});

test('second test', () => {
  // å‡è®¾first testå·²ç»è¿è¡Œå¹¶è®¾ç½®äº†çŠ¶æ€
});

// å¥½çš„æµ‹è¯•ï¼šæ¯ä¸ªæµ‹è¯•éƒ½ç‹¬ç«‹è®¾ç½®è‡ªå·±çš„çŠ¶æ€
test('first test', () => {
  // è®¾ç½®è‡ªå·±çš„çŠ¶æ€
});

test('second test', () => {
  // è®¾ç½®è‡ªå·±çš„çŠ¶æ€
});
```

### 4. æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–

å¯¹äºAPIè°ƒç”¨ã€æ•°æ®åº“è®¿é—®ç­‰å¤–éƒ¨ä¾èµ–ï¼Œåº”è¯¥ä½¿ç”¨æ¨¡æ‹Ÿ(mock)ï¼š

```javascript
// æ¨¡æ‹ŸAPIè°ƒç”¨
jest.mock('./api', () => ({
  fetchData: jest.fn()
    .mockResolvedValueOnce({ data: 'initial' })
    .mockResolvedValueOnce({ data: 'updated' })
}));

test('fetches and displays data', async () => {
  render(<DataComponent />);
  
  await waitFor(() => {
    expect(screen.getByText('initial')).toBeInTheDocument();
  });
});
```

## ç»“è¯­

å‰ç«¯æµ‹è¯•ä¸æ˜¯å¯æœ‰å¯æ— çš„å¥¢ä¾ˆå“ï¼Œè€Œæ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„å¿…éœ€å“ã€‚å®ƒä¸ä»…èƒ½æé«˜ä»£ç è´¨é‡ï¼Œè¿˜èƒ½åŠ é€Ÿå¼€å‘æµç¨‹ï¼Œæ”¯æŒæŒç»­é›†æˆï¼Œå¹¶ä¸ºå›¢é˜Ÿæä¾›å®è´µçš„æ–‡æ¡£ã€‚

æ­£å¦‚æˆ‘åœ¨å®è·µä¸­ä½“ä¼šåˆ°çš„ï¼Œæµ‹è¯•è™½ç„¶éœ€è¦é¢å¤–çš„æ—¶é—´å’Œç²¾åŠ›æŠ•å…¥ï¼Œä½†å®ƒå¸¦æ¥çš„å›æŠ¥è¿œè¿œè¶…è¿‡æˆæœ¬ã€‚å½“ä½ çœ‹åˆ°è‡ªå·±çš„åº”ç”¨åœ¨æ¯æ¬¡éƒ¨ç½²åéƒ½èƒ½ç¨³å®šè¿è¡Œï¼Œé‚£ç§æˆå°±æ„Ÿæ˜¯æ— ä¸ä¼¦æ¯”çš„ã€‚

> "æµ‹è¯•ä¸æ˜¯å¼€å‘æµç¨‹çš„ç»ˆç‚¹ï¼Œè€Œæ˜¯è´¨é‡çš„èµ·ç‚¹ã€‚" â€”â€” è¿™å¥è¯æˆ‘æ·±æœ‰ä½“ä¼šã€‚

å¦‚æœä½ è¿˜æ²¡æœ‰åœ¨å‰ç«¯é¡¹ç›®ä¸­å®æ–½æµ‹è¯•ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ ä»ä»Šå¤©å¼€å§‹å°è¯•ã€‚ä»å°å¤„ç€æ‰‹ï¼Œæ¯”å¦‚ä¸ºå‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç¼–å†™æµ‹è¯•ï¼Œç„¶åé€æ­¥æ‰©å±•åˆ°æ•´ä¸ªé¡¹ç›®ã€‚ç›¸ä¿¡æˆ‘ï¼Œä½ çš„ä»£ç å’Œä½ çš„å›¢é˜Ÿéƒ½ä¼šæ„Ÿè°¢ä½ ã€‚

---

**ç›¸å…³èµ„æº**ï¼š
- [Jestå®˜æ–¹æ–‡æ¡£](https://jestjs.io/)
- [React Testing Libraryæ–‡æ¡£](https://testing-library.com/docs/react-testing-library/intro/)
- [Cypressæ–‡æ¡£](https://docs.cypress.io/)
- [æµ‹è¯•é‡‘å­—å¡”](https://martinfowler.com/bliki/TestPyramid.html)

æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„å‰ç«¯æµ‹è¯•ç»éªŒæˆ–é—®é¢˜ï¼ğŸ‘‡