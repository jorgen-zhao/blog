---
title: Server-Sent Events (SSE) - è½»é‡çº§æœåŠ¡å™¨æ¨é€æŠ€æœ¯
date: 2023-10-15 14:30:00
categories: 
  - protocol
tags:
  - SSE
  - å®æ—¶é€šä¿¡
  - WebæŠ€æœ¯
  - æœåŠ¡å™¨æ¨é€
author: 
  name: Jorgen
  link: https://github.com/jorgen-zhao
---

## å‰è¨€

åœ¨å®æ—¶é€šä¿¡é¢†åŸŸï¼Œæˆ‘ä»¬ç†Ÿæ‚‰äº†WebSocketçš„å¼ºå¤§åŒå‘èƒ½åŠ›å’ŒMQTTåœ¨ç‰©è”ç½‘åœºæ™¯çš„è½»é‡çº§ä¼˜åŠ¿ã€‚ä½†ä½ æ˜¯å¦æƒ³è¿‡ï¼Œå½“åªéœ€è¦**å•å‘æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯**çš„æ•°æ®æ¨é€æ—¶ï¼Œæ˜¯å¦æœ‰æ›´è½»é‡çš„è§£å†³æ–¹æ¡ˆï¼Ÿä»Šå¤©æˆ‘è¦ä»‹ç»çš„å°±æ˜¯å¸¸è¢«å¿½ç•¥çš„"ä½è°ƒç‹è€…"â€”â€”Server-Sent Events (SSE)ã€‚ğŸ“¡

::: tip
SSEæ˜¯ä¸€ç§åŸºäºHTTPçš„æœåŠ¡å™¨æ¨é€æŠ€æœ¯ï¼Œè®©æœåŠ¡å™¨èƒ½ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€äº‹ä»¶æµï¼Œç‰¹åˆ«é€‚åˆéœ€è¦å®æ—¶æ•°æ®æ›´æ–°çš„åœºæ™¯ã€‚
:::

## SSEçš„å·¥ä½œåŸç†

SSEæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç®€å•çš„**å•å‘é€šä¿¡æ¨¡å¼**ï¼Œå®ƒé€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š

1. **æŒä¹…è¿æ¥**ï¼šå®¢æˆ·ç«¯å‘èµ·HTTPè¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¿æŒè¿æ¥ä¸å…³é—­
2. **äº‹ä»¶æµ**ï¼šæœåŠ¡å™¨ä»¥`text/event-stream`æ ¼å¼å‘é€æ•°æ®
3. **è‡ªåŠ¨é‡è¿**ï¼šå®¢æˆ·ç«¯è‡ªåŠ¨å¤„ç†è¿æ¥ä¸­æ–­å¹¶å°è¯•é‡è¿

```javascript
// å®¢æˆ·ç«¯ç¤ºä¾‹
const eventSource = new EventSource('/updates');
eventSource.onmessage = (event) => {
  console.log('æ–°æ•°æ®:', event.data);
};
eventSource.onerror = (err) => {
  console.error('è¿æ¥é”™è¯¯:', err);
};
```

## SSE vs WebSocketï¼šä¸€åœºä¼˜é›…çš„è¾ƒé‡

| ç‰¹æ€§          | SSE                          | WebSocket                  |
|---------------|------------------------------|----------------------------|
| é€šä¿¡æ–¹å‘      | æœåŠ¡å™¨â†’å®¢æˆ·ç«¯ (å•å‘)          | åŒå‘é€šä¿¡                   |
| åè®®          | çº¯HTTP                       | ç‹¬ç«‹åè®® (ws://)           |
| è‡ªåŠ¨é‡è¿      | å†…ç½®æ”¯æŒ                     | éœ€æ‰‹åŠ¨å®ç°                 |
| äºŒè¿›åˆ¶æ”¯æŒ    | âŒ ä»…æ–‡æœ¬                     | âœ… æ”¯æŒäºŒè¿›åˆ¶              |
| å¤æ‚åº¦        | ä½                           | é«˜                         |
| æµè§ˆå™¨å…¼å®¹    | ç°ä»£æµè§ˆå™¨å¹¿æ³›æ”¯æŒ           | éœ€è€ƒè™‘å…¼å®¹æ€§               |

> ğŸ’¡ **æˆ‘çš„ç»éªŒ**ï¼šåœ¨éœ€è¦å®æ—¶æ•°æ®å±•ç¤ºï¼ˆå¦‚è‚¡ä»·æ›´æ–°ã€ä½“è‚²èµ›äº‹ï¼‰çš„åœºæ™¯ä¸­ï¼ŒSSEçš„ç®€æ´æ€§å¾€å¾€æ¯”WebSocketçš„åŒå‘èƒ½åŠ›æ›´å®ç”¨ã€‚

## SSEå®æˆ˜ï¼šä»é›¶å®ç°å®æ—¶é€šçŸ¥

### æœåŠ¡ç«¯å®ç° (Node.js)

```javascript
const http = require('http');

const server = http.createServer((req, res) => {
  if (req.url === '/events') {
    res.writeHead(200, {
      'Content-Type': 'text/event-stream',
      'Cache-Control': 'no-cache',
      'Connection': 'keep-alive'
    });

    // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æ¨é€
    setInterval(() => {
      const data = JSON.stringify({
        timestamp: new Date().toISOString(),
        message: `å®æ—¶æ¶ˆæ¯ #${Math.floor(Math.random() * 100)}`
      });
      res.write(`data: ${data}\n\n`);
    }, 2000);
  }
});

server.listen(3000, () => {
  console.log('SSEæœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000');
});
```

### å®¢æˆ·ç«¯å®ç°

```html
<div id="notifications"></div>

<script>
const eventSource = new EventSource('http://localhost:3000/events');
eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data);
  const notification = document.createElement('div');
  notification.textContent = `[${data.timestamp}] ${data.message}`;
  document.getElementById('notifications').appendChild(notification);
};
</script>
```

## SSEçš„å…¸å‹åº”ç”¨åœºæ™¯

1. **å®æ—¶ä»ªè¡¨ç›˜**ï¼šæ•°æ®å¯è§†åŒ–å¤§å±çš„å®æ—¶æ›´æ–°
2. **é€šçŸ¥ç³»ç»Ÿ**ï¼šç¤¾äº¤åª’ä½“åŠ¨æ€ã€é‚®ä»¶æé†’
3. **æ–°é—»æ¨é€**ï¼šçªå‘æ–°é—»å®æ—¶æ’­æŠ¥
4. **åä½œå·¥å…·**ï¼šæ–‡æ¡£ç¼–è¾‘çŠ¶æ€åŒæ­¥
5. **ç‰©è”ç½‘ç›‘æ§**ï¼šä¼ æ„Ÿå™¨æ•°æ®æµå±•ç¤º

::: theorem
å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼ŒSSEæ˜¯ç†æƒ³é€‰æ‹©ï¼š
- ä»…éœ€æœåŠ¡å™¨â†’å®¢æˆ·ç«¯çš„æ•°æ®æµ
- æ•°æ®æ ¼å¼ä»¥æ–‡æœ¬ä¸ºä¸»
- éœ€è¦æµè§ˆå™¨åŸç”Ÿæ”¯æŒ
- å¸Œæœ›å®ç°ç®€å•ä¸”è‡ªåŠ¨é‡è¿
:::

## ç»“è¯­

åœ¨è¿½æ±‚å®æ—¶ä½“éªŒçš„ä»Šå¤©ï¼ŒSSEä»¥å…¶**ç®€æ´æ€§ã€ä½å¼€é”€å’Œæµè§ˆå™¨åŸç”Ÿæ”¯æŒ**ï¼Œä¸ºå•å‘æ•°æ®æ¨é€æä¾›äº†ä¼˜é›…è§£å†³æ–¹æ¡ˆã€‚ğŸš€

è™½ç„¶WebSocketåœ¨åŒå‘é€šä¿¡åœºæ™¯ä¸­æ— å¯æ›¿ä»£ï¼Œä½†åœ¨å•å‘æ¨é€éœ€æ±‚é¢å‰ï¼ŒSSEå°±åƒä¸€æŠŠç‘å£«å†›åˆ€â€”â€”å°å·§å´ç²¾å‡†æœ‰åŠ›ã€‚ä¸‹æ¬¡å½“ä½ éœ€è¦å®æ—¶æ•°æ®å±•ç¤ºæ—¶ï¼Œä¸å¦¨ç»™SSEä¸€ä¸ªæœºä¼šï¼Œå®ƒå¯èƒ½ä¼šè®©ä½ æƒŠå–œäºå®ƒçš„ç®€å•é«˜æ•ˆï¼

> "æœ€å¥½çš„æŠ€æœ¯ä¸æ˜¯æœ€å¤æ‚çš„ï¼Œè€Œæ˜¯æœ€é€‚åˆåœºæ™¯çš„ã€‚" â€”â€” Jorgençš„æŠ€æœ¯å“²å­¦

---

**å»¶ä¼¸é˜…è¯»**ï¼š  
- [MDN SSEæ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)
- [SSE vs WebSocketæ€§èƒ½å¯¹æ¯”](https://stackoverflow.com/questions/51954032/serversentevents-vs-websocket)
```