---
title: 协议设计
date: 2023-02-05 09:20:44
permalink: /pages/72aeef/
categories:
  - 开发日志
tags:
  - 
author: 
  name: Jorgen
  link: https://github.com/jorgen-zhao
---

## 思考

> 场景：利用单次传输存在字节上限的方式（北斗短报文，二代单次只能上传< 80字节）进行电表信息的采集。

1. 集中器汇集电表的数据，通过电磁波/485线的方式采集到每户电表的数据。统一由集中器进行上报传输。单个电表不具有联网的能力，只有集中器才有联网的能力。

2. 一般这种场景，都是使用4G的方式进行传输。但是在一些偏远地区（如新疆边缘地带），不具备稳定的4G信号的这种场景。所以得有一些其他的传输方式。

3. 北斗短报文即是这种的解决方案。通过卫星的方式传输数据。

   | 优势                                                         | 劣势                                                         |
   | ------------------------------------------------------------ | ------------------------------------------------------------ |
   | 4G等主流的传输途径不可触及的场景，非常适合北斗短报文进行信息传输 | 单次的传输存在上限，< 80字节；民用传输极不稳定，非常容易丢包；指挥机虽然支持通播，但最快传输速度 > 60s |


4. 集中器传输数据，也不是一股脑进行采集传输。一般会按照二十个电表这样字符，大于2k字节数据这样为一帧。

5. 使用短报文设计协议时，就得非常注意单次传输的大小，以及丢包如何进行补偿。且短报文还存在延时下发的硬性限制。


> 问题：大数据量；传输丢包情况；延时下发的限制

1. 大数据量：使用压缩算法，终端获取到数据后，使用压缩算法先进行处理。压缩比能达到7 ~ 8 成
2. 传输丢包情况：协议商定；上传的报文中涵盖主帧头（包含一共多少数量帧信息），分帧头（由分帧编号 + 剩余数据组成）；每一帧获取的时间设定超时限制，总超时时间一到，即开始组包，如果发现存在不完整的情况，下发请求丢包报文。获取丢包数据。重复这个流程，一直直到数据采集完成。
3. 延时下发限制：由于北斗民用卡的限制，每次发送间隔 > 60s，所以得给下发的报文区分类型。不同类型的报文下发的优先级有区别。大约可分为：下发请求报文 > 超时获取主帧报文 > 超时获取分帧报文。

##  要点
设计物联网交互协议时，以下是需要考虑的关键要点：

1. 低功耗：物联网设备通常具有有限的电池寿命，因此交互协议需要在通信过程中尽可能地减少功耗，从而延长设备寿命。
   
2. 数据格式：数据格式应该能够满足设备之间的数据交换需要，并且易于解析和处理。可以采用JSON、XML、二进制等格式

3. 安全性：物联网设备通常包含重要的数据和控制信息，因此交互协议需要确保这些信息在传输过程中得到保护。协议应该包括数据加密和身份验证等安全特性。
   
4. 网络拓扑：物联网设备可以是分散的，且组成的网络可以采用各种不同的拓扑结构。交互协议应该考虑到这些因素，并能够适应不同的拓扑结构，如星形、网状、总线等。

5. 互操作性：物联网设备通常来自不同的制造商，使用不同的通信协议和数据格式。因此，交互协议应该具有良好的互操作性，以便不同类型的设备可以相互通信。

6. 带宽效率：物联网设备的网络带宽通常非常有限，因此交互协议需要设计为高效的数据传输方式，以确保数据传输的速度和效率。

7. 灵活性：物联网设备和应用程序通常需要进行不同类型的交互。因此，交互协议应该是灵活的，并支持不同类型的交互，例如请求-响应、发布-订阅等。

8.  可扩展性：物联网设备数量和种类可能会随着时间的推移而增加，因此交互协议应该设计为可扩展的，以便能够适应未来的增长。

以上是设计物联网交互协议时需要考虑的关键要点。这些因素需要根据具体的应用场景进行权衡和优化，以达到最佳的协议设计。