---
title: 平台架构
date: 2023-03-04 22:29:37
permalink: /pages/72ef80/
categories:
  - 开发日志
tags:
  - 单体架构
  - 微服务架构
author: 
  name: Jorgen
  link: https://github.com/jorgen-zhao
---
## 架构

::: tip 原则
架构从来都不是一成不变的，而是持续演进的结果。
:::

<!-- more -->

## 单体架构
由单台机器就足以支撑其良好运行的系统，单体不仅易于开发、易于测试、易于部署，且由于系统中各个功能、模块、方法的调用过程都是进程内调用，不会发生进程间通信。

::: theorem Monolithic Application

Monolith means composed all in one piece. The Monolithic application describes a single-tiered software application in which different components combined into a single program from a single platform.

单体意味着自包含。单体应用描述了一种由同一技术平台的不同组件构成的单层软件。
::: right
来自 [维基百科](https://en.wikipedia.org/wiki/Monolithic_application)
:::

### 4G物联

要求：
1. 服务器作为服务端，暴露端口。集中器作为客户端连接服务器端口，进行数据交互。
2. 服务端接收到集中器上报的数据，透传给电力主站，即完成整个流程。
   
流程图如下所示：
![4G方式](/dev/00/00.png)

这种项目直接使用单体架构就能满足条件。

### 短报文物联
这一种架构其实和第一种没什么区别。单体架构就能满足条件。

![北斗短报文方式](/dev/00/10.png)

单独拿出来讲呢，主要是这里面涉及到了北斗短报文的方式进行数据传输。目前使用的民用2代卡呢，主要有几个限制：
1. 单次通信的数据容量限制，单次数据承载量<80字节
2. 单次通信间隔 > 60s

基于以上2个硬性条件限制，当使用其传输大容量报文时，需要考虑丢包补偿，超时重试机制。这个在架构上没什么特别的体现，主要是流程异常时还能够完成整个数据采集的流程。

## 微服务架构

::: tip 微服务架构（Microservices）
微服务是一种通过多个小型服务组合来构建单个应用的架构风格，这些服务围绕业务能力而非特定的技术标准来构建。各个服务可以采用不同的编程语言，不同的数据存储技术，运行在不同的进程之中。服务采取轻量级的通信机制和自动化的部署机制实现通信与运维。
:::

拓展功能，在一个模块上进行开发，无论是拓展，还是维护，都极大的不方便。而且每次升级都会造成数据丢失。对功能进行拆分，演变为微服务模式。

### 设备部分
设备存在大部分不能联网，或者联网需求性不强，可以借助**网关**来拓展通信功能。网关借助485/串口/波的方式连接设备，设备将数据通过渠道传递给网关。网关获取数据之后，再与平台进行通信。数据交互。下发指令类似。

![IoT平台](/dev/00/20.png)

### 平台层
1. 连接层：负责与设备交互，接受设备上报的数据，下发平台的指令给设备；
2. 中间件层：削峰大数据量同时上报的数据，缓存到诸如kafka的消息引擎中；
3. 解析层：作为消费者，消费`kafka`中的消息；
4. 数据处理层：将解析完的数据进行处理：校正、数据补偿、计算、批处理…..
5. 数据流转层：将处理完成的数据进行业务推送：web、第三方平台、微信……
6. 呈现层：RESTful接口，用于**运维**人员进行系统排查与使用；
7. 持久层：报文数据，与业务数据持久化，通常使用`NoSQL`方式进行持久。→ 拓展：使用时序数据库做持久层;
8. 业务层：交于**用户**功能，满足用户简便、实用的需求。符合一般系统的功能：登录、注册、管理设备、查看故障异常、收发消息、下发指令


![IoT平台](/dev/00/30.png)

### 注意点
1. 服务拆分后，分布式项目。各个流程节点如何同步数据状态。如何保证数据的准确性，稳定性。
2. 服务运行情况、中间件的运行情况、数据库运行情况、服务器的运行情况 ⇒ 搭配监控系统检测健康状态。
3. 业务流转的情况，搭配分布式日志系统，选型，涉及运维便捷性、易用性等方面因素。
4. 采用敏捷开发模式，即意味着服务的开发模式是持续开发，持续集成。即需要使用现代化运维工具 docker + Jenkins的方式CI/CD