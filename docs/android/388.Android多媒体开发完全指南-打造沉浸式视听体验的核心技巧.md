---
title: Androidå¤šåª’ä½“å¼€å‘å®Œå…¨æŒ‡å—-æ‰“é€ æ²‰æµ¸å¼è§†å¬ä½“éªŒçš„æ ¸å¿ƒæŠ€å·§
date: 2026-02-06
tags: [Androidå¼€å‘, å¤šåª’ä½“, éŸ³è§†é¢‘å¤„ç†]
---

## å‰è¨€

å—¨ï¼Œå¤§å®¶å¥½ï¼æˆ‘æ˜¯Jorgenï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠAndroidå¼€å‘ä¸­ä¸€ä¸ªéå¸¸æœ‰è¶£ä½†åˆå®¹æ˜“è¢«å¿½è§†çš„è¯é¢˜â€”â€”å¤šåª’ä½“å¼€å‘ã€‚ğŸ“ºğŸµ

åœ¨å½“ä»Šçš„ç§»åŠ¨åº”ç”¨ä¸­ï¼Œå¤šåª’ä½“åŠŸèƒ½å·²ç»æˆä¸ºå¸å¼•ç”¨æˆ·çš„é‡è¦å…ƒç´ ã€‚æ— è®ºæ˜¯çŸ­è§†é¢‘åº”ç”¨ã€éŸ³ä¹æ’­æ”¾å™¨ï¼Œè¿˜æ˜¯ç¤¾äº¤åª’ä½“ä¸­çš„å›¾ç‰‡åˆ†äº«ï¼Œéƒ½ç¦»ä¸å¼€å¤šåª’ä½“æŠ€æœ¯çš„æ”¯æŒã€‚ç„¶è€Œï¼Œå¾ˆå¤šå¼€å‘è€…åœ¨å¤„ç†éŸ³è§†é¢‘ã€ç›¸æœºç­‰åŠŸèƒ½æ—¶ï¼Œå¾€å¾€ä¼šé‡åˆ°å„ç§æŒ‘æˆ˜ã€‚

::: tip
å¤šåª’ä½“å¼€å‘ä¸ä»…ä»…æ˜¯è°ƒç”¨APIé‚£ä¹ˆç®€å•ï¼Œå®ƒæ¶‰åŠåˆ°æ€§èƒ½ä¼˜åŒ–ã€å†…å­˜ç®¡ç†ã€ç”¨æˆ·ä½“éªŒç­‰å¤šä¸ªæ–¹é¢ï¼Œæ˜¯ä¸€é—¨éœ€è¦æ·±å…¥å­¦ä¹ çš„æŠ€èƒ½ã€‚
:::

æœ¬æ–‡å°†å¸¦æ‚¨å…¨é¢äº†è§£Androidå¤šåª’ä½“å¼€å‘çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œä»åŸºç¡€çš„éŸ³è§†é¢‘æ’­æ”¾åˆ°é«˜çº§çš„ç›¸æœºæ“ä½œï¼ŒåŠ©æ‚¨æ‰“é€ å‡ºä»¤äººæƒŠè‰³çš„æ²‰æµ¸å¼åº”ç”¨ä½“éªŒã€‚

## Androidå¤šåª’ä½“å¼€å‘æ¦‚è¿°

Androidç³»ç»Ÿæä¾›äº†ä¸°å¯Œçš„å¤šåª’ä½“APIï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°åœ¨åº”ç”¨ä¸­é›†æˆéŸ³è§†é¢‘ã€å›¾åƒå¤„ç†ç­‰åŠŸèƒ½ã€‚è¿™äº›APIä¸»è¦åˆ†å¸ƒåœ¨ä»¥ä¸‹å‡ ä¸ªåŒ…ä¸­ï¼š

- `android.media` - åŸºç¡€å¤šåª’ä½“åŠŸèƒ½
- `android.media.audiofx` - éŸ³é¢‘æ•ˆæœå¤„ç†
- `android.media.camera2` - ç›¸æœºæ§åˆ¶
- `android.media.mediaplayer` - åª’ä½“æ’­æ”¾
- `android.media.mediacodec` - åª’ä½“ç¼–è§£ç 
- `android.media.mediarecorder` - åª’ä½“å½•åˆ¶

## éŸ³é¢‘æ’­æ”¾ä¸å¤„ç†

### MediaPlayeråŸºç¡€ä½¿ç”¨

`MediaPlayer`æ˜¯Androidä¸­æœ€å¸¸ç”¨çš„éŸ³é¢‘æ’­æ”¾ç±»ï¼Œå®ƒå¯ä»¥æ’­æ”¾å„ç§æ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶ã€‚

```java
MediaPlayer mediaPlayer = new MediaPlayer();
try {
    // è®¾ç½®æ•°æ®æº
    mediaPlayer.setDataSource(context, audioUri);
    // å‡†å¤‡æ’­æ”¾
    mediaPlayer.prepare();
    // å¼€å§‹æ’­æ”¾
    mediaPlayer.start();
} catch (IOException e) {
    e.printStackTrace();
}
```

### ä½¿ç”¨ExoPlayeræ›¿ä»£MediaPlayer

è™½ç„¶`MediaPlayer`ç®€å•æ˜“ç”¨ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘æ›´æ¨èä½¿ç”¨Googleå®˜æ–¹çš„`ExoPlayer`ã€‚å®ƒæä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¦‚è‡ªé€‚åº”æµåª’ä½“ã€DRMæ”¯æŒå’Œæ›´å¥½çš„æ€§èƒ½æ§åˆ¶ã€‚

```java
SimpleExoPlayer player = new SimpleExoPlayer.Builder(context).build();
playerView.setPlayer(player);
MediaItem mediaItem = MediaItem.fromUri(audioUri);
player.setMediaItem(mediaItem);
player.prepare();
player.play();
```

### éŸ³é¢‘ç„¦ç‚¹å¤„ç†

åœ¨Androidç³»ç»Ÿä¸­ï¼Œå¤šä¸ªåº”ç”¨å¯èƒ½ä¼šåŒæ—¶æ’­æ”¾éŸ³é¢‘ï¼Œå› æ­¤æ­£ç¡®å¤„ç†éŸ³é¢‘ç„¦ç‚¹éå¸¸é‡è¦ã€‚

```java
AudioManager audioManager = (AudioManager) getSystemService(AUDIO_SERVICE);
int result = audioManager.requestAudioFocus(
    new AudioManager.OnAudioFocusChangeListener() {
        @Override
        public void onAudioFocusChange(int focusChange) {
            switch (focusChange) {
                case AudioManager.AUDIOFOCUS_GAIN:
                    // è·å¾—ç„¦ç‚¹ï¼Œå¯ä»¥å¼€å§‹æˆ–ç»§ç»­æ’­æ”¾
                    break;
                case AudioManager.AUDIOFOCUS_LOSS:
                    // å¤±å»ç„¦ç‚¹ï¼Œåœæ­¢æ’­æ”¾
                    break;
                case AudioManager.AUDIOFOCUS_LOSS_TRANSIENT:
                    // ä¸´æ—¶å¤±å»ç„¦ç‚¹ï¼Œæš‚åœæ’­æ”¾
                    break;
            }
        }
    },
    AudioManager.STREAM_MUSIC,
    AudioManager.AUDIOFOCUS_GAIN
);
```

## è§†é¢‘æ’­æ”¾ä¸å¤„ç†

### VideoViewä¸MediaController

å¯¹äºç®€å•çš„è§†é¢‘æ’­æ”¾ï¼Œå¯ä»¥ä½¿ç”¨`VideoView`é…åˆ`MediaController`å®ç°åŸºæœ¬çš„æ’­æ”¾æ§åˆ¶ã€‚

```xml
<VideoView
    android:id="@+id/videoView"
    android:layout_width="match_parent"
    android:layout_height="wrap_content" />
```

```java
VideoView videoView = findViewById(R.id.videoView);
MediaController mediaController = new MediaController(this);
mediaController.setAnchorView(videoView);
videoView.setMediaController(mediaController);
videoView.setVideoURI(Uri.parse(videoUrl));
videoView.start();
```

### è‡ªå®šä¹‰è§†é¢‘æ’­æ”¾å™¨

ä¸ºäº†æ‰“é€ æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦è‡ªå®šä¹‰è§†é¢‘æ’­æ”¾å™¨ç•Œé¢ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨`SurfaceView`æˆ–`TextureView`ç»“åˆ`MediaPlayer`æˆ–`ExoPlayer`æ¥å®ç°ã€‚

```java
SurfaceView surfaceView = findViewById(R.id.surfaceView);
MediaPlayer mediaPlayer = new MediaPlayer();
mediaPlayer.setSurface(surfaceView.getHolder().getSurface());
// è®¾ç½®æ•°æ®æºå¹¶å‡†å¤‡æ’­æ”¾...
```

### è§†é¢‘æ ¼å¼è½¬æ¢ä¸ç¼–è§£ç 

å¯¹äºéœ€è¦å¤„ç†è§†é¢‘æ–‡ä»¶çš„åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨`MediaCodec`è¿›è¡Œè§†é¢‘çš„ç¼–è§£ç æ“ä½œã€‚

```java
MediaCodec codec = MediaCodec.createEncoderByType(MIME_TYPE);
codec.configure(format, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE);
codec.start();
```

## ç›¸æœºå¼€å‘

### Camera2 APIåŸºç¡€ä½¿ç”¨

ä»Android 5.0å¼€å§‹ï¼ŒGoogleå¼•å…¥äº†æ–°çš„`Camera2` APIæ¥æ›¿ä»£æ—§çš„`Camera` APIã€‚`Camera2`æä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½å’Œæ›´ç²¾ç»†çš„æ§åˆ¶ã€‚

```java
CameraManager cameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);
String cameraId = cameraManager.getCameraIdList()[0];
CameraCharacteristics characteristics = cameraManager.getCameraCharacteristics(cameraId);

// æ£€æŸ¥ç›¸æœºæ˜¯å¦æ”¯æŒè‡ªåŠ¨å¯¹ç„¦
Integer afMode = characteristics.get(CameraCharacteristics.CONTROL_AF_MODE);
if (afMode == null || (afMode & CameraMetadata.CONTROL_AF_MODE_AUTO_FOCUS) == 0) {
    // ä¸æ”¯æŒè‡ªåŠ¨å¯¹ç„¦
}

// æ‰“å¼€ç›¸æœº
cameraManager.openCamera(cameraId, stateCallback, null);
```

### å®ç°ç›¸æœºé¢„è§ˆ

```java
TextureView textureView = findViewById(R.id.textureView);
textureView.setSurfaceTextureListener(new TextureView.SurfaceTextureListener() {
    @Override
    public void onSurfaceTextureAvailable(SurfaceTexture surface, int width, int height) {
        // å¼€å§‹ç›¸æœºé¢„è§ˆ
        startCameraPreview(surface);
    }
    
    // å…¶ä»–å›è°ƒæ–¹æ³•...
});
```

### æ‹ç…§ä¸å½•åƒ

```java
// æ‹ç…§
CaptureRequest.Builder captureBuilder = cameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE);
captureBuilder.addTarget(imageReader.getSurface());
captureBuilder.set(CaptureControl.CONTROL_AF_TRIGGER, CameraMetadata.CONTROL_AF_TRIGGER_START);
cameraDevice.capture(captureBuilder.build(), captureCallback, backgroundHandler);

// å½•åƒ
MediaRecorder mediaRecorder = new MediaRecorder();
// é…ç½®MediaRecorder...
cameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_RECORD).build();
```

## éŸ³é¢‘å½•åˆ¶

### MediaRecorderå®ç°å½•éŸ³

```java
MediaRecorder recorder = new MediaRecorder();
recorder.setAudioSource(MediaRecorder.AudioSource.MIC);
recorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);
recorder.setOutputFile(audioFilePath);
recorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);

try {
    recorder.prepare();
    recorder.start();
} catch (IOException e) {
    e.printStackTrace();
}
```

### AudioRecordå®ç°æ›´çµæ´»çš„å½•éŸ³

å¯¹äºéœ€è¦å®æ—¶å¤„ç†éŸ³é¢‘æ•°æ®çš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨`AudioRecord`ç±»ã€‚

```java
int bufferSize = AudioRecord.getMinBufferSize(sampleRate, channelConfig, audioFormat);
AudioRecord audioRecord = new AudioRecord(
    MediaRecorder.AudioSource.MIC,
    sampleRate,
    channelConfig,
    audioFormat,
    bufferSize
);

audioRecord.startRecording();

// åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¯»å–éŸ³é¢‘æ•°æ®
new Thread(() -> {
    byte[] buffer = new byte[bufferSize];
    while (isRecording) {
        int bytesRead = audioRecord.read(buffer, 0, bufferSize);
        // å¤„ç†éŸ³é¢‘æ•°æ®...
    }
}).start();
```

## å¤šåª’ä½“æ€§èƒ½ä¼˜åŒ–

### å†…å­˜ç®¡ç†

å¤šåª’ä½“æ“ä½œé€šå¸¸æ¶‰åŠå¤§é‡å†…å­˜ä½¿ç”¨ï¼Œå› æ­¤åˆç†çš„å†…å­˜ç®¡ç†è‡³å…³é‡è¦ã€‚

```java
// ä½¿ç”¨åé‡Šæ”¾èµ„æº
if (mediaPlayer != null) {
    mediaPlayer.release();
    mediaPlayer = null;
}

// ä½¿ç”¨Bitmapæ—¶æ³¨æ„å›æ”¶
if (bitmap != null && !bitmap.isRecycled()) {
    bitmap.recycle();
    bitmap = null;
}
```

### ç¡¬ä»¶åŠ é€Ÿ

åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿå¯ä»¥æ˜¾è‘—æé«˜å¤šåª’ä½“å¤„ç†çš„æ€§èƒ½ã€‚

```java
// åœ¨æ¸…å•æ–‡ä»¶ä¸­å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ
<application
    android:hardwareAccelerated="true">
    
// æˆ–è€…åœ¨ä»£ç ä¸­å¯ç”¨
view.setLayerType(View.LAYER_TYPE_HARDWARE, null);
```

### åå°å¤„ç†

å¤šåª’ä½“å¤„ç†å¯èƒ½ä¼šè€—æ—¶è¾ƒé•¿ï¼Œåº”é¿å…åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚

```java
// ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†å¤šåª’ä½“ä»»åŠ¡
ExecutorService executor = Executors.newFixedThreadPool(4);
executor.execute(() -> {
    // æ‰§è¡Œè€—æ—¶æ“ä½œ
});
```

## å¤šåª’ä½“åº”ç”¨æœ€ä½³å®è·µ

### 1. é€‚é…ä¸åŒè®¾å¤‡å’ŒAndroidç‰ˆæœ¬

```java
// æ£€æŸ¥ç›¸æœºåŠŸèƒ½
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
    // ä½¿ç”¨Camera2 API
} else {
    // ä½¿ç”¨æ—§ç‰ˆCamera API
}

// æ£€æŸ¥æƒé™
if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA) 
    != PackageManager.PERMISSION_GRANTED) {
    // è¯·æ±‚æƒé™
}
```

### 2. å¤„ç†è®¾å¤‡æ—‹è½¬

```java
@Override
public void onConfigurationChanged(Configuration newConfig) {
    super.onConfigurationChanged(newConfig);
    if (newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE) {
        // æ¨ªå±å¤„ç†
    } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT) {
        // ç«–å±å¤„ç†
    }
}
```

### 3. ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

```java
// æ’­æ”¾/æš‚åœæŒ‰é’®åˆ‡æ¢
playPauseButton.setOnClickListener(v -> {
    if (mediaPlayer.isPlaying()) {
        mediaPlayer.pause();
        playPauseButton.setImageResource(R.drawable.ic_play);
    } else {
        mediaPlayer.start();
        playPauseButton.setImageResource(R.drawable.ic_pause);
    }
});
```

## ç»“è¯­

å¤šåª’ä½“å¼€å‘æ˜¯Androidåº”ç”¨å¼€å‘ä¸­éå¸¸æœ‰è¶£ä¸”é‡è¦çš„ä¸€ç¯ã€‚ä»ç®€å•çš„éŸ³é¢‘æ’­æ”¾åˆ°å¤æ‚çš„ç›¸æœºæ“ä½œï¼ŒAndroidæä¾›äº†ä¸°å¯Œçš„APIå’Œå·¥å…·æ¥æ»¡è¶³å„ç§éœ€æ±‚ã€‚

::: right
"å¥½çš„å¤šåª’ä½“ä½“éªŒæ˜¯å¸å¼•ç”¨æˆ·çš„å…³é”®ï¼Œä¹Ÿæ˜¯æå‡åº”ç”¨å“è´¨çš„é‡è¦æ‰‹æ®µã€‚"
:::

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®åº”ç”¨çš„å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œå¹¶æ³¨æ„æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©æ‚¨åœ¨Androidå¤šåª’ä½“å¼€å‘çš„é“è·¯ä¸Šå°‘èµ°å¼¯è·¯ï¼Œæ‰“é€ å‡ºä»¤äººæƒŠè‰³çš„åº”ç”¨ï¼

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµã€‚ğŸ‘‡

> è®°ä½ï¼ŒæŠ€æœ¯æ˜¯æ‰‹æ®µï¼Œä½“éªŒæ‰æ˜¯ç›®æ ‡ã€‚è®©æˆ‘ä»¬ç”¨å¤šåª’ä½“æŠ€æœ¯ä¸ºç”¨æˆ·åˆ›é€ æ›´åŠ ä¸°å¯Œå¤šå½©çš„æ•°å­—ç”Ÿæ´»ï¼