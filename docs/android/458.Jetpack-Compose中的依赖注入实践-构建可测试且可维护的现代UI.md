---
title: Jetpack Composeä¸­çš„ä¾èµ–æ³¨å…¥å®è·µ-æ„å»ºå¯æµ‹è¯•ä¸”å¯ç»´æŠ¤çš„ç°ä»£UI
date: 2026-02-06
tags: [Jetpack Compose, ä¾èµ–æ³¨å…¥, æ¶æ„]
---

## å‰è¨€

è‡ªä»Jetpack Composeå‘å¸ƒä»¥æ¥ï¼ŒAndroid UIå¼€å‘è¿›å…¥äº†ä¸€ä¸ªå…¨æ–°çš„å£°æ˜å¼æ—¶ä»£ã€‚ğŸš€ ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸é¢ä¸´ä¸€ä¸ªå…³é”®é—®é¢˜ï¼šå¦‚ä½•åœ¨Composeä¸­ä¼˜é›…åœ°å®ç°ä¾èµ–æ³¨å…¥ï¼Ÿä¼ ç»ŸViewç³»ç»Ÿçš„DIæ–¹æ¡ˆï¼ˆå¦‚Daggerï¼‰åœ¨Composeä¸­å¯èƒ½æ˜¾å¾—ç¬¨é‡ï¼Œè€Œå®˜æ–¹æ¨èçš„Hiltåˆç¼ºä¹é’ˆå¯¹Composeçš„ä¸“é—¨æŒ‡å—ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ·±å…¥æ¢è®¨å¦‚ä½•åœ¨Composeä¸­æ„å»ºå¯æµ‹è¯•ä¸”å¯ç»´æŠ¤çš„ä¾èµ–æ³¨å…¥æ¶æ„ã€‚

::: tip
"åœ¨å£°æ˜å¼UIä¸­ï¼ŒçŠ¶æ€ç®¡ç†æ˜¯æ ¸å¿ƒï¼Œè€Œä¾èµ–æ³¨å…¥æ˜¯çŠ¶æ€ç®¡ç†çš„åŸºçŸ³"
:::

## ä¾èµ–æ³¨å…¥åŸºç¡€

åœ¨æ·±å…¥Composeä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæ¦‚å¿µï¼š

```kotlin
// ä¼ ç»Ÿæ–¹å¼ - ç´§è€¦åˆ
class UserProfileViewModel {
    private val userRepository = UserRepository() // ç›´æ¥å®ä¾‹åŒ–
}

// ä¾èµ–æ³¨å…¥æ–¹å¼ - æ¾è€¦åˆ
class UserProfileViewModel @Inject constructor(
    private val userRepository: UserRepository // é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥
)
```

ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š
- **å¯æµ‹è¯•æ€§**ï¼šè½»æ¾æ³¨å…¥mockå¯¹è±¡è¿›è¡Œå•å…ƒæµ‹è¯•
- **å¯ç»´æŠ¤æ€§**ï¼šç»„ä»¶é—´è§£è€¦ï¼Œé™ä½ä¿®æ”¹å½±å“èŒƒå›´
- **å¯é‡ç”¨æ€§**ï¼šç»„ä»¶å¯åœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­å¤ç”¨

## åœ¨Composeä¸­ä½¿ç”¨Hilt

Hiltæ˜¯Googleå®˜æ–¹æ¨èçš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå¯¹Composeæä¾›äº†åŸç”Ÿæ”¯æŒã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®ç°ï¼š

### 1. åŸºç¡€è®¾ç½®

```kotlin
// åœ¨Applicationç±»ä¸­åˆå§‹åŒ–Hilt
@HiltAndroidApp
class MyApplication : Application()

// åœ¨Activityä¸­å¯ç”¨Hilt
@AndroidEntryPoint
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            MyTheme {
                // Composeå†…å®¹
            }
        }
    }
}
```

### 2. ViewModelæ³¨å…¥

```kotlin
@HiltViewModel
class UserProfileViewModel @Inject constructor(
    private val userRepository: UserRepository
) : ViewModel() {
    // ViewModelå®ç°
}
```

åœ¨Composeä¸­ä½¿ç”¨ViewModelï¼š

```kotlin
@Composable
fun UserProfileScreen(viewModel: UserProfileViewModel = hiltViewModel()) {
    // ä½¿ç”¨ViewModel
}
```

## é«˜çº§ä¾èµ–æ³¨å…¥æŠ€å·§

### 1. ä½œç”¨åŸŸæ„ŸçŸ¥çš„ä¾èµ–æ³¨å…¥

```kotlin
// ä¸ºç‰¹å®šå±å¹•åˆ›å»ºè‡ªå®šä¹‰ä½œç”¨åŸŸ
@EntryPoint
@InstallIn(ActivityComponent::class)
interface UserProfileEntryPoint {
    fun userRepository(): UserRepository
}

@Composable
fun UserProfileScreen() {
    val entryPoint = remember { EntryPointAccessors.fromActivity<MainActivity, UserProfileEntryPoint>(localActivity) }
    val userRepository = entryPoint.userRepository()
    
    // ä½¿ç”¨userRepository
}
```

### 2. ä¾èµ–æ³¨å…¥çš„Composableå‡½æ•°

```kotlin
@Composable
fun provideUserProfileViewModel(): UserProfileViewModel {
    return hiltViewModel()
}

@Composable
fun UserProfileScreen(viewModel: () -> UserProfileViewModel = { provideUserProfileViewModel() }) {
    // ä½¿ç”¨ViewModel
}
```

## å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·èµ„æ–™å±å¹•

è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·èµ„æ–™å±å¹•ï¼Œå±•ç¤ºä¾èµ–æ³¨å…¥çš„æœ€ä½³å®è·µï¼š

```kotlin
// 1. å®šä¹‰ä¾èµ–æ¥å£
interface UserRepository {
    suspend fun getUserProfile(userId: String): UserProfile
}

// 2. å®ç°ä¾èµ–
@Singleton
class UserRepositoryImpl @Inject constructor(
    private val apiService: ApiService
) : UserRepository {
    override suspend fun getUserProfile(userId: String): UserProfile {
        return apiService.getUserProfile(userId)
    }
}

// 3. ViewModel
@HiltViewModel
class UserProfileViewModel @Inject constructor(
    private val userRepository: UserRepository
) : ViewModel() {
    private val _userProfile = MutableStateFlow<UserProfile?>(null)
    val userProfile: StateFlow<UserProfile?> = _userProfile
    
    fun loadProfile(userId: String) {
        viewModelScope.launch {
            _userProfile.value = userRepository.getUserProfile(userId)
        }
    }
}

// 4. Compose UI
@Composable
fun UserProfileScreen(
    viewModel: UserProfileViewModel = hiltViewModel(),
    userId: String = "123"
) {
    LaunchedEffect(Unit) {
        viewModel.loadProfile(userId)
    }
    
    val userProfile by viewModel.userProfile.collectAsState()
    
    userProfile?.let { profile ->
        Column(
            modifier = Modifier.fillMaxSize(),
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.Center
        ) {
            Image(
                painter = rememberAsyncImagePainter(profile.avatarUrl),
                contentDescription = "User Avatar",
                modifier = Modifier.size(120.dp)
            )
            Text(
                text = profile.name,
                style = MaterialTheme.typography.h4
            )
            Text(
                text = profile.email,
                style = MaterialTheme.typography.body1
            )
        }
    }
}
```

## æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

### 1. ä¾èµ–æ³¨å…¥å±‚çº§

```
ApplicationComponent (å•ä¾‹)
â”œâ”€â”€ ActivityComponent (æ¯ä¸ªActivity)
â”œâ”€â”€ FragmentComponent (æ¯ä¸ªFragment)
â””â”€â”€ ViewModelComponent (æ¯ä¸ªViewModel)
```

### 2. é¿å…è¿‡åº¦æ³¨å…¥

```kotlin
// ä¸æ¨èï¼šæ³¨å…¥è¿‡å¤šä¾èµ–
@HiltViewModel
class UserProfileViewModel @Inject constructor(
    private val userRepository: UserRepository,
    private val analyticsService: AnalyticsService,
    private val preferencesManager: PreferencesManager,
    private val imageLoader: ImageLoader
) // å¤ªå¤šä¾èµ–äº†ï¼

// æ¨èï¼šç»„åˆæœåŠ¡
@HiltViewModel
class UserProfileViewModel @Inject constructor(
    private val userProfileService: UserProfileService // ç»„åˆå¤šä¸ªæœåŠ¡
)
```

### 3. æµ‹è¯•ç­–ç•¥

```kotlin
// å•å…ƒæµ‹è¯•
class UserProfileViewModelTest {
    @Test
    fun `loadProfile should update state`() = runTest {
        // å‡†å¤‡mockä¾èµ–
        val mockRepository = mockk<UserRepository>()
        every { mockRepository.getUserProfile(any()) } returns testUserProfile
        
        // åˆ›å»ºViewModel
        val viewModel = UserProfileViewModel(mockRepository)
        
        // æ‰§è¡Œæµ‹è¯•
        viewModel.loadProfile("123")
        
        // éªŒè¯ç»“æœ
        assertEquals(testUserProfile, viewModel.userProfile.value)
    }
}
```

## ç»“è¯­

åœ¨Jetpack Composeä¸­å®ç°ä¾èµ–æ³¨å…¥ï¼Œä¸ä»…æ˜¯æŠ€æœ¯é€‰æ‹©ï¼Œæ›´æ˜¯æ¶æ„æ€æƒ³çš„ä½“ç°ã€‚é€šè¿‡åˆç†ä½¿ç”¨Hiltå’ŒComposeçš„å†…ç½®æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºï¼š

- **é«˜å¯æµ‹è¯•æ€§**ï¼šè½»æ¾ä¸ºæ¯ä¸ªComposableæ³¨å…¥æµ‹è¯•ä¾èµ–
- **é«˜å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„ä¾èµ–å…³ç³»ï¼Œé™ä½ä¿®æ”¹æˆæœ¬
- **é«˜æ€§èƒ½**ï¼šé¿å…ä¸å¿…è¦çš„ä¾èµ–åˆ›å»ºå’Œé”€æ¯

è®°ä½ï¼Œä¾èµ–æ³¨å…¥ä¸æ˜¯é“¶å¼¹ï¼Œä½†å®ƒç¡®å®æ˜¯æ„å»ºå¤æ‚åº”ç”¨æ—¶çš„å¼ºå¤§å·¥å…·ã€‚éšç€Composeçš„ä¸æ–­æ¼”è¿›ï¼Œæˆ‘ä»¬æœŸå¾…çœ‹åˆ°æ›´å¤šå®˜æ–¹æä¾›çš„DIè§£å†³æ–¹æ¡ˆã€‚ğŸ”¥

> "ä¼˜ç§€çš„æ¶æ„ä¸æ˜¯å…³äºæŠ€æœ¯ï¼Œè€Œæ˜¯å…³äºæ¸…æ™°æ€§å’Œå¯ç»´æŠ¤æ€§"

---

*æœ¬æ–‡ç¤ºä¾‹ä»£ç åŸºäºHilt 2.45å’ŒCompose 1.4ç¼–å†™ï¼Œå®é™…ä½¿ç”¨æ—¶è¯·å‚è€ƒæœ€æ–°æ–‡æ¡£*