---
title: Androidåº”ç”¨æ€§èƒ½ä¼˜åŒ–å®æˆ˜æ¡ˆä¾‹ - æ‰“é€ æµç•…ç”¨æˆ·ä½“éªŒçš„æ·±åº¦è§£æ
date: 2026-02-04
tags: [æ€§èƒ½ä¼˜åŒ–, Androidå¼€å‘, å®æˆ˜æ¡ˆä¾‹]
---

## å‰è¨€

å˜¿ï¼Œå„ä½Androidå¼€å‘è€…ä»¬ï¼ğŸ‘‹ ä½œä¸ºä¸€ååœ¨Androidå¼€å‘è·¯ä¸Šæ‘¸çˆ¬æ»šæ‰“å¤šå¹´çš„è€å…µï¼Œæˆ‘æ·±çŸ¥æ€§èƒ½ä¼˜åŒ–å¯¹äºç”¨æˆ·ä½“éªŒçš„é‡è¦æ€§ã€‚~~æ›¾ç»å› ä¸ºä¸€ä¸ªå¡é¡¿çš„åˆ—è¡¨é¡µé¢è¢«äº§å“ç»ç†è¿½ç€é—®"ä¸ºä»€ä¹ˆæ»‘åŠ¨è¿™ä¹ˆå¡"çš„æ—¥å­ï¼Œç›¸ä¿¡å¤§å®¶éƒ½ä¸é™Œç”Ÿ~~ã€‚

ä»Šå¤©ï¼Œæˆ‘æƒ³å’Œå¤§å®¶åˆ†äº«ä¸€äº›æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­é‡åˆ°çš„æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹ï¼Œä»¥åŠæˆ‘æ˜¯å¦‚ä½•é€šè¿‡ç³»ç»Ÿæ€§çš„åˆ†æå’Œè§£å†³æ–¹æ¡ˆï¼Œå°†åº”ç”¨æ€§èƒ½æå‡åˆ°ä¸€ä¸ªæ–°é«˜åº¦ã€‚è¿™äº›æ¡ˆä¾‹ä¸ä»…æ¶µç›–äº†å¸¸è§çš„æ€§èƒ½é—®é¢˜ï¼Œè¿˜åŒ…å«äº†è¯¦ç»†çš„ä¼˜åŒ–æ€è·¯å’Œå®é™…æ•ˆæœå¯¹æ¯”ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¯å‘ã€‚

## æ€§èƒ½ä¼˜åŒ–åŸºç¡€çŸ¥è¯†

åœ¨æ·±å…¥å®æˆ˜æ¡ˆä¾‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹Androidæ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€çŸ¥è¯†ã€‚

### å…³é”®æ€§èƒ½æŒ‡æ ‡

::: tip
æ€§èƒ½ä¼˜åŒ–ä¸æ˜¯ç›²ç›®åœ°è¿›è¡Œï¼Œè€Œæ˜¯éœ€è¦æœ‰æ˜ç¡®çš„ç›®æ ‡å’ŒæŒ‡æ ‡ã€‚ä»¥ä¸‹æ˜¯Androidå¼€å‘ä¸­å‡ ä¸ªå…³é”®çš„æ€§èƒ½æŒ‡æ ‡ï¼š
- **å¯åŠ¨æ—¶é—´**ï¼šä»ç‚¹å‡»åº”ç”¨å›¾æ ‡åˆ°åº”ç”¨å®Œå…¨å¯äº¤äº’çš„æ—¶é—´
- **UIæµç•…åº¦**ï¼šé€šå¸¸ä»¥å¸§ç‡(FPS)è¡¡é‡ï¼Œ60 FPSä¸ºç†æƒ³çŠ¶æ€
- **å†…å­˜ä½¿ç”¨**ï¼šåº”ç”¨è¿è¡Œæ—¶çš„å†…å­˜å ç”¨æƒ…å†µ
- **ç”µé‡æ¶ˆè€—**ï¼šåº”ç”¨å¯¹è®¾å¤‡ç”µé‡çš„å½±å“
- **ç½‘ç»œè¯·æ±‚**ï¼šAPIå“åº”æ—¶é—´å’Œæ•°æ®ä¼ è¾“æ•ˆç‡
:::

### å¸¸ç”¨æ€§èƒ½åˆ†æå·¥å…·

| å·¥å…·åç§° | ç”¨é€” | ç‰¹ç‚¹ |
|---------|------|------|
| **Android Profiler** | CPUã€å†…å­˜ã€ç½‘ç»œå’Œèƒ½è€—åˆ†æ | å®˜æ–¹å·¥å…·ï¼ŒåŠŸèƒ½å…¨é¢ |
| **Systrace** | ç³»ç»Ÿçº§æ€§èƒ½åˆ†æ | å¯è§†åŒ–å±•ç¤ºæ‰§è¡Œæµç¨‹ |
| **Perfetto** | é«˜çº§ç³»ç»Ÿæ€§èƒ½åˆ†æ | æ›¿ä»£Systraceçš„æ–°å·¥å…· |
| **LeakCanary** | å†…å­˜æ³„æ¼æ£€æµ‹ | è‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼ |
| **StrictMode** | æ£€æµ‹ä¸»çº¿ç¨‹è¿è§„æ“ä½œ | å¼€å‘é˜¶æ®µå¿«é€Ÿå‘ç°é—®é¢˜ |

## å®æˆ˜æ¡ˆä¾‹ä¸€ï¼šå¯åŠ¨ä¼˜åŒ–

### é—®é¢˜èƒŒæ™¯

æˆ‘è´Ÿè´£çš„ä¸€ä¸ªç”µå•†åº”ç”¨ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬ä¸­å¯åŠ¨æ—¶é—´å¢åŠ äº†çº¦2ç§’ï¼Œä»åŸæ¥çš„1.5ç§’å»¶é•¿åˆ°3.5ç§’ã€‚ç”¨æˆ·åé¦ˆæ˜æ˜¾å¢åŠ ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ç«¯è®¾å¤‡ä¸Šï¼Œå¯åŠ¨æ—¶é—´ç”šè‡³è¶…è¿‡5ç§’ã€‚

### åˆ†æè¿‡ç¨‹

é¦–å…ˆï¼Œæˆ‘ä½¿ç”¨Android Profilerçš„å¯åŠ¨åˆ†æåŠŸèƒ½æ¥è¿½è¸ªå¯åŠ¨è¿‡ç¨‹ä¸­çš„è€—æ—¶æƒ…å†µï¼š

```kotlin
// åœ¨Applicationç±»ä¸­æ·»åŠ å¯åŠ¨æ—¶é—´è¿½è¸ª
class MyApplication : Application() {
    override fun onCreate() {
        super.onCreate()
        val startTime = System.currentTimeMillis()
        
        // åº”ç”¨åˆå§‹åŒ–ä»£ç ...
        
        val endTime = System.currentTimeMillis()
        Log.d("StartupTime", "Application startup took ${endTime - startTime}ms")
    }
}
```

é€šè¿‡åˆ†æï¼Œæˆ‘å‘ç°ä¸»è¦è€—æ—¶ç‚¹é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **æ•°æ®åº“åˆå§‹åŒ–**ï¼šè€—æ—¶1.2ç§’
2. **ç½‘ç»œè¯·æ±‚**ï¼šè€—æ—¶0.8ç§’
3. **å›¾ç‰‡é¢„åŠ è½½**ï¼šè€—æ—¶0.6ç§’
4. **å…¶ä»–åˆå§‹åŒ–ä»»åŠ¡**ï¼šè€—æ—¶0.9ç§’

### è§£å†³æ–¹æ¡ˆ

é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘é‡‡å–äº†ä»¥ä¸‹ä¼˜åŒ–æªæ–½ï¼š

#### 1. å»¶è¿Ÿæ•°æ®åº“åˆå§‹åŒ–

```kotlin
// åŸå§‹ä»£ç  - åº”ç”¨å¯åŠ¨æ—¶ç«‹å³åˆå§‹åŒ–æ•°æ®åº“
class MyApplication : Application() {
    override fun onCreate() {
        super.onCreate()
        DatabaseHelper.initialize(this) // åŒæ­¥åˆå§‹åŒ–
    }
}

// ä¼˜åŒ–åä»£ç  - å»¶è¿Ÿåˆå§‹åŒ–
class MyApplication : Application() {
    override fun onCreate() {
        super.onCreate()
        // ä½¿ç”¨WorkManagerå»¶è¿Ÿåˆå§‹åŒ–
        val workRequest = OneTimeWorkRequestBuilder<DatabaseInitWorker>()
            .setInitialDelay(1, TimeUnit.SECONDS)
            .build()
        WorkManager.getInstance(this).enqueue(workRequest)
    }
}
```

#### 2. ä¼˜åŒ–ç½‘ç»œè¯·æ±‚ç­–ç•¥

```kotlin
// åŸå§‹ä»£ç  - å¯åŠ¨æ—¶ç«‹å³å‘èµ·ç½‘ç»œè¯·æ±‚
override fun onCreate() {
    super.onCreate()
    apiService.fetchCategories() // åŒæ­¥è¯·æ±‚
}

// ä¼˜åŒ–åä»£ç  - å¼‚æ­¥è¯·æ±‚å¹¶ç¼“å­˜ç»“æœ
override fun onCreate() {
    super.onCreate()
    // ä½¿ç”¨åç¨‹åœ¨IOçº¿ç¨‹å‘èµ·è¯·æ±‚
    GlobalScope.launch(Dispatchers.IO) {
        try {
            val categories = apiService.fetchCategories()
            cacheCategories(categories)
        } catch (e: Exception) {
            // å¤„ç†å¼‚å¸¸ï¼Œä½¿ç”¨ç¼“å­˜æ•°æ®
            loadCachedCategories()
        }
    }
}
```

#### 3. å›¾ç‰‡é¢„åŠ è½½ä¼˜åŒ–

```kotlin
// åŸå§‹ä»£ç  - å¯åŠ¨æ—¶é¢„åŠ è½½æ‰€æœ‰å›¾ç‰‡
override fun onCreate() {
    super.onCreate()
    imageLoader.preloadAllImages() // é˜»å¡ä¸»çº¿ç¨‹
}

// ä¼˜åŒ–åä»£ç  - æŒ‰éœ€åŠ è½½
override fun onCreate() {
    super.onCreate()
    // åªé¢„åŠ è½½é¦–å±éœ€è¦çš„å›¾ç‰‡
    imageLoader.preloadScreenImages()
    // ä½¿ç”¨WorkManageré¢„åŠ è½½å…¶ä»–å›¾ç‰‡
    val workRequest = OneTimeWorkRequestBuilder<ImagePreloadWorker>()
        .setInitialDelay(3, TimeUnit.SECONDS)
        .build()
    WorkManager.getInstance(this).enqueue(workRequest)
}
```

### æ•ˆæœå¯¹æ¯”

| ä¼˜åŒ–é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡æ¯”ä¾‹ |
|---------|--------|--------|---------|
| åº”ç”¨å¯åŠ¨æ—¶é—´ | 3.5ç§’ | 1.8ç§’ | 48.6% |
| é¦–å±æ¸²æŸ“æ—¶é—´ | 2.8ç§’ | 1.5ç§’ | 46.4% |
| å†…å­˜å ç”¨ | 85MB | 78MB | 8.2% |

## å®æˆ˜æ¡ˆä¾‹äºŒï¼šåˆ—è¡¨å¡é¡¿ä¼˜åŒ–

### é—®é¢˜èƒŒæ™¯

åº”ç”¨ä¸­çš„å•†å“åˆ—è¡¨é¡µé¢åœ¨æ»šåŠ¨æ—¶å‡ºç°æ˜æ˜¾å¡é¡¿ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ç«¯è®¾å¤‡ä¸Šï¼Œå¸§ç‡ç»å¸¸ä½äº30 FPSï¼Œç”¨æˆ·ä½“éªŒæå·®ã€‚

### åˆ†æè¿‡ç¨‹

æˆ‘ä½¿ç”¨Android Profilerçš„CPUåˆ†æå·¥å…·å’ŒSystraceæ¥è¿½è¸ªåˆ—è¡¨æ»šåŠ¨æ—¶çš„æ€§èƒ½ç“¶é¢ˆï¼š

```kotlin
// åˆ—è¡¨é€‚é…å™¨åŸå§‹ä»£ç 
class ProductAdapter : RecyclerView.Adapter<ProductAdapter.ViewHolder>() {
    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        val product = products[position]
        holder.bind(product)
    }
    
    inner class ViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        fun bind(product: Product) {
            // åœ¨ä¸»çº¿ç¨‹åŠ è½½å›¾ç‰‡
            Picasso.get().load(product.imageUrl).into(itemView.imageView)
            // è§£æJSONæ•°æ®
            val json = JSONObject(product.jsonData)
            itemView.titleView.text = json.getString("title")
            // å¤æ‚çš„è§†å›¾è®¡ç®—
            itemView.priceView.text = calculatePrice(product)
        }
    }
}
```

é€šè¿‡åˆ†æï¼Œæˆ‘å‘ç°ä¸»è¦é—®é¢˜åœ¨äºï¼š

1. **ä¸»çº¿ç¨‹IOæ“ä½œ**ï¼šåœ¨`onBindViewHolder`ä¸­ç›´æ¥åŠ è½½å›¾ç‰‡
2. **å¤æ‚è®¡ç®—**ï¼šä»·æ ¼è®¡ç®—å’ŒJSONè§£æåœ¨ä¸»çº¿ç¨‹è¿›è¡Œ
3. **è¿‡åº¦ç»˜åˆ¶**ï¼šåˆ—è¡¨é¡¹å¸ƒå±€å±‚çº§è¿‡æ·±
4. **è§†å›¾å›æ”¶é—®é¢˜**ï¼šè§†å›¾å¤ç”¨æ•ˆç‡ä½

### è§£å†³æ–¹æ¡ˆ

#### 1. å›¾ç‰‡åŠ è½½ä¼˜åŒ–

```kotlin
// ä½¿ç”¨Glideæ›¿ä»£Picassoï¼Œå¹¶æ·»åŠ å†…å­˜ç¼“å­˜
inner class ViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
    fun bind(product: Product) {
        // ä½¿ç”¨Glideï¼Œè®¾ç½®å†…å­˜å’Œç£ç›˜ç¼“å­˜
        Glide.with(itemView.context)
            .load(product.imageUrl)
            .placeholder(R.drawable.placeholder)
            .error(R.drawable.error_image)
            .diskCacheStrategy(DiskCacheStrategy.ALL)
            .into(itemView.imageView)
    }
}
```

#### 2. å¼‚æ­¥å¤„ç†å¤æ‚è®¡ç®—

```kotlin
// ä½¿ç”¨åç¨‹å°†å¤æ‚è®¡ç®—ç§»è‡³åå°çº¿ç¨‹
inner class ViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
    fun bind(product: Product) {
        // åœ¨IOçº¿ç¨‹å¤„ç†JSONè§£æ
        GlobalScope.launch(Dispatchers.IO) {
            val json = JSONObject(product.jsonData)
            val title = json.getString("title")
            val price = calculatePrice(product)
            
            // å›åˆ°ä¸»çº¿ç¨‹æ›´æ–°UI
            withContext(Dispatchers.Main) {
                itemView.titleView.text = title
                itemView.priceView.text = price
            }
        }
    }
}
```

#### 3. å‡å°‘è¿‡åº¦ç»˜åˆ¶

```xml
<!-- ä¼˜åŒ–å‰çš„åˆ—è¡¨é¡¹å¸ƒå±€ -->
<LinearLayout>
    <RelativeLayout>
        <ImageView />
        <TextView />
        <TextView />
        <LinearLayout>
            <TextView />
            <TextView />
        </LinearLayout>
    </RelativeLayout>
</LinearLayout>

<!-- ä¼˜åŒ–åçš„åˆ—è¡¨é¡¹å¸ƒå±€ -->
<androidx.constraintlayout.widget.ConstraintLayout>
    <ImageView
        android:id="@+id/imageView"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintDimensionRatio="1:1" />
    
    <TextView
        android:id="@+id/titleView"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toEndOf="@id/imageView"
        app:layout_constraintEnd_toEndOf="parent" />
    
    <TextView
        android:id="@+id/priceView"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        app:layout_constraintTop_toBottomOf="@id/titleView"
        app:layout_constraintStart_toEndOf="@id/imageView"
        app:layout_constraintEnd_toEndOf="parent" />
</androidx.constraintlayout.widget.ConstraintLayout>
```

#### 4. ä¼˜åŒ–è§†å›¾å¤ç”¨

```kotlin
// ä½¿ç”¨DiffUtilä¼˜åŒ–åˆ—è¡¨æ›´æ–°
class ProductDiffCallback : DiffUtil.ItemCallback<Product>() {
    override fun areItemsTheSame(oldItem: Product, newItem: Product): Boolean {
        return oldItem.id == newItem.id
    }
    
    override fun areContentsTheSame(oldItem: Product, newItem: Product): Boolean {
        return oldItem == newItem
    }
}

// åœ¨Activity/Fragmentä¸­ä½¿ç”¨
val diffCallback = ProductDiffCallback()
val diffResult = DiffUtil.calculateDiff(diffCallback)
adapter.updateProducts(newProducts)
diffResult.dispatchUpdatesTo(adapter)
```

### æ•ˆæœå¯¹æ¯”

| ä¼˜åŒ–é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡æ¯”ä¾‹ |
|---------|--------|--------|---------|
| æ»šåŠ¨å¸§ç‡ | 25-30 FPS | 55-60 FPS | 83.3% |
| åˆ—è¡¨æ›´æ–°æ—¶é—´ | 120ms | 45ms | 62.5% |
| å†…å­˜å ç”¨ | 92MB | 85MB | 7.6% |

## å®æˆ˜æ¡ˆä¾‹ä¸‰ï¼šå†…å­˜ä¼˜åŒ–

### é—®é¢˜èƒŒæ™¯

åº”ç”¨åœ¨ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œå†…å­˜å ç”¨æŒç»­å¢é•¿ï¼Œç‰¹åˆ«æ˜¯åœ¨å›¾ç‰‡æµè§ˆå’Œåˆ—è¡¨æ»šåŠ¨åœºæ™¯ä¸‹ï¼Œç»å¸¸è§¦å‘GCï¼Œå¯¼è‡´åº”ç”¨å¡é¡¿ç”šè‡³å´©æºƒã€‚

### åˆ†æè¿‡ç¨‹

ä½¿ç”¨LeakCanaryå’ŒAndroid Profilerçš„å†…å­˜åˆ†æå·¥å…·ï¼Œæˆ‘å‘ç°äº†ä»¥ä¸‹å†…å­˜é—®é¢˜ï¼š

1. **é™æ€å˜é‡æŒæœ‰Context**ï¼šå¯¼è‡´Activityæ— æ³•è¢«å›æ”¶
2. **æœªå–æ¶ˆçš„å¼‚æ­¥ä»»åŠ¡**ï¼šå¯¼è‡´å†…å­˜æ³„æ¼
3. **å¤§å›¾ç‰‡æœªåˆç†ç¼©æ”¾**ï¼šå ç”¨è¿‡å¤šå†…å­˜
4. **é›†åˆç±»æœªåŠæ—¶æ¸…ç†**ï¼šå¯¼è‡´å†…å­˜ç´¯ç§¯

### è§£å†³æ–¹æ¡ˆ

#### 1. ä¿®å¤é™æ€å˜é‡å¯¼è‡´çš„å†…å­˜æ³„æ¼

```kotlin
// é—®é¢˜ä»£ç 
class ImageLoader {
    companion object {
        private var context: Context? = null
        
        fun init(context: Context) {
            this.context = context
        }
    }
}

// è§£å†³æ–¹æ¡ˆ
class ImageLoader {
    companion object {
        private var weakContext: WeakReference<Context>? = null
        
        fun init(context: Context) {
            this.weakContext = WeakReference(context.applicationContext)
        }
    }
}
```

#### 2. æ­£ç¡®å¤„ç†å¼‚æ­¥ä»»åŠ¡

```kotlin
// é—®é¢˜ä»£ç 
class MainActivity : AppCompatActivity() {
    private var job: Job? = null
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        job = GlobalScope.launch(Dispatchers.IO) {
            // å¼‚æ­¥ä»»åŠ¡
        }
    }
}

// è§£å†³æ–¹æ¡ˆ
class MainActivity : AppCompatActivity() {
    private var job: Job? = null
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        job = GlobalScope.launch(Dispatchers.IO) {
            // å¼‚æ­¥ä»»åŠ¡
        }
    }
    
    override fun onDestroy() {
        super.onDestroy()
        job?.cancel() // å–æ¶ˆæœªå®Œæˆçš„ä»»åŠ¡
    }
}
```

#### 3. å›¾ç‰‡åŠ è½½ä¼˜åŒ–

```kotlin
// ä½¿ç”¨Glideçš„å†…å­˜ç¼“å­˜ç­–ç•¥
Glide.with(context)
    .load(imageUrl)
    .override(targetWidth, targetHeight) // é™åˆ¶å›¾ç‰‡å°ºå¯¸
    .diskCacheStrategy(DiskCacheStrategy.ALL)
    .into(imageView)

// æˆ–ä½¿ç”¨BitmapPool
val bitmapPool = Glide.get(context).bitmapPool
val options = RequestOptions()
    .override(targetWidth, targetHeight)
    .diskCacheStrategy(DiskCacheStrategy.ALL)
    .transform(DownsampleStrategy.CENTER_OUTSIDE)
Glide.with(context)
    .load(imageUrl)
    .apply(options)
    .into(imageView)
```

#### 4. é›†åˆç±»ç®¡ç†

```kotlin
// é—®é¢˜ä»£ç 
class DataManager {
    private val cache = HashMap<String, Any>()
    
    fun addData(key: String, value: Any) {
        cache[key] = value
    }
    
    // æ²¡æœ‰æ¸…ç†æ–¹æ³•
}

// è§£å†³æ–¹æ¡ˆ
class DataManager {
    private val cache = HashMap<String, Any>()
    
    fun addData(key: String, value: Any) {
        cache[key] = value
    }
    
    fun clearCache() {
        cache.clear()
    }
    
    fun removeOldData() {
        // ç§»é™¤ä¸å¸¸ç”¨çš„æ•°æ®
        val iterator = cache.iterator()
        while (iterator.hasNext()) {
            val entry = iterator.next()
            if (isOldData(entry.value)) {
                iterator.remove()
            }
        }
    }
}
```

### æ•ˆæœå¯¹æ¯”

| ä¼˜åŒ–é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡æ¯”ä¾‹ |
|---------|--------|--------|---------|
| å†…å­˜å ç”¨å³°å€¼ | 180MB | 120MB | 33.3% |
| GCé¢‘ç‡ | æ¯3-5åˆ†é’Ÿä¸€æ¬¡ | æ¯15-20åˆ†é’Ÿä¸€æ¬¡ | 75% |
| å´©æºƒç‡ | 2.5% | 0.3% | 88% |

## å®æˆ˜æ¡ˆä¾‹å››ï¼šç½‘ç»œè¯·æ±‚ä¼˜åŒ–

### é—®é¢˜èƒŒæ™¯

åº”ç”¨ä¸­çš„ç½‘ç»œè¯·æ±‚å“åº”ç¼“æ…¢ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸ä½³çš„æƒ…å†µä¸‹ï¼Œç»å¸¸å‡ºç°è¶…æ—¶å’Œå¤±è´¥ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

### åˆ†æè¿‡ç¨‹

ä½¿ç”¨Charleså’ŒAndroid Profilerçš„ç½‘ç»œåˆ†æå·¥å…·ï¼Œæˆ‘å‘ç°äº†ä»¥ä¸‹é—®é¢˜ï¼š

1. **é‡å¤è¯·æ±‚**ï¼šç›¸åŒæ•°æ®è¢«å¤šæ¬¡è¯·æ±‚
2. **æ— ç¼“å­˜æœºåˆ¶**ï¼šæ¯æ¬¡éƒ½ä»æœåŠ¡å™¨è·å–æ•°æ®
3. **å¤§æ–‡ä»¶ä¼ è¾“**ï¼šå›¾ç‰‡å’Œè§†é¢‘æœªå‹ç¼©
4. **è¯·æ±‚ä¸²è¡ŒåŒ–**ï¼šå¤šä¸ªè¯·æ±‚é¡ºåºæ‰§è¡Œï¼Œè€—æ—¶ç´¯åŠ 

### è§£å†³æ–¹æ¡ˆ

#### 1. å®ç°è¯·æ±‚ç¼“å­˜

```kotlin
// ä½¿ç”¨Retrofitçš„ç¼“å­˜æœºåˆ¶
@GET("products")
suspend fun getProducts(
    @Header("Cache-Control") cacheControl: String = "public, max-age=3600"
): Response<List<Product>>

// æˆ–ä½¿ç”¨OkHttpçš„ç¼“å­˜ç­–ç•¥
val cache = Cache(context.cacheDir, 10 * 1024 * 1024) // 10MBç¼“å­˜
val okHttpClient = OkHttpClient.Builder()
    .cache(cache)
    .build()
```

#### 2. è¯·æ±‚åˆå¹¶ä¸å¹¶è¡Œå¤„ç†

```kotlin
// ä¸²è¡Œè¯·æ±‚ï¼ˆé—®é¢˜ï¼‰
suspend fun loadUserData() {
    val user = apiService.getUser()
    val orders = apiService.getOrders(user.id)
    val products = apiService.getProducts()
    val profile = apiService.getProfile(user.id)
}

// å¹¶è¡Œè¯·æ±‚ï¼ˆä¼˜åŒ–ï¼‰
suspend fun loadUserData() {
    coroutineScope {
        val user = async { apiService.getUser() }
        val orders = async { apiService.getOrders(user.await().id) }
        val products = async { apiService.getProducts() }
        val profile = async { apiService.getProfile(user.await().id) }
        
        // ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ
        val result = awaitAll(user, orders, products, profile)
    }
}
```

#### 3. å›¾ç‰‡å‹ç¼©ä¸æ‡’åŠ è½½

```kotlin
// æœåŠ¡ç«¯è¿”å›å›¾ç‰‡URLï¼Œæ ¹æ®è®¾å¤‡å°ºå¯¸åŠ è½½ä¸åŒå°ºå¯¸
@GET("images/{id}")
suspend fun getImage(
    @Path("id") id: String,
    @Query("width") width: Int,
    @Query("height") height: Int
): Response<ResponseBody>

// åœ¨Adapterä¸­æ ¹æ®è®¾å¤‡å°ºå¯¸åŠ¨æ€åŠ è½½
val deviceWidth = resources.displayMetrics.widthPixels / 2
val deviceHeight = (deviceWidth * 1.5).toInt()

Glide.with(context)
    .load("${imageUrl}?width=$deviceWidth&height=$deviceHeight")
    .override(deviceWidth, deviceHeight)
    .into(imageView)
```

#### 4. å®ç°ç¦»çº¿ä¼˜å…ˆç­–ç•¥

```kotlin
class Repository(private val apiService: ApiService, private val db: AppDatabase) {
    suspend fun getProducts(): List<Product> {
        // 1. å…ˆä»æ•°æ®åº“è·å–
        val cachedProducts = db.productDao().getAll()
        if (cachedProducts.isNotEmpty()) {
            return cachedProducts
        }
        
        // 2. ä»ç½‘ç»œè·å–
        val remoteProducts = apiService.getProducts()
        db.productDao().insertAll(remoteProducts)
        
        return remoteProducts
    }
    
    // å®ç°æ•°æ®åŒæ­¥
    suspend fun syncProducts() {
        try {
            val remoteProducts = apiService.getProducts()
            db.productDao().insertAll(remoteProducts)
        } catch (e: Exception) {
            // å¤„ç†åŒæ­¥å¤±è´¥
        }
    }
}
```

### æ•ˆæœå¯¹æ¯”

| ä¼˜åŒ–é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡æ¯”ä¾‹ |
|---------|--------|--------|---------|
| å¹³å‡å“åº”æ—¶é—´ | 2.5ç§’ | 0.8ç§’ | 68% |
| ç½‘ç»œè¯·æ±‚æ•°é‡ | 120æ¬¡/åˆ†é’Ÿ | 45æ¬¡/åˆ†é’Ÿ | 62.5% |
| æµé‡æ¶ˆè€— | 15MB/åˆ†é’Ÿ | 8MB/åˆ†é’Ÿ | 46.7% |

## æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

ç»è¿‡ä»¥ä¸Šå®æˆ˜æ¡ˆä¾‹ï¼Œæˆ‘æ€»ç»“å‡ºä»¥ä¸‹Androidæ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³å®è·µï¼š

### 1. å»ºç«‹æ€§èƒ½ç›‘æ§ä½“ç³»

::: theorem
æ€§èƒ½ä¼˜åŒ–å§‹äºæµ‹é‡ï¼Œè€Œä¸æ˜¯çŒœæµ‹ã€‚å»ºç«‹å®Œå–„çš„æ€§èƒ½ç›‘æ§ä½“ç³»æ˜¯ä¼˜åŒ–çš„ç¬¬ä¸€æ­¥ã€‚
:::

- **å…³é”®æŒ‡æ ‡ç›‘æ§**ï¼šå»ºç«‹å¯åŠ¨æ—¶é—´ã€å¸§ç‡ã€å†…å­˜å ç”¨ç­‰å…³é”®æŒ‡æ ‡çš„ç›‘æ§
- **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šé›†æˆæ€§èƒ½æµ‹è¯•åˆ°CI/CDæµç¨‹
- **ç”¨æˆ·åé¦ˆæ”¶é›†**ï¼šæ”¶é›†ç”¨æˆ·å…³äºæ€§èƒ½é—®é¢˜çš„åé¦ˆ

### 2. éµå¾ªä¼˜åŒ–ä¼˜å…ˆçº§

::: tip
ä¸æ˜¯æ‰€æœ‰æ€§èƒ½é—®é¢˜éƒ½éœ€è¦ç«‹å³è§£å†³ã€‚æŒ‰ç…§å½±å“ç¨‹åº¦å’Œè§£å†³æˆæœ¬æ’åºï¼Œä¼˜å…ˆè§£å†³é«˜å½±å“ã€ä½æˆæœ¬çš„ä¼˜åŒ–ç‚¹ã€‚
:::

ä¼˜åŒ–ä¼˜å…ˆçº§æ’åºï¼š
1. **ç”¨æˆ·ä½“éªŒå½±å“å¤§**ï¼šå¦‚å¯åŠ¨æ—¶é—´ã€UIå¡é¡¿
2. **èµ„æºæ¶ˆè€—é«˜**ï¼šå¦‚å†…å­˜æ³„æ¼ã€ç”µé‡æ¶ˆè€—
3. **æ™®éæ€§é—®é¢˜**ï¼šå¦‚ä½ç«¯è®¾å¤‡ä¸Šçš„æ€§èƒ½é—®é¢˜
4. **è¾¹ç¼˜æƒ…å†µ**ï¼šå¦‚ç‰¹å®šåœºæ™¯ä¸‹çš„æ€§èƒ½é—®é¢˜

### 3. é‡‡ç”¨æ¸è¿›å¼ä¼˜åŒ–

::: right
"è¿‡æ—©çš„ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº" - Donald Knuth
:::

- **å…ˆè§£å†³ç“¶é¢ˆ**ï¼šä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·æ‰¾åˆ°çœŸæ­£çš„ç“¶é¢ˆç‚¹
- **å°æ­¥å¿«è·‘**ï¼šæ¯æ¬¡åªä¼˜åŒ–ä¸€ä¸ªç‚¹ï¼ŒéªŒè¯æ•ˆæœåå†è¿›è¡Œä¸‹ä¸€ä¸ª
- **æ•°æ®é©±åŠ¨**ï¼šç”¨æ•°æ®éªŒè¯ä¼˜åŒ–æ•ˆæœï¼Œè€Œä¸æ˜¯å‡­æ„Ÿè§‰

### 4. ä»£ç å±‚é¢çš„ä¼˜åŒ–æŠ€å·§

```kotlin
// é¿å…åœ¨ä¸»çº¿ç¨‹è¿›è¡Œè€—æ—¶æ“ä½œ
// é—®é¢˜ä»£ç 
fun loadData() {
    val data = fetchDataFromNetwork() // é˜»å¡ä¸»çº¿ç¨‹
    updateUI(data)
}

// ä¼˜åŒ–ä»£ç 
fun loadData() {
    GlobalScope.launch(Dispatchers.IO) {
        val data = fetchDataFromNetwork()
        withContext(Dispatchers.Main) {
            updateUI(data)
        }
    }
}

// ä½¿ç”¨å¯¹è±¡æ± å‡å°‘GC
val viewPool = RecyclerView.RecycledViewPool()
recyclerView.setRecycledViewPool(viewPool)

// ä½¿ç”¨è½»é‡çº§æ•°æ®ç»“æ„
// é—®é¢˜ä»£ç 
val list = ArrayList<String>()
// ä¼˜åŒ–ä»£ç 
val list = mutableListOf<String>()
```

### 5. å¸ƒå±€ä¼˜åŒ–æŠ€å·§

```xml
<!-- å‡å°‘å¸ƒå±€å±‚çº§ -->
<!-- é—®é¢˜å¸ƒå±€ -->
<LinearLayout>
    <LinearLayout>
        <LinearLayout>
            <TextView />
        </LinearLayout>
    </LinearLayout>
</LinearLayout>

<!-- ä¼˜åŒ–å¸ƒå±€ -->
<androidx.constraintlayout.widget.ConstraintLayout>
    <TextView />
</androidx.constraintlayout.widget.ConstraintLayout>

<!-- ä½¿ç”¨includeå’Œmergeå‡å°‘é‡å¤ä»£ç  -->
<include layout="@layout/common_toolbar" />
<merge xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- åˆå¹¶å¸ƒå±€å†…å®¹ -->
</merge>
```

## ç»“è¯­

é€šè¿‡ä»¥ä¸Šå››ä¸ªå®æˆ˜æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Androidæ€§èƒ½ä¼˜åŒ–çš„å¤æ‚æ€§å’Œç³»ç»Ÿæ€§ã€‚~~è®°ä½ï¼Œæ€§èƒ½ä¼˜åŒ–ä¸æ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œï¼Œè€Œæ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹~~ã€‚éšç€åº”ç”¨åŠŸèƒ½çš„å¢åŠ å’Œè®¾å¤‡çš„æ›´æ–°ï¼Œæ€§èƒ½é—®é¢˜ä¼šä¸æ–­å‡ºç°ï¼Œæˆ‘ä»¬éœ€è¦æŒç»­å…³æ³¨å’Œä¼˜åŒ–ã€‚

å¸Œæœ›è¿™äº›å®æˆ˜æ¡ˆä¾‹èƒ½å¤Ÿå¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨Androidæ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚è®°ä½ï¼Œæœ€å¥½çš„ä¼˜åŒ–æ˜¯é¢„é˜²è€Œä¸æ˜¯ä¿®å¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­å°±å…»æˆè‰¯å¥½çš„æ€§èƒ½ä¹ æƒ¯ï¼Œè¿œæ¯”åæœŸä¼˜åŒ–äº‹åŠåŠŸå€ã€‚

æœ€åï¼Œæˆ‘æƒ³è¯´ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œä¹Ÿæ˜¯ä¸€é—¨ç§‘å­¦ã€‚å®ƒéœ€è¦æˆ‘ä»¬æ·±å…¥ç†è§£Androidç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼Œä¹Ÿéœ€è¦æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„è€å¿ƒå’Œç»†å¿ƒå»åˆ†æå’Œè§£å†³é—®é¢˜ã€‚å¸Œæœ›æ¯ä¸€ä½Androidå¼€å‘è€…éƒ½èƒ½æ‰“é€ å‡ºæ—¢åŠŸèƒ½å¼ºå¤§åˆæ€§èƒ½å“è¶Šçš„åº”ç”¨ï¼

> "æ€§èƒ½ä¸æ˜¯ç›®æ ‡ï¼Œè€Œæ˜¯æ‰‹æ®µã€‚æœ€ç»ˆçš„ç›®æ ‡æ˜¯åˆ›é€ å“è¶Šçš„ç”¨æˆ·ä½“éªŒã€‚" â€”â€” Jorgen