---
title: Androidå¤šçº¿ç¨‹ä¸å¹¶å‘å¤„ç†å®Œå…¨æŒ‡å—-ä»Threadåˆ°åç¨‹çš„è¿›é˜¶ä¹‹è·¯
date: 2026-01-28
tags: [Androidå¤šçº¿ç¨‹, å¹¶å‘ç¼–ç¨‹, Kotlinåç¨‹]
---

## å‰è¨€

å—¨ï¼Œå¤§å®¶å¥½ï¼æˆ‘æ˜¯Jorgenï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠä¸€èŠAndroidå¼€å‘ä¸­ä¸€ä¸ªæ—¢åŸºç¡€åˆå¤æ‚çš„è¯é¢˜â€”â€”å¤šçº¿ç¨‹ä¸å¹¶å‘å¤„ç†ã€‚ğŸ¤”

è¯´å®è¯ï¼Œåˆšå¼€å§‹å­¦Androidæ—¶ï¼Œæˆ‘å¯¹å¤šçº¿ç¨‹çš„ç†è§£ä»…é™äº"ä¸èƒ½åœ¨ä¸»çº¿ç¨‹åšè€—æ—¶æ“ä½œ"ï¼Œç„¶åå°±ç®€å•ç²—æš´åœ°å¼€äº†ä¸ªAsyncTaskã€‚éšç€é¡¹ç›®å¤æ‚åº¦å¢åŠ ï¼Œå„ç§ANRã€æ­»é”é—®é¢˜æ¥è¸µè€Œè‡³ï¼Œæˆ‘æ‰æ„è¯†åˆ°å¤šçº¿ç¨‹çš„é‡è¦æ€§ã€‚

::: tip
"åœ¨Androidå¼€å‘ä¸­ï¼ŒæŒæ¡å¤šçº¿ç¨‹ç¼–ç¨‹å°±åƒæ˜¯å­¦ä¼šäº†æ­¦åŠŸç§˜ç±ï¼Œæ—¢èƒ½è®©ä½ å†™å‡ºæµç•…çš„åº”ç”¨ï¼Œåˆèƒ½åœ¨å…³é”®æ—¶åˆ»æ•‘ä½ äºæ°´ç«ã€‚"
:::

æœ¬æ–‡å°†å¸¦å¤§å®¶ä¸€èµ·æ¢ç´¢Androidå¤šçº¿ç¨‹çš„ä¸–ç•Œï¼Œä»ä¼ ç»Ÿçš„Threadæœºåˆ¶åˆ°ç°ä»£çš„Kotlinåç¨‹ï¼Œå…¨æ–¹ä½è§£æAndroidå¹¶å‘ç¼–ç¨‹çš„å¥¥ç§˜ã€‚

## Androidå¤šçº¿ç¨‹åŸºç¡€

### ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ï¼Ÿ

åœ¨Androidä¸­ï¼ŒUIæ“ä½œå¿…é¡»åœ¨ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰æ‰§è¡Œï¼Œè€Œè€—æ—¶æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œã€å¤§æ–‡ä»¶è¯»å†™ï¼‰åˆ™å¿…é¡»åœ¨å­çº¿ç¨‹æ‰§è¡Œã€‚è¿™æ˜¯Androidç³»ç»Ÿå¼ºåˆ¶çš„è§„å®šï¼Œç›®çš„æ˜¯ä¿è¯UIçš„å“åº”æ€§ã€‚

å¦‚æœæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

```java
// é”™è¯¯ç¤ºä¾‹ï¼šåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œ
new Thread(() -> {
    // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    try {
        Thread.sleep(5000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
}).start();
```

ä¸Šé¢çš„ä»£ç çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Œä½†å®é™…ä¸Šä¼šå¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œç”šè‡³å¼¹å‡ºANRå¯¹è¯æ¡†ï¼ğŸ¤¦â€â™‚ï¸

### Threadä¸Handleræœºåˆ¶

Androidä¸­æœ€åŸºç¡€çš„å¤šçº¿ç¨‹å®ç°å°±æ˜¯Javaçš„Threadç±»ï¼Œé…åˆHandleræœºåˆ¶å®ç°çº¿ç¨‹é—´é€šä¿¡ã€‚

```java
// åˆ›å»ºå­çº¿ç¨‹
new Thread(new Runnable() {
    @Override
    public void run() {
        // æ‰§è¡Œè€—æ—¶æ“ä½œ
        String result = doBackgroundTask();
        
        // é€šè¿‡Handlerè¿”å›ä¸»çº¿ç¨‹æ›´æ–°UI
        new Handler(Looper.getMainLooper()).post(new Runnable() {
            @Override
            public void run() {
                textView.setText(result);
            }
        });
    }
}).start();
```

è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ç›´æ¥ï¼Œä½†å­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š
1. ä»£ç å†—é•¿ï¼Œå®¹æ˜“å‡ºé”™
2. çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯å¼€é”€å¤§
3. éœ€è¦æ‰‹åŠ¨å¤„ç†çº¿ç¨‹åŒæ­¥é—®é¢˜

### AsyncTaskï¼šå·²å¼ƒç”¨çš„å†å²

åœ¨æ—©æœŸAndroidå¼€å‘ä¸­ï¼ŒAsyncTaskæ›¾æ˜¯å¤„ç†åå°ä»»åŠ¡çš„åˆ©å™¨ï¼š

```java
new AsyncTask<String, Integer, String>() {
    @Override
    protected String doInBackground(String... params) {
        // åå°æ‰§è¡Œè€—æ—¶æ“ä½œ
        return "Task completed";
    }
    
    @Override
    protected void onPostExecute(String result) {
        // è¿”å›ä¸»çº¿ç¨‹æ›´æ–°UI
        textView.setText(result);
    }
}.execute("param");
```

ç„¶è€Œï¼ŒAsyncTaskå­˜åœ¨è¯¸å¤šé—®é¢˜ï¼š
1. å†…å­˜æ³„æ¼é£é™©ï¼ˆActivityé”€æ¯åä»»åŠ¡ä»åœ¨æ‰§è¡Œï¼‰
2. å¹¶å‘æ‰§è¡Œé—®é¢˜ï¼ˆå¤šä¸ªAsyncTaskå¯èƒ½åŒæ—¶è¿è¡Œï¼‰
3. åœ¨Android 8.0+ä¸­å·²è¢«æ ‡è®°ä¸ºè¿‡æ—¶

::: theorem
AsyncTaskè™½ç„¶ç®€å•æ˜“ç”¨ï¼Œä½†ç”±äºå…¶è®¾è®¡ç¼ºé™·å’Œç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œç°åœ¨å·²ä¸æ¨èåœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨ã€‚äº†è§£å®ƒä¸»è¦æ˜¯ä¸ºäº†ç»´æŠ¤æ—§é¡¹ç›®ã€‚
:::

## ç°ä»£Androidå¤šçº¿ç¨‹æ–¹æ¡ˆ

### ThreadPoolExecutorï¼šçº¿ç¨‹æ± çš„åŠ›é‡

ä¸ºäº†è§£å†³é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹çš„é—®é¢˜ï¼ŒAndroidæä¾›äº†çº¿ç¨‹æ± æœºåˆ¶ï¼š

```java
// åˆ›å»ºçº¿ç¨‹æ± 
ExecutorService executor = Executors.newFixedThreadPool(4);

// æäº¤ä»»åŠ¡
executor.execute(() -> {
    String result = doBackgroundTask();
    runOnUiThread(() -> textView.setText(result));
});

// å…³é—­çº¿ç¨‹æ± 
executor.shutdown();
```

çº¿ç¨‹æ± çš„ä¼˜åŠ¿ï¼š
1. å¤ç”¨çº¿ç¨‹ï¼Œå‡å°‘åˆ›å»ºé”€æ¯å¼€é”€
2. æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…èµ„æºè€—å°½
3. æä¾›ä»»åŠ¡é˜Ÿåˆ—ï¼Œç®¡ç†ä»»åŠ¡æ‰§è¡Œé¡ºåº

### HandlerThreadä¸IntentService

å¯¹äºéœ€è¦ä¸²è¡Œå¤„ç†çš„ä»»åŠ¡ï¼ŒAndroidæä¾›äº†HandlerThreadå’ŒIntentServiceï¼š

```java
// HandlerThreadç¤ºä¾‹
HandlerThread handlerThread = new HandlerThread("backgroundThread");
handlerThread.start();
Handler handler = new Handler(handlerThread.getLooper());

handler.post(() -> {
    // åœ¨HandlerThreadä¸­æ‰§è¡Œä»»åŠ¡
});

// IntentServiceç¤ºä¾‹
public class MyIntentService extends IntentService {
    public MyIntentService() {
        super("MyIntentService");
    }
    
    @Override
    protected void onHandleIntent(Intent intent) {
        // å¤„ç†Intentè¯·æ±‚
    }
}
```

è¿™ä¸¤ç§æ–¹å¼ç‰¹åˆ«é€‚åˆå¤„ç†éœ€è¦é¡ºåºæ‰§è¡Œçš„çŸ­ä»»åŠ¡ã€‚

### Kotlinåç¨‹ï¼šç°ä»£å¹¶å‘ç¼–ç¨‹çš„åˆ©å™¨

åç¨‹æ˜¯Kotlinæä¾›çš„è½»é‡çº§çº¿ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå½»åº•æ”¹å˜äº†Androidå¼€å‘ä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ï¼š

```kotlin
// ä½¿ç”¨åç¨‹æ‰§è¡Œåå°ä»»åŠ¡
lifecycleScope.launch(Dispatchers.IO) {
    val result = withContext(Dispatchers.IO) {
        // æ‰§è¡Œè€—æ—¶æ“ä½œ
        fetchDataFromNetwork()
    }
    
    withContext(Dispatchers.Main) {
        // è¿”å›ä¸»çº¿ç¨‹æ›´æ–°UI
        textView.text = result
    }
}
```

åç¨‹çš„ä¼˜åŠ¿ï¼š
1. ä»£ç ç®€æ´ï¼Œæ¥è¿‘åŒæ­¥ç¼–ç¨‹é£æ ¼
2. è½»é‡çº§ï¼Œåˆ›å»ºæˆæœ¬ä½
3. æ”¯æŒæŒ‚èµ·å‡½æ•°ï¼Œç®€åŒ–å¼‚æ­¥æ“ä½œ
4. ä¸Androidç”Ÿå‘½å‘¨æœŸç»„ä»¶å®Œç¾é›†æˆ

## Androidå¹¶å‘æœ€ä½³å®è·µ

### çº¿ç¨‹å®‰å…¨ä¸åŒæ­¥æœºåˆ¶

åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ•°æ®å®‰å…¨æ˜¯é¦–è¦è€ƒè™‘çš„é—®é¢˜ï¼š

```kotlin
// ä½¿ç”¨åŒæ­¥ä»£ç å—
val lock = Any()
val sharedData = mutableListOf<String>()

fun addData(data: String) {
    synchronized(lock) {
        sharedData.add(data)
    }
}

// ä½¿ç”¨åŸå­ç±»
val atomicCounter = AtomicInteger(0)

fun incrementCounter() {
    atomicCounter.incrementAndGet()
}
```

### åå°ä»»åŠ¡å¤„ç†

å¯¹äºéœ€è¦é•¿æœŸè¿è¡Œçš„åå°ä»»åŠ¡ï¼ŒAndroidæä¾›äº†å¤šç§è§£å†³æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | ç”Ÿå‘½å‘¨æœŸ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|---------|---------|------|------|
| WorkManager | éœ€è¦ä¿è¯æ‰§è¡Œçš„åå°ä»»åŠ¡ | çµæ´» | å¯é ã€æ”¯æŒçº¦æŸ | é…ç½®å¤æ‚ |
| JobScheduler | API 21+çš„åå°ä»»åŠ¡ | è®¾å¤‡é‡å¯åå¯é‡æ–°è°ƒåº¦ | ç³»ç»Ÿç®¡ç† | ä»…é™API 21+ |
| AlarmManager | å®šæ—¶ä»»åŠ¡ | ä¸å—åº”ç”¨ç”Ÿå‘½å‘¨æœŸé™åˆ¶ | ç²¾ç¡® | ç”µé‡æ¶ˆè€—å¤§ |

```kotlin
// WorkManagerç¤ºä¾‹
val workRequest = OneTimeWorkRequestBuilder<MyWorker>()
    .setConstraints(Constraints.Builder()
        .setRequiredNetworkType(NetworkType.CONNECTED)
        .build())
    .build()

WorkManager.getInstance(context).enqueue(workRequest)
```

### RxJavaå“åº”å¼ç¼–ç¨‹

è™½ç„¶Kotlinåç¨‹å·²æˆä¸ºä¸»æµï¼Œä½†RxJavaåœ¨å¤„ç†å¤æ‚å¼‚æ­¥æµç¨‹æ—¶ä»æœ‰å…¶ä¼˜åŠ¿ï¼š

```java
Observable.fromCallable(() -> fetchDataFromNetwork())
    .subscribeOn(Schedulers.io())
    .observeOn(AndroidSchedulers.mainThread())
    .subscribe(result -> {
        textView.setText(result);
    }, error -> {
        Log.e("RxJava", "Error", error);
    });
```

## å®æˆ˜æ¡ˆä¾‹ï¼šå›¾ç‰‡åŠ è½½ä¼˜åŒ–

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…çš„å›¾ç‰‡åŠ è½½æ¡ˆä¾‹ï¼Œå¯¹æ¯”ä¸åŒå¤šçº¿ç¨‹æ–¹æ¡ˆçš„å®ç°æ–¹å¼ã€‚

### ä¼ ç»ŸThread+Handleræ–¹å¼

```java
private void loadImageWithThread(String url) {
    new Thread(() -> {
        Bitmap bitmap = downloadBitmap(url);
        new Handler(Looper.getMainLooper()).post(() -> {
            imageView.setImageBitmap(bitmap);
        });
    }).start();
}
```

### AsyncTaskæ–¹å¼ï¼ˆå·²ä¸æ¨èï¼‰

```java
private void loadImageWithAsyncTask(String url) {
    new AsyncTask<String, Void, Bitmap>() {
        @Override
        protected Bitmap doInBackground(String... urls) {
            return downloadBitmap(urls[0]);
        }
        
        @Override
        protected void onPostExecute(Bitmap bitmap) {
            imageView.setImageBitmap(bitmap);
        }
    }.execute(url);
}
```

### åç¨‹æ–¹å¼ï¼ˆæ¨èï¼‰

```kotlin
private fun loadImageWithCoroutine(url: String) {
    lifecycleScope.launch {
        val bitmap = withContext(Dispatchers.IO) {
            downloadBitmap(url)
        }
        imageView.setImageBitmap(bitmap)
    }
}
```

### WorkManageræ–¹å¼ï¼ˆé€‚ç”¨äºåå°åŠ è½½ï¼‰

```kotlin
private fun loadImageWithWorkManager(url: String) {
    val workRequest = OneTimeWorkRequestBuilder<ImageLoaderWorker>()
        .setInputData(workDataOf(URL_KEY to url))
        .build()
    
    WorkManager.getInstance(context).enqueue(workRequest)
    
    WorkManager.getInstance(context).getWorkInfoByIdLiveData(workRequest.id)
        .observe(this, { workInfo ->
            if (workInfo.state == WorkInfo.State.SUCCEEDED) {
                val bitmap = workInfo.outputData.getParcelable<Bitmap>(BITMAP_KEY)
                imageView.setImageBitmap(bitmap)
            }
        })
}
```

ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒKotlinåç¨‹çš„æ–¹å¼æœ€ä¸ºç®€æ´ç›´è§‚ï¼Œä»£ç é‡æœ€å°‘ï¼Œå¯è¯»æ€§ä¹Ÿæœ€é«˜ã€‚

## ç»“è¯­

é€šè¿‡æœ¬æ–‡çš„æ¢è®¨ï¼Œæˆ‘ä»¬äº†è§£äº†Androidå¤šçº¿ç¨‹ä¸å¹¶å‘å¤„ç†çš„æ¼”è¿›å†ç¨‹ï¼Œä»ä¼ ç»Ÿçš„Threadæœºåˆ¶åˆ°ç°ä»£çš„Kotlinåç¨‹ï¼Œæ¯ç§æ–¹æ¡ˆéƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ã€‚

> "é€‰æ‹©æ­£ç¡®çš„å¤šçº¿ç¨‹æ–¹æ¡ˆï¼Œå°±åƒé€‰æ‹©åˆé€‚çš„äº¤é€šå·¥å…·ä¸€æ ·ï¼ŒçŸ­é€”æ­¥è¡Œï¼Œæ‰“è½¦è¿œè¡Œï¼Œé•¿é€”åé£æœºï¼Œæ²¡æœ‰æœ€å¥½çš„ï¼Œåªæœ‰æœ€åˆé€‚çš„ã€‚"

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘å»ºè®®ï¼š

1. å¯¹äºç®€å•çš„åå°ä»»åŠ¡ï¼Œä¼˜å…ˆä½¿ç”¨Kotlinåç¨‹
2. å¯¹äºéœ€è¦ä¿è¯æ‰§è¡Œçš„åå°ä»»åŠ¡ï¼Œä½¿ç”¨WorkManager
3. å¯¹äºå¤æ‚çš„å¼‚æ­¥æµç¨‹ï¼Œå¯ä»¥è€ƒè™‘RxJava
4. å¯¹äºç»´æŠ¤æ—§é¡¹ç›®ï¼Œäº†è§£AsyncThreadå’ŒHandlerThreadä»æœ‰å¿…è¦

Androidçš„å¤šçº¿ç¨‹ä¸–ç•Œåšå¤§ç²¾æ·±ï¼Œå¸Œæœ›æœ¬æ–‡èƒ½ä¸ºä½ æ‰“å¼€ä¸€æ‰‡çª—ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–è§è§£ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï¼ğŸ‘‹

æœ€åï¼Œåˆ«å¿˜äº†åœ¨å®é™…é¡¹ç›®ä¸­å¤šå®è·µï¼Œå¤šæ€»ç»“ï¼Œåªæœ‰çœŸæ­£åŠ¨æ‰‹ç¼–ç ï¼Œæ‰èƒ½å°†è¿™äº›çŸ¥è¯†å†…åŒ–ä¸ºè‡ªå·±çš„æŠ€èƒ½ã€‚ç¥å¤§å®¶ç¼–ç æ„‰å¿«ï¼ğŸ˜„