---
title: Android Jetpack Compose UIæµ‹è¯•å®Œå…¨æŒ‡å—-æ„å»ºå¯é ç°ä»£åº”ç”¨çš„æ ¸å¿ƒæŠ€å·§
date: 2026-02-04
tags: [Jetpack Compose, UIæµ‹è¯•, Androidæµ‹è¯•]
---

## å‰è¨€

å¤§å®¶å¥½ï¼æˆ‘æ˜¯Jorgenï¼Œä»Šå¤©æƒ³å’Œå¤§å®¶èŠèŠAndroidå¼€å‘ä¸­ä¸€ä¸ªéå¸¸é‡è¦ä½†ç»å¸¸è¢«å¿½è§†çš„è¯é¢˜â€”â€”UIæµ‹è¯•ã€‚ç‰¹åˆ«æ˜¯åœ¨Jetpack Composeæˆä¸ºAndroid UIå¼€å‘æ–°æ ‡å‡†çš„èƒŒæ™¯ä¸‹ï¼Œå¦‚ä½•æœ‰æ•ˆåœ°æµ‹è¯•æˆ‘ä»¬çš„ç°ä»£UIç»„ä»¶å˜å¾—å°¤ä¸ºå…³é”®ã€‚

ï¿½ è®°å¾—åˆšå¼€å§‹å­¦ä¹ Composeæ—¶ï¼Œæˆ‘å¸¸å¸¸é™·å…¥è¿™æ ·çš„å›°å¢ƒï¼šæ˜æ˜åœ¨é¢„è§ˆä¸­çœ‹èµ·æ¥ä¸€åˆ‡å®Œç¾ï¼Œä½†è¿è¡Œæ—¶å´å‡ºç°å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚åæ¥æ‰å‘ç°ï¼Œé—®é¢˜å¾€å¾€å‡ºåœ¨çŠ¶æ€ç®¡ç†å’Œäº¤äº’é€»è¾‘ä¸Šï¼Œè€Œè¿™äº›æ°æ°æ˜¯UIæµ‹è¯•èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å‘ç°çš„é—®é¢˜ã€‚

::: tip
"æµ‹è¯•ä¸æ˜¯éªŒè¯ä»£ç æ˜¯å¦æ­£ç¡®ï¼Œè€Œæ˜¯éªŒè¯ä»£ç æ˜¯å¦æŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„æ–¹å¼å·¥ä½œã€‚" â€”â€” è¿™æ˜¯æˆ‘åœ¨æµ‹è¯•ä¸­å­¦åˆ°çš„æœ€é‡è¦çš„ä¸€è¯¾ã€‚
:::

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å¸¦å¤§å®¶æ·±å…¥äº†è§£å¦‚ä½•åœ¨Jetpack Composeåº”ç”¨ä¸­è¿›è¡Œå…¨é¢çš„UIæµ‹è¯•ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§æŠ€å·§ï¼Œå¸®åŠ©ä½ æ„å»ºæ›´åŠ å¯é çš„ç°ä»£Androidåº”ç”¨ã€‚

## Composeæµ‹è¯•åŸºç¡€

### ä¸ºä»€ä¹ˆComposeæµ‹è¯•å¦‚æ­¤é‡è¦ï¼Ÿ

ä¸ä¼ ç»ŸViewç³»ç»Ÿä¸åŒï¼ŒComposeçš„å£°æ˜å¼UIèŒƒå¼å¸¦æ¥äº†å…¨æ–°çš„æµ‹è¯•æ–¹å¼ã€‚åœ¨Composeä¸­ï¼ŒUIæ˜¯çŠ¶æ€çš„å‡½æ•°å¼è¡¨ç¤ºï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ›´ç›´æ¥åœ°æµ‹è¯•UIçš„è¡Œä¸ºã€‚

ğŸ— **Composeæµ‹è¯•çš„æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **çŠ¶æ€é©±åŠ¨æµ‹è¯•**ï¼šç”±äºUIæ˜¯çŠ¶æ€çš„å‡½æ•°å¼è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜çŠ¶æ€æ¥éªŒè¯UIå˜åŒ–
- **ç¡®å®šæ€§æµ‹è¯•**ï¼šæ²¡æœ‰å¤æ‚çš„è§†å›¾å±‚æ¬¡ç»“æ„ï¼Œæµ‹è¯•æ›´åŠ ç›´æ¥å’Œå¯é¢„æµ‹
- **å¿«é€Ÿåé¦ˆ**ï¼šå•å…ƒæµ‹è¯•å¯ä»¥å¿«é€Ÿè¿è¡Œï¼Œæä¾›å³æ—¶åé¦ˆ

### æµ‹è¯•ç¯å¢ƒè®¾ç½®

è¦å¼€å§‹Composeæµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼š

```kotlin
// testImplementation
androidx.compose.ui:ui-test-junit4:1.5.0
androidx.compose.ui:ui-test-manifest:1.5.0
androidx.compose.material:material:1.5.0
```

åŒæ—¶ï¼Œç¡®ä¿åœ¨AndroidManifest.xmlä¸­æ·»åŠ æµ‹è¯•å·¥å…·ï¼š

```xml
<instrumentation
    android:name="androidx.test.runner.AndroidJUnitRunner"
    android:targetPackage="your.package.name" />
```

## åŸºç¡€UIæµ‹è¯•

### Composeæµ‹è¯•è§„åˆ™

åœ¨Composeæµ‹è¯•ä¸­ï¼Œ`createComposeRule`æ˜¯æœ€å¸¸ç”¨çš„æµ‹è¯•è§„åˆ™ï¼Œå®ƒæä¾›äº†ä¸Composeäº¤äº’çš„èƒ½åŠ›ï¼š

```kotlin
@get:Rule
val composeTestRule = createComposeRule()

@Test
fun myTest() {
    // è®¾ç½®å†…å®¹
    composeTestRule.setContent {
        MyComposable()
    }
    
    // æ‰§è¡Œæµ‹è¯•
    // ...
}
```

### æŸ¥æ‰¾UIå…ƒç´ 

Composeæä¾›äº†å¤šç§æŸ¥æ‰¾UIå…ƒç´ çš„æ–¹æ³•ï¼š

```kotlin
// é€šè¿‡æ–‡æœ¬æŸ¥æ‰¾
composeTestRule.onNodeWithText("Hello World").assertExists()

// é€šè¿‡å†…å®¹æè¿°æŸ¥æ‰¾
composeTestRule.onNodeWithContentDescription("Save").performClick()

// é€šè¿‡èµ„æºIDæŸ¥æ‰¾
composeTestRule.onNode(hasTestTag("my_button")).performClick()

// é€šè¿‡è‡ªå®šä¹‰åŒ¹é…å™¨
composeTestRule.onNode(hasClickAction()).assertIsDisplayed()
```

::: theorem
Composeæµ‹è¯•ä¸­çš„åŒ¹é…å™¨æ˜¯ç»„åˆå¼çš„ï¼Œä½ å¯ä»¥é€šè¿‡`and()`, `or()`, `not()`ç­‰æ“ä½œç¬¦åˆ›å»ºå¤æ‚çš„åŒ¹é…æ¡ä»¶ã€‚
:::

### äº¤äº’æ“ä½œ

æµ‹è¯•ä¸ä»…ä»…æ˜¯éªŒè¯UIçš„å­˜åœ¨ï¼Œè¿˜éœ€è¦æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’ï¼š

```kotlin
// ç‚¹å‡»
composeTestRule.onNodeWithText("Click Me").performClick()

// è¾“å…¥æ–‡æœ¬
composeTestRule.onNodeWithText("Username").performTextInput("testuser")

// æ»šåŠ¨
composeTestRule.onNodeWithText("Bottom Item").performScrollTo()

// æ‹–æ‹½
composeTestRule.onNode(hasClickAction()).performTouchInput { 
    down(center)
    moveTo(centerLeft)
    up()
}
```

## é«˜çº§æµ‹è¯•æŠ€å·§

### çŠ¶æ€æµ‹è¯•

ç”±äºComposeæ˜¯çŠ¶æ€é©±åŠ¨çš„ï¼Œæµ‹è¯•çŠ¶æ€å˜åŒ–æ˜¯å…³é”®ï¼š

```kotlin
@Test
fun stateChangeTest() {
    var counter by remember { mutableStateOf(0) }
    
    composeTestRule.setContent {
        CounterButton(count = counter, onIncrement = { counter++ })
    }
    
    // åˆå§‹çŠ¶æ€
    composeTestRule.onNodeWithText("Count: 0").assertExists()
    
    // è§¦å‘çŠ¶æ€å˜åŒ–
    composeTestRule.onNodeWithText("Increment").performClick()
    
    // éªŒè¯æ–°çŠ¶æ€
    composeTestRule.onNodeWithText("Count: 1").assertExists()
}
```

### å¼‚æ­¥æ“ä½œæµ‹è¯•

åº”ç”¨ä¸­ç»å¸¸åŒ…å«å¼‚æ­¥æ“ä½œï¼Œæµ‹è¯•è¿™äº›æ“ä½œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼š

```kotlin
@Test
fun asyncOperationTest() {
    val viewModel = MyViewModel()
    
    composeTestRule.setContent {
        MyScreen(viewModel = viewModel)
    }
    
    // è§¦å‘å¼‚æ­¥æ“ä½œ
    composeTestRule.onNodeWithText("Load Data").performClick()
    
    // ç­‰å¾…åŠ è½½å®Œæˆ
    composeTestRule.waitUntil(
        condition = { viewModel.isLoading.value == false },
        timeoutMillis = 5000
    )
    
    // éªŒè¯ç»“æœ
    composeTestRule.onNodeWithText("Data Loaded").assertExists()
}
```

### æµ‹è¯•å¯¼èˆª

åœ¨å¯¼èˆªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦éªŒè¯å¯¼èˆªé€»è¾‘æ˜¯å¦æ­£ç¡®ï¼š

```kotlin
@Test
fun navigationTest() {
    val navController = NavHostController(LocalContext.current)
    
    composeTestRule.setContent {
        MyApp(navController = navController)
    }
    
    // éªŒè¯åˆå§‹å±å¹•
    composeTestRule.onNodeWithText("Home").assertExists()
    
    // è§¦å‘å¯¼èˆª
    composeTestRule.onNodeWithText("Go to Details").performClick()
    
    // éªŒè¯å¯¼èˆªç»“æœ
    composeTestRule.onNodeWithText("Details Screen").assertExists()
}
```

## æµ‹è¯•æœ€ä½³å®è·µ

### æµ‹è¯•é‡‘å­—å¡”

::: right
"æµ‹è¯•åº”è¯¥åƒé‡‘å­—å¡”ä¸€æ ·ï¼Œæœ‰å¤§é‡çš„å•å…ƒæµ‹è¯•ï¼Œé€‚é‡çš„é›†æˆæµ‹è¯•ï¼Œå°‘é‡çš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚"
:::

åœ¨Composeåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥éµå¾ªæµ‹è¯•é‡‘å­—å¡”åŸåˆ™ï¼š

1. **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•å•ä¸ªå¯ç»„åˆå‡½æ•°ï¼Œä¸ä¾èµ–Androidæ¡†æ¶
2. **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•å¤šä¸ªå¯ç»„åˆå‡½æ•°çš„äº¤äº’
3. **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šæµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹

### æµ‹è¯•å‘½åçº¦å®š

è‰¯å¥½çš„æµ‹è¯•å‘½åå¯ä»¥æé«˜ä»£ç å¯è¯»æ€§ï¼š

```kotlin
@Test
fun `when user clicks button then counter should increment`() {
    // æµ‹è¯•å®ç°
}
```

### æµ‹è¯•æ•°æ®ç®¡ç†

ä½¿ç”¨æµ‹è¯•æ•°æ®æ„å»ºå™¨æ¨¡å¼æ¥åˆ›å»ºæµ‹è¯•æ•°æ®ï¼š

```kotlin
data class User(val id: Int, val name: String, val email: String)

class UserBuilder {
    private var id = 1
    private var name = "Test User"
    private var email = "test@example.com"
    
    fun withId(id: Int) = apply { this.id = id }
    fun withName(name: String) = apply { this.name = name }
    fun withEmail(email: String) = apply { this.email = email }
    
    fun build() = User(id, name, email)
}

// ä½¿ç”¨
val user = UserBuilder()
    .withId(42)
    .withName("Jorgen")
    .withEmail("jorgen@example.com")
    .build()
```

## å®æˆ˜æ¡ˆä¾‹ï¼šæµ‹è¯•ç™»å½•å±å¹•

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…çš„ç™»å½•å±å¹•æµ‹è¯•æ¡ˆä¾‹æ¥å±•ç¤ºå¦‚ä½•åº”ç”¨ä¸Šè¿°æŠ€å·§ï¼š

```kotlin
@Test
fun `when user enters valid credentials then login should succeed`() {
    // åˆ›å»ºæµ‹è¯•æ•°æ®
    val validUsername = "testuser"
    val validPassword = "password123"
    val loginResult = mutableStateOf<LoginResult?>(null)
    
    // è®¾ç½®å†…å®¹
    composeTestRule.setContent {
        LoginScreen(
            onLoginResult = { result -> loginResult.value = result }
        )
    }
    
    // è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
    composeTestRule.onNodeWithText("Username").performTextInput(validUsername)
    composeTestRule.onNodeWithText("Password").performTextInput(validPassword)
    
    // ç‚¹å‡»ç™»å½•æŒ‰é’®
    composeTestRule.onNodeWithText("Login").performClick()
    
    // éªŒè¯ç™»å½•ç»“æœ
    composeTestRule.waitUntil(
        condition = { loginResult.value != null },
        timeoutMillis = 2000
    )
    
    // éªŒè¯æˆåŠŸçŠ¶æ€
    assertEquals(LoginResult.Success, loginResult.value)
}
```

## æµ‹è¯•å·¥å…·ä¸èµ„æº

### å¸¸ç”¨æµ‹è¯•å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| `composeTestRule` | æä¾›ä¸Composeäº¤äº’çš„åŸºæœ¬API |
| `onNode()` | æŸ¥æ‰¾UIå…ƒç´  |
| `performClick()` | æ¨¡æ‹Ÿç‚¹å‡»æ“ä½œ |
| `performTextInput()` | æ¨¡æ‹Ÿæ–‡æœ¬è¾“å…¥ |
| `waitUntil()` | ç­‰å¾…æ¡ä»¶æ»¡è¶³ |
| `assertExists()` | éªŒè¯å…ƒç´ å­˜åœ¨ |

### æµ‹è¯•èµ„æºç®¡ç†

åœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç®¡ç†æµ‹è¯•èµ„æºï¼š

```kotlin
// æµ‹è¯•èµ„æºç›®å½•
src/androidTest/res/drawable/test_icon.png
src/androidTest/res/values/test_strings.xml

// åœ¨æµ‹è¯•ä¸­ä½¿ç”¨
val testIcon = drawableResource(R.drawable.test_icon)
val testString = stringResource(R.string.test_message)
```

## ç»“è¯­

ğŸš€ é€šè¿‡ä»Šå¤©çš„åˆ†äº«ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶å¯¹Jetpack Composeçš„UIæµ‹è¯•æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚æµ‹è¯•ä¸ä»…ä»…æ˜¯ä¿è¯ä»£ç è´¨é‡çš„æ‰‹æ®µï¼Œæ›´æ˜¯æˆ‘ä»¬ç†è§£åº”ç”¨è¡Œä¸ºã€å‘ç°æ½œåœ¨é—®é¢˜çš„é‡è¦å·¥å…·ã€‚

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘å»ºè®®å°†æµ‹è¯•ä½œä¸ºå¼€å‘æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯äº‹åæ·»åŠ ã€‚è‰¯å¥½çš„æµ‹è¯•ä¹ æƒ¯å¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆç‡ï¼Œå‡å°‘è°ƒè¯•æ—¶é—´ï¼Œå¹¶æœ€ç»ˆäº¤ä»˜æ›´åŠ å¯é çš„åº”ç”¨ã€‚

> "æµ‹è¯•ä¸æ˜¯éªŒè¯ä»£ç æ˜¯å¦æ­£ç¡®ï¼Œè€Œæ˜¯éªŒè¯ä»£ç æ˜¯å¦æŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„æ–¹å¼å·¥ä½œã€‚" â€”â€” è¿™å¥è¯å€¼å¾—æˆ‘ä»¬æ¯ä¸€ä½å¼€å‘è€…é“­è®°ã€‚

æœªæ¥ï¼Œéšç€Composeçš„ä¸æ–­å‘å±•å’Œå®Œå–„ï¼Œæµ‹è¯•å·¥å…·å’Œæ–¹æ³•ä¹Ÿä¼šå˜å¾—æ›´åŠ ä¸°å¯Œã€‚è®©æˆ‘ä»¬ä¸€èµ·æ‹¥æŠ±æµ‹è¯•ï¼Œæ„å»ºæ›´åŠ å¯é å’Œç°ä»£çš„Androidåº”ç”¨ï¼

å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµã€‚åˆ«å¿˜äº†ç‚¹èµå’Œå…³æ³¨ï¼Œè·å–æ›´å¤šAndroidå¼€å‘å¹²è´§ï¼ğŸ˜‰