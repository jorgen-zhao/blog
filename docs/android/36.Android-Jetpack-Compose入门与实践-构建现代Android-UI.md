```yaml
---
title: Android Jetpack Composeå…¥é—¨ä¸å®è·µ - æ„å»ºç°ä»£Android UI
date: 2023-11-15 10:00:00
categories: 
  - Android
tags:
  - Jetpack Compose
  - Android UI
  - å£°æ˜å¼UI
  - ç°ä»£ Android å¼€å‘
author: 
  name: Jorgen
  link: https://github.com/jorgen-zhao
---
## å‰è¨€

ä½œä¸ºä¸€åAndroidå¼€å‘è€…ï¼Œä½ æ˜¯å¦æ›¾ç»è¢«XMLå¸ƒå±€çš„ç¹çå’Œå¤æ‚æ€§æ‰€å›°æ‰°ï¼Ÿæ˜¯å¦åŒå€¦äº†findViewByIdå’Œé¢‘ç¹çš„UIæ›´æ–°æ“ä½œï¼ŸğŸ¤” 

å¥½æ¶ˆæ¯æ˜¯ï¼ŒGoogleæ¨å‡ºäº†Jetpack Composeï¼Œè¿™æ˜¯ä¸€å¥—ç°ä»£åŒ–çš„Android UIå·¥å…·åŒ…ï¼Œå®ƒé‡‡ç”¨å£°æ˜å¼ç¼–ç¨‹èŒƒå¼ï¼Œå½»åº•æ”¹å˜äº†æˆ‘ä»¬æ„å»ºç”¨æˆ·ç•Œé¢çš„æ–¹å¼ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å¸¦ä½ èµ°è¿›Jetpack Composeçš„ä¸–ç•Œï¼Œä»å…¥é—¨åˆ°å®è·µï¼Œä¸€èµ·æ¢ç´¢æ„å»ºç°ä»£Android UIçš„æ–°æ–¹å¼ï¼

::: tip
"Composeä¸æ˜¯è¦å–ä»£Viewç³»ç»Ÿï¼Œè€Œæ˜¯æä¾›ä¸€ç§æ›´ç°ä»£ã€æ›´é«˜æ•ˆçš„æ–¹å¼æ¥æ„å»ºAndroid UIã€‚å®ƒå°†ä¸ç°æœ‰çš„Viewç³»ç»Ÿå…±å­˜ï¼Œå¹¶é€æ¸æˆä¸ºAndroid UIå¼€å‘çš„ä¸»æµé€‰æ‹©ã€‚"
:::

## ä»€ä¹ˆæ˜¯Jetpack Composeï¼Ÿ

Jetpack Composeæ˜¯Googleæ¨å‡ºçš„ä¸€ä¸ªç°ä»£åŒ–çš„Android UIå·¥å…·åŒ…ï¼Œå®ƒä½¿ç”¨å£°æ˜å¼ç¼–ç¨‹èŒƒå¼æ¥æ„å»ºåŸç”ŸUIã€‚ä¸ä¼ ç»Ÿçš„å‘½ä»¤å¼UIç¼–ç¨‹ä¸åŒï¼ŒComposeå…è®¸ä½ é€šè¿‡æè¿°UIåœ¨ç‰¹å®šçŠ¶æ€ä¸‹çš„å¤–è§‚æ¥æ„å»ºç•Œé¢ï¼Œè€Œä¸æ˜¯é€šè¿‡å‘½ä»¤å¼åœ°æ“ä½œUIå…ƒç´ ã€‚

### å£°æ˜å¼UI vs å‘½ä»¤å¼UI

**å‘½ä»¤å¼UIï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰**ï¼š
```kotlin
// éœ€è¦æ‰‹åŠ¨æ“ä½œUIå…ƒç´ 
val textView = findViewById<TextView>(R.id.my_text)
textView.text = "Hello World"
textView.setTextColor(Color.RED)
```

**å£°æ˜å¼UIï¼ˆComposeæ–¹å¼ï¼‰**ï¼š
```kotlin
// åªéœ€æè¿°UIåœ¨ç‰¹å®šçŠ¶æ€ä¸‹çš„å¤–è§‚
Text(
    text = "Hello World",
    color = Color.Red
)
```

### Composeçš„ä¼˜åŠ¿

1. **æ›´å°‘çš„ä»£ç **ï¼šå‡å°‘æ ·æ¿ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡
2. **ç›´è§‚çš„çŠ¶æ€ç®¡ç†**ï¼šçŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘UIæ›´æ–°
3. **å¼ºå¤§çš„å·¥å…·æ”¯æŒ**ï¼šå®æ—¶é¢„è§ˆã€çƒ­é‡è½½ç­‰åŠŸèƒ½
4. **ä¸Kotlinå®Œç¾èåˆ**ï¼šå……åˆ†åˆ©ç”¨Kotlinçš„è¯­è¨€ç‰¹æ€§
5. **ç»Ÿä¸€çš„è®¾è®¡ç³»ç»Ÿ**ï¼šMaterial Design 3æ”¯æŒ

## ç¯å¢ƒæ­å»º

è¦å¼€å§‹ä½¿ç”¨Jetpack Composeï¼Œé¦–å…ˆéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ç›¸å…³ä¾èµ–ã€‚

### æ·»åŠ ä¾èµ–

åœ¨appæ¨¡å—çš„build.gradle.ktsæ–‡ä»¶ä¸­æ·»åŠ ï¼š

```kotlin
dependencies {
    // Composeæ ¸å¿ƒåº“
    implementation("androidx.compose.ui:ui:1.5.0")
    implementation("androidx.compose.material:material:1.5.0")
    implementation("androidx.compose.ui:ui-tooling-preview:1.5.0")
    
    // æ´»åŠ¨å’ŒViewModelæ”¯æŒ
    implementation("androidx.activity:activity-compose:1.7.1")
    implementation("androidx.lifecycle:lifecycle-viewmodel-compose:2.6.1")
    
    // å·¥å…·æ”¯æŒ
    debugImplementation("androidx.compose.ui:ui-tooling:1.5.0")
}
```

### é…ç½®AndroidManifest.xml

ç¡®ä¿Activityä½¿ç”¨`ComponentActivity`ï¼š

```xml
<activity
    android:name=".MainActivity"
    android:exported="true"
    android:theme="@style/Theme.MyApplication">
    <intent-filter>
        <action android:name="android.intent.action.MAIN" />
        <category android:name="android.intent.category.LAUNCHER" />
    </intent-filter>
</activity>
```

### å¯ç”¨Compose

åœ¨MainActivityä¸­è®¾ç½®Composeå†…å®¹ï¼š

```kotlin
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            MyApplicationTheme {
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    Greeting(name = "Android")
                }
            }
        }
    }
}
```

## åŸºç¡€UIç»„ä»¶

Composeæä¾›äº†ä¸°å¯Œçš„UIç»„ä»¶ï¼Œè®©æˆ‘ä»¬ä»æœ€åŸºç¡€çš„å¼€å§‹å­¦ä¹ ã€‚

### Textç»„ä»¶

```kotlin
Text(
    text = "Hello Compose!",
    color = Color.Blue,
    fontSize = 24.sp,
    fontWeight = FontWeight.Bold,
    modifier = Modifier.padding(16.dp)
)
```

### Buttonç»„ä»¶

```kotlin
Button(
    onClick = {
        // æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        Log.d("Compose", "Button clicked!")
    },
    colors = ButtonDefaults.buttonColors(
        containerColor = MaterialTheme.colorScheme.primary,
        contentColor = Color.White
    )
) {
    Text(text = "Click Me")
}
```

### Imageç»„ä»¶

```kotlin
Image(
    painter = painterResource(id = R.drawable.ic_launcher_foreground),
    contentDescription = "App Logo",
    modifier = Modifier.size(100.dp),
    contentScale = ContentScale.Crop
)
```

### Columnã€Rowå’ŒBox

è¿™äº›æ˜¯Composeä¸­æœ€åŸºç¡€çš„å¸ƒå±€ç»„ä»¶ï¼š

```kotlin
Column(
    modifier = Modifier.fillMaxSize(),
    verticalArrangement = Arrangement.Center,
    horizontalAlignment = Alignment.CenterHorizontally
) {
    Text("Item 1")
    Text("Item 2")
    Text("Item 3")
}

Row(
    modifier = Modifier.fillMaxWidth(),
    horizontalArrangement = Arrangement.SpaceEvenly,
    verticalAlignment = Alignment.CenterVertically
) {
    Text("Left")
    Text("Center")
    Text("Right")
}

Box(
    modifier = Modifier.size(200.dp),
    contentAlignment = Alignment.Center
) {
    Text("I'm in a Box")
}
```

## çŠ¶æ€ç®¡ç†

çŠ¶æ€ç®¡ç†æ˜¯Composeçš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚åœ¨Composeä¸­ï¼Œå½“çŠ¶æ€æ”¹å˜æ—¶ï¼ŒUIä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ã€‚

### rememberå’ŒmutableStateOf

```kotlin
@Composable
fun Counter() {
    var count by remember { mutableStateOf(0) }
    
    Column(
        modifier = Modifier.fillMaxSize(),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text(text = "Count: $count")
        
        Button(onClick = { count++ }) {
            Text("Increment")
        }
    }
}
```

### collectAsState

å¯¹äºFlowï¼Œå¯ä»¥ä½¿ç”¨`collectAsState`æ¥æ”¶é›†çŠ¶æ€ï¼š

```kotlin
@Composable
fun UserProfile(userId: String) {
    val user by viewModel.getUser(userId).collectAsState()
    
    if (user == null) {
        CircularProgressIndicator()
    } else {
        Text(text = "Welcome, ${user.name}!")
    }
}
```

### rememberSaveable

`remember`åªåœ¨ç»„åˆæœŸé—´ä¿æŒçŠ¶æ€ï¼Œè€Œ`rememberSaveable`ä¼šåœ¨é…ç½®æ›´æ”¹æ—¶ä¿æŒçŠ¶æ€ï¼š

```kotlin
@Composable
fun RememberSaveableExample() {
    var text by rememberSaveable { mutableStateOf("") }
    
    TextField(
        value = text,
        onValueChange = { text = it },
        label = { Text("Enter text") }
    )
}
```

## å¸ƒå±€ç³»ç»Ÿ

Composeçš„å¸ƒå±€ç³»ç»Ÿçµæ´»è€Œå¼ºå¤§ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€äº›é«˜çº§å¸ƒå±€æŠ€å·§ã€‚

### ConstraintLayout

ç±»ä¼¼äºä¼ ç»ŸAndroidçš„ConstraintLayoutï¼ŒComposeä¹Ÿæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼š

```kotlin
ConstraintLayout(
    modifier = Modifier.fillMaxSize()
) {
    val (button, text) = createRefs()
    
    Button(
        onClick = { /* Do something */ },
        modifier = Modifier.constrainAs(button) {
            top.linkTo(parent.top, margin = 16.dp)
            start.linkTo(parent.start, margin = 16.dp)
        }
    ) {
        Text("Button")
    }
    
    Text(
        text = "Hello ConstraintLayout",
        modifier = Modifier.constrainAs(text) {
            top.linkTo(button.bottom, margin = 16.dp)
            start.linkTo(button.start)
            end.linkTo(button.end)
        }
    )
}
```

### LazyColumnå’ŒLazyRow

ç”¨äºé«˜æ•ˆæ˜¾ç¤ºé•¿åˆ—è¡¨ï¼š

```kotlin
LazyColumn(
    modifier = Modifier.fillMaxSize(),
    contentPadding = PaddingValues(16.dp),
    verticalArrangement = Arrangement.spacedBy(8.dp)
) {
    items(100) { index ->
        Card(
            modifier = Modifier.fillMaxWidth(),
            elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)
        ) {
            Text(
                text = "Item #$index",
                modifier = Modifier.padding(16.dp)
            )
        }
    }
}
```

### è‡ªå®šä¹‰å¸ƒå±€

ä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰å¸ƒå±€ï¼š

```kotlin
@Composable
fun StaggeredGrid(
    modifier: Modifier = Modifier,
    rows: Int = 3,
    content: @Composable () -> Unit
) {
    Layout(
        modifier = modifier,
        content = content
    ) { measurables, constraints ->
        // æµ‹é‡å’Œå¸ƒå±€é€»è¾‘
        // ...
    }
}
```

## ä¸»é¢˜å’Œæ ·å¼

Composeæä¾›äº†å¼ºå¤§çš„ä¸»é¢˜ç³»ç»Ÿï¼Œå¯ä»¥è½»æ¾è‡ªå®šä¹‰åº”ç”¨çš„å¤–è§‚ã€‚

### å®šä¹‰ä¸»é¢˜

```kotlin
@Composable
fun MyApplicationTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    content: @Composable () -> Unit
) {
    val colorScheme = if (darkTheme) {
        DarkColorScheme
    } else {
        LightColorScheme
    }
    
    MaterialTheme(
        colorScheme = colorScheme,
        typography = Typography(),
        shapes = Shapes(),
        content = content
    )
}
```

### è‡ªå®šä¹‰é¢œè‰²

```kotlin
private val LightColorScheme = lightColorScheme(
    primary = Color(0xFF6200EE),
    primaryContainer = Color(0xFFEADDFF),
    secondary = Color(0xFF03DAC5),
    background = Color(0xFFFFFBFE),
    surface = Color(0xFFFFFBFE),
    onPrimary = Color.White,
    onSecondary = Color.Black,
    onBackground = Color(xFF1C1B1F),
    onSurface = Color(xFF1C1B1F)
)
```

### è‡ªå®šä¹‰å­—ä½“

```kotlin
val Typography = Typography(
    bodyLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 16.sp,
        lineHeight = 24.sp,
        letterSpacing = 0.5.sp
    ),
    titleLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 22.sp,
        lineHeight = 28.sp,
        letterSpacing = 0.sp
    )
)
```

## å®æˆ˜æ¡ˆä¾‹ï¼šå¤©æ°”åº”ç”¨

è®©æˆ‘ä»¬é€šè¿‡æ„å»ºä¸€ä¸ªç®€å•çš„å¤©æ°”åº”ç”¨æ¥å®è·µComposeçš„çŸ¥è¯†ã€‚

### å®šä¹‰æ•°æ®æ¨¡å‹

```kotlin
data class WeatherInfo(
    val city: String,
    val temperature: Int,
    val description: String,
    val icon: String
)
```

### åˆ›å»ºWeatherCardç»„ä»¶

```kotlin
@Composable
fun WeatherCard(
    weather: WeatherInfo,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Text(
                text = weather.city,
                style = MaterialTheme.typography.headlineMedium
            )
            
            Image(
                painter = painterResource(id = getWeatherIcon(weather.icon)),
                contentDescription = weather.description,
                modifier = Modifier.size(64.dp)
            )
            
            Text(
                text = "${weather.temperature}Â°C",
                style = MaterialTheme.typography.displayLarge
            )
            
            Text(
                text = weather.description,
                style = MaterialTheme.typography.bodyLarge
            )
        }
    }
}

private fun getWeatherIcon(iconName: String): Int {
    return when (iconName) {
        "sunny" -> R.drawable.ic_sunny
        "cloudy" -> R.drawable.ic_cloudy
        "rainy" -> R.drawable.ic_rainy
        else -> R.drawable.ic_default
    }
}
```

### åˆ›å»ºä¸»å±å¹•

```kotlin
@Composable
fun WeatherScreen(
    viewModel: WeatherViewModel = viewModel()
) {
    val weather by viewModel.weather.collectAsState()
    val isLoading by viewModel.isLoading.collectAsState()
    val error by viewModel.error.collectAsState()
    
    LaunchedEffect(Unit) {
        viewModel.loadWeather("Beijing")
    }
    
    Box(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp)
    ) {
        when {
            isLoading -> CircularProgressIndicator(
                modifier = Modifier.align(Alignment.Center)
            )
            error != null -> Text(
                text = "Error: $error",
                color = Color.Red,
                modifier = Modifier.align(Alignment.Center)
            )
            weather != null -> WeatherCard(
                weather = weather!!,
                modifier = Modifier.align(Alignment.Center)
            )
        }
    }
}
```

### ViewModelå®ç°

```kotlin
class WeatherViewModel : ViewModel() {
    private val _weather = MutableStateFlow<WeatherInfo?>(null)
    val weather: StateFlow<WeatherInfo?> = _weather
    
    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading
    
    private val _error = MutableStateFlow<String?>(null)
    val error: StateFlow<String?> = _error
    
    fun loadWeather(city: String) {
        viewModelScope.launch {
            _isLoading.value = true
            _error.value = null
            
            try {
                // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
                delay(1000)
                
                // æ¨¡æ‹ŸæˆåŠŸå“åº”
                _weather.value = WeatherInfo(
                    city = city,
                    temperature = 22,
                    description = "Sunny",
                    icon = "sunny"
                )
            } catch (e: Exception) {
                _error.value = e.message
            } finally {
                _isLoading.value = false
            }
        }
    }
}
```

## æ€»ç»“ä¸å±•æœ›

é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬äº†è§£äº†Jetpack Composeçš„åŸºç¡€çŸ¥è¯†å’Œå®è·µæŠ€å·§ã€‚ä»ç¯å¢ƒæ­å»ºåˆ°åŸºç¡€UIç»„ä»¶ï¼Œä»çŠ¶æ€ç®¡ç†åˆ°å¸ƒå±€ç³»ç»Ÿï¼Œå†åˆ°ä¸»é¢˜å®šåˆ¶å’Œå®æˆ˜æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥èµ°è¿›äº†Composeçš„ä¸–ç•Œã€‚

::: theorem
Composeçš„æ ¸å¿ƒæ€æƒ³æ˜¯"å£°æ˜å¼UI"ï¼Œå³é€šè¿‡æè¿°UIåœ¨ç‰¹å®šçŠ¶æ€ä¸‹çš„å¤–è§‚æ¥æ„å»ºç•Œé¢ï¼Œè€Œä¸æ˜¯é€šè¿‡å‘½ä»¤å¼åœ°æ“ä½œUIå…ƒç´ ã€‚è¿™ç§èŒƒå¼ä½¿å¾—ä»£ç æ›´ç®€æ´ã€æ›´æ˜“äºç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿæ›´ç¬¦åˆç°ä»£è½¯ä»¶å¼€å‘çš„ç†å¿µã€‚
:::

> "Jetpack Composeä¸ä»…ä»…æ˜¯ä¸€ä¸ªUIå·¥å…·ï¼Œå®ƒä»£è¡¨äº†Androidå¼€å‘çš„æœªæ¥æ–¹å‘ã€‚éšç€Composeçš„ä¸æ–­æˆç†Ÿå’Œå®Œå–„ï¼Œå®ƒå°†æˆä¸ºAndroidå¼€å‘ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚"

å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œç°åœ¨æ­£æ˜¯å­¦ä¹ Composeçš„æœ€ä½³æ—¶æœºã€‚è™½ç„¶Viewç³»ç»Ÿä»ç„¶ä¼šå­˜åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œä½†Composeå·²ç»æˆä¸ºAndroidå¼€å‘çš„é‡è¦è¶‹åŠ¿ã€‚æŒæ¡Composeï¼Œä¸ä»…èƒ½æé«˜å¼€å‘æ•ˆç‡ï¼Œè¿˜èƒ½è®©ä½ åœ¨æœªæ¥çš„Androidå¼€å‘ä¸­ä¿æŒç«äº‰åŠ›ã€‚

## æœªæ¥å±•æœ›

Jetpack Composeä»åœ¨å¿«é€Ÿå‘å±•ä¸­ï¼Œæœªæ¥æˆ‘ä»¬å¯ä»¥æœŸå¾…ï¼š

1. **æ›´ä¸°å¯Œçš„ç»„ä»¶åº“**ï¼šæ›´å¤šé¢„å®šä¹‰çš„ç»„ä»¶å’Œå¸ƒå±€
2. **æ›´å¥½çš„æ€§èƒ½**ï¼šæ›´é«˜æ•ˆçš„æ¸²æŸ“æœºåˆ¶
3. **æ›´å¼ºå¤§çš„å·¥å…·æ”¯æŒ**ï¼šæ›´å¥½çš„IDEé›†æˆå’Œè°ƒè¯•å·¥å…·
4. **è·¨å¹³å°æ”¯æŒ**ï¼šComposeå¯èƒ½æ‰©å±•åˆ°iOSã€Webå’Œæ¡Œé¢å¹³å°
5. **ä¸Kotlin Multiplatformçš„æ·±åº¦é›†æˆ**ï¼šå®ç°çœŸæ­£çš„è·¨å¹³å°UIå¼€å‘

è®©æˆ‘ä»¬ä¸€èµ·æ‹¥æŠ±Composeï¼Œæ„å»ºæ›´ç¾å¥½çš„Androidåº”ç”¨å§ï¼ğŸš€

---

å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½å¸®åŠ©ä½ å…¥é—¨Jetpack Composeï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚ğŸ‘‡